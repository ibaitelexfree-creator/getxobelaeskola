services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_SUPABASE_URL: ${NEXT_PUBLIC_SUPABASE_URL}
        NEXT_PUBLIC_SUPABASE_ANON_KEY: ${NEXT_PUBLIC_SUPABASE_ANON_KEY}
        SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
        STRIPE_SECRET_KEY: ${STRIPE_SECRET_KEY}
        NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: ${NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY}
        NEXT_PUBLIC_APP_URL: ${NEXT_PUBLIC_APP_URL}
        GOOGLE_CALENDAR_ID: ${GOOGLE_CALENDAR_ID}
        GOOGLE_SERVICE_ACCOUNT_EMAIL: ${GOOGLE_SERVICE_ACCOUNT_EMAIL}
        GOOGLE_PRIVATE_KEY: ${GOOGLE_PRIVATE_KEY}
        STRIPE_WEBHOOK_SECRET: ${STRIPE_WEBHOOK_SECRET}
        RESEND_API_KEY: ${RESEND_API_KEY}
    image: ${DOCKER_IMAGE:-getxo-web:latest}
    container_name: getxo-web
    restart: always
    expose:
      - "3000"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.getxo.rule=Host(`getxobelaeskola.cloud`) || Host(`www.getxobelaeskola.cloud`)"
      - "traefik.http.routers.getxo.entrypoints=websecure"
      - "traefik.http.routers.getxo.tls.certresolver=mytlschallenge"
      - "traefik.http.services.getxo.loadbalancer.server.port=3000"
    env_file:
      - .env
    networks:
      - n8n_default

networks:
  n8n_default:
    external: true
