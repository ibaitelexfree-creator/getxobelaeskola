(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`3315ec8c-f8a1-48a9-8ecc-a83d5029f2f3`,e._sentryDebugIdIdentifier=`sentry-dbid-3315ec8c-f8a1-48a9-8ecc-a83d5029f2f3`)})()}catch{}import{C as e,Cn as t,D as n,E as r,Gt as i,It as a,L as o,M as s,P as c,Pt as l,T as u,Z as d,_ as f,_t as p,bt as m,et as h,h as g,it as _,j as v,ot as y,q as b,vn as x,vt as S,w as C}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{bt as w,yt as T}from"./_MapCache-DjbOQyB7.js";import{At as E,Ci as D,Et as O,Hi as k,Oi as A,Tt as j,Ui as M,Vi as N,_t as P,gi as F,wi as I,zi as L}from"./src-CppJvwzX.js";import{t as R}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{Dr as z,Rr as ee,r as te,t as ne,ws as re,yr as ie,zt as ae}from"./users.store-pCkD7Zo0.js";import{Is as oe,Ls as se,Yc as ce,qo as le,rs as B,zs as ue}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import{r as de}from"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import"./versions.store-1_eor2Ku.js";import{t as fe}from"./usePageRedirectionHelper-BoF8hzbN.js";import"./executions.store-DnLtKXBA.js";import"./pushConnection.store-IFO3HVvG.js";import"./collaboration.store-QKYwE2H2.js";import{i as V,n as H,r as U,t as W}from"./utils-B9GTX8VZ.js";import{t as pe}from"./useWorkflowActivate-CpGKv5Cd.js";import{t as G}from"./WorkflowPreview-CJf5czT0.js";import{t as K}from"./useIntersectionObserver-CdOhbl0L.js";var q={key:0},me={key:1},J=R(c({__name:`WorkflowHistoryListItem`,props:{item:{},index:{},actions:{},isSelected:{type:Boolean,default:!1},isVersionActive:{type:Boolean,default:!1},isGrouped:{type:Boolean,default:!1}},emits:[`action`,`preview`,`mounted`],setup(o,{emit:c}){let l=o,p=c,_=T(),y=ne(),b=a(!1),S=a(null),w=e(()=>{let{date:e,time:t}=H(l.item.createdAt);return _.baseText(`workflowHistory.item.createdAt`,{interpolate:{date:e,time:t}})}),E=e(()=>{let e=l.item.authors.split(`, `),t=e[0];return e.length>1&&(t=`${t} + ${e.length-1}`),{size:e.length,label:t}}),D=e(()=>l.item.name?l.item.name:l.isVersionActive?U(l.item.versionId):``),O=e(()=>l.isVersionActive&&V(l.item.workflowPublishHistory)||null),k=e(()=>V(l.item.workflowPublishHistory)),M=e=>{if(!e)return null;let t=y.usersById[e];return t?.fullName??t?.email??null},P=e(()=>l.isGrouped?null:l.isVersionActive?M(O.value?.userId)?_.baseText(`workflowHistory.item.publishedBy`):_.baseText(`workflowHistory.item.active`):l.index===0&&!l.isVersionActive?_.baseText(`workflowHistory.item.currentChanges`):k.value?M(k.value?.userId)?_.baseText(`workflowHistory.item.publishedBy`):_.baseText(`workflowHistory.item.active`):w.value),F=e(()=>l.isGrouped?null:l.isVersionActive&&O.value?O.value.createdAt:k.value?k.value.createdAt:null),I=e(()=>l.isGrouped?null:l.isVersionActive&&O.value?M(O.value.userId):k.value?M(k.value.userId):null),L=e(()=>{if(!F.value)return null;let{date:e,time:t}=H(F.value);return _.baseText(`workflowHistory.item.createdAt`,{interpolate:{date:e,time:t}})}),R=e=>{p(`action`,{action:e,id:l.item.versionId,data:{formattedCreatedAt:w.value,versionName:D.value,description:l.item.description}})},z=e=>{b.value=e},ee=e=>{p(`preview`,{event:e,id:l.item.versionId})};return d(()=>{p(`mounted`,{index:l.index,offsetTop:S.value?.offsetTop??0,isSelected:l.isSelected})}),(e,a)=>(h(),u(i(A),{placement:`left`,disabled:!P.value,"show-after":300},{content:m(()=>[l.index===0&&!l.isVersionActive?(h(),n(`div`,q,t(P.value),1)):(h(),n(`div`,me,[v(t(P.value)+` `,1),I.value?(h(),n(f,{key:0},[v(t(I.value),1)],64)):r(``,!0),L.value?(h(),n(f,{key:1},[I.value?(h(),n(f,{key:0},[v(`, `)],64)):r(``,!0),v(` `+t(L.value),1)],64)):r(``,!0)]))]),default:m(()=>[C(`li`,{ref_key:`itemElement`,ref:S,"data-test-id":`workflow-history-list-item`,role:`button`,class:x({[e.$style.item]:!0,[e.$style.selected]:l.isSelected,[e.$style.actionsVisible]:b.value,[e.$style.grouped]:l.isGrouped}),onClick:ee},[C(`span`,{class:x(e.$style.timelineColumn)},[l.isGrouped?(h(),n(`span`,{key:1,class:x(e.$style.timelineLine)},null,2)):(h(),n(f,{key:0},[l.isVersionActive?(h(),n(`span`,{key:0,class:x([e.$style.timelineDot,e.$style.timelineDotPublished])},null,2)):l.index===0&&!l.isVersionActive?(h(),n(`span`,{key:1,class:x([e.$style.timelineDot,e.$style.timelineDotLatest])},null,2)):(h(),n(`span`,{key:2,class:x([e.$style.timelineDot,e.$style.timelineDotDefault])},null,2))],64))],2),C(`div`,{class:x(e.$style.wrapper)},[C(`div`,{class:x(e.$style.content)},[D.value?(h(),n(f,{key:0},[C(`div`,{class:x(e.$style.mainRow)},[s(i(N),{size:`small`,bold:!0,color:`text-dark`,class:x(e.$style.mainLine)},{default:m(()=>[v(t(D.value),1)]),_:1},8,[`class`])],2),C(`div`,{class:x(e.$style.metaRow)},[s(i(N),{size:`small`,color:`text-base`,class:x(e.$style.metaAuthor)},{default:m(()=>[v(t(E.value.label)+`, `,1)]),_:1},8,[`class`]),s(i(N),{tag:`time`,size:`small`,color:`text-base`,class:x(e.$style.metaTime)},{default:m(()=>[v(t(w.value),1)]),_:1},8,[`class`])],2)],64)):(h(),n(`div`,{key:1,class:x(e.$style.unnamedRow)},[s(i(N),{size:`small`,color:`text-base`,class:x(e.$style.unnamedAuthor)},{default:m(()=>[v(t(E.value.label)+`, `,1)]),_:1},8,[`class`]),s(i(N),{tag:`time`,size:`small`,color:`text-base`,class:x(e.$style.unnamedTime)},{default:m(()=>[v(t(w.value),1)]),_:1},8,[`class`])],2))],2),s(i(j),{class:x(e.$style.actions),actions:l.actions,placement:`bottom-end`,onAction:R,onClick:a[0]||=g(()=>{},[`stop`]),onVisibleChange:z},null,8,[`class`,`actions`])],2)],2)]),_:1},8,[`disabled`]))}}),[[`__cssModules`,{$style:{item:`_item_t6iqo_125`,grouped:`_grouped_t6iqo_136`,selected:`_selected_t6iqo_136`,wrapper:`_wrapper_t6iqo_154`,timelineColumn:`_timelineColumn_t6iqo_168`,timelineDot:`_timelineDot_t6iqo_179`,timelineDotPublished:`_timelineDotPublished_t6iqo_186`,timelineDotLatest:`_timelineDotLatest_t6iqo_190`,timelineDotDefault:`_timelineDotDefault_t6iqo_194`,timelineLine:`_timelineLine_t6iqo_199`,content:`_content_t6iqo_207`,mainRow:`_mainRow_t6iqo_215`,mainLine:`_mainLine_t6iqo_221`,metaRow:`_metaRow_t6iqo_227`,metaAuthor:`_metaAuthor_t6iqo_235`,metaTime:`_metaTime_t6iqo_243`,unnamedRow:`_unnamedRow_t6iqo_248`,unnamedAuthor:`_unnamedAuthor_t6iqo_255`,unnamedTime:`_unnamedTime_t6iqo_263`,actions:`_actions_t6iqo_268`,publishedBadge:`_publishedBadge_t6iqo_275`}}]]),Y=[`aria-expanded`,`onClick`],he=[`aria-label`],X={"data-test-id":`prune-time-display`},ge=R(c({__name:`WorkflowHistoryList`,props:{items:{},selectedItem:{},actions:{},requestNumberOfItems:{},lastReceivedItemsLength:{},evaluatedPruneTimeInHours:{},shouldUpgrade:{type:Boolean},isListLoading:{type:Boolean},activeVersionId:{}},emits:[`action`,`preview`,`loadMore`,`upgrade`],setup(o,{emit:c}){let d=o,g=c,y=T(),b=a(null),S=a(null),E=a(!0),D=l(new Set),k=e(()=>W(d.items)),A=e=>{D.has(e)?D.delete(e):D.add(e)},j=e(()=>d.lastReceivedItemsLength===d.requestNumberOfItems),{observe:P}=K({root:b,threshold:.01,onIntersect:()=>{E.value=!1,g(`loadMore`,{take:d.requestNumberOfItems,skip:d.items.length})}});p([S,j,()=>d.items.length],([e,t])=>{e&&t&&P(e)},{immediate:!0});let F=(e,t)=>{let n=d.actions;return t===0&&(n=n.filter(e=>e.value!==`restore`)),n=e.versionId===d.activeVersionId?n.filter(e=>e.value!==`publish`):n.filter(e=>e.value!==`unpublish`),n},I=({action:e,id:t,data:n})=>{E.value=!1,g(`action`,{action:e,id:t,data:n})},L=({event:e,id:t})=>{E.value=!1,g(`preview`,{event:e,id:t})},R=({offsetTop:e,isSelected:t})=>{t&&E.value&&(E.value=!1,b.value?.scrollTo({top:e,behavior:`smooth`}))},z=e(()=>{let e=d.evaluatedPruneTimeInHours;if(e<24){let t=e===1?`workflowHistory.limitHour`:`workflowHistory.limitHours`;return y.baseText(t,{interpolate:{hours:String(e)}})}else{let t=Math.round(e/24),n=t===1?`workflowHistory.limitDay`:`workflowHistory.limitDays`;return y.baseText(n,{interpolate:{days:String(t)}})}});return(e,a)=>(h(),n(`ul`,{ref_key:`listElement`,ref:b,class:x(e.$style.list),"data-test-id":`workflow-history-list`},[(h(!0),n(f,null,_(k.value,a=>(h(),n(f,{key:a.type===`version`?a.item.versionId:a.groupId},[a.type===`group-header`?(h(),n(`li`,{key:0,class:x(e.$style.groupHeader),"aria-expanded":D.has(a.groupId),role:`button`,"data-test-id":`workflow-history-group-header`,onClick:e=>A(a.groupId)},[s(i(M),{class:x([e.$style.groupTimelineColumn,e.$style.groupChevron]),icon:D.has(a.groupId)?`chevron-down`:`chevron-right`,size:`small`},null,8,[`class`,`icon`]),s(i(N),{color:`text-base`,size:`small`},{default:m(()=>[v(t(i(y).baseText(`workflowHistory.group.unnamedVersions`,{adjustToNumber:a.count,interpolate:{count:String(a.count)}})),1)]),_:2},1024)],10,Y)):r(``,!0),a.type===`group-header`&&D.has(a.groupId)?(h(!0),n(f,{key:1},_(a.versions,e=>(h(),u(J,{key:e.item.versionId,index:e.originalIndex,item:e.item,"is-selected":e.item.versionId===d.selectedItem?.versionId,"is-version-active":e.item.versionId===d.activeVersionId,actions:F(e.item,e.originalIndex),"is-grouped":!0,onAction:I,onPreview:L,onMounted:R},null,8,[`index`,`item`,`is-selected`,`is-version-active`,`actions`]))),128)):r(``,!0),a.type===`version`?(h(),u(J,{key:2,index:a.originalIndex,item:a.item,"is-selected":a.item.versionId===d.selectedItem?.versionId,"is-version-active":a.item.versionId===d.activeVersionId,actions:F(a.item,a.originalIndex),onAction:I,onPreview:L,onMounted:R},null,8,[`index`,`item`,`is-selected`,`is-version-active`,`actions`])):r(``,!0)],64))),128)),d.items.length&&j.value?(h(),n(`li`,{key:0,ref_key:`loadMoreSentinel`,ref:S,class:x(e.$style.sentinel),"aria-hidden":`true`},null,2)):r(``,!0),d.isListLoading?(h(),n(`li`,{key:1,class:x(e.$style.loader),role:`status`,"aria-live":`polite`,"aria-busy":`true`,"aria-label":i(y).baseText(`generic.loading`)},[s(i(O),{rows:3,class:`mb-xs`}),s(i(O),{rows:3,class:`mb-xs`}),s(i(O),{rows:3,class:`mb-xs`})],10,he)):r(``,!0),d.shouldUpgrade?(h(),n(`li`,{key:2,class:x(e.$style.retention)},[C(`span`,X,t(z.value),1),s(i(w),{keypath:`workflowHistory.upgrade`,tag:`span`,scope:`global`},{link:m(()=>[C(`a`,{href:`#`,onClick:a[0]||=e=>g(`upgrade`)},t(i(y).baseText(`workflowHistory.upgrade.link`)),1)]),_:1})],2)):r(``,!0)],2))}}),[[`__cssModules`,{$style:{list:`_list_n49uh_125`,loader:`_loader_n49uh_135`,sentinel:`_sentinel_n49uh_139`,retention:`_retention_n49uh_143`,groupHeader:`_groupHeader_n49uh_151`,groupTimelineColumn:`_groupTimelineColumn_n49uh_170`,groupChevron:`_groupChevron_n49uh_174`}}]]),Z=200,_e=R(c({__name:`WorkflowHistoryContent`,props:{workflow:{},workflowVersion:{},actions:{},isVersionActive:{type:Boolean},isListLoading:{type:Boolean},isFirstItemShown:{type:Boolean}},emits:[`action`],setup(o,{emit:c}){let l=T(),d=o,f=c,g=e(()=>{if(!d.workflowVersion||!d.workflow)return;let{pinData:e,...t}=d.workflow;return{...t,nodes:d.workflowVersion.nodes,connections:d.workflowVersion.connections}}),_=e(()=>{if(!d.workflowVersion)return``;let{date:e,time:t}=H(d.workflowVersion.createdAt);return l.baseText(`workflowHistory.item.createdAt`,{interpolate:{date:e,time:t}})}),y=e(()=>d.workflowVersion?.name?d.workflowVersion.name:d.isVersionActive&&d.workflowVersion?U(d.workflowVersion.versionId):_.value),b=a(!1),S=e(()=>d.workflowVersion?.description??``),w=e(()=>S.value.length>Z),E=e(()=>!w.value||b.value?S.value:S.value.substring(0,Z)+`... `),D=()=>{b.value=!b.value},O=e(()=>{let e=d.actions;return d.isFirstItemShown&&(e=e.filter(e=>e.value!==`restore`)),e=d.isVersionActive?e.filter(e=>e.value!==`publish`):e.filter(e=>e.value!==`unpublish`),e}),P=e=>{d.workflowVersion&&f(`action`,{action:e,id:d.workflowVersion.versionId,data:{formattedCreatedAt:_.value,versionName:y.value,description:S.value}})};return p(()=>d.workflowVersion,()=>{b.value=!1}),(e,a)=>(h(),n(`div`,{class:x(e.$style.content)},[d.workflowVersion?(h(),u(G,{key:0,workflow:g.value,loading:d.isListLoading,"loader-type":`spinner`},null,8,[`workflow`,`loading`])):r(``,!0),d.workflowVersion?(h(),n(`div`,{key:1,class:x(e.$style.info)},[C(`div`,{class:x(e.$style.card)},[C(`div`,{class:x(e.$style.descriptionBox)},[y.value?(h(),u(i(A),{key:0,content:y.value},{default:m(()=>[s(i(N),{class:x(e.$style.mainLine),bold:``,color:`text-dark`},{default:m(()=>[v(t(y.value),1)]),_:1},8,[`class`])]),_:1},8,[`content`])):r(``,!0),S.value?(h(),u(i(N),{key:1,size:`small`,color:`text-base`},{default:m(()=>[v(t(E.value)+` `,1),w.value?(h(),u(i(F),{key:0,size:`small`,onClick:D},{default:m(()=>[v(t(b.value?i(l).baseText(`generic.showLess`):i(l).baseText(`generic.showMore`)),1)]),_:1})):r(``,!0)]),_:1})):r(``,!0)],2),s(i(j),{class:x(e.$style.actions),actions:O.value,placement:`bottom-end`,"data-test-id":`workflow-history-content-actions`,onAction:P},{default:m(()=>[s(i(k),{variant:`subtle`,size:`large`,"data-test-id":`action-toggle-button`},{default:m(()=>[v(t(i(l).baseText(`workflowHistory.content.actions`))+` `,1),s(i(M),{class:`ml-3xs`,icon:`chevron-down`,size:`small`})]),_:1})]),_:1},8,[`class`,`actions`])],2)],2)):r(``,!0)],2))}}),[[`__cssModules`,{$style:{content:`_content_1kvp7_125`,info:`_info_1kvp7_135`,card:`_card_1kvp7_143`,descriptionBox:`_descriptionBox_1kvp7_150`,mainLine:`_mainLine_1kvp7_162`,actions:`_actions_1kvp7_170`}}]]),ve={key:0},Q=R(c({__name:`WorkflowHistory`,setup(c){let l=[`restore`,`publish`,`unpublish`,`name`,`clone`,`open`,`download`],d=l.reduce((e,t)=>({...e,[t.toUpperCase()]:t}),{}),f=D(),p=I(),g=T(),_=ie(),w=fe(),O=z(),A=te(),j=ee(),M=ne(),N=re(),F=pe(),R=e(()=>N.isEnterpriseFeatureEnabled[ce.NamedVersions]),V=a(!0),H=a(!0),U=a(20),W=a(0),G=a(null),K=a([]),q=a(null),me=e(()=>l.filter(e=>!(e===`publish`&&G.value?.isArchived||e===`name`&&!R.value))),J=e(()=>xe(`workflowId`)),Y=e(()=>xe(`versionId`)),he=e(()=>({name:B.WORKFLOW,params:{name:J.value}})),X=e(()=>le(j.getWorkflowById(J.value)?.scopes).workflow),Z=e(()=>j.getWorkflowById(J.value)?.activeVersion?.versionId),Q=e(()=>me.value.map(e=>({label:g.baseText(`workflowHistory.item.actions.${e}`),disabled:e===`clone`&&!X.value.create||(e===`restore`||e===`name`)&&!X.value.update||(e===`publish`||e===`unpublish`)&&!X.value.publish,value:e}))),ye=e(()=>K.value[0]?.versionId===Y.value),$=e=>{ae.track(e,{instance_id:de().instanceId,workflow_id:J.value})},be=async e=>{let t=await O.getWorkflowHistory(J.value,e);W.value=t.length;let n=t.flatMap(e=>e.workflowPublishHistory.map(e=>e.userId)).filter(e=>!!e),r=new Set(n);await M.fetchUsers({filter:{ids:Array.from(r)}}),K.value=K.value.concat(t)};b(async()=>{$(`User opened workflow history`);try{let[e]=await Promise.all([j.fetchWorkflow(J.value),be({take:U.value})]);G.value=e,H.value=!1,!Y.value&&K.value.length&&await p.replace({name:B.WORKFLOW_HISTORY,params:{workflowId:J.value,versionId:K.value[0].versionId}})}catch(e){V.value=!1,_.showError(e,g.baseText(`workflowHistory.title`))}});let xe=e=>{let t=f.params[e];return typeof t==`string`?t:t?.[0]??``},Se=e=>{let{href:t}=p.resolve({name:B.WORKFLOW_HISTORY,params:{workflowId:J.value,versionId:e}});window.open(t,`_blank`)},Ce=async(e,t)=>{let n=await O.cloneIntoNewWorkflow(J.value,e,t),{href:r}=p.resolve({name:B.WORKFLOW,params:{name:n.id}});_.showMessage({title:g.baseText(`workflowHistory.action.clone.success.title`),message:o(`a`,{href:r,target:`_blank`},g.baseText(`workflowHistory.action.clone.success.message`)),type:`success`,duration:1e4})},we=async e=>{let t=(await j.fetchWorkflow(J.value)).versionId;if(G.value=await O.restoreWorkflow(J.value,e),G.value.versionId===t){_.showMessage({title:g.baseText(`workflowHistory.action.restore.alreadyRestored`),type:`info`});return}K.value=(await O.getWorkflowHistory(J.value,{take:1})).concat(K.value),_.showMessage({title:g.baseText(`workflowHistory.action.restore.success.title`),type:`success`})},Te=(e,t)=>{let n=P(),r=a({versionId:e,versionName:t.versionName,description:t.description,modalTitle:g.baseText(`workflows.publishModal.title`),submitButtonLabel:g.baseText(`workflows.publish`),submitting:!1,eventBus:n});n.once(`submit`,async t=>{r.value.submitting=!0;try{let{success:n}=await F.publishWorkflow(J.value,e,{name:t.name,description:t.description});if(n){G.value=j.getWorkflowById(J.value);let e=K.value.find(e=>e.versionId===t.versionId);e&&(e.name=t.name,e.description=t.description,G.value?.activeVersion?.workflowPublishHistory&&(e.workflowPublishHistory=G.value.activeVersion.workflowPublishHistory)),q.value?.versionId===t.versionId&&(q.value={...q.value,name:t.name,description:t.description,workflowPublishHistory:G.value?.activeVersion?.workflowPublishHistory??q.value.workflowPublishHistory}),$(`User published version from history`),A.closeModal(se)}}finally{r.value.submitting=!1}}),A.openModalWithData({name:se,data:r.value})},Ee=(e,t)=>{if(Z.value!==e)return;let n=P();n.once(`unpublish`,async()=>{let e=await F.unpublishWorkflowFromHistory(J.value);A.closeModal(ue),e&&(G.value=j.getWorkflowById(J.value),_.showMessage({title:g.baseText(`workflowHistory.action.unpublish.success.title`),type:`success`}),$(`User unpublished workflow from history`))}),A.openModalWithData({name:ue,data:{versionName:t.versionName,eventBus:n}})},De=async(e,t)=>{let n=P(),r=a({versionId:e,versionName:t.versionName,description:t.description,modalTitle:g.baseText(`workflowHistory.nameVersionModal.title`),submitButtonLabel:g.baseText(`workflowHistory.nameVersionModal.confirmButton`),submitting:!1,eventBus:n});n.once(`submit`,async t=>{r.value.submitting=!0;try{await O.updateWorkflowHistoryVersion(J.value,e,{name:t.name,description:t.description});let n=K.value.find(e=>e.versionId===t.versionId);n&&(n.name=t.name,n.description=t.description),q.value?.versionId===t.versionId&&(q.value={...q.value,name:t.name,description:t.description}),_.showMessage({title:g.baseText(`workflowHistory.action.nameVersion.success.title`),type:`success`}),$(`User named version from history`),A.closeModal(oe)}catch(e){_.showError(e,g.baseText(`workflowHistory.action.nameVersion.error.title`))}finally{r.value.submitting=!1}}),A.openModalWithData({name:oe,data:r.value})},Oe=async({action:e,id:t,data:n})=>{try{switch(e){case d.OPEN:Se(t),$(`User opened version in new tab`);break;case d.DOWNLOAD:await O.downloadVersion(J.value,t,n),$(`User downloaded version`);break;case d.CLONE:await Ce(t,n),$(`User cloned version`);break;case d.RESTORE:await we(t),$(`User restored version`);break;case d.PUBLISH:Te(t,n);break;case d.UNPUBLISH:Ee(t,n);break;case d.NAME:await De(t,n);break}}catch(t){_.showError(t,g.baseText(`workflowHistory.action.error.title`,{interpolate:{action:g.baseText(`workflowHistory.item.actions.${e}`).toLowerCase()}}))}},ke=async({event:e,id:t})=>{e.metaKey||e.ctrlKey?(Se(t),$(`User opened version in new tab`)):await p.push({name:B.WORKFLOW_HISTORY,params:{workflowId:J.value,versionId:t}})},Ae=()=>{w.goToUpgrade(`workflow-history`,`upgrade-workflow-history`)};return S(async()=>{if(Y.value)try{let[e,t]=await Promise.all([O.getWorkflowVersion(J.value,Y.value),j.fetchWorkflow(J.value)]);q.value=e,G.value=t,$(`User selected version`)}catch(e){e.message?.includes(`version`)?_.showError(Error(`${e.message} "${Y.value}"&nbsp;`),g.baseText(`workflowHistory.title`)):(V.value=!1,_.showError(e,g.baseText(`workflowHistory.title`)))}}),(e,a)=>{let o=y(`RouterLink`);return h(),n(`div`,{class:x(e.$style.view)},[C(`div`,{class:x(e.$style.header)},[s(i(L),{tag:`h2`,size:`medium`},{default:m(()=>[v(t(G.value?.name),1)]),_:1}),G.value?.isArchived?(h(),n(`span`,ve,[s(i(E),{class:`ml-s`,theme:`tertiary`,bold:``,"data-test-id":`workflow-archived-tag`},{default:m(()=>[v(t(i(g).baseText(`workflows.item.archived`)),1)]),_:1})])):r(``,!0)],2),C(`div`,{class:x(e.$style.corner)},[s(i(L),{tag:`h2`,size:`medium`,bold:``},{default:m(()=>[v(t(i(g).baseText(`workflowHistory.title`)),1)]),_:1}),s(o,{to:he.value,"data-test-id":`workflow-history-close-button`},{default:m(()=>[s(i(k),{variant:`ghost`,icon:`x`,size:`small`,square:``})]),_:1},8,[`to`])],2),C(`div`,{class:x(e.$style.listComponentWrapper)},[V.value?(h(),u(ge,{key:0,items:K.value,"last-received-items-length":W.value,"selected-item":q.value,actions:Q.value,"request-number-of-items":U.value,"should-upgrade":i(O).shouldUpgrade,"evaluated-prune-time-in-hours":i(O).evaluatedPruneTime,"is-list-loading":H.value,"active-version-id":Z.value,onAction:Oe,onPreview:ke,onLoadMore:be,onUpgrade:Ae},null,8,[`items`,`last-received-items-length`,`selected-item`,`actions`,`request-number-of-items`,`should-upgrade`,`evaluated-prune-time-in-hours`,`is-list-loading`,`active-version-id`])):r(``,!0)],2),C(`div`,{class:x(e.$style.contentComponentWrapper)},[V.value?(h(),u(_e,{key:0,workflow:G.value,"workflow-version":q.value,"is-version-active":q.value?.versionId===Z.value,actions:Q.value,"is-list-loading":H.value,"is-first-item-shown":ye.value,onAction:Oe},null,8,[`workflow`,`workflow-version`,`is-version-active`,`actions`,`is-list-loading`,`is-first-item-shown`])):r(``,!0)],2)],2)}}}),[[`__cssModules`,{$style:{view:`_view_q2hup_125`,header:`_header_q2hup_135`,corner:`_corner_q2hup_143`,contentComponentWrapper:`_contentComponentWrapper_q2hup_154`,listComponentWrapper:`_listComponentWrapper_q2hup_159`}}]]);export{Q as default};
//# sourceMappingURL=WorkflowHistory-C1x7wtPO.js.map