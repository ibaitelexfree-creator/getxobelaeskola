(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`ade635e0-658b-448e-be22-3b9f3d255fe1`,e._sentryDebugIdIdentifier=`sentry-dbid-ade635e0-658b-448e-be22-3b9f3d255fe1`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{C as t,Cn as n,D as r,E as i,Gt as a,It as o,M as s,P as c,T as l,Z as ee,_ as u,_t as d,bt as f,et as p,h as m,it as h,j as g,p as _,vn as v,w as y,xt as b}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as te}from"./_MapCache-DjbOQyB7.js";import{At as x,Ci as S,Oi as C,Pi as w,Tt as T,Ui as E,Vi as D,bt as ne,ft as O,ot as k,pt as A,st as j,wi as M}from"./src-CppJvwzX.js";import{t as N}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{C as re,Ft as P,Gt as F,Lt as I,Ma as L,Ti as R,Tr as z,Ua as B,Wa as ie,fn as ae,n as oe,qr as se,r as V,rt as H,t as ce,wr as le,ws as ue}from"./users.store-pCkD7Zo0.js";import{Ss as U,Yc as de,qo as W,rs as G,yo as fe}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import"./_baseOrderBy-El3qbNHQ.js";import{t as K}from"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import"./useEnvFeatureFlag-CHY3xSda.js";import{t as pe}from"./externalSecrets.ee.store-RuZGBiOy.js";import"./folders.store-CS_gIPIm.js";import"./ProjectIcon-D-HRIqn6.js";import{t as q}from"./ProjectCardBadge-dALz__Ys.js";import{t as me}from"./CredentialIcon-B1JZV04S.js";import{t as he}from"./useDynamicCredentials-BSZ25lEI.js";import"./EnterpriseEdition.ee-BF3fOBuQ.js";import{t as ge}from"./TimeAgo-BLqTSlco.js";import"./orderBy-KAUxkCYD.js";import"./ProjectSharing-DgwjJKfK.js";import{t as _e}from"./insights.store-CIIvho7C.js";import"./insights.constants-DHL43iRt.js";import"./insights.utils-B2NpOI0Q.js";import{r as ve}from"./readyToRun.store-DM7AW4os.js";import{t as ye}from"./EmptySharedSectionActionBox-BGCRJ9Jt.js";import{t as be}from"./ResourcesListLayout-Dgyw19qu.js";import"./ResourceFiltersDropdown-tUuDPU--.js";import{t as xe}from"./ProjectHeader-KFxxuu0P.js";import{t as Se}from"./InsightsSummary-8qyRMqyz.js";import{t as J}from"./pickBy-D_42q52J.js";var Y=e(K(),1),X={key:0},Ce=N(c({__name:`CredentialCard`,props:{data:{},readOnly:{type:Boolean,default:!1},needsSetup:{type:Boolean,default:!1}},emits:[`click`],setup(e,{emit:o}){let c={OPEN:`open`,DELETE:`delete`,MOVE:`move`},ee=o,u=e,d=te(),h=z(),S=V(),w=H(),O=F(),{isEnabled:k}=he(),A=t(()=>d.baseText(`generic.credential`).toLowerCase()),j=t(()=>w.getCredentialTypeByName(u.data.type??``)),M=t(()=>W(u.data.scopes).credential),N=t(()=>{let e=[{label:d.baseText(`credentials.item.open`),value:c.OPEN}];return M.value.delete&&e.push({label:d.baseText(`credentials.item.delete`),value:c.DELETE}),M.value.move&&O.isTeamProjectFeatureEnabled&&e.push({label:d.baseText(`credentials.item.move`),value:c.MOVE}),e}),re=t(()=>{let e=new Date().getFullYear().toString();return(0,Y.default)(u.data.createdAt,`d mmmm${String(u.data.createdAt).startsWith(e)?``:`, yyyy`}`)});function P(){ee(`click`,u.data.id)}async function I(e){switch(e){case c.OPEN:P();break;case c.DELETE:await B();break;case c.MOVE:ie();break}}async function B(){await h.confirm(d.baseText(`credentialEdit.credentialEdit.confirmMessage.deleteCredential.message`,{interpolate:{savedCredentialName:u.data.name}}),d.baseText(`credentialEdit.credentialEdit.confirmMessage.deleteCredential.headline`),{confirmButtonText:d.baseText(`credentialEdit.credentialEdit.confirmMessage.deleteCredential.confirmButtonText`)})===`confirm`&&await w.deleteCredential({id:u.data.id})}function ie(){S.openModalWithData({name:L,data:{resource:u.data,resourceType:R.Credential,resourceTypeLabel:A.value}})}return(t,o)=>(p(),l(a(ne),{class:v(t.$style.cardLink),onClick:m(P,[`stop`])},{prepend:f(()=>[s(me,{"credential-type-name":j.value?.name??``},null,8,[`credential-type-name`])]),header:f(()=>[s(a(D),{tag:`h2`,bold:``,class:v(t.$style.cardHeading)},{default:f(()=>[g(n(e.data.name)+` `,1),e.readOnly?(p(),l(a(x),{key:0,class:`ml-3xs`,theme:`tertiary`,bold:``},{default:f(()=>[g(n(a(d).baseText(`credentials.item.readonly`)),1)]),_:1})):i(``,!0),e.needsSetup?(p(),l(a(x),{key:1,class:`ml-3xs`,theme:`warning`},{default:f(()=>[g(n(a(d).baseText(`credentials.item.needsSetup`)),1)]),_:1})):i(``,!0),a(k)&&e.data.isResolvable?(p(),l(a(C),{key:2,placement:`top`},{content:f(()=>[y(`div`,{class:v(t.$style.tooltipContent)},[y(`strong`,null,n(a(d).baseText(`credentials.dynamic.tooltipTitle`)),1),y(`span`,null,n(a(d).baseText(`credentials.dynamic.tooltip`)),1)],2)]),default:f(()=>[s(a(x),{theme:`tertiary`,class:`ml-3xs pl-3xs pr-3xs`,"data-test-id":`credential-card-dynamic`},{default:f(()=>[y(`span`,{class:v(t.$style.dynamicBadgeText)},[s(a(E),{icon:`key-round`,size:`medium`}),g(` `+n(a(d).baseText(`credentials.dynamic.badge`)),1)],2)]),_:1})]),_:1})):i(``,!0)]),_:1},8,[`class`])]),append:f(()=>[y(`div`,{class:v(t.$style.cardActions),onClick:o[0]||=m(()=>{},[`stop`])},[s(q,{class:v(t.$style.cardBadge),resource:e.data,"resource-type":a(R).Credential,"resource-type-label":A.value,"personal-project":a(O).personalProject,"show-badge-border":!1,global:e.data.isGlobal},null,8,[`class`,`resource`,`resource-type`,`resource-type-label`,`personal-project`,`global`]),s(a(T),{"data-test-id":`credential-card-actions`,actions:N.value,theme:`dark`,onAction:I},null,8,[`actions`])],2)]),default:f(()=>[y(`div`,{class:v(t.$style.cardDescription)},[s(a(D),{color:`text-light`,size:`small`},{default:f(()=>[j.value?(p(),r(`span`,X,n(j.value.displayName)+` | `,1)):i(``,!0),b(y(`span`,null,[g(n(a(d).baseText(`credentials.item.updated`))+` `,1),s(ge,{date:e.data.updatedAt},null,8,[`date`]),o[1]||=g(` | `,-1)],512),[[_,e.data]]),b(y(`span`,null,n(a(d).baseText(`credentials.item.created`))+` `+n(re.value),513),[[_,e.data]])]),_:1})],2)]),_:1},8,[`class`]))}}),[[`__cssModules`,{$style:{cardLink:`_cardLink_1nez8_125`,cardHeading:`_cardHeading_1nez8_135`,cardDescription:`_cardDescription_1nez8_142`,cardActions:`_cardActions_1nez8_149`,dynamicBadgeText:`_dynamicBadgeText_1nez8_159`,tooltipContent:`_tooltipContent_1nez8_167`,cardBadge:`_cardBadge_1nez8_183`}}]]),we=e(J(),1),Te={class:`mb-s`},Ee={class:`mb-s`},De={key:0,class:`mb-s`},Z=N(c({__name:`CredentialsView`,props:{credentialId:{}},setup(e){let c=e,m=H(),_=re(),b=V(),x=le(),C=pe(),T=F(),E=ce(),D=_e(),ne=ae(),N=S(),L=M(),R=I(),z=te(),B=ve(),U=e=>{L.replace({query:(0,we.default)(e)})},fe=e=>{U({...K.value,search:e})},K=o({...N.query,setupNeeded:N.query.setupNeeded?.toString()===`true`,...N.query.externalSecretsStore?{externalSecretsStore:N.query.externalSecretsStore.toString()}:{}}),q=o(!1),me=e=>{let t=e;return t?Object.keys(t).length===0?!0:Object.values(t).every(e=>!e||e===`__n8n_EMPTY_VALUE_7b1af746-3729-4c60-9b9b-e08eb29e58da`):!1},he=t(()=>m.allCredentials.map(e=>({resourceType:`credential`,id:e.id,name:e.name,value:``,updatedAt:e.updatedAt,createdAt:e.createdAt,homeProject:e.homeProject,scopes:e.scopes,sharedWithProjects:e.sharedWithProjects,readOnly:!W(e.scopes).credential.update,needsSetup:me(e.data),isGlobal:e.isGlobal,isResolvable:e.isResolvable,type:e.type}))),ge=t(()=>m.allCredentialTypes),J=t(()=>m.credentialTypesById),Y=t(()=>x.preferences.branchReadOnly),X=t(()=>W(T.currentProject?.scopes??T.personalProject?.scopes)),Z=t(()=>T.personalProject),Oe=t(()=>!!N.query.externalSecretsStore&&C.isEnterpriseExternalSecretsEnabled),ke=e=>{L.replace({params:{credentialId:e},query:N.query})},Ae=()=>{ke(`create`),R.track(`User clicked add cred button`,{source:`Creds list`})};oe({store:b,onModalClosed(e){[`selectCredential`,`editCredential`].includes(e)&&L.replace({params:{credentialId:``},query:N.query})}});let je=(e,t,n)=>{if(!se(e))return!1;let r=t;if(r.type&&r.type.length>0&&(n&&=r.type.includes(e.type)),r.search){let t=r.search.toLowerCase();n||=J.value[e.type]&&J.value[e.type].displayName.toLowerCase().includes(t)}return r.setupNeeded&&(n&&=e.needsSetup),n},Me=()=>{c.credentialId===`create`&&(X.value.credential.create?b.openModal(ie):L.replace({name:G.HOMEPAGE}))},Q=async()=>{if(c.credentialId&&c.credentialId!==`create`){let e=m.getCredentialById(c.credentialId),t=W(e?.scopes).credential;if(!e)return await L.replace({name:G.ENTITY_NOT_FOUND,params:{entityType:`credential`}});if(t.update||t.read){b.openExistingCredential(c.credentialId);return}return await L.replace({name:G.ENTITY_UNAUTHORIZED,params:{entityType:`credential`}})}},$=async()=>{q.value=!0;let e=ue().isEnterpriseFeatureEnabled[de.Variables],t=!B.isSharedSubPage&&B.isProjectsSubPage&&N?.params?.projectId===T.personalProject?.id,n=[C.fetchGlobalSecrets()];N?.params?.projectId!==T.personalProject?.id&&typeof N?.params?.projectId==`string`&&n.push(C.fetchProjectSecrets(N.params.projectId));let r=[m.fetchAllCredentials({projectId:N?.params?.projectId,includeScopes:!0,onlySharedWithMe:B.isSharedSubPage,includeGlobal:!t,externalSecretsStore:K.value.externalSecretsStore}),m.fetchCredentialTypes(!1),...n,_.loadNodeTypesIfNotLoaded(),e?P().fetchAllVariables():Promise.resolve()];await Promise.all(r),Me(),await Q(),q.value=!1};return m.$onAction(({name:e,after:t})=>{e===`createNewCredential`&&t(()=>{m.fetchAllCredentials({projectId:N?.params?.projectId,includeScopes:!0,externalSecretsStore:K.value.externalSecretsStore})})}),x.$onAction(({name:e,after:t})=>{e===`pullWorkfolder`&&t(()=>{$()})}),d(()=>N?.params?.projectId,$),d(()=>c.credentialId,()=>{Me(),Q()}),d(()=>K.value.externalSecretsStore,async(e,t)=>{e!==t&&(e!==void 0||t!==void 0)&&$()}),ee(()=>{ne.set(z.baseText(`credentials.heading`))}),(e,t)=>(p(),l(be,{ref:`layout`,filters:K.value,"onUpdate:filters":[t[0]||=e=>K.value=e,U],"resource-key":`credentials`,resources:he.value,initialize:$,"additional-filters-handler":je,"type-props":{itemSize:77},loading:q.value,disabled:Y.value||!X.value.credential.create,"onUpdate:search":fe},{header:f(()=>[s(xe,{"main-button":`credential`},{default:f(()=>[a(B).isOverviewSubPage&&a(D).isSummaryEnabled?(p(),l(Se,{key:0,loading:a(D).weeklySummary.isLoading,summary:a(D).weeklySummary.state,"time-range":`week`},null,8,[`loading`,`summary`])):i(``,!0)]),_:1})]),default:f(({data:e})=>[s(Ce,{"data-test-id":`resources-list-item`,class:`mb-2xs`,data:e,"read-only":e.readOnly,"needs-setup":e.needsSetup,onClick:ke},null,8,[`data`,`read-only`,`needs-setup`])]),filters:f(({setKeyValue:t})=>[y(`div`,Te,[s(a(k),{label:a(z).baseText(`credentials.filters.type`),bold:!1,size:`small`,color:`text-base`,class:`mb-3xs`},null,8,[`label`]),s(a(O),{ref:`typeInput`,"model-value":K.value.type,size:`medium`,multiple:``,filterable:``,class:v(e.$style[`type-input`]),"onUpdate:modelValue":e=>t(`type`,e)},{default:f(()=>[(p(!0),r(u,null,h(ge.value,e=>(p(),l(a(A),{key:e.name,value:e.name,label:e.displayName},null,8,[`value`,`label`]))),128))]),_:1},8,[`model-value`,`class`,`onUpdate:modelValue`])]),y(`div`,Ee,[s(a(k),{label:a(z).baseText(`credentials.filters.status`),bold:!1,size:`small`,color:`text-base`,class:`mb-3xs`},null,8,[`label`]),s(a(j),{label:a(z).baseText(`credentials.filters.setup`),"data-test-id":`credential-filter-setup-needed`,"model-value":K.value.setupNeeded,"onUpdate:modelValue":e=>t(`setupNeeded`,e)},null,8,[`label`,`model-value`,`onUpdate:modelValue`])]),Oe.value&&K.value.externalSecretsStore?(p(),r(`div`,De,[s(a(k),{label:a(z).baseText(`credentials.filters.secretStore`),bold:!1,size:`small`,color:`text-base`,class:`mb-3xs`},null,8,[`label`]),s(a(O),{"model-value":K.value.externalSecretsStore,size:`medium`,disabled:``,"data-test-id":`credential-filter-secret-store`,class:v(e.$style[`type-input`])},{default:f(()=>[s(a(A),{value:K.value.externalSecretsStore,label:K.value.externalSecretsStore},null,8,[`value`,`label`])]),_:1},8,[`model-value`,`class`])])):i(``,!0)]),empty:f(()=>[a(B).isSharedSubPage&&Z.value?(p(),l(ye,{key:0,"personal-project":Z.value,"resource-type":`credentials`},null,8,[`personal-project`])):(p(),l(a(w),{key:1,"data-test-id":`empty-resources-list`,icon:{type:`icon`,value:`lock`},heading:a(z).baseText(a(E).currentUser?.firstName?`credentials.empty.heading`:`credentials.empty.heading.userNotSetup`,{interpolate:{name:a(E).currentUser?.firstName??``}}),description:a(z).baseText(`credentials.empty.description`),"button-text":a(z).baseText(`credentials.empty.button`),"button-type":`secondary`,"button-disabled":Y.value||!X.value.credential.create,"button-icon":Y.value||!X.value.credential.create?`lock`:void 0,"onClick:button":Ae},{disabledButtonTooltip:f(()=>[g(n(Y.value?a(z).baseText(`readOnlyEnv.cantAdd.credential`):a(z).baseText(`credentials.empty.button.disabled.tooltip`)),1)]),_:1},8,[`heading`,`description`,`button-text`,`button-disabled`,`button-icon`]))]),_:1},8,[`filters`,`resources`,`loading`,`disabled`]))}}),[[`__cssModules`,{$style:{"type-input":`_type-input_12nwp_125`,sidebarContainer:`_sidebarContainer_12nwp_129`}}]]);export{Z as default};
//# sourceMappingURL=CredentialsView-CDTYTBNo.js.map