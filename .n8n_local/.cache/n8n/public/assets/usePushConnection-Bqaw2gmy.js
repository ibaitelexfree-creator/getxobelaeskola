(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`e1b28f48-82a4-4127-9350-4d09ae25c310`,e._sentryDebugIdIdentifier=`sentry-dbid-e1b28f48-82a4-4127-9350-4d09ae25c310`)})()}catch{}import{It as e}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as t}from"./_MapCache-DjbOQyB7.js";import{C as n,It as r,J as i,Lt as a,Qi as o,Qs as s,Rr as c,Tt as l,Vi as u,Vt as d,W as f,ai as p,fn as m,p as h,pn as g,r as _,rt as v,s as y,un as b,v as x,ws as S,xa as C,xr as w,y as ee,ya as T,yr as E}from"./users.store-pCkD7Zo0.js";import{Ua as D,Vs as te,ea as ne,jo as O,oa as k,xo as A}from"./constants-D1jZwsUK.js";import{j,r as M}from"./_baseOrderBy-El3qbNHQ.js";import{t as N}from"./banners.store-Ce6ZTWqJ.js";import{t as P}from"./assistant.store-BGYzebcZ.js";import{t as F}from"./useCanvasOperations-BHGWcL34.js";import{i as I,t as L}from"./useRunWorkflow-DzzlHC01.js";import{t as R}from"./pushConnection.store-IFO3HVvG.js";import{t as z}from"./readyToRun.store-DM7AW4os.js";import{t as B}from"./aiTemplatesStarterCollection.store-NMq1bc_J.js";async function V(e){b().updateBuilderCredits(e.data.creditsQuota,e.data.creditsClaimed)}async function H({data:e},t){let n=y(),r=c(),o=_(),s=B(),l=z();if(t.workflowState.executingNode.lastAddedExecutingNode=null,n.activeExecutionId===void 0)return;let u=a();h();let d=r.getWorkflowById(e.workflowId)?.meta?.templateId;d&&(d===f.EasyAiTemplate?u.track(`User executed test AI workflow`,{status:e.status}):d.startsWith(`035_template_onboarding`)?s.trackUserExecutedWorkflow(d.split(`-`).pop()??``,e.status):d===`ready-to-run-ai-workflow`||d===`ready-to-run-ai-workflow-v5`||d===`ready-to-run-ai-workflow-v6`?e.status===`success`?l.trackExecuteAiWorkflowSuccess():l.trackExecuteAiWorkflow(e.status):i(d)&&u.track(`User executed tutorial template`,{template:d,status:e.status})),o.setProcessingExecutionResults(!0);let p=!1;e.status===`success`&&(X(t.workflowState,e.status,p),p=!0);let m=await W(e.executionId);if(!m){t.workflowState.setActiveExecutionId(void 0),o.setProcessingExecutionResults(!1);return}let g=G(m);o.setProcessingExecutionResults(!1),m.data?.waitTill===void 0?m.status===`error`||m.status===`canceled`?J(m,g):X(t.workflowState,m.status,p):q(t),Z(m,g,t.workflowState),U(m,t)}function U(e,t){if(e.status!==`success`||e.data?.startData?.destinationNode!==void 0)return;let n=e.workflowData.nodes.find(e=>e.type===A),r=n?e?.data?.resultData?.runData[n.name]:void 0;if(!n||r===void 0)return;let i=r[0]?.data?.main[0],a=i?i[0]?.json?._rowsLeft:0;if(a&&a>0){let{runWorkflow:e}=L(t);e({triggerNode:n.name,nodeData:r[0],rerunTriggerNode:!0})}}async function W(e){let t=y();try{let n=await t.fetchExecutionDataById(e);return n?.data?{id:e,workflowId:n.workflowId,workflowData:t.workflow,data:o(n.data),status:n.status,startedAt:t.workflowExecutionData?.startedAt,stoppedAt:new Date}:void 0}catch{return}}function G(e){return ne({...e.data,startData:e.data?.startData,resultData:e.data?.resultData??{runData:{}},executionData:e.data?.executionData})}function K(e){let n=t();if(e.status===`crashed`)return n.baseText(`pushConnection.executionFailed.message`);if(e.status===`canceled`){let e=y();return n.baseText(`executionsList.showMessage.stopExecution.message`,{interpolate:{activeExecutionId:e.activeExecutionId??``}})}return x({error:e.data?.resultData.error,lastNodeExecuted:e.data?.resultData.lastNodeExecuted})}function q(e){let t=y(),n=S(),r=g(e),i=t.workflowObject;if(!(t.workflowSettings.saveManualExecutions??n.saveManualExecutions)){let e=_();T.emit(`registerGlobalLinkAction`,{key:`open-settings`,action:async()=>{t.isWorkflowSaved[t.workflowId]||await r.saveAsNewWorkflow(),e.openModal(te)}})}m().setDocumentTitle(i.name,`IDLE`)}function J(e,n){let r=E(),i=t(),o=a(),s=y(),c=m(),u=l(),d=s.workflowObject;if(c.setDocumentTitle(d.name,`ERROR`),n.resultData.error?.name===`ExpressionError`&&n.resultData.error.functionality===`pairedItem`){let e=n.resultData.error;u.getWorkflowDataToSave().then(t=>{let n={caused_by_credential:!1,error_message:e.description,error_title:e.message,error_type:e.context.type,node_graph_string:JSON.stringify(k(t,u.getNodeTypes()).nodeGraph),workflow_id:s.workflowId};if(e.context.nodeCause&&[`paired_item_no_info`,`paired_item_invalid_info`].includes(e.context.type)){let t=d.getNode(e.context.nodeCause);t&&(n.is_pinned=!!d.getPinDataOfNode(t.name),n.mode=t.parameters.mode,n.node_type=t.type,n.operation=t.parameters.operation,n.resource=t.parameters.resource)}o.track(`Instance FE emitted paired item error`,n)})}if(e.status===`canceled`)r.showMessage({title:i.baseText(`nodeView.showMessage.stopExecutionTry.title`),type:`success`});else if(e.data?.resultData.error){let{message:t,title:n}=ee({error:e.data.resultData.error,lastNodeExecuted:e.data?.resultData.lastNodeExecuted});r.showMessage({title:n,message:t,type:`error`,duration:0}),b().incrementManualExecutionStats(`error`)}}function Y(e,t,n){let r=E();m().setDocumentTitle(e,`IDLE`),n.setActiveExecutionId(void 0),r.showMessage({title:t,type:`success`})}function X(e,r,i){let a=y(),o=E(),s=t(),c=n(),l=a.workflowObject.name??``;m().setDocumentTitle(l,`IDLE`);let d=a.getWorkflowExecution;if(d?.executedNode){let t=a.getNodeByName(d.executedNode),n=t&&c.getNodeType(t.type,t.typeVersion),r=d.data?.resultData?.runData?.[d.executedNode];n?.polling&&!r?o.showMessage({title:s.baseText(`pushConnection.pollingNode.dataNotFound`,{interpolate:{service:u(n)}}),message:s.baseText(`pushConnection.pollingNode.dataNotFound.message`,{interpolate:{service:u(n)}}),type:`success`}):i||Y(l,s.baseText(`pushConnection.nodeExecutedSuccessfully`),e)}else i||Y(l,s.baseText(`pushConnection.workflowExecutedSuccessfully`),e);r===`success`&&!i&&b().incrementManualExecutionStats(`success`)}function Z(e,t,n){let i=y(),a=r({workflowState:n}),o=K(e),s=i.getWorkflowExecution;if(n.executingNode.executingNode.length=0,s===null)return;n.setWorkflowExecutionData({...s,status:e.status,id:e.id,stoppedAt:e.stoppedAt}),i.setWorkflowExecutionRunData(t),n.setActiveExecutionId(void 0),a.updateNodesExecutionIssues();let c=t.resultData.lastNodeExecuted,l=0;c&&t.resultData.runData[c]&&!o&&(l=t.resultData.runData[c][0].data?.main[0]?.length??0),n.setActiveExecutionId(void 0),w().run(`pushConnection.executionFinished`,{itemsCount:l,nodeName:t.resultData.lastNodeExecuted,errorMessage:o,runDataExecutedStartData:t.startData,resultDataError:t.resultData.error});let u=t.resultData?.error?.lineNumber;C.emit(`highlightLine`,u??`last`)}async function re({data:e},t){let n=y(),r=_();if(n.activeExecutionId===void 0)return;r.setProcessingExecutionResults(!0);let i=await W(e.executionId);if(!i){r.setProcessingExecutionResults(!1);return}let a=G(i);r.setProcessingExecutionResults(!1),i.data?.waitTill===void 0?i.status===`error`||i.status===`canceled`?J(i,a):X(t.workflowState,i.status,!1):q(t),Z(i,a,t.workflowState)}async function ie({data:e},t){let n=y();n.activeExecutionId!==void 0&&(n.activeExecutionId===null&&t.workflowState.setActiveExecutionId(e.executionId),n.workflowExecutionData?.data&&e.flattedRunData&&(n.workflowExecutionData.data.resultData.runData=o(e.flattedRunData)))}async function ae(e){let t=n(),r=v();await t.getNodeTypes(),await r.fetchCredentialTypes(!0)}async function oe({data:e},{workflowState:t}){let n=y(),r=P(),i={main:[]};if(e.itemCountByConnectionType&&typeof e.itemCountByConnectionType==`object`){let t={json:{[O]:!0}};for(let[n,r]of Object.entries(e.itemCountByConnectionType))p(n)&&(i[n]=r.map(e=>Array.from({length:e},()=>t)))}let a={...e,data:{...e.data,data:i}};n.updateNodeExecutionStatus(a),t.executingNode.removeExecutingNode(e.nodeName),r.onNodeExecution(e)}async function se({data:e}){let t=y(),n=I();t.updateNodeExecutionRunData(e),n.trackSchemaPreviewExecution(e)}async function ce({data:e},{workflowState:t}){let n=y();t.executingNode.addExecutingNode(e.nodeName),n.addNodeExecutionStartedData(e)}async function le({data:e}){let t=n();await t.getNodeTypes();let r=D(e.name);await t.getFullNodesProperties([e],!r)}async function ue({data:e}){let t=n(),r=v(),i=[e];await r.fetchCredentialTypes(!1).then(()=>{t.removeNodeTypes(i)})}async function de({data:e}){console.log(e.source,...e.messages)}const fe=100;var pe=120*1e3;const Q=j(`orchestrationManager`,{state:()=>({initialStatusReceived:!1,workers:{},workersHistory:{},workersLastUpdated:{},statusInterval:null}),actions:{updateWorkerStatus(e){this.workers[e.senderId]=e,this.workersHistory[e.senderId]||(this.workersHistory[e.senderId]=[]),this.workersHistory[e.senderId].push({data:e,timestamp:Date.now()}),this.workersHistory[e.senderId].length>100&&this.workersHistory[e.senderId].shift(),this.workersLastUpdated[e.senderId]=Date.now(),this.initialStatusReceived=!0},removeStaleWorkers(){for(let e in this.workersLastUpdated)this.workersLastUpdated[e]+pe<Date.now()&&(delete this.workers[e],delete this.workersHistory[e],delete this.workersLastUpdated[e])},startWorkerStatusPolling(){let e=M();this.statusInterval||=setInterval(async()=>{await s(e.restApiContext),this.removeStaleWorkers()},1e3)},stopWorkerStatusPolling(){this.statusInterval&&=(clearInterval(this.statusInterval),null)},getWorkerLastUpdated(e){return this.workersLastUpdated[e]??0},getWorkerStatus(e){return this.workers[e]},getWorkerStatusHistory(e){return this.workersHistory[e]??[]}}});async function $({data:e}){Q().updateWorkerStatus(e.status)}async function me({data:e},t){let n=y();e.workflowId===n.workflowId&&(n.executionWaitingForWebhook=!1,t.workflowState.setActiveExecutionId(void 0))}async function he({data:e},t){let n=y();e.workflowId===n.workflowId&&(n.executionWaitingForWebhook=!1,t.workflowState.setActiveExecutionId(e.executionId??null))}async function ge({data:e}){let{initializeWorkspace:t}=F(),n=y(),r=c(),i=N(),a=_(),{workflowId:o,activeVersionId:s}=e,l=n.workflowId===o,u=n.workflow.activeVersionId!==s;if(l&&u&&!a.stateIsDirty){let e=await r.fetchWorkflow(o);if(!e.checksum)throw Error(`Failed to fetch workflow`);await t(e)}l&&i.removeBannerFromStack(`WORKFLOW_AUTO_DEACTIVATED`)}async function _e({data:e}){let t=y(),n=c(),{initializeWorkspace:r}=F(),i=N(),a=_();if(t.setWorkflowInactive(e.workflowId),t.workflowId===e.workflowId){if(!a.stateIsDirty){let t=await n.fetchWorkflow(e.workflowId);if(!t.checksum)throw Error(`Failed to fetch workflow`);await r(t)}i.pushBannerToStack(`WORKFLOW_AUTO_DEACTIVATED`)}}async function ve({data:e}){let{initializeWorkspace:t}=F(),n=y(),r=c(),i=_();if(n.workflowId===e.workflowId&&!i.stateIsDirty){let n=await r.fetchWorkflow(e.workflowId);if(!n.checksum)throw Error(`Failed to fetch workflow`);await t(n)}}async function ye({data:e},n){let r=y();if(r.workflowId!==e.workflowId)return;r.setWorkflowInactive(e.workflowId),n.workflowState.setActive(null);let i=E(),a=t();i.showError(Error(e.errorMessage),a.baseText(`workflowActivator.showError.title`,{interpolate:{newStateName:`activated`}})+`:`)}function be(e){let t=[],n=!1;async function r(){if(n||t.length===0)return;n=!0;let i=t.shift();if(i!==void 0)try{await e(i)}catch(e){console.error(`Error processing event:`,e)}n=!1,await r()}function i(e){t.push(e),r()}return{enqueue:i}}function xe({router:t,workflowState:n}){let r=R(),i={router:t,workflowState:n??d()},{enqueue:a}=be(l),o=e(null);function s(){o.value=r.addEventListener(e=>{a(e)})}function c(){typeof o.value==`function`&&o.value()}async function l(e){switch(e.type){case`testWebhookDeleted`:return await me(e,i);case`testWebhookReceived`:return await he(e,i);case`reloadNodeType`:return await le(e);case`removeNodeType`:return await ue(e);case`nodeDescriptionUpdated`:return await ae(e);case`nodeExecuteBefore`:return await ce(e,i);case`nodeExecuteAfter`:return await oe(e,i);case`nodeExecuteAfterData`:return await se(e);case`executionStarted`:return await ie(e,i);case`sendWorkerStatusMessage`:return await $(e);case`sendConsoleMessage`:return await de(e);case`workflowFailedToActivate`:return await ye(e,i);case`executionFinished`:return await H(e,i);case`executionRecovered`:return await re(e,i);case`workflowActivated`:return await ge(e);case`workflowDeactivated`:return await ve(e);case`workflowAutoDeactivated`:return await _e(e);case`updateBuilderCredits`:return await V(e)}}return{initialize:s,terminate:c}}export{fe as n,Q as r,xe as t};
//# sourceMappingURL=usePushConnection-Bqaw2gmy.js.map