(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`4ed6ff88-5e30-4774-97be-331e0b53b3fc`,e._sentryDebugIdIdentifier=`sentry-dbid-4ed6ff88-5e30-4774-97be-331e0b53b3fc`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{Bt as t,C as n,Cn as r,D as i,E as a,Gt as o,It as s,M as c,P as l,T as u,_ as d,bt as f,et as p,it as m,j as h,vn as g,w as _}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{x as v,yt as ee}from"./_MapCache-DjbOQyB7.js";import{Ci as y,Et as b,Hi as x,Oi as S,Vi as C,at as w,wi as te,zi as T}from"./src-CppJvwzX.js";import{t as E}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{Lt as D,Tr as O,Z as k,yr as A}from"./users.store-pCkD7Zo0.js";import{Po as j,Ss as M,rs as N}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import{t as P}from"./roles.store-Cq99swn7.js";var F=e(j(),1),I=e(k(),1),ne={key:0},re={style:{flex:`1`}},ie={key:1,class:`mt-xl`},L=E(l({__name:`ProjectRoleView`,props:{roleSlug:{}},setup(e){let l=P(),E=y(),k=te(),{showError:j,showMessage:L}=A(),R=ee(),z=O(),B=D(),V=e,H=()=>({displayName:``,description:``,scopes:structuredClone(t(l.processedProjectRoles.find(e=>e.slug===`project:viewer`)?.scopes||[]))}),U=s(),{state:W,isLoading:G}=v(async()=>{if(!V.roleSlug)return H();try{let e=await l.fetchRoleBySlug({slug:V.roleSlug});return U.value=structuredClone(e),{displayName:e.displayName,description:e.description,scopes:e.scopes}}catch(e){return j(e,`Error fetching role`),H()}},H(),{shallow:!1}),K=n(()=>U.value?.systemRole===!0||E.name===N.PROJECT_ROLE_VIEW),q=n(()=>U.value?!(0,F.default)(U.value.displayName,W.value.displayName)||!(0,F.default)(U.value.description??null,W.value.description||null)||!(0,F.default)((0,I.default)(U.value.scopes),(0,I.default)(W.value.scopes)):!1);function J(e){W.value=e?{displayName:e.displayName,description:e.description,scopes:e.scopes}:H()}let ae=[`read`,`update`,`delete`].map(e=>`project:${e}`),oe=[`read`,`update`,`create`,`move`,`delete`].map(e=>`folder:${e}`),se=[`read`,`update`,`create`,`publish`,`unpublish`,`move`,`delete`].map(e=>`workflow:${e}`),ce=[`read`,`update`,`create`,`share`,`move`,`delete`].map(e=>`credential:${e}`),le=[`push`].map(e=>`sourceControl:${e}`),ue=[`read`,`readRow`,`update`,`writeRow`,`create`,`delete`].map(e=>`dataTable:${e}`),Y=[`read`,`update`,`create`,`delete`].map(e=>`projectVariable:${e}`),de=[`project`,`folder`,`workflow`,`credential`,`dataTable`,`projectVariable`,`sourceControl`],X={project:ae,folder:oe,workflow:se,credential:ce,sourceControl:le,dataTable:ue,projectVariable:Y};function Z(e){let t=W.value.scopes.indexOf(e);if(t===-1?W.value.scopes.push(e):W.value.scopes.splice(t,1),e.startsWith(`dataTable:`)&&e.endsWith(`:read`)){Z(e.replace(`:read`,`:listProject`));return}e.endsWith(`:read`)&&Z(e.replace(`:read`,`:list`)),e===`workflow:update`&&Z(`workflow:execute`)}async function fe(){try{let e=await l.createProjectRole({...W.value,description:W.value.description??void 0,roleType:`project`});return l.fetchRoles(),B.track(`User successfully created new role`,{role_id:e.slug,role_name:e.displayName,permissions:e.scopes}),k.replace({name:N.PROJECT_ROLE_SETTINGS,params:{roleSlug:e.slug}}),L({type:`success`,message:R.baseText(`projectRoles.action.create.success`)}),U.value=structuredClone(e),e}catch(e){j(e,R.baseText(`projectRoles.action.create.error`));return}}async function pe(e){return e?await z.confirm(R.baseText(`projectRoles.action.update.text`,{interpolate:{count:e}}),R.baseText(`projectRoles.action.update.title`,{interpolate:{count:e}}),{type:`warning`,confirmButtonText:R.baseText(`projectRoles.action.update`),cancelButtonText:R.baseText(`projectRoles.action.cancel`)})===M:!0}async function me(e){if(await pe(U?.value?.usedByUsers))try{let t=await l.updateProjectRole(e,{...W.value,description:W.value.description??void 0});return l.fetchRoles(),B.track(`User updated role`,{role_id:t.slug,role_name:t.displayName,permissions_from:U.value?.scopes,permissions_to:t.scopes}),U.value=structuredClone(t),L({type:`success`,message:R.baseText(`projectRoles.action.update.success`)}),t}catch(e){j(e,R.baseText(`projectRoles.action.update.error`));return}}async function Q(){V.roleSlug?await me(V.roleSlug):await fe()}function $(e){let n=l.processedProjectRoles.find(t=>t.slug===e);n&&(W.value.scopes=structuredClone(t(n.scopes)))}async function he(){if(U?.value&&await z.confirm(R.baseText(`projectRoles.action.delete.text`,{interpolate:{roleName:U.value.displayName}}),R.baseText(`projectRoles.action.delete.title`,{interpolate:{roleName:U.value.displayName}}),{type:`warning`,confirmButtonText:R.baseText(`projectRoles.action.delete`),cancelButtonText:R.baseText(`projectRoles.action.cancel`)})===`confirm`){B.track(`User clicked delete role`,{role_id:U.value.slug,role_name:U.value.displayName,permissions:U.value?.scopes});try{await l.deleteProjectRole(U.value.slug);let e=l.roles.project.findIndex(e=>e.slug===U.value?.slug);e!==-1&&l.roles.project.splice(e,1),L({title:R.baseText(`projectRoles.action.delete.success`),type:`success`}),B.track(`User successfully deleted role`,{role_id:U.value.slug,role_name:U.value.displayName,permissions:U.value?.scopes}),k.back()}catch(e){j(e,R.baseText(`projectRoles.action.delete.error`));return}}}let ge=[{name:`REQUIRED`},{name:`MIN_LENGTH`,config:{minimum:2}}];return(t,n)=>(p(),i(`div`,{class:g([`pb-xl`,t.$style.container])},[c(o(x),{variant:`ghost`,icon:`arrow-left`,class:g(t.$style.backButton),onClick:n[0]||=()=>o(k).back()},{default:f(()=>[h(r(o(R).baseText(`projectRoles.backToRoleList`)),1)]),_:1},8,[`class`]),_(`div`,{class:g([`mb-xl`,t.$style.headerContainer])},[c(o(T),{tag:`h1`,size:`2xlarge`},{default:f(()=>[h(r(e.roleSlug?`Role "${o(W).displayName}"`:o(R).baseText(`projectRoles.newRole`)),1)]),_:1}),U.value&&!K.value?(p(),i(`div`,ne,[c(o(x),{variant:`subtle`,disabled:!q.value,class:`mr-xs`,onClick:n[1]||=e=>J(U.value)},{default:f(()=>[h(r(o(R).baseText(`projectRoles.discardChanges`)),1)]),_:1},8,[`disabled`]),c(o(x),{disabled:!q.value,onClick:Q},{default:f(()=>[h(r(o(R).baseText(`projectRoles.save`)),1)]),_:1},8,[`disabled`])])):U.value?a(``,!0):(p(),u(o(x),{key:1,onClick:Q},{default:f(()=>[h(r(o(R).baseText(`projectRoles.create`)),1)]),_:1}))],2),_(`div`,{class:g([`mb-l`,t.$style.formContainer])},[c(o(w),{modelValue:o(W).displayName,"onUpdate:modelValue":n[2]||=e=>o(W).displayName=e,label:o(R).baseText(`projectRoles.roleName`),"validate-on-blur":``,"validation-rules":ge,class:`mb-s`,"show-required-asterisk":``,required:``,maxlength:100,disabled:K.value},null,8,[`modelValue`,`label`,`disabled`]),c(o(w),{modelValue:o(W).description,"onUpdate:modelValue":n[3]||=e=>o(W).description=e,label:o(R).baseText(`projectRoles.description`),placeholder:o(R).baseText(`projectRoles.optional`),type:`textarea`,maxlength:500,autosize:{minRows:2,maxRows:4},disabled:K.value},null,8,[`modelValue`,`label`,`placeholder`,`disabled`])],2),c(o(T),{tag:`h2`,size:`xlarge`,class:`mb-s`},{default:f(()=>[h(r(o(R).baseText(`projectRoles.permissions`)),1)]),_:1}),K.value?a(``,!0):(p(),i(d,{key:0},[c(o(C),{color:`text-light`,class:`mb-2xs`,tag:`p`},{default:f(()=>[h(r(o(R).baseText(`projectRoles.preset`)),1)]),_:1}),_(`div`,{class:g([`mb-s`,t.$style.presetsContainer])},[c(o(x),{variant:`subtle`,onClick:n[4]||=e=>$(`project:admin`)},{default:f(()=>[h(r(o(R).baseText(`projectRoles.admin`)),1)]),_:1}),c(o(x),{variant:`subtle`,onClick:n[5]||=e=>$(`project:editor`)},{default:f(()=>[h(r(o(R).baseText(`projectRoles.editor`)),1)]),_:1}),c(o(x),{variant:`subtle`,onClick:n[6]||=e=>$(`project:viewer`)},{default:f(()=>[h(r(o(R).baseText(`projectRoles.viewer`)),1)]),_:1})],2)],64)),_(`div`,{class:g(t.$style.cardContainer)},[(p(),i(d,null,m(de,e=>_(`div`,{key:e,class:g([`mb-s mt-s`,t.$style.card])},[_(`div`,{class:g(t.$style.cardTitle)},r(o(R).baseText(`projectRoles.type.${e}`)),3),_(`div`,re,[o(G)?(p(),u(o(b),{key:0,rows:X[e].length,"shrink-last":!1},null,8,[`rows`])):(p(!0),i(d,{key:1},m(X[e],e=>(p(),i(`div`,{key:e,class:`mb-2xs`},[c(o(S),{content:o(R).baseText(`projectRoles.${e}.tooltip`),placement:`right`,enterable:!1,"show-after":250},{default:f(()=>[c(o(w),{"data-test-id":`scope-checkbox-${e}`,"model-value":o(W).scopes.includes(e),label:o(R).baseText(`projectRoles.${e}`),"validate-on-blur":``,type:`checkbox`,class:g(t.$style.checkbox),disabled:K.value,"onUpdate:modelValue":()=>Z(e)},null,8,[`data-test-id`,`model-value`,`label`,`class`,`disabled`,`onUpdate:modelValue`])]),_:2},1032,[`content`])]))),128))])],2)),64))],2),e.roleSlug&&!K.value?(p(),i(`div`,ie,[c(o(T),{tag:`h2`,class:`mb-2xs`,size:`large`},{default:f(()=>[h(r(o(R).baseText(`projectRoles.dangerZone`)),1)]),_:1}),c(o(C),{tag:`p`,class:`mb-s`},{default:f(()=>[U.value?.usedByUsers?(p(),i(d,{key:0},[h(r(o(R).baseText(`projectRoles.action.delete.useWarning`,{interpolate:{count:U.value.usedByUsers}})),1)],64)):(p(),i(d,{key:1},[h(r(o(R).baseText(`projectRoles.action.delete.warning`)),1)],64))]),_:1}),c(o(x),{variant:`destructive`,disabled:!!U.value?.usedByUsers,onClick:he},{default:f(()=>[h(r(o(R).baseText(`projectRoles.action.delete.button`)),1)]),_:1},8,[`disabled`])])):a(``,!0)],2))}}),[[`__cssModules`,{$style:{container:`_container_14r2u_2`,cardContainer:`_cardContainer_14r2u_9`,card:`_card_14r2u_9`,cardTitle:`_cardTitle_14r2u_28`,backButton:`_backButton_14r2u_32`,headerContainer:`_headerContainer_14r2u_38`,formContainer:`_formContainer_14r2u_44`,presetsContainer:`_presetsContainer_14r2u_48`,checkbox:`_checkbox_14r2u_53`}}]]);export{L as default};
//# sourceMappingURL=ProjectRoleView-Ca1ZsnRF.js.map