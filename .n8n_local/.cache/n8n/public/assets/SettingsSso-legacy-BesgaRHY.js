!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"n8n@2.9.4"}}catch(e){}}(),System.register(["./chunk-legacy-BCpDjeTS.js","./vue.runtime.esm-bundler-legacy-BquwEXRp.js","./_MapCache-legacy-BR_CVmoL.js","./src-legacy-kcwUfEuS.js","./_plugin-vue_export-helper-legacy-DtDV0xrP.js","./sanitize-html-legacy-rns0ELH_.js","./users.store-legacy-B-bVJKl3.js","./dialog-legacy-fV5dITAe.js","./constants-legacy-DVkAm8xO.js","./merge-legacy-C4nCP5az.js","./_baseOrderBy-legacy-BnyL5wLN.js","./dateformat-legacy-BvMRGS_P.js","./useDebounce-legacy-BSzeAS4U.js","./versions.store-legacy-DyDzuHis.js","./usePageRedirectionHelper-legacy-DkG-ZaDD.js","./useClipboard-legacy-CaRHRTup.js","./CopyInput-legacy-tkihub7c.js","./exports-legacy-D4VVuJ_2.js","./sso.store-legacy-B2e5Mjw4.js","./userRoleProvisioning.store-legacy-DFNUT4U5.js"],(function(e,t){var s,o,n,a,l,i,r,c,u,d,g,v,p,b,m,f,_,x,y,h,C,T,w,P,k,R,S,E,j,U,$,V,D,I,L,M,O,B,z,A,F,q,G,H,Y,J,K,N,Q,Z,W,X,ee,te,se,oe,ne,ae,le,ie,re,ce,ue,de,ge,ve,pe,be,me,fe,_e,xe,ye,he,Ce,Te;function we(e){const t=X(),o=A(),n=i("disabled"),a=e=>e?e.scopesProvisionInstanceRole&&e.scopesProvisionProjectRoles?"instance_and_project_roles":e.scopesProvisionInstanceRole?"instance_role":"disabled":"disabled",l=s((()=>a(t.provisioningConfig)!==n.value));return t.getProvisioningConfig().then((()=>{n.value=a(t.provisioningConfig)})),{formValue:n,isUserRoleProvisioningChanged:l,saveProvisioningConfig:async s=>{const l=s?"disabled":n.value;var i,r;l!==a(t.provisioningConfig)&&(await t.saveProvisioningConfig((i=l,"instance_role"===i?{scopesProvisionInstanceRole:!0,scopesProvisionProjectRoles:!1}:"instance_and_project_roles"===i?{scopesProvisionInstanceRole:!0,scopesProvisionProjectRoles:!0}:{scopesProvisionInstanceRole:!1,scopesProvisionProjectRoles:!1})),n.value=l,r=l,o.track("User updated provisioning settings",{instance_id:J().instanceId,authentication_method:e,updated_setting:r}))},shouldPromptUserToConfirmUserRoleProvisioningChange:({currentLoginEnabled:e,loginEnabledFormValue:t})=>{const s=e!==t,o=s&&e,a=s&&!e&&"disabled"!==n.value,i=l.value&&e&&!o;return a||i}}}function Pe(){const e=i(),t=i(),s=J(),o=()=>{const e=new Date;return`${e.getDate()}_${e.getMonth()+1}_${e.getFullYear()}_${e.getHours()}_${e.getMinutes()}`},n=e=>e.includes(",")||e.includes('"')?`"${e.replace(/"/g,'""')}"`:e,a=(e,t)=>{const s=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(s),n=document.createElement("a");n.setAttribute("href",o),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)},l=async()=>{if(e.value)return e.value;if(t.value)return await t.value;const o=async function(e){const t=[],s={select:["email","role"],expand:["projectRelations"]};let o=0,n=0,a=!0;for(;a;){const l={...s,sortBy:["email:desc"],take:50,skip:50*o},i=await z(e,l);0===o&&(n=i.count),t.push(...i.items),a=50===i.items.length&&t.length<n,o++}return{count:n,items:t}}(s.restApiContext).then((s=>(e.value=s,t.value=void 0,s))).catch((e=>{throw t.value=void 0,e}));return t.value=o,await o},r=i(!1),c=i(!1);return{downloadProjectRolesCsv:async()=>{const e=await l(),t=["email,project_displayname,project_id,project_role"];for(const s of e.items){const e=n(s.email??"");if(s.projectRelations&&s.projectRelations.length>0)for(const o of s.projectRelations){const s=n(o.name??""),a=n(o.id??""),l=n(o.role.split(":")[1]??o.role);t.push(`${e},${s},${a},${l}`)}}a(t.join("\n"),`n8n_project_role_export_${o()}.csv`),r.value=!0},downloadInstanceRolesCsv:async()=>{const e=await l(),t=["email,instance_role"];for(const s of e.items){const e=n(s.email??""),o=n(s.role??"");t.push(`${e},${o}`)}a(t.join("\n"),`n8n_instance_role_export_${o()}.csv`),c.value=!0},hasDownloadedInstanceRoleCsv:c,hasDownloadedProjectRoleCsv:r,accessSettingsCsvExportOnModalClose:()=>{c.value=!1,r.value=!1,e.value=void 0,t.value=void 0}}}return{setters:[function(e){e.o},function(e){s=e.C,o=e.Cn,n=e.D,a=e.E,l=e.Gt,i=e.It,r=e.M,c=e.P,u=e.T,d=e.U,g=e.Z,v=e._,p=e._t,b=e.bt,m=e.et,f=e.ft,_=e.h,x=e.it,y=e.j,h=e.jt,C=e.st,T=e.vn,w=e.w,P=e.xt},function(e){k=e.yt},function(e){R=e.Hi,S=e.Pi,E=e.Q,j=e.Ui,U=e.Vi,$=e.bt,V=e.ft,D=e.ji,I=e.pt,L=e.st,M=e.z,O=e.zi},function(e){B=e.t},function(e){},function(e){z=e.Ds,A=e.Lt,F=e.Tr,q=e._r,G=e.fn,H=e.yr},function(e){Y=e.t},function(e){e.Ss},function(e){},function(e){J=e.r},function(e){},function(e){},function(e){},function(e){K=e.t},function(e){},function(e){N=e.t},function(e){Q=e.r},function(e){Z=e.n,W=e.t},function(e){X=e.t}],execute:function(){(ee=document.createElement("style")).textContent='._group_o443m_125{padding:var(--spacing--xl)0 0}._group_o443m_125>label{font-size:var(--font-size--sm);font-weight:var(--font-weight--medium);padding:0 0 var(--spacing--2xs);display:inline-block}._group_o443m_125 small{padding:var(--spacing--2xs)0 0;font-size:var(--font-size--2xs);color:var(--color--text);display:block}._userRoleProvisioningSelect_o443m_141{max-width:400px;display:block}._button_1bulq_126{margin-left:var(--spacing--xs)}._card_1bulq_130{background-color:var(--color--background--light-1)}._descriptionTextPartTwo_1bulq_134{margin-left:4px}._icon_1bulq_138{height:32px;margin:0 var(--spacing--lg)}._list_1bulq_143{padding:0 var(--spacing--2xs)}._list_1bulq_143 li{align-items:center;display:flex}._list_1bulq_143 li:before{content:"â€¢";margin-right:var(--spacing--3xs);margin-bottom:2px}._switch_1blmf_128 span{font-size:var(--font-size--2xs);font-weight:var(--font-weight--bold);color:var(--color--text--tint-1)}._buttons_1blmf_134{padding:var(--spacing--2xl)0 var(--spacing--2xs);justify-content:flex-start;display:flex}._buttons_1blmf_134 button{margin:0 var(--spacing--sm)0 0}._group_1blmf_143{padding:var(--spacing--xl)0 0}._group_1blmf_143>label{font-size:var(--font-size--sm);font-weight:var(--font-weight--medium);padding:0 0 var(--spacing--2xs);display:inline-block}._group_1blmf_143 small{padding:var(--spacing--2xs)0 0;font-size:var(--font-size--2xs);color:var(--color--text);display:block}._checkboxGroup_1blmf_159 label>:first-child{vertical-align:text-top}._actionBox_1blmf_163{margin:var(--spacing--2xl)0 0}._footer_1blmf_167{color:var(--color--text);font-size:var(--font-size--2xs)}._heading_bewbd_125{margin-bottom:var(--spacing--sm)}._actionBox_bewbd_129{margin-top:var(--spacing--lg)}\n/*$vite$:1*/',document.head.appendChild(ee);try{t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},(z=(new t.Error).stack)&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[z]="a852be4b-9e3f-4c7d-b719-199b5cde5f0d",t._sentryDebugIdIdentifier="sentry-dbid-a852be4b-9e3f-4c7d-b719-199b5cde5f0d")}catch(t){}var t,z;te=["href"],se=B(c({__name:"UserRoleProvisioningDropdown",props:d({authProtocol:{}},{modelValue:{default:"disabled"},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=f(e,"modelValue"),s=k(),a=q().hasScope("provisioning:manage"),i=e=>{t.value=e},c=[{label:s.baseText("settings.sso.settings.userRoleProvisioning.option.disabled.label"),value:"disabled"},{label:s.baseText("settings.sso.settings.userRoleProvisioning.option.instanceRole.label"),value:"instance_role"},{label:s.baseText("settings.sso.settings.userRoleProvisioning.option.instanceAndProjectRoles.label"),value:"instance_and_project_roles"}];return(u,d)=>(m(),n("div",{class:T(u.$style.group)},[w("label",null,o(l(s).baseText("settings.sso.settings.userRoleProvisioning.label")),1),r(l(V),{"model-value":t.value,disabled:!l(a),"data-test-id":"oidc-user-role-provisioning",class:T(u.$style.userRoleProvisioningSelect),"onUpdate:modelValue":i},{default:b((()=>[(m(),n(v,null,x(c,(e=>r(l(I),{key:e.value,label:e.label,"data-test-id":"oidc-user-role-provisioning-option",value:e.value},null,8,["label","value"]))),64))])),_:1},8,["model-value","disabled","class"]),w("small",null,[y(o(l(s).baseText("settings.sso.settings.userRoleProvisioning.help"))+" ",1),w("a",{href:`https://docs.n8n.io/user-management/${e.authProtocol}/setup/`,target:"_blank"},o(l(s).baseText("settings.sso.settings.userRoleProvisioning.help.linkText")),9,te)])],2))}}),[["__cssModules",{$style:{group:"_group_o443m_125",userRoleProvisioningSelect:"_userRoleProvisioningSelect_o443m_141"}}]]),oe={class:"mb-s"},ne={class:"mb-s"},ae=["href"],le={class:"mb-s"},ie={key:0},re={class:"mb-s"},ce={class:"mb-s"},ue=["href"],de={class:"mb-s"},ge=c({__name:"ConfirmProvisioningDialog",props:d({newProvisioningSetting:{},authProtocol:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:d(["confirmProvisioning","cancel"],["update:modelValue"]),setup(e,{emit:t}){const c=f(e,"modelValue"),d=e,g=t,_=k(),x=i(!1),h=i(!1),S=i(!1),E=i(!1),{hasDownloadedInstanceRoleCsv:V,hasDownloadedProjectRoleCsv:D,downloadProjectRolesCsv:I,downloadInstanceRolesCsv:M,accessSettingsCsvExportOnModalClose:O}=Pe(),B=s((()=>"disabled"===d.newProvisioningSetting)),z=s((()=>B.value?"disable":"enable")),A=s((()=>"instance_and_project_roles"===d.newProvisioningSetting));p(c,(()=>{S.value=!1,E.value=!1,O()}));const F=async()=>{x.value=!0;try{await M()}finally{x.value=!1}},q=async()=>{h.value=!0;try{await I()}finally{h.value=!1}},G=()=>{S.value=!0,g("confirmProvisioning")};return(t,s)=>{const i=C("n8n-html");return m(),u(l(Y),{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=e=>c.value=e),title:l(_).baseText(`settings.provisioningConfirmDialog.${z.value}.title`),width:"650"},{footer:b((()=>[r(l(R),{variant:"ghost",type:"button","data-test-id":"provisioning-cancel-button",onClick:s[1]||(s[1]=e=>g("cancel"))},{default:b((()=>[y(o(l(_).baseText("settings.provisioningConfirmDialog.button.cancel")),1)])),_:1}),r(l(R),{variant:"solid",type:"button",disabled:S.value||!E.value||!B.value&&!l(V)||A.value&&!l(D),"data-test-id":"provisioning-confirm-button",onClick:G},{default:b((()=>[y(o(l(_).baseText(`settings.provisioningConfirmDialog.button.${z.value}.confirm`)),1)])),_:1},8,["disabled"])])),default:b((()=>[B.value?(m(),n(v,{key:1},[w("div",re,[r(l(U),{color:"text-base"},{default:b((()=>[y(o(l(_).baseText("settings.provisioningConfirmDialog.disable.description")),1)])),_:1})]),w("div",ce,[r(l(U),{color:"text-base"},{default:b((()=>[w("a",{href:`https://docs.n8n.io/user-management/${e.authProtocol}/setup/`,target:"_blank"},o(l(_).baseText("settings.provisioningConfirmDialog.link.docs")),9,ue)])),_:1})])],64)):(m(),n(v,{key:0},[w("div",oe,[r(l(U),{color:"text-base"},{default:b((()=>[y(o(l(_).baseText("instance_and_project_roles"===e.newProvisioningSetting?"settings.provisioningConfirmDialog.breakingChangeDescription.firstSentence.partOne.withProjectRoles":"settings.provisioningConfirmDialog.breakingChangeDescription.firstSentence.partOne")),1)])),_:1}),r(l(U),{class:T(t.$style.descriptionTextPartTwo),color:"text-base"},{default:b((()=>[y(o(l(_).baseText("settings.provisioningConfirmDialog.breakingChangeDescription.firstSentence.partTwo")),1)])),_:1},8,["class"])]),w("div",ne,[r(l(U),{color:"text-base"},{default:b((()=>[w("a",{href:`https://docs.n8n.io/user-management/${e.authProtocol}/setup/`,target:"_blank"},o(l(_).baseText("settings.provisioningConfirmDialog.link.docs")),9,ae)])),_:1})]),w("div",le,[P(r(l(U),{color:"text-base"},null,512),[[i,l(_).baseText("settings.provisioningConfirmDialog.breakingChangeDescription.secondLine")]])]),w("ul",{class:T([t.$style.list,"mb-s"])},[w("li",null,[r(l(U),{color:"text-base"},{default:b((()=>[y(o(l(_).baseText("settings.provisioningConfirmDialog.button.downloadInstanceRolesCsv")),1)])),_:1}),l(V)?(m(),u(l(j),{key:1,icon:"check",color:"success",class:T(t.$style.icon)},null,8,["class"])):(m(),u(l(R),{key:0,variant:"ghost","native-type":"button",icon:"file-download","data-test-id":"provisioning-download-instance-roles-csv-button",disabled:x.value,loading:x.value,class:T([t.$style.button,"n8n-button--highlight"]),onClick:F},null,8,["disabled","loading","class"]))]),A.value?(m(),n("li",ie,[r(l(U),{color:"text-base"},{default:b((()=>[y(o(l(_).baseText("settings.provisioningConfirmDialog.button.downloadProjectRolesCsv")),1)])),_:1}),l(D)?(m(),u(l(j),{key:1,icon:"check",color:"success",class:T(t.$style.icon)},null,8,["class"])):(m(),u(l(R),{key:0,variant:"ghost","native-type":"button",icon:"file-download","data-test-id":"provisioning-download-project-roles-csv-button",disabled:h.value,loading:h.value,class:T([t.$style.button,"n8n-button--highlight"]),onClick:q},null,8,["disabled","loading","class"]))])):a("",!0)],2)],64)),w("div",de,[r(l($),{class:T(t.$style.card)},{default:b((()=>[r(l(L),{modelValue:E.value,"onUpdate:modelValue":s[0]||(s[0]=e=>E.value=e),disabled:!B.value&&(!l(V)||A.value&&!l(D)),"data-test-id":"provisioning-confirmation-checkbox"},{label:b((()=>[r(l(U),{color:"text-base"},{default:b((()=>[y(o(l(_).baseText(`settings.provisioningConfirmDialog.${z.value}.checkbox`)),1)])),_:1})])),_:1},8,["modelValue","disabled"])])),_:1},8,["class"])])])),_:1},8,["modelValue","title"])}}}),ve=B(ge,[["__cssModules",{$style:{button:"_button_1bulq_126",card:"_card_1bulq_130",descriptionTextPartTwo:"_descriptionTextPartTwo_1bulq_134",icon:"_icon_1bulq_138",list:"_list_1bulq_143"}}]]),pe={class:"mt-2xs mb-s"},be={key:0},me={key:1},_e=B(c({__name:"SamlSettingsForm",setup(e){const t=k(),c=Z(),u=A(),d=H(),v=F(),p=i(!1),f=i(),_=i(!1),x="url",C="xml",P=i([{label:t.baseText("settings.sso.settings.ips.options.url"),value:x},{label:t.baseText("settings.sso.settings.ips.options.xml"),value:C}]),S=i(x),E=i(),j=i(),U=i(),$=i(!1),{formValue:V,isUserRoleProvisioningChanged:I,saveProvisioningConfig:O,shouldPromptUserToConfirmUserRoleProvisioningChange:B}=we(W.SAML),z=async()=>{const e=await c.getSamlConfig();U.value=e?.entityID,f.value=e?.returnUrl,e?.metadataUrl?S.value=x:e?.metadata&&(S.value=C),j.value=e?.metadata,E.value=e?.metadataUrl,_.value=e.loginEnabled??!1},q=s((()=>{if(p.value)return!1;const e=c.isSamlLoginEnabled!==_.value;return I.value||(S.value===x?!!E.value&&E.value!==c.samlConfig?.metadataUrl:S.value===C&&!!j.value&&j.value!==c.samlConfig?.metadata)||e})),G=s((()=>S.value===x?!!E.value:S.value===C&&!!j.value)),Y=async(e=!1)=>{try{p.value=!0,X();const s=_.value!==c.isSamlLoginEnabled&&!0===c.isSamlLoginEnabled;if(s&&"confirm"!==await(async()=>await v.confirm(t.baseText("settings.sso.confirmMessage.beforeSaveForm.message",{interpolate:{protocol:"SAML"}}),t.baseText("settings.sso.confirmMessage.beforeSaveForm.headline",{interpolate:{protocol:"SAML"}}),{cancelButtonText:t.baseText("settings.ldap.confirmMessage.beforeSaveForm.cancelButtonText"),confirmButtonText:t.baseText("settings.ldap.confirmMessage.beforeSaveForm.confirmButtonText")}))())return;if(!e&&B({currentLoginEnabled:!!c.isSamlLoginEnabled,loginEnabledFormValue:_.value}))return void($.value=!0);$.value=!1;const o=S.value===x?{metadataUrl:E.value}:{metadata:j.value};if(!c.isSamlLoginEnabled&&_.value&&(await c.saveSamlConfig(o),"confirm"!==await(async()=>{const e=await v.confirm(t.baseText("settings.sso.settings.save.testConnection.message"),t.baseText("settings.sso.settings.save.testConnection.title"),{confirmButtonText:t.baseText("settings.sso.settings.save.testConnection.test"),cancelButtonText:t.baseText("settings.sso.settings.save.activate.cancel")});return"confirm"===e?(await K(),await v.confirm(t.baseText("settings.sso.settings.save.confirmTestConnection.message"),t.baseText("settings.sso.settings.save.confirmTestConnection.title"),{confirmButtonText:t.baseText("settings.sso.settings.save.confirmTestConnection.confirm"),cancelButtonText:t.baseText("settings.sso.settings.save.activate.cancel")})):e})()))return;const n=await c.saveSamlConfig({...o,loginEnabled:_.value});await O(s),c.selectedAuthProtocol=W.SAML,await z(),(e=>{if(!e)return void Q("Single Sign-On SAML: telemtetry data undefined on submit",{level:"error"});const t={instance_id:J().instanceId,authentication_method:W.SAML,identity_provider:e.metadataUrl?"metadata":"xml",is_active:e.loginEnabled??!1};u.track("User updated single sign on settings",t)})(n)}catch(s){return void d.showError(s,t.baseText("settings.sso.settings.save.error"))}finally{p.value=!1}},K=async()=>{try{const e=await c.testSamlConfig();"undefined"!=typeof window&&window.open(e,"_blank")}catch(e){d.showError(e,"error")}},X=()=>{if(S.value===x)try{const e=new URL(E.value);if("https:"!==e.protocol&&"http:"!==e.protocol)throw new Error("The provided protocol is not supported")}catch(e){throw new Error(t.baseText("settings.sso.settings.ips.url.invalid"))}};return g((async()=>{await async function(){if(c.isEnterpriseSamlEnabled)try{await z()}catch(e){d.showError(e,"error")}}()})),(e,s)=>(m(),n("div",null,[w("div",{class:T(e.$style.group)},[w("label",null,o(l(t).baseText("settings.sso.settings.redirectUrl.label")),1),r(N,{value:f.value,"copy-button-text":l(t).baseText("generic.clickToCopy"),"toast-title":l(t).baseText("settings.sso.settings.redirectUrl.copied")},null,8,["value","copy-button-text","toast-title"]),w("small",null,o(l(t).baseText("settings.sso.settings.redirectUrl.help")),1)],2),w("div",{class:T(e.$style.group)},[w("label",null,o(l(t).baseText("settings.sso.settings.entityId.label")),1),r(N,{value:U.value,"copy-button-text":l(t).baseText("generic.clickToCopy"),"toast-title":l(t).baseText("settings.sso.settings.entityId.copied")},null,8,["value","copy-button-text","toast-title"]),w("small",null,o(l(t).baseText("settings.sso.settings.entityId.help")),1)],2),w("div",{class:T(e.$style.group)},[w("label",null,o(l(t).baseText("settings.sso.settings.ips.label")),1),w("div",pe,[r(l(M),{modelValue:S.value,"onUpdate:modelValue":s[0]||(s[0]=e=>S.value=e),options:P.value},null,8,["modelValue","options"])]),S.value===x?(m(),n("div",be,[r(l(D),{modelValue:E.value,"onUpdate:modelValue":s[1]||(s[1]=e=>E.value=e),type:"text",name:"metadataUrl",size:"large",placeholder:l(t).baseText("settings.sso.settings.ips.url.placeholder"),"data-test-id":"sso-provider-url"},null,8,["modelValue","placeholder"]),w("small",null,o(l(t).baseText("settings.sso.settings.ips.url.help")),1)])):a("",!0),S.value===C?(m(),n("div",me,[r(l(D),{modelValue:j.value,"onUpdate:modelValue":s[2]||(s[2]=e=>j.value=e),type:"textarea",name:"metadata",rows:4,"data-test-id":"sso-provider-xml"},null,8,["modelValue"]),w("small",null,o(l(t).baseText("settings.sso.settings.ips.xml.help")),1)])):a("",!0),r(se,{modelValue:l(V),"onUpdate:modelValue":s[3]||(s[3]=e=>h(V)?V.value=e:null),"auth-protocol":"saml"},null,8,["modelValue"]),r(ve,{modelValue:$.value,"onUpdate:modelValue":s[4]||(s[4]=e=>$.value=e),"new-provisioning-setting":l(V),"auth-protocol":"saml",onConfirmProvisioning:s[5]||(s[5]=e=>Y(!0)),onCancel:s[6]||(s[6]=e=>$.value=!1)},null,8,["modelValue","new-provisioning-setting"]),w("div",{class:T([e.$style.group,e.$style.checkboxGroup])},[r(l(L),{modelValue:_.value,"onUpdate:modelValue":s[7]||(s[7]=e=>_.value=e),"data-test-id":"sso-toggle",label:l(t).baseText("settings.sso.activated")},null,8,["modelValue","label"])],2)],2),w("div",{class:T(e.$style.buttons)},[r(l(R),{disabled:!q.value,loading:p.value,size:"large","data-test-id":"sso-save",onClick:s[8]||(s[8]=e=>Y(!1))},{default:b((()=>[y(o(l(t).baseText("settings.sso.settings.save")),1)])),_:1},8,["disabled","loading"]),r(l(R),{variant:"subtle",disabled:!G.value,size:"large","data-test-id":"sso-test",onClick:K},{default:b((()=>[y(o(l(t).baseText("settings.sso.settings.test")),1)])),_:1},8,["disabled"])],2)]))}}),[["__cssModules",{$style:fe={switch:"_switch_1blmf_128",buttons:"_buttons_1blmf_134",group:"_group_1blmf_143",checkboxGroup:"_checkboxGroup_1blmf_159",actionBox:"_actionBox_1blmf_163",footer:"_footer_1blmf_167"}}]]),xe=B(c({__name:"OidcSettingsForm",setup(e){const t=k(),a=Z(),c=A(),u=H(),d=F(),p=i(!1),f=i(""),_=i(""),C=i(""),P=i(!1),{formValue:S,isUserRoleProvisioningChanged:E,saveProvisioningConfig:j,shouldPromptUserToConfirmUserRoleProvisioningChange:U}=we(W.OIDC),$=i("select_account"),M=e=>{$.value=e},O=[{label:t.baseText("settings.sso.settings.oidc.prompt.login"),value:"login"},{label:t.baseText("settings.sso.settings.oidc.prompt.none"),value:"none"},{label:t.baseText("settings.sso.settings.oidc.prompt.consent"),value:"consent"},{label:t.baseText("settings.sso.settings.oidc.prompt.select_account"),value:"select_account"},{label:t.baseText("settings.sso.settings.oidc.prompt.create"),value:"create"}],B=i(""),z=async()=>{const e=await a.getOidcConfig();_.value=e.clientId,C.value=e.clientSecret,f.value=e.discoveryEndpoint,$.value=e.prompt??"select_account",B.value=e.authenticationContextClassReference?.join(",")||""},q=s((()=>{const e=B.value.split(",").map((e=>e.trim())).filter(Boolean).join(","),t=a.oidcConfig?.authenticationContextClassReference?.join(",")||"";return a.oidcConfig?.clientId===_.value&&a.oidcConfig?.clientSecret===C.value&&a.oidcConfig?.discoveryEndpoint===f.value&&a.oidcConfig?.loginEnabled===a.isOidcLoginEnabled&&a.oidcConfig?.prompt===$.value&&!E.value&&t===B.value&&e===t}));async function G(e=!1){if(!e&&U({currentLoginEnabled:!!a.oidcConfig?.loginEnabled,loginEnabledFormValue:a.isOidcLoginEnabled}))return void(P.value=!0);const s=a.oidcConfig?.loginEnabled!==a.isOidcLoginEnabled&&!0===a.oidcConfig?.loginEnabled;if(s&&"confirm"!==await d.confirm(t.baseText("settings.sso.confirmMessage.beforeSaveForm.message",{interpolate:{protocol:"OIDC"}}),t.baseText("settings.sso.confirmMessage.beforeSaveForm.headline",{interpolate:{protocol:"OIDC"}}),{cancelButtonText:t.baseText("settings.ldap.confirmMessage.beforeSaveForm.cancelButtonText"),confirmButtonText:t.baseText("settings.ldap.confirmMessage.beforeSaveForm.confirmButtonText")}))return;const o=B.value.split(",").map((e=>e.trim())).filter(Boolean);try{p.value=!0;const e=await a.saveOidcConfig({clientId:_.value,clientSecret:C.value,discoveryEndpoint:f.value,prompt:$.value,loginEnabled:a.isOidcLoginEnabled,authenticationContextClassReference:o});await j(s),P.value=!1,a.selectedAuthProtocol=W.OIDC,C.value=e.clientSecret,function(e){const t={instance_id:J().instanceId,authentication_method:W.OIDC,discovery_endpoint:e.discoveryEndpoint,is_active:e.loginEnabled};c.track("User updated single sign on settings",t)}(e)}catch(n){return void u.showError(n,t.baseText("settings.sso.settings.save.error_oidc"))}finally{p.value=!1,await z()}}return g((async()=>{await(async()=>{if(a.isEnterpriseOidcEnabled)try{await z()}catch(e){u.showError(e,"error")}})()})),(e,s)=>(m(),n("div",null,[w("div",{class:T(e.$style.group)},[s[10]||(s[10]=w("label",null,"Redirect URL",-1)),r(N,{value:l(a).oidc.callbackUrl,"copy-button-text":l(t).baseText("generic.clickToCopy"),"toast-title":"Redirect URL copied to clipboard"},null,8,["value","copy-button-text"]),s[11]||(s[11]=w("small",null,"Copy the Redirect URL to configure your OIDC provider ",-1))],2),w("div",{class:T(e.$style.group)},[s[12]||(s[12]=w("label",null,"Discovery Endpoint",-1)),r(l(D),{"model-value":f.value,type:"text","data-test-id":"oidc-discovery-endpoint",placeholder:"https://accounts.google.com/.well-known/openid-configuration","onUpdate:modelValue":s[0]||(s[0]=e=>f.value=e)},null,8,["model-value"]),s[13]||(s[13]=w("small",null,"Paste here your discovery endpoint",-1))],2),w("div",{class:T(e.$style.group)},[s[14]||(s[14]=w("label",null,"Client ID",-1)),r(l(D),{"model-value":_.value,type:"text","data-test-id":"oidc-client-id","onUpdate:modelValue":s[1]||(s[1]=e=>_.value=e)},null,8,["model-value"]),s[15]||(s[15]=w("small",null,"The client ID you received when registering your application with your provider",-1))],2),w("div",{class:T(e.$style.group)},[s[16]||(s[16]=w("label",null,"Client Secret",-1)),r(l(D),{"model-value":C.value,type:"password","data-test-id":"oidc-client-secret","onUpdate:modelValue":s[2]||(s[2]=e=>C.value=e)},null,8,["model-value"]),s[17]||(s[17]=w("small",null,"The client Secret you received when registering your application with your provider",-1))],2),w("div",{class:T(e.$style.group)},[s[18]||(s[18]=w("label",null,"Prompt",-1)),r(l(V),{"model-value":$.value,"data-test-id":"oidc-prompt","onUpdate:modelValue":M},{default:b((()=>[(m(),n(v,null,x(O,(e=>r(l(I),{key:e.value,label:e.label,"data-test-id":"oidc-prompt-filter-option",value:e.value},null,8,["label","value"]))),64))])),_:1},8,["model-value"]),s[19]||(s[19]=w("small",null,"The prompt parameter to use when authenticating with the OIDC provider",-1))],2),r(se,{modelValue:l(S),"onUpdate:modelValue":s[3]||(s[3]=e=>h(S)?S.value=e:null),"auth-protocol":"oidc"},null,8,["modelValue"]),r(ve,{modelValue:P.value,"onUpdate:modelValue":s[4]||(s[4]=e=>P.value=e),"new-provisioning-setting":l(S),"auth-protocol":"oidc",onConfirmProvisioning:s[5]||(s[5]=e=>G(!0)),onCancel:s[6]||(s[6]=e=>P.value=!1)},null,8,["modelValue","new-provisioning-setting"]),w("div",{class:T(e.$style.group)},[s[20]||(s[20]=w("label",null,"Authentication Context Class Reference",-1)),r(l(D),{"model-value":B.value,type:"textarea","data-test-id":"oidc-authentication-context-class-reference",placeholder:"mfa, phrh, pwd","onUpdate:modelValue":s[7]||(s[7]=e=>B.value=e)},null,8,["model-value"]),s[21]||(s[21]=w("small",null,"ACR values to include in the authorization request (acr_values parameter), separated by commas in order of preference.",-1))],2),w("div",{class:T([e.$style.group,e.$style.checkboxGroup])},[r(l(L),{modelValue:l(a).isOidcLoginEnabled,"onUpdate:modelValue":s[8]||(s[8]=e=>l(a).isOidcLoginEnabled=e),"data-test-id":"sso-oidc-toggle",label:l(t).baseText("settings.sso.activated")},null,8,["modelValue","label"])],2),w("div",{class:T(e.$style.buttons)},[r(l(R),{"data-test-id":"sso-oidc-save",size:"large",loading:p.value,disabled:p.value||q.value,onClick:s[9]||(s[9]=e=>G(!1))},{default:b((()=>[y(o(l(t).baseText("settings.sso.settings.save")),1)])),_:1},8,["loading","disabled"])],2)]))}}),[["__cssModules",{$style:fe}]]),ye={class:"pb-2xl"},he={href:"https://docs.n8n.io/user-management/saml/",target:"_blank"},Ce={key:1,"data-test-id":"sso-content-licensed"},Te={key:2,"data-test-id":"sso-content-licensed"},e("default",B(c({__name:"SettingsSso",setup(e){const t=k(),c=Z(),d=G(),p=K(),f=s((()=>[{label:W.SAML.toUpperCase(),value:W.SAML},{label:c.isEnterpriseOidcEnabled?W.OIDC.toUpperCase():`${W.OIDC.toUpperCase()} (${t.baseText("generic.upgradeToEnterprise")})`,value:W.OIDC}])),h=s((()=>c.isEnterpriseSamlEnabled||c.isEnterpriseOidcEnabled)),C=i(W.SAML);function P(e){C.value=e}const R=()=>{p.goToUpgrade("sso","upgrade-sso")};return g((()=>{d.set(t.baseText("settings.sso.title")),c.initializeSelectedProtocol(),C.value=c.selectedAuthProtocol||W.SAML})),(e,s)=>(m(),n("div",ye,[w("div",{class:T(e.$style.heading)},[r(l(O),{size:"2xlarge"},{default:b((()=>[y(o(l(t).baseText("settings.sso.title")),1)])),_:1})],2),r(l(E),null,{default:b((()=>[y(o(l(t).baseText("settings.sso.info"))+" ",1),w("a",he,o(l(t).baseText("settings.sso.info.link")),1)])),_:1}),h.value?(m(),n("div",{key:0,"data-test-id":"sso-auth-protocol-select",class:T(e.shared.group)},[s[1]||(s[1]=w("label",null,"Select Authentication Protocol",-1)),w("div",null,[r(l(V),{filterable:"","model-value":C.value,placeholder:l(t).baseText("parameterInput.select"),"onUpdate:modelValue":P,onKeydown:s[0]||(s[0]=_((()=>{}),["stop"]))},{default:b((()=>[(m(!0),n(v,null,x(f.value,(({label:e,value:t})=>(m(),u(l(I),{key:t,value:t,label:e,"data-test-id":"credential-select-option"},null,8,["value","label"])))),128))])),_:1},8,["model-value","placeholder"])])],2)):a("",!0),l(c).isEnterpriseSamlEnabled&&C.value===l(W).SAML?(m(),n("div",Ce,[r(_e)])):a("",!0),l(c).isEnterpriseOidcEnabled&&C.value===l(W).OIDC?(m(),n("div",Te,[r(xe)])):a("",!0),h.value?a("",!0):(m(),u(l(S),{key:3,"data-test-id":"sso-content-unlicensed",class:T(e.$style.actionBox),description:l(t).baseText("settings.sso.actionBox.description"),"button-text":l(t).baseText("settings.sso.actionBox.buttonText"),"onClick:button":R},{heading:b((()=>[w("span",null,o(l(t).baseText("settings.sso.actionBox.title")),1)])),_:1},8,["class","description","button-text"]))]))}}),[["__cssModules",{shared:fe,$style:{heading:"_heading_bewbd_125",actionBox:"_actionBox_bewbd_129"}}]]))}}}));
//# sourceMappingURL=SettingsSso-legacy-BesgaRHY.js.map