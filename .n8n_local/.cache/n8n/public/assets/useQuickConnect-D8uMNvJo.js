(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`8b1f0856-3344-46c3-8a4e-121dd5faf7a0`,e._sentryDebugIdIdentifier=`sentry-dbid-8b1f0856-3344-46c3-8a4e-121dd5faf7a0`)})()}catch{}import{C as e,It as t}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as n}from"./_MapCache-DjbOQyB7.js";import{Fr as r,Gt as i,Lt as a,rt as o,s,ws as c,yr as l}from"./users.store-pCkD7Zo0.js";import{Bc as u,Ri as d,zi as f}from"./constants-D1jZwsUK.js";function p(){let e=o(),r=i(),c=s(),u=l(),p=n(),m=a(),h=t(null),g=t(null);function _(t,n=new Set){if(n.has(t))return[];n.add(t);let r=e.getCredentialTypeByName(t);if(r?.extends===void 0)return[];let i=[];for(let e of r.extends)i.push(e),i.push(..._(e,n));return i}function v(e){let t=_(e);return e===`oAuth2Api`||e===`oAuth1Api`||t.includes(`oAuth2Api`)||t.includes(`oAuth1Api`)}function y(e){let t=_(e);return e===`googleOAuth2Api`||t.includes(`googleOAuth2Api`)}function b(t){if(!v(t))return!1;let n=e.getCredentialTypeByName(t);if(!n)return!1;let r=n.__overwrittenProperties??[];return r.length===0?!1:n.properties.filter(e=>e.type!==`hidden`&&e.type!==`notice`&&!r.includes(e.name)).every(e=>e.required!==!0||e.type!==`string`&&e.type!==`number`)}async function x(t){let n=_(t.type);try{if(t.type===`oAuth2Api`||n.includes(`oAuth2Api`))return f(await e.oAuth2Authorize(t));if(t.type===`oAuth1Api`||n.includes(`oAuth1Api`))return f(await e.oAuth1Authorize(t))}catch(e){return u.showError(e,p.baseText(`credentialEdit.credentialEdit.showError.generateAuthorizationUrl.title`)),d(`api-error`)}return d(`no-url`)}function S(e){try{let t=new URL(e);return[`http:`,`https:`].includes(t.protocol)}catch{return!1}}function C(){u.showError(Error(p.baseText(`credentialEdit.credentialEdit.showError.invalidOAuthUrl.message`)),p.baseText(`credentialEdit.credentialEdit.showError.invalidOAuthUrl.title`))}function w(e,t){let n=window.open(e,`OAuth Authorization`,`scrollbars=no,resizable=yes,status=no,titlebar=no,location=no,toolbar=no,menubar=no,width=500,height=700`);return t?.addEventListener(`abort`,()=>{n?.close()}),n}async function T(e,t){return await new Promise(n=>{let r=new BroadcastChannel(`oauth-callback`),i=!1,a=e=>{i||(i=!0,r.close(),n(e))};t?.addEventListener(`abort`,()=>{a(!1)}),r.addEventListener(`message`,t=>{e.close(),t.data===`success`?(u.showMessage({title:p.baseText(`nodeCredentials.oauth.accountConnected`),type:`success`}),a(!0)):(u.showMessage({title:p.baseText(`nodeCredentials.oauth.accountConnectionFailed`),type:`error`}),a(!1))})})}async function E(e,t){let n=await x(e);if(!n.ok)return n.error===`no-url`&&C(),!1;if(!S(n.result))return C(),!1;let r=w(n.result,t);return r?await T(r,t):(C(),!1)}async function D(t,n){let i=e.getCredentialTypeByName(t);if(!i)return null;let a;try{a=await e.createNewCredential({id:``,name:i.displayName,type:t,data:{allowedHttpRequestDomains:`none`}},r.currentProject?.id,void 0,{skipStoreUpdate:!0}),m.track(`User created credentials`,{credential_type:a.type,credential_id:a.id,workflow_id:c.workflowId})}catch(e){return u.showError(e,p.baseText(`nodeCredentials.showMessage.title`)),null}let o=new AbortController;h.value=o,g.value=a.id;let s=await E(a,o.signal);h.value=null,g.value=null;let l={credential_type:t,workflow_id:c.workflowId??null,credential_id:a.id,is_complete:!0,is_new:!0,is_valid:s,uses_external_secrets:!1};return n&&(l.node_type=n),m.track(`User saved credentials`,l),s?(e.upsertCredential(a),a):(e.deleteCredential({id:a.id}),null)}function O(){h.value&&h.value.abort(),g.value&&e.deleteCredential({id:g.value})}return{getParentTypes:_,isOAuthCredentialType:v,isGoogleOAuthType:y,hasManagedOAuthCredentials:b,authorize:E,createAndAuthorize:D,cancelAuthorize:O}}function m(){let t=c(),n=r(),i=a(),{isOAuthCredentialType:o,createAndAuthorize:s,cancelAuthorize:l}=p(),d=e(()=>n.isVariantEnabled(u.name,u.variant)),f=e(()=>{let e=new Map;for(let n of t.moduleSettings[`quick-connect`]?.options??[])e.set(n.credentialType,n);return e}),m=e(()=>{let e=new Map;for(let n of t.moduleSettings[`quick-connect`]?.options??[])e.has(n.packageName)||e.set(n.packageName,n);return e});function h(e,t){if(!d.value||f.value.size===0)return;let n=f.value.get(e);if(!n)return;let r=t.split(`.`)[0];return n.packageName===r?n:void 0}function g(e){if(!(!d.value||m.value.size===0))return m.value.get(e)}function _(e){if(!(!d.value||f.value.size===0))for(let t of e){let e=f.value.get(t);if(e)return e}}async function v(e){let{credentialTypeName:t,nodeType:n,source:r}=e;return i.track(`User clicked quick connect button`,{source:r,credential_type:t,node_type:n}),h(t,n)?null:o(t)?await s(t,n):null}return{isQuickConnectEnabled:d,getQuickConnectOption:h,getQuickConnectOptionByPackageName:g,getQuickConnectOptionByCredentialTypes:_,connect:v,cancelConnect:l}}export{p as n,m as t};
//# sourceMappingURL=useQuickConnect-D8uMNvJo.js.map