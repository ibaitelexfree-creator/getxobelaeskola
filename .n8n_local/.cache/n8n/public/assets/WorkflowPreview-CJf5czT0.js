(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`c10ae5e0-b9f0-4242-8c0a-c3160fe3eaa2`,e._sentryDebugIdIdentifier=`sentry-dbid-c10ae5e0-b9f0-4242-8c0a-c3160fe3eaa2`)})()}catch{}import{C as e,D as t,E as n,Gt as r,It as i,J as a,M as o,P as s,Z as c,_t as l,et as u,vn as d,w as f}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as p}from"./_MapCache-DjbOQyB7.js";import{Et as m,F as h}from"./src-CppJvwzX.js";import{t as g}from"./_plugin-vue_export-helper-B_J4Khre.js";import{Gt as _,yr as v}from"./users.store-pCkD7Zo0.js";import{t as y}from"./executions.store-DnLtKXBA.js";var b=[`src`],x=g(s({__name:`WorkflowPreview`,props:{loading:{type:Boolean,default:!1},mode:{default:`workflow`},workflow:{default:void 0},executionId:{default:void 0},executionMode:{default:void 0},nodeId:{default:void 0},loaderType:{default:`image`},canOpenNDV:{type:Boolean,default:!0},hideNodeIssues:{type:Boolean,default:!1},focusOnLoad:{type:Boolean,default:!0},hideControls:{type:Boolean,default:!1}},emits:[`close`,`ready`],setup(s,{emit:g}){let x=s,S=g,C=p(),w=v(),T=y(),E=_(),D=i(null),O=i(!1),k=i(!1),A=i(!1),j=i(0),M=i(0),N=e(()=>{let e=`${window.BASE_PATH??`/`}workflows/demo`;return x.hideControls?`${e}?hideControls=true`:e}),P=e(()=>!x.loading&&(x.mode===`workflow`&&!!x.workflow||x.mode===`execution`&&!!x.executionId)&&k.value),F=()=>{try{if(!x.workflow)throw Error(C.baseText(`workflowPreview.showError.missingWorkflow`));if(!x.workflow.nodes||!Array.isArray(x.workflow.nodes))throw Error(C.baseText(`workflowPreview.showError.arrayEmpty`));D.value?.contentWindow?.postMessage?.(JSON.stringify({command:`openWorkflow`,workflow:x.workflow,canOpenNDV:x.canOpenNDV,hideNodeIssues:x.hideNodeIssues,projectId:E.currentProjectId}),`*`)}catch(e){w.showError(e,C.baseText(`workflowPreview.showError.previewError.title`),C.baseText(`workflowPreview.showError.previewError.message`))}},I=()=>{try{if(!x.executionId)throw Error(C.baseText(`workflowPreview.showError.missingExecution`));D.value?.contentWindow?.postMessage?.(JSON.stringify({command:`openExecution`,executionId:x.executionId,executionMode:x.executionMode??``,nodeId:x.nodeId,canOpenNDV:x.canOpenNDV,projectId:E.currentProjectId}),`*`),T.activeExecution&&D.value?.contentWindow?.postMessage?.(JSON.stringify({command:`setActiveExecution`,executionId:T.activeExecution.id}),`*`)}catch(e){w.showError(e,C.baseText(`workflowPreview.showError.previewError.title`),C.baseText(`workflowPreview.executionMode.showError.previewError.message`))}},L=()=>{A.value=!0,j.value=window.scrollX,M.value=window.scrollY},R=()=>{A.value=!1},z=({data:e})=>{if(e?.includes?.(`"command"`))try{let t=JSON.parse(e);t.command===`n8nReady`?B():t.command===`openNDV`?V():t.command===`closeNDV`?H():t.command===`error`&&U()}catch(e){console.error(e)}},B=()=>{k.value=!0,x.focusOnLoad&&setTimeout(()=>{D.value?.contentWindow?.focus()}),S(`ready`)},V=()=>{O.value=!0},H=()=>{O.value=!1},U=()=>{S(`close`)},W=()=>{A.value&&window.scrollTo(j.value,M.value)};return c(()=>{window.addEventListener(`message`,z),document.addEventListener(`scroll`,W)}),a(()=>{window.removeEventListener(`message`,z),document.removeEventListener(`scroll`,W)}),l(()=>P.value,()=>{P.value&&(x.mode===`workflow`?F():x.mode===`execution`&&I())}),l(()=>x.executionId,()=>{x.mode===`execution`&&x.executionId&&I()}),l(()=>x.workflow,()=>{x.mode===`workflow`&&x.workflow&&F()}),(e,i)=>(u(),t(`div`,{class:d(e.$style.container)},[s.loaderType===`image`&&!P.value?(u(),t(`div`,{key:0,class:d(e.$style.imageLoader)},[o(r(m),{loading:!P.value,rows:1,variant:`image`},null,8,[`loading`])],2)):s.loaderType===`spinner`&&!P.value?(u(),t(`div`,{key:1,class:d(e.$style.spinner)},[o(r(h),{type:`dots`})],2)):n(``,!0),f(`iframe`,{ref_key:`iframeRef`,ref:D,class:d({[e.$style.workflow]:!O.value,[e.$style.executionPreview]:s.mode===`execution`,[e.$style.openNDV]:O.value,[e.$style.show]:P.value}),src:N.value,"data-test-id":`workflow-preview-iframe`,onMouseenter:L,onMouseleave:R},null,42,b)],2))}}),[[`__cssModules`,{$style:{container:`_container_ycaoi_125`,workflow:`_workflow_ycaoi_132`,show:`_show_ycaoi_138`,openNDV:`_openNDV_ycaoi_144`,spinner:`_spinner_ycaoi_153`,imageLoader:`_imageLoader_ycaoi_161`,executionPreview:`_executionPreview_ycaoi_169`}}]]);export{x as t};
//# sourceMappingURL=WorkflowPreview-CJf5czT0.js.map