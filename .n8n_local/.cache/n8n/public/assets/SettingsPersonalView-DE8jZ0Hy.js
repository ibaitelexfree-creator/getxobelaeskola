(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`2562a7a8-206f-419c-b05a-c0194e6f5235`,e._sentryDebugIdIdentifier=`sentry-dbid-2562a7a8-206f-419c-b05a-c0194e6f5235`)})()}catch{}import{C as e,Cn as t,D as n,E as r,Gt as i,It as a,J as ee,M as o,P as te,T as s,Z as ne,_ as re,bt as c,et as l,it as ie,j as u,vn as d,w as f}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as ae}from"./_MapCache-DjbOQyB7.js";import{Hi as p,Oi as oe,U as se,Vi as m,ft as ce,gi as h,gt as le,it as ue,ot as g,pt as de,wt as fe,zi as _}from"./src-CppJvwzX.js";import{t as v}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{fn as pe,lr as me,r as y,t as he,ws as ge,yr as _e}from"./users.store-pCkD7Zo0.js";import{Ts as b,cs as x,os as ve,ti as S,v as ye,ys as C}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import{r as w,t as be}from"./auth.eventBus-OiCaRLlR.js";import{n as T}from"./sso.store-Dd63iqNy.js";var E={class:`mb-s`},D={"data-test-id":`personal-data-form`},O={key:0},k={class:`mb-s`},A={class:`mb-s`},j={key:0,"data-test-id":`mfa-section`},M={class:`mb-xs`},N={class:`mb-s`},P=v(te({__name:`SettingsPersonalView`,setup(te){let v=ae(),{showToast:P,showError:F}=_e(),xe=pe(),I=a(!1),L=a(null),R=le(),z=a(!1),B=a(y().theme),Se=a([{name:`system`,label:`settings.personal.theme.systemDefault`},{name:`light`,label:`settings.personal.theme.light`},{name:`dark`,label:`settings.personal.theme.dark`}]),V=y(),H=he(),U=ge(),W=T(),Ce=me(),G=e(()=>H.currentUser),K=e(()=>{let e=W.isEnterpriseLdapEnabled&&G.value?.signInType===`ldap`,t=W.isSamlLoginEnabled&&W.isDefaultAuthenticationSaml,n=W.isEnterpriseOidcEnabled&&G.value?.signInType===`oidc`;return e||t||n}),q=e(()=>H.isInstanceOwner||!K.value),J=e(()=>!H.mfaEnabled),we=e(()=>U.isMFAEnforced),Te=e(()=>U.isMfaFeatureEnabled),Y=e(()=>B.value!==V.theme),Ee=e(()=>I.value||Y.value),De=e(()=>({[S.Default]:{name:v.baseText(`auth.roles.default`),description:v.baseText(`settings.personal.role.tooltip.default`)},[S.Member]:{name:v.baseText(`auth.roles.member`),description:v.baseText(`settings.personal.role.tooltip.member`)},[S.ChatUser]:{name:v.baseText(`auth.roles.chatUser`),description:v.baseText(`settings.personal.role.tooltip.chatUser`)},[S.Admin]:{name:v.baseText(`auth.roles.admin`),description:v.baseText(`settings.personal.role.tooltip.admin`)},[S.Owner]:{name:v.baseText(`auth.roles.owner`),description:v.baseText(`settings.personal.role.tooltip.owner`,{interpolate:{cloudAccess:Ce.hasCloudPlan?v.baseText(`settings.personal.role.tooltip.cloud`):``}})}})),X=e(()=>De.value[H.globalRoleName]);ne(()=>{xe.set(v.baseText(`settings.personal.personalSettings`)),L.value=[{name:`firstName`,initialValue:G.value?.firstName,properties:{label:v.baseText(`auth.firstName`),maxlength:32,required:!0,autocomplete:`given-name`,capitalize:!0,disabled:K.value}},{name:`lastName`,initialValue:G.value?.lastName,properties:{label:v.baseText(`auth.lastName`),maxlength:32,required:!0,autocomplete:`family-name`,capitalize:!0,disabled:K.value}},{name:`email`,initialValue:G.value?.email,properties:{label:v.baseText(`auth.email`),type:`email`,required:!0,validationRules:[{name:`VALID_EMAIL`}],autocomplete:`email`,capitalize:!0,disabled:!q.value}}]});function Oe(){I.value=!0}function ke(e){z.value=e}async function Z(e){try{await je(e),await Q(),P({title:v.baseText(`settings.personal.personalSettingsUpdated`),message:``,type:`success`})}catch(e){F(e,v.baseText(`settings.personal.personalSettingsUpdatedError`))}}async function Ae(e){let t=e,n=H.currentUser?.email!==t.email;H.currentUser?.mfaEnabled&&n?(V.openModal(b),w.once(`closed`,async e=>{e&&await Z({...t,mfaCode:e.mfaCode})})):n?(V.openModal(x),be.once(`close`,async e=>{e&&(await Z({...t,currentPassword:e.currentPassword}),V.closeModal(x))})):await Z(t)}async function je(e){!I.value||!H.currentUserId||(await H.updateUser({firstName:e.firstName,lastName:e.lastName,email:e.email,mfaCode:e.mfaCode,currentPassword:e.currentPassword}),I.value=!1)}async function Q(){Y.value&&V.setTheme(B.value)}function Me(){R.emit(`submit`)}function Ne(){V.openModal(ve)}async function Pe(){if(!U.isCloudDeployment||!H.isInstanceOwner){V.openModal(C);return}try{await H.canEnableMFA(),V.openModal(C)}catch(e){P({title:v.baseText(`settings.personal.mfa.toast.canEnableMfa.title`),message:e.message,type:`error`}),await H.sendConfirmationEmail()}}async function $(e){if(e)try{await H.disableMfa(e),P({title:v.baseText(`settings.personal.mfa.toast.disabledMfa.title`),message:v.baseText(`settings.personal.mfa.toast.disabledMfa.message`),type:`success`,duration:0})}catch(e){F(e,v.baseText(`settings.personal.mfa.toast.disabledMfa.error.message`))}}async function Fe(){V.openModal(b),w.once(`closed`,$)}return ee(()=>{w.off(`closed`,$)}),(e,a)=>(l(),n(`div`,{class:d(e.$style.container),"data-test-id":`personal-settings-container`},[f(`div`,{class:d(e.$style.header)},[o(i(_),{size:`2xlarge`},{default:c(()=>[u(t(i(v).baseText(`settings.personal.personalSettings`)),1)]),_:1}),G.value?(l(),n(`div`,{key:0,class:d(e.$style.user)},[f(`span`,{class:d(e.$style.username),"data-test-id":`current-user-name`},[o(i(m),{color:`text-base`,bold:``},{default:c(()=>[u(t(G.value.fullName),1)]),_:1}),o(i(oe),{placement:`bottom`},{content:c(()=>[u(t(X.value.description),1)]),default:c(()=>[o(i(m),{class:d(e.$style.tooltip),color:`text-light`,"data-test-id":`current-user-role`},{default:c(()=>[u(t(X.value.name),1)]),_:1},8,[`class`])]),_:1})],2),o(i(fe),{"first-name":G.value.firstName,"last-name":G.value.lastName,size:`large`},null,8,[`first-name`,`last-name`])],2)):r(``,!0)],2),f(`div`,null,[f(`div`,E,[o(i(_),{size:`large`},{default:c(()=>[u(t(i(v).baseText(`settings.personal.basicInformation`)),1)]),_:1})]),f(`div`,D,[L.value?(l(),s(i(ue),{key:0,inputs:L.value,"event-bus":i(R),onUpdate:Oe,onReady:ke,onSubmit:Ae},null,8,[`inputs`,`event-bus`])):r(``,!0)])]),q.value?(l(),n(`div`,O,[f(`div`,k,[o(i(_),{size:`large`},{default:c(()=>[u(t(i(v).baseText(`settings.personal.security`)),1)]),_:1})]),f(`div`,A,[o(i(g),{label:i(v).baseText(`auth.password`)},{default:c(()=>[o(i(h),{"data-test-id":`change-password-link`,onClick:Ne},{default:c(()=>[u(t(i(v).baseText(`auth.changePassword`)),1)]),_:1})]),_:1},8,[`label`])]),Te.value?(l(),n(`div`,j,[f(`div`,M,[o(i(g),{label:i(v).baseText(`settings.personal.mfa.section.title`)},null,8,[`label`]),o(i(m),{bold:!1,class:d(e.$style.infoText)},{default:c(()=>[u(t(J.value?i(v).baseText(`settings.personal.mfa.button.disabled.infobox`):i(v).baseText(`settings.personal.mfa.button.enabled.infobox`))+` `,1),o(i(h),{to:i(ye),size:`small`,bold:!0},{default:c(()=>[u(t(i(v).baseText(`generic.learnMore`)),1)]),_:1},8,[`to`])]),_:1},8,[`class`])]),J.value&&we.value?(l(),s(i(se),{key:0,content:i(v).baseText(`settings.personal.mfa.enforced`)},null,8,[`content`])):r(``,!0),J.value?(l(),s(i(p),{key:1,variant:`subtle`,class:d(e.$style.button),label:i(v).baseText(`settings.personal.mfa.button.enabled`),"data-test-id":`enable-mfa-button`,onClick:Pe},null,8,[`class`,`label`])):(l(),s(i(p),{key:2,variant:`subtle`,class:d(e.$style.disableMfaButton),label:i(v).baseText(`settings.personal.mfa.button.disabled`),"data-test-id":`disable-mfa-button`,onClick:Fe},null,8,[`class`,`label`]))])):r(``,!0)])):r(``,!0),f(`div`,null,[f(`div`,N,[o(i(_),{size:`large`},{default:c(()=>[u(t(i(v).baseText(`settings.personal.personalisation`)),1)]),_:1})]),f(`div`,null,[o(i(g),{label:i(v).baseText(`settings.personal.theme`)},{default:c(()=>[o(i(ce),{modelValue:B.value,"onUpdate:modelValue":a[0]||=e=>B.value=e,class:d(e.$style.themeSelect),"data-test-id":`theme-select`,size:`small`,filterable:``},{default:c(()=>[(l(!0),n(re,null,ie(Se.value,e=>(l(),s(i(de),{key:e.name,label:i(v).baseText(e.label),value:e.name},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`,`class`])]),_:1},8,[`label`])])]),f(`div`,null,[o(i(p),{float:`right`,label:i(v).baseText(`settings.personal.save`),size:`large`,disabled:!Ee.value||!z.value,"data-test-id":`save-settings-button`,onClick:Me},null,8,[`label`,`disabled`])])],2))}}),[[`__cssModules`,{$style:{container:`_container_7zt8s_125`,header:`_header_7zt8s_132`,user:`_user_7zt8s_141`,username:`_username_7zt8s_151`,tooltip:`_tooltip_7zt8s_164`,disableMfaButton:`_disableMfaButton_7zt8s_168`,button:`_button_7zt8s_172`,infoText:`_infoText_7zt8s_179`,themeSelect:`_themeSelect_7zt8s_184`}}]]);export{P as default};
//# sourceMappingURL=SettingsPersonalView-DE8jZ0Hy.js.map