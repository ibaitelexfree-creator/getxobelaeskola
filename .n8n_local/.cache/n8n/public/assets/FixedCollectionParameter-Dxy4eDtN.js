(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`4cbb1f67-794f-40a5-b80b-6ade41560076`,e._sentryDebugIdIdentifier=`sentry-dbid-4cbb1f67-794f-40a5-b80b-6ade41560076`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{C as t,Cn as n,D as r,E as i,G as a,Gt as o,It as s,M as c,P as l,T as u,Ut as d,W as f,_ as p,_t as m,bt as h,et as g,h as _,it as v,j as y,jt as b,k as x,mt as ee,q as te,vn as S,w as C,y as ne}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{Q as w,yt as re}from"./_MapCache-DjbOQyB7.js";import{Dt as T,Hi as E,Mi as D,Oi as ie,Ui as O,Vi as k,ft as ae,lt as A,m as j,nt as M,ot as oe,pt as se,tt as N,vt as ce}from"./src-CppJvwzX.js";import{t as P}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import"./date-picker-CHH0vNVG.js";import{Bt as le,It as ue,s as de,zr as F,zt as fe}from"./users.store-pCkD7Zo0.js";import{F as pe,c as I,r as L,s as R,t as z}from"./ParameterInputList-BmOOAGJV.js";import{Ha as B,Ia as V,Po as H}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import{N as me}from"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import"./useClipboard-Duc7LjuO.js";import"./executions.store-DnLtKXBA.js";import"./assistant.store-BGYzebcZ.js";import"./chatPanel.store-YdM_XYGp.js";import"./RunData-DoJODYvb.js";import"./NDVEmptyState-Cd-QhxaI.js";import"./useEnvFeatureFlag-CHY3xSda.js";import"./externalSecrets.ee.store-RuZGBiOy.js";import"./uniqBy-Bd2DEoH8.js";import"./usePinnedData-C6FFXoty.js";import"./nodeIcon--7uU1Imq.js";import"./canvas.utils-C8dCdoZZ.js";import"./nodeCreator.store-KD9kt9dE.js";import"./useCanvasOperations-BHGWcL34.js";import"./folders.store-CS_gIPIm.js";import"./useQuickConnect-D8uMNvJo.js";import"./CredentialIcon-B1JZV04S.js";import"./useDynamicCredentials-BSZ25lEI.js";import"./RunDataHtml-Dkm6vMd9.js";import"./Draggable-YWqutRc8.js";import"./NodeIcon-Dv1e4Lvu.js";import"./VirtualSchema-SoERffbL.js";import"./useCalloutHelpers-BqZQxC7j.js";import"./useTelemetryContext-Dq1_6uNp.js";import"./useRunWorkflow-DzzlHC01.js";import"./pushConnection.store-IFO3HVvG.js";import"./nodeTransforms-CG9uauaw.js";import"./vue-json-pretty-CT_xxsnb.js";import"./collaboration.store-QKYwE2H2.js";import"./dateFormatter-C82w-7IH.js";import"./useExecutionHelpers-mcaelfkG.js";import"./vue-BgT2pM2d.js";var U=e(j(),1),he=e(H(),1),ge=e(L(),1),W=[`data-test-id`],_e={key:1},ve={class:`optional-value-item`},ye={class:`optional-value-item`},G=P(l({__name:`FixedCollectionParameterLegacy`,props:{nodeValues:{},parameter:{},path:{},values:{default:()=>({})},isReadOnly:{type:Boolean,default:!1},isNested:{type:Boolean},hiddenIssuesInputs:{default:()=>[]}},emits:[`valueChanged`],setup(e,{emit:a}){let l=re(),d=ue(),f=e,b=a,x=de(),ee=le(),{activeNode:w}=me(ee),T=s({}),ie=s(null),A=e=>{if(V(f.parameter.options))return f.parameter.options.find(t=>t.name===e)},j=(e,t)=>`${f.path}.${e}${t===void 0?``:`[${t}]`}`,M=t(()=>!!f.parameter.typeOptions?.multipleValues),N=t(()=>!f.parameter.typeOptions?.hideEmptyMessage),ce=t(()=>!!f.parameter.typeOptions?.sortable),P=t(()=>l.nodeText(w.value?.type).placeholder(f.parameter,f.path)||l.baseText(`fixedCollectionParameter.choose`)),F=t(()=>new Set(Object.keys(T.value||{}))),pe=t(()=>{let e=[];for(let t of F.value){let n=A(t);n&&e.push(n)}return e}),I=s(new Map),L=t(()=>V(f.parameter.options)?M.value?f.parameter.options:f.parameter.options.filter(e=>!F.value.has(e.name)):[]),R=t(()=>!!f.parameter.typeOptions?.hideOptionalFields),H=t(()=>f.parameter.typeOptions?.addOptionalFieldButtonText?l.nodeText(w.value?.type).addOptionalFieldButtonText(f.parameter):l.baseText(`fixedCollectionParameter.addField`)),G=(e,t)=>t===void 0?e:`${e}-${t}`,be=(e,t)=>{if(!t)return!1;let n=t[e.name];return n==null||typeof n==`string`&&n===``?!1:typeof n==`object`?!(0,he.default)(n,e.default):n!==e.default},xe=()=>{if(R.value&&V(f.parameter.options)){I.value.clear();for(let e of f.parameter.options){let t=`${f.path}.${e.name}`,n=(0,U.default)(f.nodeValues,t);if(!n)continue;let r=e.values.filter(e=>e.required!==!0&&e.type!==`notice`);if(M.value&&Array.isArray(n))n.forEach((t,n)=>{let i=G(e.name,n),a=new Set;for(let e of r)be(e,t)&&a.add(e.name);a.size>0&&I.value.set(i,a)});else if(typeof n==`object`&&!Array.isArray(n)){let t=G(e.name),i=new Set;for(let e of r)be(e,n)&&i.add(e.name);i.size>0&&I.value.set(t,i)}}}},Se=(e,t,n)=>{let r=G(e,n);return I.value.get(r)?.has(t)??!1},K=(e,t)=>{if(!R.value)return e.values;let n=G(e.name,t),r=I.value.get(n);return e.values.filter(e=>!!(e.required===!0||e.type===`notice`||r?.has(e.name)||e.typeOptions?.showEvenWhenOptional))},q=(e,t)=>{if(!R.value)return[];let n=j(e.name,t);return e.values.filter(e=>e.required===!0||e.type===`notice`||e.typeOptions?.showEvenWhenOptional?!1:d.displayParameter(f.nodeValues,e,n,w.value))},Ce=(e,t,n)=>{let r=G(e.name,n),i=I.value.get(r);i||(i=new Set,I.value.set(r,i));let a=e.values.find(e=>e.name===t);if(!a)return;let o=i.has(t);o?i.delete(t):i.add(t),I.value.set(r,i),b(`valueChanged`,{name:j(e.name,n)+`.${t}`,value:o?void 0:B(a.default)})};m(()=>f.values,e=>{T.value=B(e)},{deep:!0}),te(()=>{T.value=B(f.values),xe()});let we=(e,t)=>{let n=T.value[e];if(!n||Array.isArray(n)&&n.length>1)b(`valueChanged`,{name:j(e,t),value:void 0});else if(!M.value&&f.isNested){let e=f.path.split(`.`),t=e.slice(0,-1).join(`.`),n=e[e.length-1];b(`valueChanged`,{name:t?`${t}.${n}`:n,value:void 0})}else b(`valueChanged`,{name:j(e),value:void 0})},Te=e=>{if(e.typeOptions?.multipleValues!==!0)return B(e.default);if(e.type===`fixedCollection`)return{};let t=(0,U.default)(f.nodeValues,[f.path,e.name],[]),n=e.default,r=Array.isArray(n)?B(n):n!==``&&typeof n!=`object`?[B(n)]:[];return t.concat(r)},J=async e=>{let t=A(e);if(!t)return;let n=`${f.path}.${t.name}`,r=t.values.reduce((e,t)=>(e[t.name]=Te(t),e),{}),i=(0,U.default)(f.nodeValues,n,[]);b(`valueChanged`,{name:n,value:M.value?[...i,r]:r}),ie.value=void 0},Ee=async e=>{await J(e),f.parameter.name===`workflowInputs`&&Y()},De=e=>{b(`valueChanged`,e),f.parameter.name===`workflowInputs`&&ke(e)},Oe=e=>{b(`valueChanged`,{name:j(e),value:T.value[e],type:`optionsOrderChanged`})},ke=e=>{fe.track(`User changed workflow input field type`,{type:e.value,workflow_id:x.workflow.id,node_id:ee.activeNode?.id})},Y=()=>{fe.track(`User added workflow input field`,{workflow_id:x.workflow.id,node_id:ee.activeNode?.id})};function X(e,t){return t}return(t,a)=>(g(),r(`div`,{class:S(t.$style.fixedCollectionParameter),"data-test-id":`fixed-collection-${f.parameter?.name}`,onKeydown:a[2]||=_(()=>{},[`stop`])},[pe.value.length===0?(g(),r(`div`,{key:0,class:S(t.$style.noItemsExist)},[N.value?(g(),u(o(k),{key:0,size:`small`},{default:h(()=>[y(n(o(l).baseText(`fixedCollectionParameter.currentlyNoItemsExist`)),1)]),_:1})):i(``,!0)],2)):i(``,!0),(g(!0),r(p,null,v(pe.value,a=>(g(),r(`div`,{key:a.name,class:S(t.$style.fixedCollectionParameterProperty)},[a.displayName!==``&&e.parameter.options&&e.parameter.options.length!==1?(g(),u(o(oe),{key:0,label:o(l).nodeText(o(w)?.type).inputLabelDisplayName(a,e.path),underline:!0,size:`small`,color:`text-dark`},null,8,[`label`])):i(``,!0),M.value?(g(),r(`div`,_e,[c(o(ge.default),{modelValue:T.value[a.name],"onUpdate:modelValue":e=>T.value[a.name]=e,handle:`.drag-handle`,"item-key":X,"drag-class":t.$style.dragging,"ghost-class":t.$style.ghost,"chosen-class":t.$style.chosen,onChange:e=>Oe(a.name)},{item:h(({index:s})=>[(g(),r(`div`,{key:a.name+`-`+s,class:S(t.$style.parameterItem)},[C(`div`,{class:S([t.$style.parameterItemWrapper,{[t.$style.borderTopDashed]:s}])},[e.isReadOnly?i(``,!0):(g(),r(`div`,{key:0,class:S([t.$style.iconButton,t.$style.defaultTopPadding])},[ce.value?(g(),u(o(D),{key:0,variant:`ghost`,size:`small`,icon:`grip-vertical`,title:o(l).baseText(`fixedCollectionParameter.dragItem`),class:`drag-handle`},null,8,[`title`])):i(``,!0)],2)),e.isReadOnly?i(``,!0):(g(),r(`div`,{key:1,class:S([t.$style.iconButton,t.$style.extraTopPadding])},[c(o(D),{variant:`ghost`,size:`small`,icon:`trash-2`,"data-test-id":`fixed-collection-delete`,title:o(l).baseText(`fixedCollectionParameter.deleteItem`),onClick:e=>we(a.name,s)},null,8,[`title`,`onClick`])],2)),(g(),u(ne,null,{default:h(()=>[c(z,{parameters:K(a,s),"node-values":e.nodeValues,path:j(a.name,s),"is-read-only":e.isReadOnly,"is-nested":e.isNested,"hide-delete":!0,"hidden-issues-inputs":e.hiddenIssuesInputs,onValueChanged:De},null,8,[`parameters`,`node-values`,`path`,`is-read-only`,`is-nested`,`hidden-issues-inputs`])]),_:2},1024)),q(a,s).length>0&&!e.isReadOnly?(g(),r(`div`,{key:2,class:S(t.$style.addOption),"data-test-id":`fixed-collection-add-property`},[c(o(ae),{placeholder:H.value,size:`small`,filterable:``,"model-value":null,"onUpdate:modelValue":e=>Ce(a,e,s)},{default:h(()=>[(g(!0),r(p,null,v(q(a,s),e=>(g(),u(o(se),{key:e.name,label:e.displayName||e.name,value:e.name},{default:h(()=>[C(`div`,ve,[C(`span`,null,n(e.displayName||e.name),1),Se(a.name,e.name,s)?(g(),u(o(O),{key:0,icon:`check`,size:`medium`})):i(``,!0)])]),_:2},1032,[`label`,`value`]))),128))]),_:2},1032,[`placeholder`,`onUpdate:modelValue`])],2)):i(``,!0)],2)],2))]),_:2},1032,[`modelValue`,`onUpdate:modelValue`,`drag-class`,`ghost-class`,`chosen-class`,`onChange`])])):(g(),r(`div`,{key:2,class:S(t.$style.parameterItem)},[C(`div`,{class:S(t.$style.parameterItemWrapper)},[e.isReadOnly?i(``,!0):(g(),r(`div`,{key:0,class:S(t.$style.iconButton)},[c(o(D),{variant:`ghost`,size:`small`,icon:`trash-2`,"data-test-id":`fixed-collection-delete`,title:o(l).baseText(`fixedCollectionParameter.deleteItem`),onClick:e=>we(a.name)},null,8,[`title`,`onClick`])],2)),c(z,{parameters:K(a),"node-values":e.nodeValues,path:j(a.name),"is-read-only":e.isReadOnly,"is-nested":e.isNested,"hide-delete":!0,class:S(t.$style.parameterItem),"hidden-issues-inputs":e.hiddenIssuesInputs,onValueChanged:De},null,8,[`parameters`,`node-values`,`path`,`is-read-only`,`is-nested`,`class`,`hidden-issues-inputs`]),q(a).length>0&&!e.isReadOnly?(g(),r(`div`,{key:1,class:S(t.$style.addOption),"data-test-id":`fixed-collection-add-property`},[c(o(ae),{placeholder:H.value,size:`small`,filterable:``,"model-value":null,"onUpdate:modelValue":e=>Ce(a,e)},{default:h(()=>[(g(!0),r(p,null,v(q(a),e=>(g(),u(o(se),{key:e.name,label:e.displayName||e.name,value:e.name},{default:h(()=>[C(`div`,ye,[C(`span`,null,n(e.displayName||e.name),1),Se(a.name,e.name)?(g(),u(o(O),{key:0,icon:`check`,size:`medium`})):i(``,!0)])]),_:2},1032,[`label`,`value`]))),128))]),_:2},1032,[`placeholder`,`onUpdate:modelValue`])],2)):i(``,!0)],2)],2))],2))),128)),L.value.length>0&&!e.isReadOnly?(g(),r(`div`,{key:1,class:S(t.$style.controls)},[e.parameter.options&&e.parameter.options.length===1?(g(),u(o(E),{key:0,style:{width:`100%`},variant:`subtle`,"data-test-id":`fixed-collection-add`,label:P.value,onClick:a[0]||=t=>Ee(e.parameter.options[0].name)},null,8,[`label`])):(g(),r(`div`,{key:1,class:S(t.$style.addOption)},[c(o(ae),{modelValue:ie.value,"onUpdate:modelValue":[a[1]||=e=>ie.value=e,J],placeholder:P.value,size:`small`,filterable:``},{default:h(()=>[(g(!0),r(p,null,v(L.value,t=>(g(),u(o(se),{key:t.name,label:o(l).nodeText(o(w)?.type).collectionOptionDisplayName(e.parameter,t,e.path),value:t.name},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`,`placeholder`])],2))],2)):i(``,!0)],42,W))}}),[[`__cssModules`,{$style:{fixedCollectionParameter:`_fixedCollectionParameter_1ijik_125`,ghost:`_ghost_1ijik_128`,dragging:`_dragging_1ijik_129`,parameterItemWrapper:`_parameterItemWrapper_1ijik_141`,controls:`_controls_1ijik_144`,active:`_active_1ijik_159`,fixedCollectionParameterProperty:`_fixedCollectionParameterProperty_1ijik_163`,iconButton:`_iconButton_1ijik_168`,parameterItem:`_parameterItem_1ijik_141`,defaultTopPadding:`_defaultTopPadding_1ijik_185`,extraTopPadding:`_extraTopPadding_1ijik_188`,borderTopDashed:`_borderTopDashed_1ijik_198`,noItemsExist:`_noItemsExist_1ijik_202`,addOption:`_addOption_1ijik_206`}}]]);function be(e,{defaultWrapperExpanded:t=!1}={}){let n=d(e),r=`n8n-fixed-collection-expanded-${n}`,i=`n8n-fixed-collection-wrapper-${n}`,a=`n8n-fixed-collection-stable-indexes-${n}`,o=s({}),c=()=>{let e=sessionStorage.getItem(a);if(!e)return{};try{return JSON.parse(e)}catch{return{}}},l=e=>{sessionStorage.setItem(a,JSON.stringify(e))},u=()=>{let e=sessionStorage.getItem(r);return e?new Set(e.split(`,`).filter(Boolean)):new Set},f=e=>{sessionStorage.setItem(r,Array.from(e).join(`,`))},p=s(u()),h=()=>{let e=sessionStorage.getItem(i);return e===null?t:e===`true`},g=e=>{sessionStorage.setItem(i,String(e))},_=s(h()),v=(e,t)=>{if(o.value[e]||(o.value[e]=[]),!o.value[e][t]){let n=c()[e]||[],r,i=!1;if(n[t]!==void 0)r=n[t];else{let t=o.value[e].map(e=>e?.stableIndex).filter(e=>e!==void 0);r=(t.length>0?Math.max(...t):-1)+1,i=!0}if(o.value[e][t]={id:F(),stableIndex:r},i){let t=c();t[e]=o.value[e].map(e=>e.stableIndex),l(t)}}return o.value[e][t].id},y=(e,t)=>(o.value[e]?.[t]||v(e,t),o.value[e][t].stableIndex);return m(_,e=>{g(e)}),{getItemId:v,getItemStableIndex:y,getExpandedState:(e,t)=>{let n=`${e}:${y(e,t)}`;return p.value.has(n)},setExpandedState:(e,t,n)=>{let r=`${e}:${y(e,t)}`;n?p.value.add(r):p.value.delete(r),f(p.value)},initExpandedState:(e,t,n)=>{o.value[e]||(o.value[e]=[]),n&&t.forEach((t,n)=>{v(e,n)})},cleanupItem:(e,t)=>{if(o.value[e]){let n=o.value[e][t];if(o.value[e].splice(t,1),n?.stableIndex!==void 0){let t=`${e}:${n.stableIndex}`;p.value.delete(t),f(p.value)}let r=c();r[e]=o.value[e].map(e=>e.stableIndex),l(r)}},cleanupProperty:e=>{o.value[e]&&(o.value[e].map(e=>e.stableIndex).forEach(t=>{let n=`${e}:${t}`;p.value.delete(n)}),delete o.value[e]);let t=c();delete t[e],l(t),f(p.value)},trimArrays:(e,t)=>{if(o.value[e]&&o.value[e].length>t){o.value[e]=o.value[e].slice(0,t);let n=c();n[e]=o.value[e].map(e=>e.stableIndex),l(n)}},reorderItems:(e,t,n)=>{if(o.value[e]){let r=[...o.value[e]],[i]=r.splice(t,1);r.splice(n,0,i),o.value[e]=r;let a=c();a[e]=r.map(e=>e.stableIndex),l(a)}},wrapperExpanded:_}}var xe=P(l({__name:`FixedCollectionItem`,props:{itemId:{},property:{},itemData:{},itemIndex:{},stableIndex:{},nodeValues:{},propertyPath:{},isReadOnly:{type:Boolean},isExpanded:{type:Boolean},sortable:{type:Boolean},disableAnimation:{type:Boolean},isDragging:{type:Boolean},titleTemplate:{},visiblePropertyValues:{},pickerPropertyValues:{},isOptionalValueAdded:{type:Function},addOptionalFieldButtonText:{}},emits:[`update:isExpanded`,`valueChanged`,`delete`,`toggleOptionalValue`],setup(e,{emit:n}){let a=re(),{isEnabled:s}=I(),l=e,d=n,f=t(()=>l.pickerPropertyValues.length>0&&!l.isReadOnly),p=t(()=>l.pickerPropertyValues.map(e=>({id:e.name,label:e.displayName||e.name,checked:l.isOptionalValueAdded(e.name)}))),m=t(()=>`${l.property.displayName} ${l.stableIndex+1}`),{resolvedExpression:_}=R({expression:()=>l.titleTemplate??``,additionalData:()=>({$collection:{item:{value:l.itemData,index:l.stableIndex,properties:l.property.values}}})}),v=e=>!!e&&e!==`undefined`&&e!==`null`&&typeof e==`string`,y=t(()=>{if(!l.titleTemplate)return m.value;let e=_.value;return v(e)?e:m.value}),b=e=>d(`valueChanged`,e);return(t,n)=>(g(),u(o(ce),{key:e.itemId,"model-value":e.isExpanded,title:y.value,"data-item-key":e.itemId,"disable-animation":e.disableAnimation,"onUpdate:modelValue":n[2]||=e=>d(`update:isExpanded`,e)},x({default:h(()=>[c(z,{"hide-delete":``,"is-nested":``,parameters:e.visiblePropertyValues,"node-values":e.nodeValues,path:e.propertyPath,"is-read-only":e.isReadOnly,"remove-first-parameter-margin":o(s),"remove-last-parameter-margin":o(s),onValueChanged:b},null,8,[`parameters`,`node-values`,`path`,`is-read-only`,`remove-first-parameter-margin`,`remove-last-parameter-margin`]),f.value?(g(),r(`div`,{key:0,class:S(t.$style.addOption),"data-test-id":`fixed-collection-add-property`},[c(o(T),{items:p.value,onSelect:n[1]||=e=>d(`toggleOptionalValue`,e)},{activator:h(()=>[c(o(E),{class:`n8n-button--highlightFill`,variant:`subtle`,icon:`plus`,label:e.addOptionalFieldButtonText},null,8,[`label`])]),_:1},8,[`items`])],2)):i(``,!0)]),_:2},[e.isReadOnly?void 0:{name:`actions`,fn:h(()=>[c(o(N),{icon:`trash-2`,label:o(a).baseText(`fixedCollectionParameter.deleteItem`),tooltip:o(a).baseText(`fixedCollectionParameter.deleteParameter`,{interpolate:{parameter:y.value}}),danger:``,"test-id":`fixed-collection-item-delete`,onClick:n[0]||=e=>d(`delete`)},null,8,[`label`,`tooltip`]),e.sortable?(g(),u(o(N),{key:0,icon:`grip-vertical`,label:o(a).baseText(`fixedCollectionParameter.dragItem`),class:S([`drag-handle`,t.$style.dragHandle,{[t.$style.dragging]:e.isDragging}]),"test-id":`fixed-collection-item-drag`},null,8,[`label`,`class`])):i(``,!0)]),key:`0`}]),1032,[`model-value`,`title`,`data-item-key`,`disable-animation`]))}}),[[`__cssModules`,{$style:{dragHandle:`_dragHandle_1vesa_125`,dragging:`_dragging_1vesa_129`,addOption:`_addOption_1vesa_133`}}]]),Se=e(L(),1),K=400,q=P(l({__name:`FixedCollectionItemList`,props:{property:{},values:{},nodeValues:{},getPropertyPath:{type:Function},itemState:{},isReadOnly:{type:Boolean},sortable:{type:Boolean},titleTemplate:{},getVisiblePropertyValues:{type:Function},getPickerPropertyValues:{type:Function},isOptionalValueAdded:{type:Function},addOptionalFieldButtonText:{}},emits:[`valueChanged`,`delete`,`dragChange`,`toggleOptionalValue`],setup(e,{emit:n}){let r=e,i=n,a=s(!1),c=w(a,t(()=>a.value?0:K)),l=e=>r.itemState.getItemId(r.property.name,r.values.findIndex(t=>t===e)),d=e=>{a.value=e},f=e=>i(`dragChange`,r.property.name,e),p=e=>i(`valueChanged`,e),m=e=>i(`delete`,r.property.name,e),_=(e,t)=>i(`toggleOptionalValue`,r.property.name,t,e),v=e=>t=>r.isOptionalValueAdded(r.property.name,t,e);return(t,n)=>(g(),u(o(Se.default),{"model-value":e.values,"item-key":l,handle:`.drag-handle`,"drag-class":t.$style.dragging,"ghost-class":t.$style.ghost,onStart:n[0]||=e=>d(!0),onEnd:n[1]||=e=>d(!1),onChange:f},{item:h(({index:t})=>[(g(),u(xe,{key:e.itemState.getItemId(e.property.name,t),"item-id":e.itemState.getItemId(e.property.name,t),property:e.property,"item-data":e.values[t],"item-index":t,"stable-index":e.itemState.getItemStableIndex(e.property.name,t),"node-values":e.nodeValues,"property-path":e.getPropertyPath(e.property.name,t),"is-read-only":e.isReadOnly,"is-expanded":e.itemState.getExpandedState(e.property.name,t),"is-dragging":a.value,sortable:e.sortable,"disable-animation":o(c),"title-template":e.titleTemplate,"visible-property-values":e.getVisiblePropertyValues(e.property,t),"picker-property-values":e.getPickerPropertyValues(e.property,t),"add-optional-field-button-text":e.addOptionalFieldButtonText,"is-optional-value-added":v(t),"onUpdate:isExpanded":n=>e.itemState.setExpandedState(e.property.name,t,n),onValueChanged:p,onDelete:e=>m(t),onToggleOptionalValue:e=>_(t,e)},null,8,[`item-id`,`property`,`item-data`,`item-index`,`stable-index`,`node-values`,`property-path`,`is-read-only`,`is-expanded`,`is-dragging`,`sortable`,`disable-animation`,`title-template`,`visible-property-values`,`picker-property-values`,`add-optional-field-button-text`,`is-optional-value-added`,`onUpdate:isExpanded`,`onDelete`,`onToggleOptionalValue`]))]),_:1},8,[`model-value`,`drag-class`,`ghost-class`]))}}),[[`__cssModules`,{$style:{ghost:`_ghost_1t7ke_125`,dragging:`_dragging_1t7ke_126`}}]]),Ce=e(j(),1),we=e(H(),1),Te=[`data-test-id`],J=P(l({__name:`FixedCollectionParameterNew`,props:{nodeValues:{},parameter:{},path:{},values:{default:()=>({})},isReadOnly:{type:Boolean,default:!1},isNested:{type:Boolean},isNewlyAdded:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},hiddenIssuesInputs:{default:()=>[]}},emits:[`valueChanged`,`delete`],setup(e,{emit:l}){let d=re(),f=le(),ne=de(),w=ue(),{activeNode:T}=me(f),D=e,O=l,k=s({}),ae=ee(`rootEl`),j=s(!1),M=s(new Map),oe=t(()=>`${T.value?.id??`unknown`}-${D.path}`),se=t(()=>{let e=Object.entries(D.values);if(e.length!==1)return!1;let[,t]=e[0];return Array.isArray(t)?t.length===1:Object.keys(t).length>0}),P=be(oe,{defaultWrapperExpanded:D.isNewlyAdded||se.value}),F=P.wrapperExpanded,I=e=>{if(V(D.parameter.options))return D.parameter.options.find(t=>t.name===e)},L=(e,t)=>`${D.path}.${e}${t===void 0?``:`[${t}]`}`,R=e=>Array.isArray(k.value[e]),H=e=>{let t=k.value[e];return Array.isArray(t)?t:[]},U=t(()=>!!D.parameter.typeOptions?.multipleValues),he=t(()=>!!D.parameter.typeOptions?.sortable),ge=t(()=>new Set(Object.keys(k.value??{}))),W=t(()=>Array.from(ge.value).map(I).filter(e=>e!==void 0)),_e=t(()=>V(D.parameter.options)?U.value?D.parameter.options:D.parameter.options.filter(e=>!ge.value.has(e.name)):[]),ve=t(()=>!!D.parameter.typeOptions?.hideOptionalFields),ye=t(()=>D.parameter.typeOptions?.addOptionalFieldButtonText?d.nodeText(T.value?.type).addOptionalFieldButtonText(D.parameter):d.baseText(`fixedCollectionParameter.addField`)),G=(e,t)=>t===void 0?e:`${e}-${t}`,xe=(e,t)=>{if(!t)return!1;let n=t[e.name];return n==null||typeof n==`string`&&n===``?!1:typeof n==`object`?!(0,we.default)(n,e.default):n!==e.default},Se=()=>{if(ve.value&&V(D.parameter.options)){M.value.clear();for(let e of D.parameter.options){let t=`${D.path}.${e.name}`,n=(0,Ce.default)(D.nodeValues,t);if(!n)continue;let r=e.values.filter(e=>e.required!==!0&&e.type!==`notice`);if(U.value&&Array.isArray(n))n.forEach((t,n)=>{let i=G(e.name,n),a=new Set;for(let e of r)xe(e,t)&&a.add(e.name);a.size>0&&M.value.set(i,a)});else if(typeof n==`object`&&!Array.isArray(n)){let t=G(e.name),i=new Set;for(let e of r)xe(e,n)&&i.add(e.name);i.size>0&&M.value.set(t,i)}}}},K=(e,t,n)=>{let r=G(e,n);return M.value.get(r)?.has(t)??!1},J=(e,t)=>{if(!ve.value)return e.values;let n=G(e.name,t),r=M.value.get(n);return e.values.filter(e=>!!(e.required===!0||e.type===`notice`||r?.has(e.name)||e.typeOptions?.showEvenWhenOptional))},Ee=(e,t)=>{if(!ve.value)return[];let n=L(e.name,t);return e.values.filter(e=>e.required===!0||e.type===`notice`||e.typeOptions?.showEvenWhenOptional?!1:w.displayParameter(D.nodeValues,e,n,T.value))},De=(e,t,n)=>{let r=G(e.name,n),i=M.value.get(r);i||(i=new Set,M.value.set(r,i));let a=e.values.find(e=>e.name===t);if(!a)return;let o=i.has(t);o?i.delete(t):i.add(t),M.value.set(r,i),O(`valueChanged`,{name:L(e.name,n)+`.${t}`,value:o?void 0:B(a.default)})},Oe=(e,t,n)=>{let r=I(e);r&&De(r,t,n)},ke=t(()=>d.nodeText(T.value?.type).inputLabelDisplayName(D.parameter,D.path)),Y=t(()=>_e.value.length===0),X=t(()=>d.nodeText(T.value?.type).placeholder(D.parameter,D.path)||d.baseText(`fixedCollectionParameter.addItem`)),Ae=t(()=>Y.value?d.baseText(`fixedCollectionParameter.allOptionsAdded`):d.baseText(`fixedCollectionParameter.addParameter`,{interpolate:{parameter:ke.value}})),Z=t(()=>_e.value.map(e=>({label:d.nodeText(T.value?.type).collectionOptionDisplayName(D.parameter,e,D.path),value:e.name}))),je=t(()=>!D.isNested&&D.parameter.displayName!==``),Me=t(()=>D.isNested),Ne=t(()=>_e.value.length>0&&!D.isReadOnly),Pe=t(()=>je.value&&!D.isReadOnly),Fe=t(()=>Ne.value&&(je.value||Me.value&&U.value)),Ie=t(()=>Me.value&&Ne.value),Le=t(()=>Object.values(k.value).every(e=>Array.isArray(e)?e.length===0:Object.keys(e).length===0)),Re=t(()=>Z.value.length===1),ze=t(()=>Z.value.length>1),Be=(e,t)=>{if(t!==void 0)return!1;let n=k.value[e];return!n||!Array.isArray(n)||n.length<=1},Ve=()=>{let e=D.path.split(`.`),t=e.at(-1)??``,n=e.slice(0,-1).join(`.`);return n?`${n}.${t}`:t},He=(e,t)=>t===void 0?!U.value&&D.isNested?Ve():L(e):L(e,t),Ue=(e,t)=>{t===void 0?Be(e,t)&&P.cleanupProperty(e):P.cleanupItem(e,t),O(`valueChanged`,{name:He(e,t),value:void 0})},We=()=>{fe.track(`User added workflow input field`,{workflow_id:ne.workflow.id,node_id:f.activeNode?.id})},Ge=e=>{fe.track(`User changed workflow input field type`,{type:e.value,workflow_id:ne.workflow.id,node_id:f.activeNode?.id})},Ke=e=>Array.isArray(e)?e:[e],qe=()=>{Object.entries(k.value).forEach(([e,t])=>P.initExpandedState(e,Ke(t),U.value))};m(()=>D.values,e=>{k.value=B(e),Object.entries(k.value).forEach(([e,t])=>P.trimArrays(e,Ke(t).length)),qe()},{deep:!0}),te(()=>{if(k.value=B(D.values),qe(),Se(),se.value){let e=W.value[0];if(e&&U.value){let t=k.value[e.name];Array.isArray(t)&&t.length>0&&P.setExpandedState(e.name,0,!0)}}});let Je=e=>{if(e.typeOptions?.multipleValues!==!0)return B(e.default);if(e.type===`fixedCollection`)return{};let t=(0,Ce.default)(D.nodeValues,[D.path,e.name],[]),n=e.default,r=e=>Array.isArray(e)?B(e):e!==``&&typeof e!=`object`?[B(e)]:[];return[...t,...r(n)]},Ye=async(e,t)=>{await a();let n=P.getItemId(e,t);(ae.value?.querySelector(`[data-item-key="${n}"]`))?.scrollIntoView({behavior:`smooth`,block:`nearest`})},Q=e=>{let t=I(e);if(!t)return;let n=`${D.path}.${t.name}`,r=Object.fromEntries(t.values.map(e=>[e.name,Je(e)])),i=(0,Ce.default)(D.nodeValues,n,[]);O(`valueChanged`,{name:n,value:U.value?[...i,r]:r});let a=i.length;P.setExpandedState(t.name,a,!0),U.value&&Ye(t.name,a),D.parameter.name===`workflowInputs`&&We()},$=e=>{O(`valueChanged`,e),D.parameter.name===`workflowInputs`&&Ge(e)},Xe=(e,t)=>{if(t.moved){P.reorderItems(e,t.moved.oldIndex,t.moved.newIndex);let n=k.value[e];if(Array.isArray(n)){let r=[...n],[i]=r.splice(t.moved.oldIndex,1);r.splice(t.moved.newIndex,0,i),k.value[e]=r}O(`valueChanged`,{name:L(e),value:k.value[e],type:`optionsOrderChanged`})}},Ze=async()=>{F.value||(F.value=!0,await a()),Re.value&&Z.value[0]&&Q(Z.value[0].value)},Qe=()=>{Re.value&&Z.value[0]&&Q(Z.value[0].value)};return(t,a)=>(g(),r(`div`,{ref_key:`rootEl`,ref:ae,class:S([t.$style.fixedCollectionParameter,{[t.$style.empty]:W.value.length===0}]),"data-test-id":`fixed-collection-${D.parameter?.name}`,onKeydown:a[4]||=_(()=>{},[`stop`])},[je.value?(g(),r(p,{key:0},[c(o(pe),{title:ke.value,bordered:Le.value,class:S(t.$style.sectionHeader)},x({_:2},[Pe.value?{name:`actions`,fn:h(()=>[c(o(ie),{disabled:!Y.value,"show-after":o(500)},{content:h(()=>[y(n(Ae.value),1)]),default:h(()=>[ze.value?(g(),u(o(A),{key:0,options:Z.value,disabled:Y.value,"data-test-id":`fixed-collection-add-header`,onSelect:Q},{trigger:h(()=>[c(o(N),{icon:`plus`,label:X.value,disabled:Y.value},null,8,[`label`,`disabled`])]),_:1},8,[`options`,`disabled`])):(g(),u(o(N),{key:1,icon:`plus`,label:X.value,disabled:Y.value,"data-test-id":`fixed-collection-add-header`,onClick:Ze},null,8,[`label`,`disabled`]))]),_:1},8,[`disabled`,`show-after`])]),key:`0`}:void 0]),1032,[`title`,`bordered`,`class`]),(g(!0),r(p,null,v(W.value,n=>(g(),r(`div`,{key:n.name,class:S(t.$style.propertySection)},[U.value&&R(n.name)?(g(),u(q,{key:0,property:n,values:H(n.name),"node-values":e.nodeValues,"get-property-path":L,"item-state":o(P),"is-read-only":!!e.isReadOnly,sortable:he.value,"title-template":e.parameter.typeOptions?.fixedCollection?.itemTitle,"get-visible-property-values":J,"get-picker-property-values":Ee,"is-optional-value-added":K,"add-optional-field-button-text":ye.value,onValueChanged:$,onDelete:Ue,onDragChange:Xe,onToggleOptionalValue:Oe},null,8,[`property`,`values`,`node-values`,`item-state`,`is-read-only`,`sortable`,`title-template`,`add-optional-field-button-text`])):(g(),u(o(ce),{key:1,"model-value":o(P).getExpandedState(n.name,0),title:n.displayName,"data-item-key":n.name,"onUpdate:modelValue":e=>o(P).setExpandedState(n.name,0,e)},x({default:h(()=>[c(z,{"hide-delete":``,parameters:J(n),"node-values":e.nodeValues,path:L(n.name),"is-read-only":!!e.isReadOnly,"is-nested":!1,"remove-first-parameter-margin":!0,"remove-last-parameter-margin":!0,"hidden-issues-inputs":e.hiddenIssuesInputs,onValueChanged:$},null,8,[`parameters`,`node-values`,`path`,`is-read-only`,`hidden-issues-inputs`])]),_:2},[e.isReadOnly?void 0:{name:`actions`,fn:h(()=>[c(o(N),{icon:`trash-2`,label:o(d).baseText(`fixedCollectionParameter.deleteItem`),danger:``,onClick:e=>Ue(n.name)},null,8,[`label`,`onClick`])]),key:`0`}]),1032,[`model-value`,`title`,`data-item-key`,`onUpdate:modelValue`]))],2))),128)),Fe.value?(g(),r(`div`,{key:0,class:S(t.$style.controls)},[Re.value?(g(),u(o(E),{key:0,class:`n8n-button--highlightFill`,variant:`subtle`,icon:`plus`,"data-test-id":`fixed-collection-add-top-level-button`,label:X.value,disabled:Y.value,onClick:Qe},null,8,[`label`,`disabled`])):ze.value?(g(),u(o(A),{key:1,options:Z.value,class:S(t.$style.dropdown),"data-test-id":`fixed-collection-add-top-level-dropdown`,disabled:Y.value,onSelect:Q},{trigger:h(()=>[c(o(E),{class:`n8n-button--highlightFill`,variant:`subtle`,icon:`plus`,label:X.value,disabled:Y.value},null,8,[`label`,`disabled`])]),_:1},8,[`options`,`class`,`disabled`])):i(``,!0)],2)):i(``,!0)],64)):Me.value?(g(),u(o(ce),{key:1,modelValue:o(F),"onUpdate:modelValue":a[3]||=e=>b(F)?F.value=e:null,title:ke.value,"show-actions-on-hover":!j.value},{actions:h(()=>[Ie.value?(g(),u(o(ie),{key:0,"show-after":o(500)},{content:h(()=>[y(n(Ae.value),1)]),default:h(()=>[ze.value?(g(),u(o(A),{key:0,options:Z.value,disabled:Y.value,"data-test-id":`fixed-collection-add-header`,onSelect:Q,"onUpdate:open":a[0]||=e=>j.value=e},{trigger:h(()=>[c(o(N),{icon:`plus`,label:X.value,disabled:Y.value},null,8,[`label`,`disabled`])]),_:1},8,[`options`,`disabled`])):(g(),u(o(N),{key:1,icon:`plus`,label:X.value,disabled:Y.value,"data-test-id":`fixed-collection-add-header-nested`,onClick:Ze},null,8,[`label`,`disabled`]))]),_:1},8,[`show-after`])):i(``,!0),e.canDelete&&!e.isReadOnly?(g(),u(o(N),{key:1,icon:`trash-2`,label:o(d).baseText(`fixedCollectionParameter.deleteItem`),danger:``,"data-test-id":`fixed-collection-delete-nested`,onClick:a[1]||=e=>O(`delete`)},null,8,[`label`])):i(``,!0)]),default:h(()=>[C(`div`,null,[U.value?(g(),r(p,{key:0},[(g(!0),r(p,null,v(W.value,n=>(g(),r(`div`,{key:n.name,class:S(t.$style.propertySection)},[k.value[n.name]?(g(),u(q,{key:0,property:n,values:k.value[n.name],"node-values":e.nodeValues,"get-property-path":L,"item-state":o(P),"is-read-only":!!e.isReadOnly,sortable:he.value,"title-template":e.parameter.typeOptions?.fixedCollection?.itemTitle,"get-visible-property-values":J,"get-picker-property-values":Ee,"is-optional-value-added":K,"add-optional-field-button-text":ye.value,onValueChanged:$,onDelete:Ue,onDragChange:Xe,onToggleOptionalValue:a[2]||=(e,t,n)=>De(I(e),t,n)},null,8,[`property`,`values`,`node-values`,`item-state`,`is-read-only`,`sortable`,`title-template`,`add-optional-field-button-text`])):i(``,!0)],2))),128)),Fe.value?(g(),r(`div`,{key:0,class:S(t.$style.controls)},[Re.value?(g(),u(o(E),{key:0,class:`n8n-button--highlightFill`,variant:`subtle`,icon:`plus`,"data-test-id":`fixed-collection-add-nested-button`,label:X.value,onClick:Qe},null,8,[`label`])):ze.value?(g(),u(o(A),{key:1,options:Z.value,class:S(t.$style.dropdown),"data-test-id":`fixed-collection-add-nested-dropdown`,onSelect:Q},{trigger:h(()=>[c(o(E),{class:`n8n-button--highlightFill`,variant:`subtle`,icon:`plus`,label:X.value},null,8,[`label`])]),_:1},8,[`options`,`class`])):i(``,!0)],2)):i(``,!0)],64)):(g(!0),r(p,{key:1},v(W.value,n=>(g(),r(`div`,{key:n.name,class:S(t.$style.propertySection)},[c(z,{"hide-delete":``,parameters:J(n),"node-values":e.nodeValues,path:L(n.name),"is-read-only":!!e.isReadOnly,"is-nested":!0,"remove-first-parameter-margin":!0,"remove-last-parameter-margin":!0,"hidden-issues-inputs":e.hiddenIssuesInputs,onValueChanged:$},null,8,[`parameters`,`node-values`,`path`,`is-read-only`,`hidden-issues-inputs`])],2))),128))])]),_:1},8,[`modelValue`,`title`,`show-actions-on-hover`])):(g(!0),r(p,{key:2},v(W.value,n=>(g(),r(`div`,{key:n.name,class:S(t.$style.propertySection)},[U.value&&R(n.name)?(g(),u(q,{key:0,property:n,values:H(n.name),"node-values":e.nodeValues,"get-property-path":L,"item-state":o(P),"is-read-only":!!e.isReadOnly,sortable:he.value,"title-template":e.parameter.typeOptions?.fixedCollection?.itemTitle,"get-visible-property-values":J,"get-picker-property-values":Ee,"is-optional-value-added":K,"add-optional-field-button-text":ye.value,onValueChanged:$,onDelete:Ue,onDragChange:Xe,onToggleOptionalValue:Oe},null,8,[`property`,`values`,`node-values`,`item-state`,`is-read-only`,`sortable`,`title-template`,`add-optional-field-button-text`])):(g(),u(o(ce),{key:1,"model-value":o(P).getExpandedState(n.name,0),title:n.displayName,"data-item-key":n.name,"onUpdate:modelValue":e=>o(P).setExpandedState(n.name,0,e)},x({default:h(()=>[c(z,{"hide-delete":``,parameters:J(n),"node-values":e.nodeValues,path:L(n.name),"is-read-only":!!e.isReadOnly,"is-nested":!1,"remove-first-parameter-margin":!0,"remove-last-parameter-margin":!0,"hidden-issues-inputs":e.hiddenIssuesInputs,onValueChanged:$},null,8,[`parameters`,`node-values`,`path`,`is-read-only`,`hidden-issues-inputs`])]),_:2},[e.isReadOnly?void 0:{name:`actions`,fn:h(()=>[c(o(N),{icon:`trash-2`,label:o(d).baseText(`fixedCollectionParameter.deleteItem`),danger:``,onClick:e=>Ue(n.name)},null,8,[`label`,`onClick`])]),key:`0`}]),1032,[`model-value`,`title`,`data-item-key`,`onUpdate:modelValue`]))],2))),128))],42,Te))}}),[[`__cssModules`,{$style:{fixedCollectionParameter:`_fixedCollectionParameter_du7gp_125`,propertySection:`_propertySection_du7gp_129`,sectionHeader:`_sectionHeader_du7gp_140`,controls:`_controls_du7gp_144`,dropdown:`_dropdown_du7gp_148`}}]]),Ee=l({__name:`FixedCollectionParameter`,props:{nodeValues:{},parameter:{},path:{},values:{default:void 0},isReadOnly:{type:Boolean},isNested:{type:Boolean},isNewlyAdded:{type:Boolean},canDelete:{type:Boolean},hiddenIssuesInputs:{default:()=>[]}},emits:[`valueChanged`,`delete`],setup(e,{emit:t}){let{isEnabled:n}=I(),r=t;return(e,t)=>o(n)?(g(),u(J,f({key:1},e.$props,{onValueChanged:t[1]||=e=>r(`valueChanged`,e),onDelete:t[2]||=e=>r(`delete`)}),null,16)):(g(),u(G,f({key:0},e.$props,{onValueChanged:t[0]||=e=>r(`valueChanged`,e)}),null,16))}});export{Ee as default};
//# sourceMappingURL=FixedCollectionParameter-Dxy4eDtN.js.map