(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`ca22fac7-8ebb-4e33-becd-db57ec6c42cc`,e._sentryDebugIdIdentifier=`sentry-dbid-ca22fac7-8ebb-4e33-becd-db57ec6c42cc`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{C as t,Cn as n,D as r,E as i,Gt as a,It as o,M as s,P as c,T as l,Z as u,_t as d,bt as f,et as p,j as m,vn as h,w as g}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as _}from"./_MapCache-DjbOQyB7.js";import{Hi as v,Mi as y,Oi as b,Vi as x,_t as S,jt as C,zi as w}from"./src-CppJvwzX.js";import{t as T}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{rt as E,yr as D}from"./users.store-pCkD7Zo0.js";import{oi as O}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import{r as k}from"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import{t as A}from"./Modal-DQeDdfPI.js";import{t as j}from"./TagsDropdown-B5U3GUsU.js";import{y as M}from"./constants-BeYoedeu.js";import{t as N}from"./CredentialPicker-u0Fuk2eM.js";import{C as P,t as F}from"./chat.store-a0NAXg9S.js";var I=T(c({__name:`ProviderSettingsModal`,props:{modalName:{},data:{}},setup(e){let c=e,T=o(null),I=o(S()),L=o(!1),R=o(!1),z=o(!1),B=o([]),V=o([]),H=t(()=>{let e=new Map(B.value.reduce((e,t)=>(t.model.provider!==`custom-agent`&&t.model.provider!==`n8n`&&e.push([t.model.model,{id:t.model.model,name:t.name}]),e),[]));for(let t of V.value)e.set(t,{id:t,name:t,isManual:!0});return Array.from(e.values())}),U=t(()=>{let e={};return H.value.forEach(t=>{e[t.id]=t}),e}),W=t({get:()=>T.value?.allowedModels?.map(e=>e.model)||[],set:e=>{T.value&&(T.value.allowedModels=H.value.filter(t=>e.includes(t.id)).map(e=>({model:e.id,displayName:e.name,isManual:e.isManual})),V.value=T.value.allowedModels.filter(e=>e.isManual).map(e=>e.model))}});async function G(e){return V.value.push(e),{id:e,name:e}}let K=_(),q=E(),J=F(),Y=D(),X=t(()=>O[c.data.provider]);function Z(e){T.value&&(T.value.credentialId=e)}function Q(){T.value&&(T.value.credentialId=null,T.value.allowedModels=[],z.value=!1)}async function $(){T.value?await c.data.onConfirm(T.value):c.data.onCancel(),I.value.emit(`close`)}function ee(){c.data.onCancel(),I.value.emit(`close`)}async function te(){T.value=await J.fetchProviderSettings(c.data.provider),z.value=T.value?.allowedModels.length>0,V.value=T.value.allowedModels.filter(e=>e.isManual).map(e=>e.model)}async function ne(e){R.value=!0;try{let t={[c.data.provider]:e};B.value=(await P(k().restApiContext,{credentials:t}))[c.data.provider].models||[]}catch(e){Y.showError(e,K.baseText(`settings.chatHub.providers.modal.edit.errorFetchingModels`))}finally{R.value=!1}}let re=t(()=>c.data.disabled||!T.value?!0:z.value&&T.value.allowedModels.length===0);function ie(e){T.value&&(T.value.enabled=typeof e==`boolean`?e:!!e,T.value.enabled||(T.value.credentialId=null,T.value.allowedModels=[],z.value=!1))}function ae(e){T.value&&(z.value=typeof e==`boolean`?e:!!e,z.value||(T.value.allowedModels=[]))}return u(async()=>{L.value=!0,await Promise.all([te(),q.fetchCredentialTypes(!1),q.fetchAllCredentials()]),L.value=!1}),d(()=>T.value?.credentialId,async e=>{e&&await ne(e)},{immediate:!0}),(t,o)=>(p(),l(A,{name:e.modalName,"event-bus":I.value,width:`50%`,"max-width":`500px`,center:!0},{header:f(()=>[g(`div`,{class:h(t.$style.header)},[s(a(w),{size:`large`,color:`text-dark`},{default:f(()=>[m(n(a(K).baseText(`settings.chatHub.providers.modal.edit.title`,{interpolate:{provider:a(M)[c.data.provider]}})),1)]),_:1})],2)]),content:f(()=>[g(`div`,{class:h(t.$style.content)},[g(`label`,{class:h(t.$style.container)},[s(a(x),{color:`text-dark`},{default:f(()=>[m(n(a(K).baseText(`settings.chatHub.providers.modal.edit.enabled.label`,{interpolate:{provider:a(M)[c.data.provider]}})),1)]),_:1}),s(a(b),{content:a(K).baseText(`settings.chatHub.providers.modal.edit.enabled.tooltip`),disabled:c.data.disabled,placement:`top`},{default:f(()=>[s(a(C),{size:`large`,"model-value":T.value?.enabled??!1,disabled:c.data.disabled,loading:L.value,"onUpdate:modelValue":ie},null,8,[`model-value`,`disabled`,`loading`])]),_:1},8,[`content`,`disabled`])],2),T.value&&T.value.enabled?(p(),r(`label`,{key:0,class:h(t.$style.container)},[s(a(x),{color:`text-dark`},{default:f(()=>[m(n(a(K).baseText(`settings.chatHub.providers.modal.edit.credential.label`)),1)]),_:1}),g(`div`,{class:h(t.$style.credentialContainer)},[s(N,{class:h(t.$style.credentialPicker),"app-name":a(M)[c.data.provider],"credential-type":X.value,"selected-credential-id":T.value.credentialId,"hide-create-new":!0,onCredentialSelected:Z,onCredentialDeselected:Q},null,8,[`class`,`app-name`,`credential-type`,`selected-credential-id`]),T.value.credentialId?(p(),l(a(y),{key:0,type:`button`,variant:`outline`,title:a(K).baseText(`settings.chatHub.providers.modal.edit.credential.clearButton`),icon:`x`,"icon-size":`large`,onClick:Q},null,8,[`title`])):i(``,!0)],2)],2)):i(``,!0),T.value&&T.value.enabled&&T.value.credentialId?(p(),r(`label`,{key:1,class:h(t.$style.container)},[s(a(x),{color:`text-dark`},{default:f(()=>[m(n(a(K).baseText(`settings.chatHub.providers.modal.edit.limitModels.label`,{interpolate:{provider:a(M)[c.data.provider]}})),1)]),_:1}),s(a(b),{content:a(K).baseText(`settings.chatHub.providers.modal.edit.limitModels.tooltip`),disabled:c.data.disabled,placement:`top`},{default:f(()=>[s(a(C),{size:`large`,"model-value":z.value,disabled:c.data.disabled,loading:L.value,"onUpdate:modelValue":ae},null,8,[`model-value`,`disabled`,`loading`])]),_:1},8,[`content`,`disabled`])],2)):i(``,!0),T.value&&T.value.enabled&&T.value.credentialId&&z.value?(p(),r(`label`,{key:2,class:h(t.$style.container)},[s(a(x),{color:`text-dark`},{default:f(()=>[m(n(a(K).baseText(`settings.chatHub.providers.modal.edit.allowedModels.label`)),1)]),_:1}),s(j,{modelValue:W.value,"onUpdate:modelValue":o[0]||=e=>W.value=e,class:h(t.$style.modelPicker),placeholder:a(K).baseText(`settings.chatHub.providers.modal.edit.models.placeholder`),"event-bus":null,"create-enabled":!0,"manage-enabled":!1,"all-tags":H.value,"is-loading":R.value,"tags-by-id":U.value,"create-tag":G,"create-tag-i18n-key":`settings.chatHub.providers.modal.edit.models.create`},null,8,[`modelValue`,`class`,`placeholder`,`all-tags`,`is-loading`,`tags-by-id`])],2)):i(``,!0)],2)]),footer:f(()=>[g(`div`,{class:h(t.$style.footer)},[g(`div`,{class:h(t.$style.footerRight)},[s(a(v),{variant:`subtle`,onClick:ee},{default:f(()=>[m(n(a(K).baseText(`settings.chatHub.providers.modal.edit.cancel`)),1)]),_:1}),s(a(v),{variant:`solid`,onClick:$,disabled:re.value},{default:f(()=>[m(n(a(K).baseText(`settings.chatHub.providers.modal.edit.confirm`)),1)]),_:1},8,[`disabled`])],2)],2)]),_:1},8,[`name`,`event-bus`]))}}),[[`__cssModules`,{$style:{header:`_header_3xawo_125`,content:`_content_3xawo_131`,container:`_container_3xawo_138`,credentialContainer:`_credentialContainer_3xawo_146`,credentialPicker:`_credentialPicker_3xawo_153`,modelPicker:`_modelPicker_3xawo_157`,footer:`_footer_3xawo_161`,footerRight:`_footerRight_3xawo_168`}}]]);export{I as default};
//# sourceMappingURL=ProviderSettingsModal-GgOtocRu.js.map