(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`2f8e1c92-5d87-456f-a8d7-865b97bb53b5`,e._sentryDebugIdIdentifier=`sentry-dbid-2f8e1c92-5d87-456f-a8d7-865b97bb53b5`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{C as t,Cn as n,D as r,E as i,Gt as a,It as o,M as s,P as c,T as l,U as u,Z as d,_ as f,_t as p,bt as m,et as h,ft as g,h as _,it as v,j as y,jt as b,st as x,vn as S,w as C,xt as w}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as T}from"./_MapCache-DjbOQyB7.js";import{Hi as E,Pi as D,Q as O,Ui as k,Vi as A,bt as j,ft as M,ji as N,pt as P,st as F,z as I,zi as L}from"./src-CppJvwzX.js";import{t as R}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{Ds as z,Lt as B,Tr as V,_r as H,fn as U,yr as W}from"./users.store-pCkD7Zo0.js";import{t as G}from"./dialog-Ds437WFa.js";import{Ss as K}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import{r as q}from"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import"./versions.store-1_eor2Ku.js";import{t as J}from"./usePageRedirectionHelper-BoF8hzbN.js";import"./useClipboard-Duc7LjuO.js";import{t as Y}from"./CopyInput-DChEtJl3.js";import{r as ee}from"./exports--h7UC0Af.js";import{n as X,t as Z}from"./sso.store-Dd63iqNy.js";import{t as te}from"./userRoleProvisioning.store-CIdn8sQc.js";var Q=[`href`],ne=R(c({__name:`UserRoleProvisioningDropdown`,props:u({authProtocol:{}},{modelValue:{default:`disabled`},modelModifiers:{}}),emits:[`update:modelValue`],setup(e){let t=g(e,`modelValue`),i=T(),o=H().hasScope(`provisioning:manage`),c=e=>{t.value=e},l=[{label:i.baseText(`settings.sso.settings.userRoleProvisioning.option.disabled.label`),value:`disabled`},{label:i.baseText(`settings.sso.settings.userRoleProvisioning.option.instanceRole.label`),value:`instance_role`},{label:i.baseText(`settings.sso.settings.userRoleProvisioning.option.instanceAndProjectRoles.label`),value:`instance_and_project_roles`}];return(u,d)=>(h(),r(`div`,{class:S(u.$style.group)},[C(`label`,null,n(a(i).baseText(`settings.sso.settings.userRoleProvisioning.label`)),1),s(a(M),{"model-value":t.value,disabled:!a(o),"data-test-id":`oidc-user-role-provisioning`,class:S(u.$style.userRoleProvisioningSelect),"onUpdate:modelValue":c},{default:m(()=>[(h(),r(f,null,v(l,e=>s(a(P),{key:e.value,label:e.label,"data-test-id":`oidc-user-role-provisioning-option`,value:e.value},null,8,[`label`,`value`])),64))]),_:1},8,[`model-value`,`disabled`,`class`]),C(`small`,null,[y(n(a(i).baseText(`settings.sso.settings.userRoleProvisioning.help`))+` `,1),C(`a`,{href:`https://docs.n8n.io/user-management/${e.authProtocol}/setup/`,target:`_blank`},n(a(i).baseText(`settings.sso.settings.userRoleProvisioning.help.linkText`)),9,Q)])],2))}}),[[`__cssModules`,{$style:{group:`_group_o443m_125`,userRoleProvisioningSelect:`_userRoleProvisioningSelect_o443m_141`}}]]);function re(e){let n=te(),r=B(),i=o(`disabled`),a=e=>e?e.scopesProvisionInstanceRole&&e.scopesProvisionProjectRoles?`instance_and_project_roles`:e.scopesProvisionInstanceRole?`instance_role`:`disabled`:`disabled`,s=e=>e===`instance_role`?{scopesProvisionInstanceRole:!0,scopesProvisionProjectRoles:!1}:e===`instance_and_project_roles`?{scopesProvisionInstanceRole:!0,scopesProvisionProjectRoles:!0}:{scopesProvisionInstanceRole:!1,scopesProvisionProjectRoles:!1},c=t(()=>a(n.provisioningConfig)!==i.value),l=t=>{r.track(`User updated provisioning settings`,{instance_id:q().instanceId,authentication_method:e,updated_setting:t})};return n.getProvisioningConfig().then(()=>{i.value=a(n.provisioningConfig)}),{formValue:i,isUserRoleProvisioningChanged:c,saveProvisioningConfig:async e=>{let t=e?`disabled`:i.value;t!==a(n.provisioningConfig)&&(await n.saveProvisioningConfig(s(t)),i.value=t,l(t))},shouldPromptUserToConfirmUserRoleProvisioningChange:({currentLoginEnabled:e,loginEnabledFormValue:t})=>{let n=e!==t,r=n&&!e,a=n&&e,o=r&&i.value!==`disabled`,s=c.value&&e&&!a;return o||s}}}async function $(e){let t=[],n={select:[`email`,`role`],expand:[`projectRelations`]},r=0,i=0,a=!0;for(;a;){let o=await z(e,{...n,sortBy:[`email:desc`],take:50,skip:r*50});r===0&&(i=o.count),t.push(...o.items),a=o.items.length===50&&t.length<i,r++}return{count:i,items:t}}function ie(){let e=o(),t=o(),n=q(),r=()=>{let e=new Date;return`${e.getDate()}_${e.getMonth()+1}_${e.getFullYear()}_${e.getHours()}_${e.getMinutes()}`},i=e=>e.includes(`,`)||e.includes(`"`)?`"${e.replace(/"/g,`""`)}"`:e,a=(e,t)=>{let n=new Blob([e],{type:`text/csv;charset=utf-8;`}),r=URL.createObjectURL(n),i=document.createElement(`a`);i.setAttribute(`href`,r),i.setAttribute(`download`,t),i.style.display=`none`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)},s=async()=>{if(e.value)return e.value;if(t.value)return await t.value;let r=$(n.restApiContext).then(n=>(e.value=n,t.value=void 0,n)).catch(e=>{throw t.value=void 0,e});return t.value=r,await r},c=o(!1),l=async()=>{let e=await s(),t=[`email,project_displayname,project_id,project_role`];for(let n of e.items){let e=i(n.email??``);if(n.projectRelations&&n.projectRelations.length>0)for(let r of n.projectRelations){let n=i(r.name??``),a=i(r.id??``),o=i(r.role.split(`:`)[1]??r.role);t.push(`${e},${n},${a},${o}`)}}a(t.join(`
`),`n8n_project_role_export_${r()}.csv`),c.value=!0},u=o(!1);return{downloadProjectRolesCsv:l,downloadInstanceRolesCsv:async()=>{let e=await s(),t=[`email,instance_role`];for(let n of e.items){let e=i(n.email??``),r=i(n.role??``);t.push(`${e},${r}`)}a(t.join(`
`),`n8n_instance_role_export_${r()}.csv`),u.value=!0},hasDownloadedInstanceRoleCsv:u,hasDownloadedProjectRoleCsv:c,accessSettingsCsvExportOnModalClose:()=>{u.value=!1,c.value=!1,e.value=void 0,t.value=void 0}}}var ae={class:`mb-s`},oe={class:`mb-s`},se=[`href`],ce={class:`mb-s`},le={key:0},ue={class:`mb-s`},de={class:`mb-s`},fe=[`href`],pe={class:`mb-s`},me=R(c({__name:`ConfirmProvisioningDialog`,props:u({newProvisioningSetting:{},authProtocol:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:u([`confirmProvisioning`,`cancel`],[`update:modelValue`]),setup(e,{emit:c}){let u=g(e,`modelValue`),d=e,_=c,v=T(),b=o(!1),D=o(!1),O=o(!1),M=o(!1),{hasDownloadedInstanceRoleCsv:N,hasDownloadedProjectRoleCsv:P,downloadProjectRolesCsv:I,downloadInstanceRolesCsv:L,accessSettingsCsvExportOnModalClose:R}=ie(),z=t(()=>d.newProvisioningSetting===`disabled`),B=t(()=>z.value?`disable`:`enable`),V=t(()=>d.newProvisioningSetting===`instance_and_project_roles`);p(u,()=>{O.value=!1,M.value=!1,R()});let H=async()=>{b.value=!0;try{await L()}finally{b.value=!1}},U=async()=>{D.value=!0;try{await I()}finally{D.value=!1}},W=()=>{O.value=!0,_(`confirmProvisioning`)};return(t,o)=>{let c=x(`n8n-html`);return h(),l(a(G),{modelValue:u.value,"onUpdate:modelValue":o[2]||=e=>u.value=e,title:a(v).baseText(`settings.provisioningConfirmDialog.${B.value}.title`),width:`650`},{footer:m(()=>[s(a(E),{variant:`ghost`,type:`button`,"data-test-id":`provisioning-cancel-button`,onClick:o[1]||=e=>_(`cancel`)},{default:m(()=>[y(n(a(v).baseText(`settings.provisioningConfirmDialog.button.cancel`)),1)]),_:1}),s(a(E),{variant:`solid`,type:`button`,disabled:O.value||!M.value||!z.value&&!a(N)||V.value&&!a(P),"data-test-id":`provisioning-confirm-button`,onClick:W},{default:m(()=>[y(n(a(v).baseText(`settings.provisioningConfirmDialog.button.${B.value}.confirm`)),1)]),_:1},8,[`disabled`])]),default:m(()=>[z.value?(h(),r(f,{key:1},[C(`div`,ue,[s(a(A),{color:`text-base`},{default:m(()=>[y(n(a(v).baseText(`settings.provisioningConfirmDialog.disable.description`)),1)]),_:1})]),C(`div`,de,[s(a(A),{color:`text-base`},{default:m(()=>[C(`a`,{href:`https://docs.n8n.io/user-management/${e.authProtocol}/setup/`,target:`_blank`},n(a(v).baseText(`settings.provisioningConfirmDialog.link.docs`)),9,fe)]),_:1})])],64)):(h(),r(f,{key:0},[C(`div`,ae,[s(a(A),{color:`text-base`},{default:m(()=>[y(n(a(v).baseText(e.newProvisioningSetting===`instance_and_project_roles`?`settings.provisioningConfirmDialog.breakingChangeDescription.firstSentence.partOne.withProjectRoles`:`settings.provisioningConfirmDialog.breakingChangeDescription.firstSentence.partOne`)),1)]),_:1}),s(a(A),{class:S(t.$style.descriptionTextPartTwo),color:`text-base`},{default:m(()=>[y(n(a(v).baseText(`settings.provisioningConfirmDialog.breakingChangeDescription.firstSentence.partTwo`)),1)]),_:1},8,[`class`])]),C(`div`,oe,[s(a(A),{color:`text-base`},{default:m(()=>[C(`a`,{href:`https://docs.n8n.io/user-management/${e.authProtocol}/setup/`,target:`_blank`},n(a(v).baseText(`settings.provisioningConfirmDialog.link.docs`)),9,se)]),_:1})]),C(`div`,ce,[w(s(a(A),{color:`text-base`},null,512),[[c,a(v).baseText(`settings.provisioningConfirmDialog.breakingChangeDescription.secondLine`)]])]),C(`ul`,{class:S([t.$style.list,`mb-s`])},[C(`li`,null,[s(a(A),{color:`text-base`},{default:m(()=>[y(n(a(v).baseText(`settings.provisioningConfirmDialog.button.downloadInstanceRolesCsv`)),1)]),_:1}),a(N)?(h(),l(a(k),{key:1,icon:`check`,color:`success`,class:S(t.$style.icon)},null,8,[`class`])):(h(),l(a(E),{key:0,variant:`ghost`,"native-type":`button`,icon:`file-download`,"data-test-id":`provisioning-download-instance-roles-csv-button`,disabled:b.value,loading:b.value,class:S([t.$style.button,`n8n-button--highlight`]),onClick:H},null,8,[`disabled`,`loading`,`class`]))]),V.value?(h(),r(`li`,le,[s(a(A),{color:`text-base`},{default:m(()=>[y(n(a(v).baseText(`settings.provisioningConfirmDialog.button.downloadProjectRolesCsv`)),1)]),_:1}),a(P)?(h(),l(a(k),{key:1,icon:`check`,color:`success`,class:S(t.$style.icon)},null,8,[`class`])):(h(),l(a(E),{key:0,variant:`ghost`,"native-type":`button`,icon:`file-download`,"data-test-id":`provisioning-download-project-roles-csv-button`,disabled:D.value,loading:D.value,class:S([t.$style.button,`n8n-button--highlight`]),onClick:U},null,8,[`disabled`,`loading`,`class`]))])):i(``,!0)],2)],64)),C(`div`,pe,[s(a(j),{class:S(t.$style.card)},{default:m(()=>[s(a(F),{modelValue:M.value,"onUpdate:modelValue":o[0]||=e=>M.value=e,disabled:!z.value&&(!a(N)||V.value&&!a(P)),"data-test-id":`provisioning-confirmation-checkbox`},{label:m(()=>[s(a(A),{color:`text-base`},{default:m(()=>[y(n(a(v).baseText(`settings.provisioningConfirmDialog.${B.value}.checkbox`)),1)]),_:1})]),_:1},8,[`modelValue`,`disabled`])]),_:1},8,[`class`])])]),_:1},8,[`modelValue`,`title`])}}}),[[`__cssModules`,{$style:{button:`_button_1bulq_126`,card:`_card_1bulq_130`,descriptionTextPartTwo:`_descriptionTextPartTwo_1bulq_134`,icon:`_icon_1bulq_138`,list:`_list_1bulq_143`}}]]),he={class:`mt-2xs mb-s`},ge={key:0},_e={key:1},ve=c({__name:`SamlSettingsForm`,setup(e){let c=T(),l=X(),u=B(),f=W(),p=V(),g=o(!1),_=o(),v=o(!1),x={URL:`url`,XML:`xml`},w=o([{label:c.baseText(`settings.sso.settings.ips.options.url`),value:x.URL},{label:c.baseText(`settings.sso.settings.ips.options.xml`),value:x.XML}]),D=o(x.URL),O=o(),k=o(),A=o(),j=o(!1),{formValue:M,isUserRoleProvisioningChanged:P,saveProvisioningConfig:L,shouldPromptUserToConfirmUserRoleProvisioningChange:R}=re(Z.SAML);async function z(){if(l.isEnterpriseSamlEnabled)try{await H()}catch(e){f.showError(e,`error`)}}let H=async()=>{let e=await l.getSamlConfig();A.value=e?.entityID,_.value=e?.returnUrl,e?.metadataUrl?D.value=x.URL:e?.metadata&&(D.value=x.XML),k.value=e?.metadata,O.value=e?.metadataUrl,v.value=e.loginEnabled??!1},U=t(()=>{if(g.value)return!1;let e=()=>D.value===x.URL?!!O.value&&O.value!==l.samlConfig?.metadataUrl:D.value===x.XML?!!k.value&&k.value!==l.samlConfig?.metadata:!1,t=l.isSamlLoginEnabled!==v.value;return P.value||e()||t}),G=t(()=>D.value===x.URL?!!O.value:D.value===x.XML?!!k.value:!1),K=e=>{if(!e){ee(`Single Sign-On SAML: telemtetry data undefined on submit`,{level:`error`});return}let t={instance_id:q().instanceId,authentication_method:Z.SAML,identity_provider:e.metadataUrl?`metadata`:`xml`,is_active:e.loginEnabled??!1};u.track(`User updated single sign on settings`,t)},J=async()=>await p.confirm(c.baseText(`settings.sso.confirmMessage.beforeSaveForm.message`,{interpolate:{protocol:`SAML`}}),c.baseText(`settings.sso.confirmMessage.beforeSaveForm.headline`,{interpolate:{protocol:`SAML`}}),{cancelButtonText:c.baseText(`settings.ldap.confirmMessage.beforeSaveForm.cancelButtonText`),confirmButtonText:c.baseText(`settings.ldap.confirmMessage.beforeSaveForm.confirmButtonText`)}),te=async()=>{let e=await p.confirm(c.baseText(`settings.sso.settings.save.testConnection.message`),c.baseText(`settings.sso.settings.save.testConnection.title`),{confirmButtonText:c.baseText(`settings.sso.settings.save.testConnection.test`),cancelButtonText:c.baseText(`settings.sso.settings.save.activate.cancel`)});return e===`confirm`?(await $(),await p.confirm(c.baseText(`settings.sso.settings.save.confirmTestConnection.message`),c.baseText(`settings.sso.settings.save.confirmTestConnection.title`),{confirmButtonText:c.baseText(`settings.sso.settings.save.confirmTestConnection.confirm`),cancelButtonText:c.baseText(`settings.sso.settings.save.activate.cancel`)})):e},Q=async(e=!1)=>{try{g.value=!0,ie();let t=v.value!==l.isSamlLoginEnabled&&l.isSamlLoginEnabled===!0;if(t&&await J()!==`confirm`)return;if(!e&&R({currentLoginEnabled:!!l.isSamlLoginEnabled,loginEnabledFormValue:v.value})){j.value=!0;return}j.value=!1;let n=D.value===x.URL?{metadataUrl:O.value}:{metadata:k.value};if(!l.isSamlLoginEnabled&&v.value&&(await l.saveSamlConfig(n),await te()!==`confirm`))return;let r=await l.saveSamlConfig({...n,loginEnabled:v.value});await L(t),l.selectedAuthProtocol=Z.SAML,await H(),K(r)}catch(e){f.showError(e,c.baseText(`settings.sso.settings.save.error`));return}finally{g.value=!1}},$=async()=>{try{let e=await l.testSamlConfig();typeof window<`u`&&window.open(e,`_blank`)}catch(e){f.showError(e,`error`)}},ie=()=>{if(D.value===x.URL)try{let e=new URL(O.value);if(e.protocol!==`https:`&&e.protocol!==`http:`)throw Error(`The provided protocol is not supported`)}catch{throw Error(c.baseText(`settings.sso.settings.ips.url.invalid`))}};return d(async()=>{await z()}),(e,t)=>(h(),r(`div`,null,[C(`div`,{class:S(e.$style.group)},[C(`label`,null,n(a(c).baseText(`settings.sso.settings.redirectUrl.label`)),1),s(Y,{value:_.value,"copy-button-text":a(c).baseText(`generic.clickToCopy`),"toast-title":a(c).baseText(`settings.sso.settings.redirectUrl.copied`)},null,8,[`value`,`copy-button-text`,`toast-title`]),C(`small`,null,n(a(c).baseText(`settings.sso.settings.redirectUrl.help`)),1)],2),C(`div`,{class:S(e.$style.group)},[C(`label`,null,n(a(c).baseText(`settings.sso.settings.entityId.label`)),1),s(Y,{value:A.value,"copy-button-text":a(c).baseText(`generic.clickToCopy`),"toast-title":a(c).baseText(`settings.sso.settings.entityId.copied`)},null,8,[`value`,`copy-button-text`,`toast-title`]),C(`small`,null,n(a(c).baseText(`settings.sso.settings.entityId.help`)),1)],2),C(`div`,{class:S(e.$style.group)},[C(`label`,null,n(a(c).baseText(`settings.sso.settings.ips.label`)),1),C(`div`,he,[s(a(I),{modelValue:D.value,"onUpdate:modelValue":t[0]||=e=>D.value=e,options:w.value},null,8,[`modelValue`,`options`])]),D.value===x.URL?(h(),r(`div`,ge,[s(a(N),{modelValue:O.value,"onUpdate:modelValue":t[1]||=e=>O.value=e,type:`text`,name:`metadataUrl`,size:`large`,placeholder:a(c).baseText(`settings.sso.settings.ips.url.placeholder`),"data-test-id":`sso-provider-url`},null,8,[`modelValue`,`placeholder`]),C(`small`,null,n(a(c).baseText(`settings.sso.settings.ips.url.help`)),1)])):i(``,!0),D.value===x.XML?(h(),r(`div`,_e,[s(a(N),{modelValue:k.value,"onUpdate:modelValue":t[2]||=e=>k.value=e,type:`textarea`,name:`metadata`,rows:4,"data-test-id":`sso-provider-xml`},null,8,[`modelValue`]),C(`small`,null,n(a(c).baseText(`settings.sso.settings.ips.xml.help`)),1)])):i(``,!0),s(ne,{modelValue:a(M),"onUpdate:modelValue":t[3]||=e=>b(M)?M.value=e:null,"auth-protocol":`saml`},null,8,[`modelValue`]),s(me,{modelValue:j.value,"onUpdate:modelValue":t[4]||=e=>j.value=e,"new-provisioning-setting":a(M),"auth-protocol":`saml`,onConfirmProvisioning:t[5]||=e=>Q(!0),onCancel:t[6]||=e=>j.value=!1},null,8,[`modelValue`,`new-provisioning-setting`]),C(`div`,{class:S([e.$style.group,e.$style.checkboxGroup])},[s(a(F),{modelValue:v.value,"onUpdate:modelValue":t[7]||=e=>v.value=e,"data-test-id":`sso-toggle`,label:a(c).baseText(`settings.sso.activated`)},null,8,[`modelValue`,`label`])],2)],2),C(`div`,{class:S(e.$style.buttons)},[s(a(E),{disabled:!U.value,loading:g.value,size:`large`,"data-test-id":`sso-save`,onClick:t[8]||=e=>Q(!1)},{default:m(()=>[y(n(a(c).baseText(`settings.sso.settings.save`)),1)]),_:1},8,[`disabled`,`loading`]),s(a(E),{variant:`subtle`,disabled:!G.value,size:`large`,"data-test-id":`sso-test`,onClick:$},{default:m(()=>[y(n(a(c).baseText(`settings.sso.settings.test`)),1)]),_:1},8,[`disabled`])],2)]))}}),ye={switch:`_switch_1blmf_128`,buttons:`_buttons_1blmf_134`,group:`_group_1blmf_143`,checkboxGroup:`_checkboxGroup_1blmf_159`,actionBox:`_actionBox_1blmf_163`,footer:`_footer_1blmf_167`},be=R(ve,[[`__cssModules`,{$style:ye}]]),xe=R(c({__name:`OidcSettingsForm`,setup(e){let i=T(),c=X(),l=B(),u=W(),p=V(),g=o(!1),_=o(``),x=o(``),w=o(``),D=o(!1),{formValue:O,isUserRoleProvisioningChanged:k,saveProvisioningConfig:A,shouldPromptUserToConfirmUserRoleProvisioningChange:j}=re(Z.OIDC),I=o(`select_account`),L=e=>{I.value=e},R=[{label:i.baseText(`settings.sso.settings.oidc.prompt.login`),value:`login`},{label:i.baseText(`settings.sso.settings.oidc.prompt.none`),value:`none`},{label:i.baseText(`settings.sso.settings.oidc.prompt.consent`),value:`consent`},{label:i.baseText(`settings.sso.settings.oidc.prompt.select_account`),value:`select_account`},{label:i.baseText(`settings.sso.settings.oidc.prompt.create`),value:`create`}],z=o(``),H=async()=>{let e=await c.getOidcConfig();x.value=e.clientId,w.value=e.clientSecret,_.value=e.discoveryEndpoint,I.value=e.prompt??`select_account`,z.value=e.authenticationContextClassReference?.join(`,`)||``},U=async()=>{if(c.isEnterpriseOidcEnabled)try{await H()}catch(e){u.showError(e,`error`)}},G=t(()=>{let e=z.value.split(`,`).map(e=>e.trim()).filter(Boolean).join(`,`),t=c.oidcConfig?.authenticationContextClassReference?.join(`,`)||``;return c.oidcConfig?.clientId===x.value&&c.oidcConfig?.clientSecret===w.value&&c.oidcConfig?.discoveryEndpoint===_.value&&c.oidcConfig?.loginEnabled===c.isOidcLoginEnabled&&c.oidcConfig?.prompt===I.value&&!k.value&&t===z.value&&e===t});async function K(e=!1){if(!e&&j({currentLoginEnabled:!!c.oidcConfig?.loginEnabled,loginEnabledFormValue:c.isOidcLoginEnabled})){D.value=!0;return}let t=c.oidcConfig?.loginEnabled!==c.isOidcLoginEnabled&&c.oidcConfig?.loginEnabled===!0;if(t&&await p.confirm(i.baseText(`settings.sso.confirmMessage.beforeSaveForm.message`,{interpolate:{protocol:`OIDC`}}),i.baseText(`settings.sso.confirmMessage.beforeSaveForm.headline`,{interpolate:{protocol:`OIDC`}}),{cancelButtonText:i.baseText(`settings.ldap.confirmMessage.beforeSaveForm.cancelButtonText`),confirmButtonText:i.baseText(`settings.ldap.confirmMessage.beforeSaveForm.confirmButtonText`)})!==`confirm`)return;let n=z.value.split(`,`).map(e=>e.trim()).filter(Boolean);try{g.value=!0;let e=await c.saveOidcConfig({clientId:x.value,clientSecret:w.value,discoveryEndpoint:_.value,prompt:I.value,loginEnabled:c.isOidcLoginEnabled,authenticationContextClassReference:n});await A(t),D.value=!1,c.selectedAuthProtocol=Z.OIDC,w.value=e.clientSecret,J(e)}catch(e){u.showError(e,i.baseText(`settings.sso.settings.save.error_oidc`));return}finally{g.value=!1,await H()}}function J(e){let t={instance_id:q().instanceId,authentication_method:Z.OIDC,discovery_endpoint:e.discoveryEndpoint,is_active:e.loginEnabled};l.track(`User updated single sign on settings`,t)}return d(async()=>{await U()}),(e,t)=>(h(),r(`div`,null,[C(`div`,{class:S(e.$style.group)},[t[10]||=C(`label`,null,`Redirect URL`,-1),s(Y,{value:a(c).oidc.callbackUrl,"copy-button-text":a(i).baseText(`generic.clickToCopy`),"toast-title":`Redirect URL copied to clipboard`},null,8,[`value`,`copy-button-text`]),t[11]||=C(`small`,null,`Copy the Redirect URL to configure your OIDC provider `,-1)],2),C(`div`,{class:S(e.$style.group)},[t[12]||=C(`label`,null,`Discovery Endpoint`,-1),s(a(N),{"model-value":_.value,type:`text`,"data-test-id":`oidc-discovery-endpoint`,placeholder:`https://accounts.google.com/.well-known/openid-configuration`,"onUpdate:modelValue":t[0]||=e=>_.value=e},null,8,[`model-value`]),t[13]||=C(`small`,null,`Paste here your discovery endpoint`,-1)],2),C(`div`,{class:S(e.$style.group)},[t[14]||=C(`label`,null,`Client ID`,-1),s(a(N),{"model-value":x.value,type:`text`,"data-test-id":`oidc-client-id`,"onUpdate:modelValue":t[1]||=e=>x.value=e},null,8,[`model-value`]),t[15]||=C(`small`,null,`The client ID you received when registering your application with your provider`,-1)],2),C(`div`,{class:S(e.$style.group)},[t[16]||=C(`label`,null,`Client Secret`,-1),s(a(N),{"model-value":w.value,type:`password`,"data-test-id":`oidc-client-secret`,"onUpdate:modelValue":t[2]||=e=>w.value=e},null,8,[`model-value`]),t[17]||=C(`small`,null,`The client Secret you received when registering your application with your provider`,-1)],2),C(`div`,{class:S(e.$style.group)},[t[18]||=C(`label`,null,`Prompt`,-1),s(a(M),{"model-value":I.value,"data-test-id":`oidc-prompt`,"onUpdate:modelValue":L},{default:m(()=>[(h(),r(f,null,v(R,e=>s(a(P),{key:e.value,label:e.label,"data-test-id":`oidc-prompt-filter-option`,value:e.value},null,8,[`label`,`value`])),64))]),_:1},8,[`model-value`]),t[19]||=C(`small`,null,`The prompt parameter to use when authenticating with the OIDC provider`,-1)],2),s(ne,{modelValue:a(O),"onUpdate:modelValue":t[3]||=e=>b(O)?O.value=e:null,"auth-protocol":`oidc`},null,8,[`modelValue`]),s(me,{modelValue:D.value,"onUpdate:modelValue":t[4]||=e=>D.value=e,"new-provisioning-setting":a(O),"auth-protocol":`oidc`,onConfirmProvisioning:t[5]||=e=>K(!0),onCancel:t[6]||=e=>D.value=!1},null,8,[`modelValue`,`new-provisioning-setting`]),C(`div`,{class:S(e.$style.group)},[t[20]||=C(`label`,null,`Authentication Context Class Reference`,-1),s(a(N),{"model-value":z.value,type:`textarea`,"data-test-id":`oidc-authentication-context-class-reference`,placeholder:`mfa, phrh, pwd`,"onUpdate:modelValue":t[7]||=e=>z.value=e},null,8,[`model-value`]),t[21]||=C(`small`,null,`ACR values to include in the authorization request (acr_values parameter), separated by commas in order of preference.`,-1)],2),C(`div`,{class:S([e.$style.group,e.$style.checkboxGroup])},[s(a(F),{modelValue:a(c).isOidcLoginEnabled,"onUpdate:modelValue":t[8]||=e=>a(c).isOidcLoginEnabled=e,"data-test-id":`sso-oidc-toggle`,label:a(i).baseText(`settings.sso.activated`)},null,8,[`modelValue`,`label`])],2),C(`div`,{class:S(e.$style.buttons)},[s(a(E),{"data-test-id":`sso-oidc-save`,size:`large`,loading:g.value,disabled:g.value||G.value,onClick:t[9]||=e=>K(!1)},{default:m(()=>[y(n(a(i).baseText(`settings.sso.settings.save`)),1)]),_:1},8,[`loading`,`disabled`])],2)]))}}),[[`__cssModules`,{$style:ye}]]),Se={class:`pb-2xl`},Ce={href:`https://docs.n8n.io/user-management/saml/`,target:`_blank`},we={key:1,"data-test-id":`sso-content-licensed`},Te={key:2,"data-test-id":`sso-content-licensed`},Ee=R(c({__name:`SettingsSso`,setup(e){let c=T(),u=X(),p=U(),g=J(),b=t(()=>[{label:Z.SAML.toUpperCase(),value:Z.SAML},{label:u.isEnterpriseOidcEnabled?Z.OIDC.toUpperCase():`${Z.OIDC.toUpperCase()} (${c.baseText(`generic.upgradeToEnterprise`)})`,value:Z.OIDC}]),x=t(()=>u.isEnterpriseSamlEnabled||u.isEnterpriseOidcEnabled),w=o(Z.SAML);function E(e){w.value=e}let k=()=>{g.goToUpgrade(`sso`,`upgrade-sso`)};return d(()=>{p.set(c.baseText(`settings.sso.title`)),u.initializeSelectedProtocol(),w.value=u.selectedAuthProtocol||Z.SAML}),(e,t)=>(h(),r(`div`,Se,[C(`div`,{class:S(e.$style.heading)},[s(a(L),{size:`2xlarge`},{default:m(()=>[y(n(a(c).baseText(`settings.sso.title`)),1)]),_:1})],2),s(a(O),null,{default:m(()=>[y(n(a(c).baseText(`settings.sso.info`))+` `,1),C(`a`,Ce,n(a(c).baseText(`settings.sso.info.link`)),1)]),_:1}),x.value?(h(),r(`div`,{key:0,"data-test-id":`sso-auth-protocol-select`,class:S(e.shared.group)},[t[1]||=C(`label`,null,`Select Authentication Protocol`,-1),C(`div`,null,[s(a(M),{filterable:``,"model-value":w.value,placeholder:a(c).baseText(`parameterInput.select`),"onUpdate:modelValue":E,onKeydown:t[0]||=_(()=>{},[`stop`])},{default:m(()=>[(h(!0),r(f,null,v(b.value,({label:e,value:t})=>(h(),l(a(P),{key:t,value:t,label:e,"data-test-id":`credential-select-option`},null,8,[`value`,`label`]))),128))]),_:1},8,[`model-value`,`placeholder`])])],2)):i(``,!0),a(u).isEnterpriseSamlEnabled&&w.value===a(Z).SAML?(h(),r(`div`,we,[s(be)])):i(``,!0),a(u).isEnterpriseOidcEnabled&&w.value===a(Z).OIDC?(h(),r(`div`,Te,[s(xe)])):i(``,!0),x.value?i(``,!0):(h(),l(a(D),{key:3,"data-test-id":`sso-content-unlicensed`,class:S(e.$style.actionBox),description:a(c).baseText(`settings.sso.actionBox.description`),"button-text":a(c).baseText(`settings.sso.actionBox.buttonText`),"onClick:button":k},{heading:m(()=>[C(`span`,null,n(a(c).baseText(`settings.sso.actionBox.title`)),1)]),_:1},8,[`class`,`description`,`button-text`]))]))}}),[[`__cssModules`,{shared:ye,$style:{heading:`_heading_bewbd_125`,actionBox:`_actionBox_bewbd_129`}}]]);export{Ee as default};
//# sourceMappingURL=SettingsSso-CfA5pT8Z.js.map