!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"n8n@2.9.4"}}catch(e){}}(),System.register(["./vue.runtime.esm-bundler-legacy-BquwEXRp.js","./_MapCache-legacy-BR_CVmoL.js","./src-legacy-kcwUfEuS.js","./_plugin-vue_export-helper-legacy-DtDV0xrP.js","./sanitize-html-legacy-rns0ELH_.js","./users.store-legacy-B-bVJKl3.js","./constants-legacy-DVkAm8xO.js","./merge-legacy-C4nCP5az.js","./_baseOrderBy-legacy-BnyL5wLN.js","./dateformat-legacy-BvMRGS_P.js","./useDebounce-legacy-BSzeAS4U.js","./versions.store-legacy-DyDzuHis.js","./usePageRedirectionHelper-legacy-DkG-ZaDD.js","./executions.store-legacy-OEeCPZk_.js","./pushConnection.store-legacy-C36NF7Lj.js","./collaboration.store-legacy-COoId2Xe.js","./utils-legacy-Dl8SPFUn.js","./useWorkflowActivate-legacy-BYoAWriG.js","./WorkflowPreview-legacy-C97BoFHX.js","./useIntersectionObserver-legacy-CUxV00uQ.js"],(function(e,t){var o,i,s,a,r,n,l,u,d,c,v,p,m,_,w,f,g,y,h,b,k,x,I,q,T,H,$,V,L,A,W,C,D,B,R,M,P,j,O,E,z,N,S,U,F,G,K,Y,J,Z,Q,X,ee,te,oe,ie,se,ae,re,ne,le,ue,de,ce,ve,pe,me,_e,we,fe,ge,ye,he,be;return{setters:[function(e){o=e.C,i=e.Cn,s=e.D,a=e.E,r=e.Gt,n=e.It,l=e.L,u=e.M,d=e.P,c=e.Pt,v=e.T,p=e.Z,m=e._,_=e._t,w=e.bt,f=e.et,g=e.h,y=e.it,h=e.j,b=e.ot,k=e.q,x=e.vn,I=e.vt,q=e.w},function(e){T=e.bt,H=e.yt},function(e){$=e.At,V=e.Ci,L=e.Et,A=e.Hi,W=e.Oi,C=e.Tt,D=e.Ui,B=e.Vi,R=e._t,M=e.gi,P=e.wi,j=e.zi},function(e){O=e.t},function(e){},function(e){E=e.Dr,z=e.Rr,N=e.r,S=e.t,U=e.ws,F=e.yr,G=e.zt},function(e){K=e.Is,Y=e.Ls,J=e.Yc,Z=e.qo,Q=e.rs,X=e.zs},function(e){},function(e){ee=e.r},function(e){},function(e){},function(e){},function(e){te=e.t},function(e){},function(e){},function(e){},function(e){oe=e.i,ie=e.n,se=e.r,ae=e.t},function(e){re=e.t},function(e){ne=e.t},function(e){le=e.t}],execute:function(){(ue=document.createElement("style")).textContent='._item_t6iqo_125{padding:0 var(--spacing--3xs);line-height:var(--line-height--xl);border-radius:var(--radius);cursor:pointer;margin-top:var(--spacing--lg);justify-content:space-between;align-items:center;display:flex;position:relative}._item_t6iqo_125:not(._grouped_t6iqo_136)._selected_t6iqo_136,._item_t6iqo_125:not(._grouped_t6iqo_136):hover{background-color:var(--color--background--light-1)}._item_t6iqo_125:first-child{margin-top:0}._item_t6iqo_125:not(:first-child):not(._grouped_t6iqo_136):before{width:var(--border-width);background-color:var(--color--foreground);content:"";height:var(--spacing--lg);position:absolute;bottom:100%;left:17.5px}._item_t6iqo_125._grouped_t6iqo_136{margin-top:var(--spacing--xs)}._item_t6iqo_125._grouped_t6iqo_136 ._wrapper_t6iqo_154{border-radius:var(--radius)}._item_t6iqo_125._grouped_t6iqo_136._selected_t6iqo_136 ._wrapper_t6iqo_154,._item_t6iqo_125._grouped_t6iqo_136:hover ._wrapper_t6iqo_154{background-color:var(--color--background--light-1)}._wrapper_t6iqo_154{flex:1;align-items:center;min-width:0;display:flex}._timelineColumn_t6iqo_168{width:var(--spacing--lg);min-width:var(--spacing--lg);flex-direction:column;justify-content:center;align-self:stretch;align-items:center;display:flex;position:relative}._timelineDot_t6iqo_179{border-radius:50%;width:8px;height:8px;display:inline-block}._timelineDotPublished_t6iqo_186{background-color:var(--color--mint-600)}._timelineDotLatest_t6iqo_190{background-color:var(--color--yellow-500)}._timelineDotDefault_t6iqo_194{border:var(--border);border-color:var(--color--text--tint-2)}._timelineLine_t6iqo_199{width:var(--border-width);background-color:var(--color--foreground);top:calc(-1*var(--spacing--xs));position:absolute;bottom:0}._content_t6iqo_207{padding:var(--spacing--3xs);flex-direction:column;flex:auto;min-width:0;display:flex}._mainRow_t6iqo_215{align-items:center;gap:var(--spacing--2xs);display:flex}._mainLine_t6iqo_221{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}._metaRow_t6iqo_227{align-items:center;gap:var(--spacing--5xs);margin-top:var(--spacing--5xs);min-width:0;display:flex}._metaAuthor_t6iqo_235{white-space:nowrap;text-overflow:ellipsis;max-width:130px;display:block;overflow:hidden}._metaTime_t6iqo_243{white-space:nowrap;flex-shrink:0}._unnamedRow_t6iqo_248{align-items:center;gap:var(--spacing--5xs);min-width:0;display:flex}._unnamedAuthor_t6iqo_255{white-space:nowrap;text-overflow:ellipsis;max-width:130px;display:block;overflow:hidden}._unnamedTime_t6iqo_263{white-space:nowrap;flex-shrink:0}._actions_t6iqo_268{padding:var(--spacing--3xs);flex-shrink:0;align-self:center;display:block}._publishedBadge_t6iqo_275{background-color:var(--color--success);color:var(--color--foreground--tint-2)}._list_n49uh_125{width:100%;height:100%;padding:var(--spacing--sm)var(--spacing--2xs);position:absolute;top:0;left:0;overflow:auto}._loader_n49uh_135{padding:0 var(--spacing--sm)}._sentinel_n49uh_139{height:1px}._retention_n49uh_143{padding:var(--spacing--sm);font-size:var(--font-size--2xs);line-height:var(--line-height--lg);text-align:center;display:grid}._groupHeader_n49uh_151{align-items:center;gap:var(--spacing--2xs);padding:var(--spacing--2xs)var(--spacing--3xs);margin-top:var(--spacing--lg);cursor:pointer;display:flex;position:relative}._groupHeader_n49uh_151:not(:first-child):before{width:var(--border-width);background-color:var(--color--foreground);content:"";height:var(--spacing--lg);position:absolute;bottom:100%;left:17.5px}._groupTimelineColumn_n49uh_170{min-width:var(--spacing--lg)}._groupChevron_n49uh_174{color:var(--color--text--tint-1)}._content_1kvp7_125{width:100%;height:100%;display:block;position:absolute;top:0;left:0;overflow:auto}._info_1kvp7_135{z-index:1;width:100%;position:absolute;top:0;left:0}._card_1kvp7_143{padding:var(--spacing--sm)var(--spacing--lg)0;justify-content:space-between;align-items:start;display:flex}._descriptionBox_1kvp7_150{gap:var(--spacing--3xs);max-width:330px;margin-top:var(--spacing--3xs);padding:var(--spacing--xs);border:var(--border-width)var(--border-style)var(--color--foreground);border-radius:var(--radius);background-color:var(--color--background--light-3);flex-direction:column;display:flex}._mainLine_1kvp7_162{text-overflow:ellipsis;white-space:nowrap;cursor:default;display:block;overflow:hidden}._actions_1kvp7_170{padding:var(--spacing--3xs);display:block}._view_q2hup_125{background-color:var(--color--background--light-3);grid-template:"header corner"65px"content list"/auto 330px;width:100%;display:grid;position:relative}._header_q2hup_135{padding:0 var(--spacing--lg);border-bottom:var(--border-width)var(--border-style)var(--color--foreground);grid-area:header;align-items:center;display:flex}._corner_q2hup_143{padding:0 var(--spacing--3xs)0 var(--spacing--sm);background-color:var(--color--background--light-2er);border-bottom:var(--border-width)var(--border-style)var(--color--foreground);border-left:var(--border-width)var(--border-style)var(--color--foreground);grid-area:corner;justify-content:space-between;align-items:center;display:flex}._contentComponentWrapper_q2hup_154{grid-area:content;position:relative}._listComponentWrapper_q2hup_159{border-left:var(--border-width)var(--border-style)var(--color--foreground);grid-area:list;position:relative}\n/*$vite$:1*/',document.head.appendChild(ue);try{t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},(ke=(new t.Error).stack)&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[ke]="c88bf551-6953-49af-b445-d5a87839ff98",t._sentryDebugIdIdentifier="sentry-dbid-c88bf551-6953-49af-b445-d5a87839ff98")}catch(t){}var t,ke;de={key:0},ce={key:1},ve=d({__name:"WorkflowHistoryListItem",props:{item:{},index:{},actions:{},isSelected:{type:Boolean,default:!1},isVersionActive:{type:Boolean,default:!1},isGrouped:{type:Boolean,default:!1}},emits:["action","preview","mounted"],setup(e,{emit:t}){const l=e,d=t,c=H(),_=S(),y=n(!1),b=n(null),k=o((()=>{const{date:e,time:t}=ie(l.item.createdAt);return c.baseText("workflowHistory.item.createdAt",{interpolate:{date:e,time:t}})})),I=o((()=>{const e=l.item.authors.split(", ");let t=e[0];return e.length>1&&(t=`${t} + ${e.length-1}`),{size:e.length,label:t}})),T=o((()=>l.item.name?l.item.name:l.isVersionActive?se(l.item.versionId):"")),$=o((()=>{if(!l.isVersionActive)return null;const e=oe(l.item.workflowPublishHistory);return e||null})),V=o((()=>oe(l.item.workflowPublishHistory))),L=e=>{if(!e)return null;const t=_.usersById[e];return t?.fullName??t?.email??null},A=o((()=>l.isGrouped?null:l.isVersionActive?L($.value?.userId)?c.baseText("workflowHistory.item.publishedBy"):c.baseText("workflowHistory.item.active"):0!==l.index||l.isVersionActive?V.value?L(V.value?.userId)?c.baseText("workflowHistory.item.publishedBy"):c.baseText("workflowHistory.item.active"):k.value:c.baseText("workflowHistory.item.currentChanges"))),D=o((()=>l.isGrouped?null:l.isVersionActive&&$.value?$.value.createdAt:V.value?V.value.createdAt:null)),R=o((()=>l.isGrouped?null:l.isVersionActive&&$.value?L($.value.userId):V.value?L(V.value.userId):null)),M=o((()=>{if(!D.value)return null;const{date:e,time:t}=ie(D.value);return c.baseText("workflowHistory.item.createdAt",{interpolate:{date:e,time:t}})})),P=e=>{d("action",{action:e,id:l.item.versionId,data:{formattedCreatedAt:k.value,versionName:T.value,description:l.item.description}})},j=e=>{y.value=e},O=e=>{d("preview",{event:e,id:l.item.versionId})};return p((()=>{d("mounted",{index:l.index,offsetTop:b.value?.offsetTop??0,isSelected:l.isSelected})})),(e,t)=>(f(),v(r(W),{placement:"left",disabled:!A.value,"show-after":300},{content:w((()=>[0!==l.index||l.isVersionActive?(f(),s("div",ce,[h(i(A.value)+" ",1),R.value?(f(),s(m,{key:0},[h(i(R.value),1)],64)):a("",!0),M.value?(f(),s(m,{key:1},[R.value?(f(),s(m,{key:0},[h(", ")],64)):a("",!0),h(" "+i(M.value),1)],64)):a("",!0)])):(f(),s("div",de,i(A.value),1))])),default:w((()=>[q("li",{ref_key:"itemElement",ref:b,"data-test-id":"workflow-history-list-item",role:"button",class:x({[e.$style.item]:!0,[e.$style.selected]:l.isSelected,[e.$style.actionsVisible]:y.value,[e.$style.grouped]:l.isGrouped}),onClick:O},[q("span",{class:x(e.$style.timelineColumn)},[l.isGrouped?(f(),s("span",{key:1,class:x(e.$style.timelineLine)},null,2)):(f(),s(m,{key:0},[l.isVersionActive?(f(),s("span",{key:0,class:x([e.$style.timelineDot,e.$style.timelineDotPublished])},null,2)):0!==l.index||l.isVersionActive?(f(),s("span",{key:2,class:x([e.$style.timelineDot,e.$style.timelineDotDefault])},null,2)):(f(),s("span",{key:1,class:x([e.$style.timelineDot,e.$style.timelineDotLatest])},null,2))],64))],2),q("div",{class:x(e.$style.wrapper)},[q("div",{class:x(e.$style.content)},[T.value?(f(),s(m,{key:0},[q("div",{class:x(e.$style.mainRow)},[u(r(B),{size:"small",bold:!0,color:"text-dark",class:x(e.$style.mainLine)},{default:w((()=>[h(i(T.value),1)])),_:1},8,["class"])],2),q("div",{class:x(e.$style.metaRow)},[u(r(B),{size:"small",color:"text-base",class:x(e.$style.metaAuthor)},{default:w((()=>[h(i(I.value.label)+", ",1)])),_:1},8,["class"]),u(r(B),{tag:"time",size:"small",color:"text-base",class:x(e.$style.metaTime)},{default:w((()=>[h(i(k.value),1)])),_:1},8,["class"])],2)],64)):(f(),s("div",{key:1,class:x(e.$style.unnamedRow)},[u(r(B),{size:"small",color:"text-base",class:x(e.$style.unnamedAuthor)},{default:w((()=>[h(i(I.value.label)+", ",1)])),_:1},8,["class"]),u(r(B),{tag:"time",size:"small",color:"text-base",class:x(e.$style.unnamedTime)},{default:w((()=>[h(i(k.value),1)])),_:1},8,["class"])],2))],2),u(r(C),{class:x(e.$style.actions),actions:l.actions,placement:"bottom-end",onAction:P,onClick:t[0]||(t[0]=g((()=>{}),["stop"])),onVisibleChange:j},null,8,["class","actions"])],2)],2)])),_:1},8,["disabled"]))}}),pe=O(ve,[["__cssModules",{$style:{item:"_item_t6iqo_125",grouped:"_grouped_t6iqo_136",selected:"_selected_t6iqo_136",wrapper:"_wrapper_t6iqo_154",timelineColumn:"_timelineColumn_t6iqo_168",timelineDot:"_timelineDot_t6iqo_179",timelineDotPublished:"_timelineDotPublished_t6iqo_186",timelineDotLatest:"_timelineDotLatest_t6iqo_190",timelineDotDefault:"_timelineDotDefault_t6iqo_194",timelineLine:"_timelineLine_t6iqo_199",content:"_content_t6iqo_207",mainRow:"_mainRow_t6iqo_215",mainLine:"_mainLine_t6iqo_221",metaRow:"_metaRow_t6iqo_227",metaAuthor:"_metaAuthor_t6iqo_235",metaTime:"_metaTime_t6iqo_243",unnamedRow:"_unnamedRow_t6iqo_248",unnamedAuthor:"_unnamedAuthor_t6iqo_255",unnamedTime:"_unnamedTime_t6iqo_263",actions:"_actions_t6iqo_268",publishedBadge:"_publishedBadge_t6iqo_275"}}]]),me=["aria-expanded","onClick"],_e=["aria-label"],we={"data-test-id":"prune-time-display"},fe=d({__name:"WorkflowHistoryList",props:{items:{},selectedItem:{},actions:{},requestNumberOfItems:{},lastReceivedItemsLength:{},evaluatedPruneTimeInHours:{},shouldUpgrade:{type:Boolean},isListLoading:{type:Boolean},activeVersionId:{}},emits:["action","preview","loadMore","upgrade"],setup(e,{emit:t}){const l=e,d=t,p=H(),g=n(null),b=n(null),k=n(!0),I=c(new Set),$=o((()=>ae(l.items))),V=o((()=>l.lastReceivedItemsLength===l.requestNumberOfItems)),{observe:A}=le({root:g,threshold:.01,onIntersect:()=>{k.value=!1,d("loadMore",{take:l.requestNumberOfItems,skip:l.items.length})}});_([b,V,()=>l.items.length],(([e,t])=>{e&&t&&A(e)}),{immediate:!0});const W=(e,t)=>{let o=l.actions;return 0===t&&(o=o.filter((e=>"restore"!==e.value))),o=e.versionId===l.activeVersionId?o.filter((e=>"publish"!==e.value)):o.filter((e=>"unpublish"!==e.value)),o},C=({action:e,id:t,data:o})=>{k.value=!1,d("action",{action:e,id:t,data:o})},R=({event:e,id:t})=>{k.value=!1,d("preview",{event:e,id:t})},M=({offsetTop:e,isSelected:t})=>{t&&k.value&&(k.value=!1,g.value?.scrollTo({top:e,behavior:"smooth"}))},P=o((()=>{const e=l.evaluatedPruneTimeInHours;if(e<24){const t=1===e?"workflowHistory.limitHour":"workflowHistory.limitHours";return p.baseText(t,{interpolate:{hours:String(e)}})}{const t=Math.round(e/24),o=1===t?"workflowHistory.limitDay":"workflowHistory.limitDays";return p.baseText(o,{interpolate:{days:String(t)}})}}));return(e,t)=>(f(),s("ul",{ref_key:"listElement",ref:g,class:x(e.$style.list),"data-test-id":"workflow-history-list"},[(f(!0),s(m,null,y($.value,(t=>(f(),s(m,{key:"version"===t.type?t.item.versionId:t.groupId},["group-header"===t.type?(f(),s("li",{key:0,class:x(e.$style.groupHeader),"aria-expanded":I.has(t.groupId),role:"button","data-test-id":"workflow-history-group-header",onClick:e=>{return o=t.groupId,void(I.has(o)?I.delete(o):I.add(o));var o}},[u(r(D),{class:x([e.$style.groupTimelineColumn,e.$style.groupChevron]),icon:I.has(t.groupId)?"chevron-down":"chevron-right",size:"small"},null,8,["class","icon"]),u(r(B),{color:"text-base",size:"small"},{default:w((()=>[h(i(r(p).baseText("workflowHistory.group.unnamedVersions",{adjustToNumber:t.count,interpolate:{count:String(t.count)}})),1)])),_:2},1024)],10,me)):a("",!0),"group-header"===t.type&&I.has(t.groupId)?(f(!0),s(m,{key:1},y(t.versions,(e=>(f(),v(pe,{key:e.item.versionId,index:e.originalIndex,item:e.item,"is-selected":e.item.versionId===l.selectedItem?.versionId,"is-version-active":e.item.versionId===l.activeVersionId,actions:W(e.item,e.originalIndex),"is-grouped":!0,onAction:C,onPreview:R,onMounted:M},null,8,["index","item","is-selected","is-version-active","actions"])))),128)):a("",!0),"version"===t.type?(f(),v(pe,{key:2,index:t.originalIndex,item:t.item,"is-selected":t.item.versionId===l.selectedItem?.versionId,"is-version-active":t.item.versionId===l.activeVersionId,actions:W(t.item,t.originalIndex),onAction:C,onPreview:R,onMounted:M},null,8,["index","item","is-selected","is-version-active","actions"])):a("",!0)],64)))),128)),l.items.length&&V.value?(f(),s("li",{key:0,ref_key:"loadMoreSentinel",ref:b,class:x(e.$style.sentinel),"aria-hidden":"true"},null,2)):a("",!0),l.isListLoading?(f(),s("li",{key:1,class:x(e.$style.loader),role:"status","aria-live":"polite","aria-busy":"true","aria-label":r(p).baseText("generic.loading")},[u(r(L),{rows:3,class:"mb-xs"}),u(r(L),{rows:3,class:"mb-xs"}),u(r(L),{rows:3,class:"mb-xs"})],10,_e)):a("",!0),l.shouldUpgrade?(f(),s("li",{key:2,class:x(e.$style.retention)},[q("span",we,i(P.value),1),u(r(T),{keypath:"workflowHistory.upgrade",tag:"span",scope:"global"},{link:w((()=>[q("a",{href:"#",onClick:t[0]||(t[0]=e=>d("upgrade"))},i(r(p).baseText("workflowHistory.upgrade.link")),1)])),_:1})],2)):a("",!0)],2))}}),ge=O(fe,[["__cssModules",{$style:{list:"_list_n49uh_125",loader:"_loader_n49uh_135",sentinel:"_sentinel_n49uh_139",retention:"_retention_n49uh_143",groupHeader:"_groupHeader_n49uh_151",groupTimelineColumn:"_groupTimelineColumn_n49uh_170",groupChevron:"_groupChevron_n49uh_174"}}]]),ye=d({__name:"WorkflowHistoryContent",props:{workflow:{},workflowVersion:{},actions:{},isVersionActive:{type:Boolean},isListLoading:{type:Boolean},isFirstItemShown:{type:Boolean}},emits:["action"],setup(e,{emit:t}){const l=H(),d=e,c=t,p=o((()=>{if(!d.workflowVersion||!d.workflow)return;const{pinData:e,...t}=d.workflow;return{...t,nodes:d.workflowVersion.nodes,connections:d.workflowVersion.connections}})),m=o((()=>{if(!d.workflowVersion)return"";const{date:e,time:t}=ie(d.workflowVersion.createdAt);return l.baseText("workflowHistory.item.createdAt",{interpolate:{date:e,time:t}})})),g=o((()=>d.workflowVersion?.name?d.workflowVersion.name:d.isVersionActive&&d.workflowVersion?se(d.workflowVersion.versionId):m.value)),y=n(!1),b=o((()=>d.workflowVersion?.description??"")),k=o((()=>b.value.length>200)),I=o((()=>!k.value||y.value?b.value:b.value.substring(0,200)+"... ")),T=()=>{y.value=!y.value},$=o((()=>{let e=d.actions;return d.isFirstItemShown&&(e=e.filter((e=>"restore"!==e.value))),e=d.isVersionActive?e.filter((e=>"publish"!==e.value)):e.filter((e=>"unpublish"!==e.value)),e})),V=e=>{d.workflowVersion&&c("action",{action:e,id:d.workflowVersion.versionId,data:{formattedCreatedAt:m.value,versionName:g.value,description:b.value}})};return _((()=>d.workflowVersion),(()=>{y.value=!1})),(e,t)=>(f(),s("div",{class:x(e.$style.content)},[d.workflowVersion?(f(),v(ne,{key:0,workflow:p.value,loading:d.isListLoading,"loader-type":"spinner"},null,8,["workflow","loading"])):a("",!0),d.workflowVersion?(f(),s("div",{key:1,class:x(e.$style.info)},[q("div",{class:x(e.$style.card)},[q("div",{class:x(e.$style.descriptionBox)},[g.value?(f(),v(r(W),{key:0,content:g.value},{default:w((()=>[u(r(B),{class:x(e.$style.mainLine),bold:"",color:"text-dark"},{default:w((()=>[h(i(g.value),1)])),_:1},8,["class"])])),_:1},8,["content"])):a("",!0),b.value?(f(),v(r(B),{key:1,size:"small",color:"text-base"},{default:w((()=>[h(i(I.value)+" ",1),k.value?(f(),v(r(M),{key:0,size:"small",onClick:T},{default:w((()=>[h(i(y.value?r(l).baseText("generic.showLess"):r(l).baseText("generic.showMore")),1)])),_:1})):a("",!0)])),_:1})):a("",!0)],2),u(r(C),{class:x(e.$style.actions),actions:$.value,placement:"bottom-end","data-test-id":"workflow-history-content-actions",onAction:V},{default:w((()=>[u(r(A),{variant:"subtle",size:"large","data-test-id":"action-toggle-button"},{default:w((()=>[h(i(r(l).baseText("workflowHistory.content.actions"))+" ",1),u(r(D),{class:"ml-3xs",icon:"chevron-down",size:"small"})])),_:1})])),_:1},8,["class","actions"])],2)],2)):a("",!0)],2))}}),he=O(ye,[["__cssModules",{$style:{content:"_content_1kvp7_125",info:"_info_1kvp7_135",card:"_card_1kvp7_143",descriptionBox:"_descriptionBox_1kvp7_150",mainLine:"_mainLine_1kvp7_162",actions:"_actions_1kvp7_170"}}]]),be={key:0},e("default",O(d({__name:"WorkflowHistory",setup(e){const t=["restore","publish","unpublish","name","clone","open","download"],d=t.reduce(((e,t)=>({...e,[t.toUpperCase()]:t})),{}),c=V(),p=P(),m=H(),_=F(),g=te(),y=E(),T=N(),L=z(),W=S(),C=U(),D=re(),B=o((()=>C.isEnterpriseFeatureEnabled[J.NamedVersions])),M=n(!0),O=n(!0),oe=n(20),ie=n(0),se=n(null),ae=n([]),ne=n(null),le=o((()=>t.filter((e=>!("publish"===e&&se.value?.isArchived||"name"===e&&!B.value))))),ue=o((()=>ye("workflowId"))),de=o((()=>ye("versionId"))),ce=o((()=>({name:Q.WORKFLOW,params:{name:ue.value}}))),ve=o((()=>Z(L.getWorkflowById(ue.value)?.scopes).workflow)),pe=o((()=>L.getWorkflowById(ue.value)?.activeVersion?.versionId)),me=o((()=>le.value.map((e=>({label:m.baseText(`workflowHistory.item.actions.${e}`),disabled:"clone"===e&&!ve.value.create||("restore"===e||"name"===e)&&!ve.value.update||("publish"===e||"unpublish"===e)&&!ve.value.publish,value:e}))))),_e=o((()=>ae.value[0]?.versionId===de.value)),we=e=>{G.track(e,{instance_id:ee().instanceId,workflow_id:ue.value})},fe=async e=>{const t=await y.getWorkflowHistory(ue.value,e);ie.value=t.length;const o=t.flatMap((e=>e.workflowPublishHistory.map((e=>e.userId)))).filter((e=>Boolean(e))),i=new Set(o);await W.fetchUsers({filter:{ids:Array.from(i)}}),ae.value=ae.value.concat(t)};k((async()=>{we("User opened workflow history");try{const[e]=await Promise.all([L.fetchWorkflow(ue.value),fe({take:oe.value})]);se.value=e,O.value=!1,!de.value&&ae.value.length&&await p.replace({name:Q.WORKFLOW_HISTORY,params:{workflowId:ue.value,versionId:ae.value[0].versionId}})}catch(e){M.value=!1,_.showError(e,m.baseText("workflowHistory.title"))}}));const ye=e=>{const t=c.params[e];return"string"==typeof t?t:t?.[0]??""},ke=e=>{const{href:t}=p.resolve({name:Q.WORKFLOW_HISTORY,params:{workflowId:ue.value,versionId:e}});window.open(t,"_blank")},xe=async({action:e,id:t,data:o})=>{try{switch(e){case d.OPEN:ke(t),we("User opened version in new tab");break;case d.DOWNLOAD:await y.downloadVersion(ue.value,t,o),we("User downloaded version");break;case d.CLONE:await(async(e,t)=>{const o=await y.cloneIntoNewWorkflow(ue.value,e,t),{href:i}=p.resolve({name:Q.WORKFLOW,params:{name:o.id}});_.showMessage({title:m.baseText("workflowHistory.action.clone.success.title"),message:l("a",{href:i,target:"_blank"},m.baseText("workflowHistory.action.clone.success.message")),type:"success",duration:1e4})})(t,o),we("User cloned version");break;case d.RESTORE:await(async e=>{const t=(await L.fetchWorkflow(ue.value)).versionId;se.value=await y.restoreWorkflow(ue.value,e),se.value.versionId!==t?(ae.value=(await y.getWorkflowHistory(ue.value,{take:1})).concat(ae.value),_.showMessage({title:m.baseText("workflowHistory.action.restore.success.title"),type:"success"})):_.showMessage({title:m.baseText("workflowHistory.action.restore.alreadyRestored"),type:"info"})})(t),we("User restored version");break;case d.PUBLISH:((e,t)=>{const o=R(),i=n({versionId:e,versionName:t.versionName,description:t.description,modalTitle:m.baseText("workflows.publishModal.title"),submitButtonLabel:m.baseText("workflows.publish"),submitting:!1,eventBus:o});o.once("submit",(async t=>{i.value.submitting=!0;try{const{success:o}=await D.publishWorkflow(ue.value,e,{name:t.name,description:t.description});if(o){se.value=L.getWorkflowById(ue.value);const e=ae.value.find((e=>e.versionId===t.versionId));e&&(e.name=t.name,e.description=t.description,se.value?.activeVersion?.workflowPublishHistory&&(e.workflowPublishHistory=se.value.activeVersion.workflowPublishHistory)),ne.value?.versionId===t.versionId&&(ne.value={...ne.value,name:t.name,description:t.description,workflowPublishHistory:se.value?.activeVersion?.workflowPublishHistory??ne.value.workflowPublishHistory}),we("User published version from history"),T.closeModal(Y)}}finally{i.value.submitting=!1}})),T.openModalWithData({name:Y,data:i.value})})(t,o);break;case d.UNPUBLISH:((e,t)=>{if(pe.value!==e)return;const o=R();o.once("unpublish",(async()=>{const e=await D.unpublishWorkflowFromHistory(ue.value);T.closeModal(X),e&&(se.value=L.getWorkflowById(ue.value),_.showMessage({title:m.baseText("workflowHistory.action.unpublish.success.title"),type:"success"}),we("User unpublished workflow from history"))})),T.openModalWithData({name:X,data:{versionName:t.versionName,eventBus:o}})})(t,o);break;case d.NAME:await(async(e,t)=>{const o=R(),i=n({versionId:e,versionName:t.versionName,description:t.description,modalTitle:m.baseText("workflowHistory.nameVersionModal.title"),submitButtonLabel:m.baseText("workflowHistory.nameVersionModal.confirmButton"),submitting:!1,eventBus:o});o.once("submit",(async t=>{i.value.submitting=!0;try{await y.updateWorkflowHistoryVersion(ue.value,e,{name:t.name,description:t.description});const o=ae.value.find((e=>e.versionId===t.versionId));o&&(o.name=t.name,o.description=t.description),ne.value?.versionId===t.versionId&&(ne.value={...ne.value,name:t.name,description:t.description}),_.showMessage({title:m.baseText("workflowHistory.action.nameVersion.success.title"),type:"success"}),we("User named version from history"),T.closeModal(K)}catch(o){_.showError(o,m.baseText("workflowHistory.action.nameVersion.error.title"))}finally{i.value.submitting=!1}})),T.openModalWithData({name:K,data:i.value})})(t,o)}}catch(i){_.showError(i,m.baseText("workflowHistory.action.error.title",{interpolate:{action:m.baseText(`workflowHistory.item.actions.${e}`).toLowerCase()}}))}},Ie=async({event:e,id:t})=>{e.metaKey||e.ctrlKey?(ke(t),we("User opened version in new tab")):await p.push({name:Q.WORKFLOW_HISTORY,params:{workflowId:ue.value,versionId:t}})},qe=()=>{g.goToUpgrade("workflow-history","upgrade-workflow-history")};return I((async()=>{if(de.value)try{const[e,t]=await Promise.all([y.getWorkflowVersion(ue.value,de.value),L.fetchWorkflow(ue.value)]);ne.value=e,se.value=t,we("User selected version")}catch(e){e.message?.includes("version")?_.showError(new Error(`${e.message} "${de.value}"&nbsp;`),m.baseText("workflowHistory.title")):(M.value=!1,_.showError(e,m.baseText("workflowHistory.title")))}})),(e,t)=>{const o=b("RouterLink");return f(),s("div",{class:x(e.$style.view)},[q("div",{class:x(e.$style.header)},[u(r(j),{tag:"h2",size:"medium"},{default:w((()=>[h(i(se.value?.name),1)])),_:1}),se.value?.isArchived?(f(),s("span",be,[u(r($),{class:"ml-s",theme:"tertiary",bold:"","data-test-id":"workflow-archived-tag"},{default:w((()=>[h(i(r(m).baseText("workflows.item.archived")),1)])),_:1})])):a("",!0)],2),q("div",{class:x(e.$style.corner)},[u(r(j),{tag:"h2",size:"medium",bold:""},{default:w((()=>[h(i(r(m).baseText("workflowHistory.title")),1)])),_:1}),u(o,{to:ce.value,"data-test-id":"workflow-history-close-button"},{default:w((()=>[u(r(A),{variant:"ghost",icon:"x",size:"small",square:""})])),_:1},8,["to"])],2),q("div",{class:x(e.$style.listComponentWrapper)},[M.value?(f(),v(ge,{key:0,items:ae.value,"last-received-items-length":ie.value,"selected-item":ne.value,actions:me.value,"request-number-of-items":oe.value,"should-upgrade":r(y).shouldUpgrade,"evaluated-prune-time-in-hours":r(y).evaluatedPruneTime,"is-list-loading":O.value,"active-version-id":pe.value,onAction:xe,onPreview:Ie,onLoadMore:fe,onUpgrade:qe},null,8,["items","last-received-items-length","selected-item","actions","request-number-of-items","should-upgrade","evaluated-prune-time-in-hours","is-list-loading","active-version-id"])):a("",!0)],2),q("div",{class:x(e.$style.contentComponentWrapper)},[M.value?(f(),v(he,{key:0,workflow:se.value,"workflow-version":ne.value,"is-version-active":ne.value?.versionId===pe.value,actions:me.value,"is-list-loading":O.value,"is-first-item-shown":_e.value,onAction:xe},null,8,["workflow","workflow-version","is-version-active","actions","is-list-loading","is-first-item-shown"])):a("",!0)],2)],2)}}}),[["__cssModules",{$style:{view:"_view_q2hup_125",header:"_header_q2hup_135",corner:"_corner_q2hup_143",contentComponentWrapper:"_contentComponentWrapper_q2hup_154",listComponentWrapper:"_listComponentWrapper_q2hup_159"}}]]))}}}));
//# sourceMappingURL=WorkflowHistory-legacy-D2Wu9qvB.js.map