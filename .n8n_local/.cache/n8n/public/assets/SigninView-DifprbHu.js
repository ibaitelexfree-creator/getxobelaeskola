(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`96925b8d-f3ca-4e0e-be3c-10bafa99b690`,e._sentryDebugIdIdentifier=`sentry-dbid-96925b8d-f3ca-4e0e-be3c-10bafa99b690`)})()}catch{}import{C as e,Cn as t,D as n,E as r,Gt as i,It as a,M as o,P as s,Pt as c,T as l,Z as u,bt as d,et as f,j as p,vn as m,w as h}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{tt as g,yt as _}from"./_MapCache-DjbOQyB7.js";import{Ci as v,Hi as y,Vi as b,X as x,bt as S,it as C,wi as w,zi as T}from"./src-CppJvwzX.js";import{t as E}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{Lt as D,t as O,ws as k,yr as A}from"./users.store-pCkD7Zo0.js";import{fl as j,ml as M,pl as N,rs as P,ul as F}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import{n as I}from"./auth.eventBus-OiCaRLlR.js";import{n as L}from"./sso.store-Dd63iqNy.js";import{t as R}from"./AuthView-O45Jsyy-.js";var z=E(s({__name:`MfaView`,props:{reportError:{type:Boolean}},emits:[`onFormChanged`,`onBackClick`,`submit`],setup(e,{emit:s}){let c=e,v=a(!1),w=a(I),E=a(null),D=a(!1),O=a(!1),A=a(``),{reportError:j}=g(c),N=a(null),P=_(),F=s,L=(e,t,n,r,i=!0,a=`off`)=>({name:e,initialValue:``,properties:{label:t,placeholder:n,maxlength:r,capitalize:!0,validateOnBlur:!1,focusInitially:i,autocomplete:a}}),R=()=>{A.value=``,D.value=!0,v.value=!1,E.value=[U()],F(`onFormChanged`,M.MFA_RECOVERY_CODE)},z=()=>{if(!D.value){F(`onBackClick`,M.MFA_TOKEN);return}D.value=!1,v.value=!0,E.value=[W()],F(`onBackClick`,M.MFA_RECOVERY_CODE),V()},B=e=>{let t=e;A.value=D.value?P.baseText(`mfa.recovery.invalid`):P.baseText(`mfa.code.invalid`),F(`submit`,t)},V=()=>{setTimeout(()=>{if(N.value){let e=N.value.$el;if(!e)return;let t=e.querySelector(`input[name="mfaCode"]`);t&&t.focus()}},200)},H=({target:{value:e,name:t}})=>{let n=t===`mfaCode`,r=n?6:36;if(e.length!==r){v.value=!1;return}O.value=!0,v.value=!0;let i=n?{mfaCode:e,mfaRecoveryCode:``}:{mfaCode:``,mfaRecoveryCode:e};try{B(i)}catch{}finally{O.value=!1}},U=()=>L(`mfaRecoveryCode`,P.baseText(`mfa.recovery.input.label`),P.baseText(`mfa.recovery.input.placeholder`),36),W=()=>L(`mfaCode`,P.baseText(`mfa.code.input.label`),P.baseText(`mfa.code.input.placeholder`),6,!1,`one-time-code`),G=()=>{w.value.emit(`submit`)},{settings:{releaseChannel:K}}=k();return u(()=>{E.value=[W()],V()}),(e,a)=>(f(),n(`div`,{class:m(e.$style.container)},[o(i(x),{size:`large`,"release-channel":i(K)},null,8,[`release-channel`]),o(i(S),null,{default:d(()=>[h(`div`,{class:m(e.$style.headerContainer)},[o(i(T),{size:`xlarge`,color:`text-dark`},{default:d(()=>[p(t(D.value?i(P).baseText(`mfa.recovery.modal.title`):i(P).baseText(`mfa.code.modal.title`)),1)]),_:1})],2),h(`div`,{class:m([e.$style.formContainer,i(j)?e.$style.formError:``])},[E.value?(f(),l(i(C),{key:0,ref_key:`mfaFormRef`,ref:N,"data-test-id":`mfa-login-form`,inputs:E.value,"event-bus":w.value,onInput:H,onSubmit:B},null,8,[`inputs`,`event-bus`])):r(``,!0),h(`div`,{class:m(e.$style.infoBox)},[!D.value&&!i(j)?(f(),l(i(b),{key:0,size:`small`,color:`text-base`,bold:!1},{default:d(()=>[p(t(i(P).baseText(`mfa.code.input.info`))+` `,1),h(`a`,{"data-test-id":`mfa-enter-recovery-code-button`,onClick:R},t(i(P).baseText(`mfa.code.input.info.action`)),1)]),_:1})):r(``,!0),i(j)?(f(),l(i(b),{key:1,color:`danger`,size:`small`},{default:d(()=>[p(t(A.value)+` `,1),D.value?r(``,!0):(f(),n(`a`,{key:0,class:m(e.$style.recoveryCodeLink),onClick:R},t(i(P).baseText(`mfa.recovery.input.info.action`)),3))]),_:1})):r(``,!0)],2)],2),h(`div`,{class:m(e.$style.footer)},[o(i(y),{float:`right`,loading:O.value,label:D.value?i(P).baseText(`mfa.recovery.button.verify`):i(P).baseText(`mfa.code.button.continue`),size:`large`,disabled:!v.value,onClick:G},null,8,[`loading`,`label`,`disabled`]),o(i(y),{variant:`subtle`,float:`left`,label:i(P).baseText(`mfa.button.back`),size:`large`,onClick:z},null,8,[`label`])],2)]),_:1})],2))}}),[[`__cssModules`,{$style:{container:`_container_1k8hu_129`,formContainer:`_formContainer_1k8hu_139`,footer:`_footer_1k8hu_143`,headerContainer:`_headerContainer_1k8hu_149`,formError:`_formError_1k8hu_154`,recoveryCodeLink:`_recoveryCodeLink_1k8hu_158`,infoBox:`_infoBox_1k8hu_162`}}]]),B=s({__name:`SigninView`,setup(t){let i=O(),o=k(),s=L(),u=v(),d=w(),p=A(),m=_(),h=D(),g=a(!1),y=a(!1),b=a(``),x=a(``),S=a(!1),C=e(()=>s.ldapLoginLabel),T=e(()=>s.isLdapLoginEnabled),E=e(()=>{let e=m.baseText(`auth.email`);return T.value&&C.value&&(e=C.value),e}),j=c({title:m.baseText(`auth.signin`),buttonText:m.baseText(`auth.signin`),redirectText:m.baseText(`forgotPassword`),redirectLink:`/forgot-password`,inputs:[{name:`emailOrLdapLoginId`,properties:{label:E.value,type:`email`,required:!0,...!T.value&&{validationRules:[{name:`VALID_EMAIL`}]},showRequiredAsterisk:!1,validateOnBlur:!1,autocomplete:`email`,capitalize:!0,focusInitially:!0}},{name:`password`,properties:{label:m.baseText(`auth.password`),type:`password`,required:!0,showRequiredAsterisk:!1,validateOnBlur:!1,autocomplete:`current-password`,capitalize:!0}}]}),N=async e=>{await V({emailOrLdapLoginId:b.value,password:x.value,mfaCode:e.mfaCode,mfaRecoveryCode:e.mfaRecoveryCode})},F=async e=>{await V(e)},I=()=>{let e=B();if(e.startsWith(`/`))return!0;try{return new URL(e).origin===window.location.origin}catch{return!1}},B=()=>{let e=``;return typeof u.query?.redirect==`string`&&(e=decodeURIComponent(u.query?.redirect)),e},V=async e=>{try{if(g.value=!0,await i.loginWithCreds({emailOrLdapLoginId:e.emailOrLdapLoginId,password:e.password,mfaCode:e.mfaCode,mfaRecoveryCode:e.mfaRecoveryCode}),g.value=!1,await o.getSettings(),p.clearAllStickyNotifications(),o.isMFAEnforced&&!i.currentUser?.mfaAuthenticated){await d.push({name:P.PERSONAL_SETTINGS});return}if(h.track(`User attempted to login`,{result:y.value?`mfa_success`:`success`}),I()){let e=B();if(e.startsWith(`http`)){window.location.href=e;return}d.push(e);return}await d.push({name:P.HOMEPAGE})}catch(t){if(t.errorCode===998){y.value=!0,W(e);return}if(h.track(`User attempted to login`,{result:y.value?`mfa_token_rejected`:`credentials_error`}),!y.value){p.showError(t,m.baseText(`auth.signin.error`)),g.value=!1;return}S.value=!0}},H=e=>{S.value=!1,e===M.MFA_TOKEN&&(y.value=!1,g.value=!1)},U=e=>{e===M.MFA_RECOVERY_CODE&&(S.value=!1)},W=e=>{b.value=e.emailOrLdapLoginId,x.value=e.password};return(e,t)=>(f(),n(`div`,null,[y.value?r(``,!0):(f(),l(R,{key:0,form:j,"form-loading":g.value,"with-sso":!0,"data-test-id":`signin-form`,onSubmit:F},null,8,[`form`,`form-loading`])),y.value?(f(),l(z,{key:1,"report-error":S.value,onSubmit:N,onOnBackClick:H,onOnFormChanged:U},null,8,[`report-error`])):r(``,!0)]))}});export{B as default};
//# sourceMappingURL=SigninView-DifprbHu.js.map