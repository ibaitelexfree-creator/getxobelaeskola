(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`b4e3c1ef-59ee-4aeb-a7ff-0d15da5ca7ec`,e._sentryDebugIdIdentifier=`sentry-dbid-b4e3c1ef-59ee-4aeb-a7ff-0d15da5ca7ec`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{C as t,Cn as n,D as r,E as i,Gt as a,M as o,P as s,Pt as c,Q as l,T as u,Z as d,_ as f,bt as p,et as m,j as h,vn as g,w as _}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{bt as v,yt as y}from"./_MapCache-DjbOQyB7.js";import{Dt as b,Hi as x,Ii as S,Vi as C,wi as w}from"./src-CppJvwzX.js";import{t as T}from"./_plugin-vue_export-helper-B_J4Khre.js";import{C as E,Lt as D,On as O,d as k,fi as A,r as j,s as M,ya as N,yr as P,zr as F}from"./users.store-pCkD7Zo0.js";import{Ai as I,Ei as L,Fs as R,Oa as z,Po as B,So as V,Ti as H,da as U,rs as W,ua as G}from"./constants-D1jZwsUK.js";import{t as K}from"./useCanvasOperations-BHGWcL34.js";import{t as q}from"./NodeIcon-Dv1e4Lvu.js";import{t as J}from"./KeyboardShortcutTooltip-BuQeOxiO.js";var Y=e(B(),1),X={trackBulk:!1,trackHistory:!0};function Z(){let e=j(),n=M(),r=E(),i=P(),a=w(),o=A(),s=K(),c=y(),l=D(),u=t(()=>H(n.workflow.connections)),d=t(()=>n.workflowObject);function f(e){i.showMessage({type:`error`,message:e,title:c.baseText(`workflowExtraction.error.failure`),duration:15*1e3})}function p(e){switch(e.errorCode){case`Input Edge To Non-Root Node`:return c.baseText(`workflowExtraction.error.selectionGraph.inputEdgeToNonRoot`,{interpolate:{node:e.node}});case`Output Edge From Non-Leaf Node`:return c.baseText(`workflowExtraction.error.selectionGraph.outputEdgeFromNonLeaf`,{interpolate:{node:e.node}});case`Multiple Input Nodes`:return c.baseText(`workflowExtraction.error.selectionGraph.multipleInputNodes`,{interpolate:{nodes:[...e.nodes].map(e=>`'${e}'`).join(`, `)}});case`Multiple Output Nodes`:return c.baseText(`workflowExtraction.error.selectionGraph.multipleOutputNodes`,{interpolate:{nodes:[...e.nodes].map(e=>`'${e}'`).join(`, `)}});case`No Continuous Path From Root To Leaf In Selection`:return c.baseText(`workflowExtraction.error.selectionGraph.noContinuousPathFromRootToLeaf`,{interpolate:{start:e.start,end:e.end}})}}function m(e,t,n,r){return{parameters:{workflowId:{__rl:!0,value:e,mode:`list`},workflowInputs:{mappingMode:`defineBelow`,value:Object.fromEntries(r.entries().map(([e,t])=>[e,`={{ ${t} }}`])),matchingColumns:[...r.keys()],schema:[...r.keys().map(e=>({id:e,displayName:e,required:!1,defaultMatch:!1,display:!0,canBeUsedToMatch:!0,removed:!1}))],attemptToConvertTypes:!1,convertFieldsToString:!0},options:{}},type:`n8n-nodes-base.executeWorkflow`,typeVersion:1.2,position:n,name:t}}function h(e,{start:t,end:i},a,o,s,c,l,u){let d=Object.fromEntries(Object.entries(o).filter(([e])=>a.some(t=>t.name===e)));i&&delete d[i];let f=a.find(e=>e.name===t),p=f??a.sort((e,t)=>e.position[1]-t.position[1])[0],m=[p.position[0]-O,p.position[1]],h=a.find(e=>e.name===i),g=h??a.sort((e,t)=>t.position[1]-e.position[1])[0],_=[g.position[0]+O,g.position[1]],v=c.size>0,y=r.getNodeType(p.type,p.typeVersion),b=f!==void 0||y&&z(y,`main`)?{[l]:{main:[[{node:p.name,type:`main`,index:0}]]}}:{},x=h&&v?{[h.name]:{main:[[{node:u,type:`main`,index:0}]]}}:{},S=v?[{parameters:{assignments:{assignments:[...c.entries().map(e=>({id:F(),name:e[0],value:`={{ ${e[1]} }}`,type:`string`}))]},options:{}},type:`n8n-nodes-base.set`,typeVersion:3.4,position:_,id:F(),name:u}]:[],C=s.size===0?{inputSource:`passthrough`}:{workflowInputs:{values:[...s.keys().map(e=>({name:e,type:`any`}))]}},w={id:F(),typeVersion:1.1,name:l,type:V,position:m,parameters:C};return{name:e,nodes:[...a,...S,w],connections:{...d,...b,...x},settings:{executionOrder:`v1`},projectId:n.workflow.homeProject?.id,parentFolderId:n.workflow.parentFolder?.id??void 0}}function g(e){let t=e.reduce((e,t)=>[e[0]+t.position[0],e[1]+t.position[1],e[2]+1],[0,0,0]);return[t[0]/t[2],t[1]/t[2]]}async function _(e){try{let t=await n.createNewWorkflow(e);try{await n.publishWorkflow(t.id,{versionId:t.versionId})}catch(e){console.error(`Failed to activate extracted sub-workflow:`,e)}let{href:r}=a.resolve({name:W.WORKFLOW,params:{name:t.id}});return i.showMessage({title:c.baseText(`workflowExtraction.success.title`),message:c.baseText(`workflowExtraction.success.message`,{interpolate:{url:r}}),type:`success`,duration:10*1e3}),t}catch(e){return i.showError(e,c.baseText(`workflowExtraction.error.subworkflowCreationFailed`)),null}}function v(e){if(Array.isArray(e))return f(c.baseText(`workflowExtraction.error.selectionGraph.listHeader`,{interpolate:{body:e.map(p).map(e=>`- ${e}`).join(`<br>`)}})),!1;let{start:t,end:r}=e,i=(e,t)=>{let r=n.getNodeByName(e);if(!r)return!0;let i=E().getNodeType(r.type,r.typeVersion);return i?t(d.value,r,i).filter(e=>typeof e==`string`?e===`main`:e.type===`main`).length<=1:!0};return t&&!i(t,G)?(f(c.baseText(`workflowExtraction.error.inputNodeHasMultipleInputBranches`,{interpolate:{node:t}})),!1):r&&!i(r,U)?(f(c.baseText(`workflowExtraction.error.outputNodeHasMultipleOutputBranches`,{interpolate:{node:r}})),!1):!Array.isArray(e)}async function b(t,r,i,a,c){o.startRecordingUndo(),e.resetLastInteractedWith();let l=(await s.addNodes([t],{...X,forcePosition:!0}))[0];i&&s.replaceNodeConnections(i,l.id,{...X,replaceInputs:!1}),r&&s.replaceNodeConnections(r,l.id,{...X,replaceOutputs:!1}),s.deleteNodes(a.map(e=>e.id),X);for(let e of c){let t=n.workflow.nodes.find(t=>t.id===e.id);(0,Y.default)(e,t)||s.replaceNodeParameters(e.id,{...t?.parameters},{...e.parameters},X)}e.markStateDirty(),o.stopRecordingUndo()}function x(t){let r=t.map(n.getNodeById).filter(e=>e!==void 0),i=r.filter(e=>E().getNodeType(e.type,e.typeVersion)?.group.includes(`trigger`));if(i.length>0)return f(c.baseText(`workflowExtraction.error.triggerSelected`,{interpolate:{nodes:i.map(e=>`'${e.name}'`).join(`, `)}})),!1;let a=L(new Set(r.map(e=>e.name)),u.value);return v(a)?(e.openModalWithData({name:R,data:{subGraph:r,selection:a}}),!0):!1}async function S(e,t,r){let{start:i,end:a}=e,o=n.workflow.nodes.map(e=>e.name),s=`Start`,c=t.map(e=>e.name);for(;c.includes(s);)s+=`_1`;let l=`Return`;for(;c.includes(l);)l+=`_1`;let u=a?d.value.getChildNodes(a,`main`,1).map(e=>d.value.getNode(e)?.name).filter(e=>e!==void 0):[],f=a?d.value.getChildNodes(a,`ALL`).map(e=>d.value.getNode(e)).filter(e=>e!==null):[],{nodes:p,variables:v}=I(t,o,s,i?[i]:void 0),y=`Call ${r}`;for(;o.includes(y);)y+=`_1`;let{nodes:x,variables:S}=I(f,f.map(e=>e.name).concat(c),y,u),C=await _(h(r,e,p,n.workflow.connections,v,S,s,l));if(C===null)return!1;let w=g(t);return await b(m(C.id,y,w,v),t.find(e=>e.name===i)?.id,t.find(e=>e.name===a)?.id,t,x),!0}function C(e,t){l.track(`User started nodes to sub-workflow extraction`,{node_count:e,success:t})}function T(e,t){l.track(`User extracted nodes to sub-workflow`,{node_count:e,success:t})}async function k(e,t,n){let r=await S(e,t,n);T(t.length,r)}function N(e){let t=x(e);C(e.length,t)}return{adjacencyList:u,extractWorkflow:N,tryExtractNodesIntoSubworkflow:x,extractNodesIntoSubworkflow:k}}var Q=c({customActions:{},delegatedClickHandler:null});function $(){function e({key:e,action:t}){Q.customActions[e]=t}function n(e){let{[e]:t,...n}=Q.customActions;Q.customActions=n}function r(e){let t={};for(let n=0;n<e.attributes.length;n++){let r=e.attributes[n];r.name.startsWith(`data-action-parameter-`)&&(t[r.name.replace(`data-action-parameter-`,``)]=r.value)}return t}function i(e){let t=e.target;if(!(t instanceof Element)||t.tagName!==`A`)return;let n=t.getAttribute(`data-action`);if(n&&typeof o.value[n]==`function`){e.preventDefault();let i=r(t);o.value[n](i)}}function a(){window.top?window.top.location.reload():window.location.reload()}let o=t(()=>({reload:a,...Q.customActions}));return d(()=>{Q.delegatedClickHandler||(Q.delegatedClickHandler=i,window.addEventListener(`click`,i),N.on(`registerGlobalLinkAction`,e))}),l(()=>{window.removeEventListener(`click`,i),Q.delegatedClickHandler=null,N.off(`registerGlobalLinkAction`,e)}),{registerCustomAction:e,unregisterCustomAction:n}}var ee=T(s({__name:`CanvasRunWorkflowButton`,props:{selectedTriggerNodeName:{},triggerNodes:{},waitingForWebhook:{type:Boolean},executing:{type:Boolean},disabled:{type:Boolean},hideTooltip:{type:Boolean},label:{},size:{},includeChatTrigger:{type:Boolean},getNodeType:{type:Function}},emits:[`mouseenter`,`mouseleave`,`execute`,`selectTriggerNode`],setup(e,{emit:s}){let c=s,l=e,d=y(),w=t(()=>l.triggerNodes.filter(e=>!e.disabled&&(l.includeChatTrigger?!0:!k(e)))),T=t(()=>l.executing?l.waitingForWebhook?d.baseText(`nodeView.runButtonText.waitingForTriggerEvent`):d.baseText(`nodeView.runButtonText.executingWorkflow`):l.label??d.baseText(`nodeView.runButtonText.executeWorkflow`)),E=t(()=>l.triggerNodes.filter(e=>l.includeChatTrigger?!0:!k(e)).toSorted((e,t)=>{let[n,r]=e.position,[i,a]=t.position;return r===a?n-i:r-a}).map(e=>({label:S(e.name,50),disabled:!!e.disabled||l.executing,id:e.name,checked:l.selectedTriggerNodeName===e.name}))),D=t(()=>w.value.length>1&&l.selectedTriggerNodeName!==void 0);function O(e){let t=l.triggerNodes.find(t=>t.name===e);return t?l.getNodeType(t.type,t.typeVersion):null}return(t,s)=>(m(),r(`div`,{class:g([t.$style.component,D.value?t.$style.split:``])},[o(J,{label:T.value,shortcut:{metaKey:!0,keys:[`â†µ`]},disabled:e.executing||e.hideTooltip},{default:p(()=>[o(a(x),{variant:`solid`,class:g(t.$style.button),loading:e.executing,iconOnly:e.executing,disabled:e.disabled,size:e.size??`large`,icon:`flask-conical`,"data-test-id":`execute-workflow-button`,onMouseenter:s[0]||=e=>t.$emit(`mouseenter`,e),onMouseleave:s[1]||=e=>t.$emit(`mouseleave`,e),onClick:s[2]||=e=>c(`execute`)},{default:p(()=>[_(`span`,{class:g(t.$style.buttonContent)},[h(n(T.value)+` `,1),D.value?(m(),u(a(C),{key:0,class:g(t.$style.subText),bold:!1},{default:p(()=>[o(a(v),{keypath:`nodeView.runButtonText.from`,scope:`global`},{nodeName:p(()=>[o(a(C),{bold:``,size:`mini`},{default:p(()=>[h(n(a(S)(l.selectedTriggerNodeName??``,25)),1)]),_:1})]),_:1})]),_:1},8,[`class`])):i(``,!0)],2)]),_:1},8,[`class`,`loading`,`iconOnly`,`disabled`,`size`])]),_:1},8,[`label`,`disabled`]),D.value?(m(),r(f,{key:0},[_(`div`,{role:`presentation`,class:g(t.$style.divider)},null,2),o(a(b),{class:g(t.$style.menu),items:E.value,disabled:e.disabled,placement:`top`,"extra-popper-class":t.$style.menuPopper,onSelect:s[3]||=e=>c(`selectTriggerNode`,e)},{activator:p(()=>[o(a(x),{variant:`solid`,"icon-size":`large`,disabled:e.disabled,class:g(t.$style.chevron),"aria-label":`Select trigger node`,icon:`chevron-down`},null,8,[`disabled`,`class`])]),menuItem:p(e=>[_(`div`,{class:g([t.$style.menuItem,e.disabled?t.$style.disabled:``])},[o(q,{class:g(t.$style.menuIcon),size:16,"node-type":O(e.id)},null,8,[`class`,`node-type`]),_(`span`,null,[o(a(v),{keypath:`nodeView.runButtonText.from`,scope:`global`},{nodeName:p(()=>[o(a(C),{bold:``,size:`small`},{default:p(()=>[h(n(e.label),1)]),_:2},1024)]),_:2},1024)])],2)]),_:1},8,[`class`,`items`,`disabled`,`extra-popper-class`])],64)):i(``,!0)],2))}}),[[`__cssModules`,{$style:{component:`_component_1chpr_125`,split:`_split_1chpr_131`,button:`_button_1chpr_131`,divider:`_divider_1chpr_139`,chevron:`_chevron_1chpr_144`,menu:`_menu_1chpr_151`,menuPopper:`_menuPopper_1chpr_155`,menuItem:`_menuItem_1chpr_159`,disabled:`_disabled_1chpr_165`,menuIcon:`_menuIcon_1chpr_165`,buttonContent:`_buttonContent_1chpr_169`,subText:`_subText_1chpr_176`}}]]);export{$ as n,Z as r,ee as t};
//# sourceMappingURL=CanvasRunWorkflowButton-B7EvorNA.js.map