!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"n8n@2.9.4"}}catch(e){}}(),System.register(["./vue.runtime.esm-bundler-legacy-BquwEXRp.js","./_MapCache-legacy-BR_CVmoL.js","./src-legacy-kcwUfEuS.js","./_plugin-vue_export-helper-legacy-DtDV0xrP.js","./users.store-legacy-B-bVJKl3.js","./constants-legacy-DVkAm8xO.js","./NodeIcon-legacy-DOI-M5xN.js","./dist-legacy-CPj4q_aQ.js","./constants-legacy-CLWGezV2.js","./chat.store-legacy-BiASMOEd.js","./ChatAgentAvatar-legacy-D6I_tkAP.js"],(function(e,t){var n,o,a,i,l,s,d,r,c,u,p,g,f,m,_,b,h,v,y,x,w,T,k,I,C,$,B,M,A,z,S,L,j,H,N,E,D,P,W,O,R,V,U,G,q,Y,Z,F,J,K,Q,X,ee,te,ne,oe,ae,ie,le,se,de,re,ce;function ue(e,t,n=!1){if(function(e){const t=e.id;return!!(t.endsWith("::configure")||t.endsWith("::add-model")||t.endsWith("::error")||t.endsWith("::loading"))||!!e.disabled||!e.data?.provider}(e))return null;if(!t||n)return e;const o=function(e,t){return!t||(e.data?.fullName??e.label??"").toLowerCase().includes(t)}(e,t),a=e.children??[],i=a.flatMap((e=>{const n=ue(e,t,o);return n?[n]:[]}));return o||i.length>0?a.length>0&&0===i.length?null:{...e,children:i}:null}function pe(e,t){return{id:ie(e.model),icon:e.icon??t??void 0,label:C(e.name,45),disabled:!1,data:{provider:e.model.provider,description:e.description??void 0,fullName:e.name}}}function ge(e,t){const n=new Map;for(const o of e){const e=o.groupName??"",t=n.get(e)??[];n.set(e,[...t,o])}return n.size<2?e.map((e=>pe(e,ae))):[...n].map((([e,n])=>({id:`n8n-project-${e}`,label:""===e?t.baseText("chatHub.models.selector.personalProject"):e,icon:n[0]?.groupIcon??ae,data:{provider:"n8n"},children:n.map((e=>pe(e,ae)))})))}function fe(e,{models:t,error:n},{settings:o,i18n:a,isLoading:i}){const l=o[e];if(!1===l?.enabled)return null;const s={id:`${e}::configure`,icon:{type:"icon",value:"settings"},label:a.baseText("chatHub.agent.configureCredentials"),disabled:!1};if(i)return{id:e,label:J[e],data:{provider:e},children:[s,{id:`${e}::loading`,label:a.baseText("generic.loadingEllipsis"),disabled:!0,divided:!0}]};const d=[...t,...(l?.allowedModels??[]).flatMap((t=>t.isManual?[te({provider:e,model:t.model},{name:t.displayName})]:[]))].toSorted(((e,t)=>(t.metadata.priority??0)-(e.metadata.priority??0))),r=d.length>0?d.flatMap(((e,t)=>{if(l&&!X(l,e.model))return[];const n=pe(e);return[0===t?{...n,divided:!0}:n]})).filter(((e,t,n)=>n.findIndex((t=>t.id===e.id))===t)):n?[{id:`${e}::error`,divided:!0,disabled:!0,label:n}]:[],c=[s,...r,...r.length>0&&0===l?.allowedModels.length?[{id:`${e}::add-model`,icon:{type:"icon",value:"plus"},label:a.baseText("chatHub.agent.addModel"),disabled:!1,divided:!0}]:[]];return{id:e,data:{provider:e},label:J[e],children:c}}function me(e,t){const n=e.children??[],o=[...t,e.label];return 0===n.length?[{...e,divided:!1,data:e.data?{...e.data,parts:o}:void 0}]:n.flatMap((e=>me(e,o)))}function _e(e,t,n){return t?e.reduce(((e,o)=>{const a=ue(o,t);if(!a)return e;const i=me(a,[]),l=Math.max(0,10-e.length),s=a.data?.provider,d=s?J[s]:"";if(e.push(...i.slice(0,l)),i.length>l){const t=l>0?n.baseText("chatHub.models.selector.moreModels",{interpolate:{providerName:d}}):a.label,o=i.slice(l).map((e=>({...e,label:C(e.data?.fullName??"",45),data:e.data?{...e.data,parts:void 0}:void 0})));e.push({...a,divided:!1,label:t,children:o})}return e}),[]):e}function be(e,t){const n=[],o=function(e,{isLoading:t,i18n:n,includeCustomAgents:o}){if(!o)return null;const a=t?[]:e.map((e=>pe(e,K)));return{id:"custom-agent",label:n.baseText("chatHub.agent.personalAgents"),icon:K,data:{provider:"custom-agent"},children:[...t?[{id:"custom-agent::loading",label:n.baseText("generic.loadingEllipsis"),disabled:!0}]:a,{id:q,icon:{type:"icon",value:"plus"},label:n.baseText("chatHub.agent.newAgent"),disabled:!1,divided:t||a.length>0}]}}(e["custom-agent"].models,t),a=function(e,{includeCustomAgents:t,i18n:n,isLoading:o}){if(!t)return null;const a=n.baseText("chatHub.workflowAgents.empty.noAgents"),i=n.baseText("generic.loadingEllipsis");return{id:"n8n",label:n.baseText("chatHub.agent.workflowAgents"),icon:ae,data:{provider:"n8n"},children:o?[{id:"n8n::loading",label:i,disabled:!0}]:0===e.length?[{id:"n8n::no-agents",label:a,disabled:!0}]:ge(e,n)}}(e.n8n.models,t);o&&n.push(o),a&&n.push(a);const i=P.options.toSorted(((e,t)=>(G.includes(e)?1:-1)-(G.includes(t)?1:-1)));let l=!1;for(const s of i){const o=fe(s,e[s],t);o&&(n.push(l?o:{...o,divided:!0}),l=!0)}return n}return e("t",(function(e){const t=oe(),o=s(!1),a=n((()=>u(e))),i=n((()=>{if(a.value)return t.customAgents[a.value]}));return f(a,(async e=>{if(e)try{o.value=!0,await t.fetchCustomAgent(e)}finally{o.value=!1}}),{immediate:!0}),{isLoading:o,customAgent:i}})),{setters:[function(e){n=e.C,o=e.Cn,a=e.D,i=e.E,l=e.Gt,s=e.It,d=e.M,r=e.P,c=e.T,u=e.Ut,p=e.Z,g=e._,f=e._t,m=e.bn,_=e.bt,b=e.et,h=e.h,v=e.it,y=e.j,x=e.mt,w=e.vn,T=e.w},function(e){k=e.yt},function(e){I=e.Hi,C=e.Ii,$=e.Mi,B=e.Oi,M=e.Ui,A=e.Vi,z=e.n},function(e){S=e.t},function(e){L=e.C,j=e.Gt,H=e.Lt,N=e.r,E=e.rt,D=e.ws},function(e){P=e.li,W=e.oi,O=e.qo},function(e){R=e.t},function(e){V=e.n},function(e){U=e._,G=e.d,e.f,q=e.g,Y=e.i,e.m,e.p,Z=e.r,F=e.v,J=e.y},function(e){K=e._,Q=e.c,X=e.d,ee=e.m,te=e.r,ne=e.s,oe=e.t,ae=e.x,ie=e.y},function(e){le=e.t}],execute:function(){(se=document.createElement("style")).textContent="._component_1abe6_125{z-index:var(--floating-ui--z);width:auto!important}._dropdownButton_1abe6_130{align-items:center;gap:var(--spacing--xs);width:fit-content;display:flex;text-decoration:none!important}._credentialsMissingIcon_1abe6_139{margin-bottom:-1px;display:inline-block}._selected_1abe6_144{align-items:start;gap:var(--spacing--4xs);flex-direction:column;display:flex}._icon_1abe6_151{flex-shrink:0;margin-top:-4px;margin-bottom:-4px}._infoIcon_1abe6_156,._menuIcon_1abe6_157{flex-shrink:0}._infoIcon_1abe6_156{margin-inline:var(--spacing--5xs)}._avatarIcon_1abe6_165{margin-right:var(--spacing--2xs)}._tooltip_1abe6_169{z-index:1000999!important}._flattenedLabel_1abe6_174{align-items:center;gap:var(--spacing--4xs);white-space:nowrap;flex-grow:1;display:flex;overflow:hidden}._separator_1abe6_183{flex-shrink:0;align-items:center;display:inline-flex}._container_i8oeh_125{align-items:center;display:flex}._toolsButton_i8oeh_130{align-items:center;gap:var(--spacing--2xs);display:flex}._toolsButton_i8oeh_130._transparentBg_i8oeh_135{background-color:transparent!important}._iconStack_i8oeh_139{align-items:center;margin-top:-4px;margin-bottom:-4px;display:flex;position:relative}._icon_i8oeh_139{padding:var(--spacing--4xs);background-color:var(--color--background--light-2);outline:2px var(--color--background--light-3)solid;border-radius:50%}._iconOverlap_i8oeh_154{margin-left:-5px}._countBadge_i8oeh_158{z-index:4;width:20px;height:20px;font-size:var(--font-size--3xs);color:var(--color--text);box-sizing:border-box;justify-content:center;align-items:center;display:flex;position:relative}._settingsButton_i8oeh_171{color:var(--button--color--text--secondary);margin-right:-2px}._settingsButton_i8oeh_171:hover{color:var(--button--color--text--secondary--hover-active-focus)}._itemSettingsButton_i8oeh_179{opacity:0}._checkPlaceholder_i8oeh_183{flex-shrink:0;width:16px}.tools-selector-dropdown{z-index:10000;min-width:330px}.tools-selector-dropdown [data-highlighted] [class*=itemSettingsButton]{opacity:1}\n/*$vite$:1*/",document.head.appendChild(se);try{t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},(u=(new t.Error).stack)&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[u]="8a5fdad7-34bd-4008-a926-1b9b2f808a10",t._sentryDebugIdIdentifier="sentry-dbid-8a5fdad7-34bd-4008-a926-1b9b2f808a10")}catch(t){}var t,u;de=r({__name:"ChatProviderAvatar",props:{provider:{},icon:{}},setup(e){const t=n((()=>te("n8n"===e.provider?{provider:"n8n",workflowId:""}:"custom-agent"===e.provider?{provider:"custom-agent",agentId:""}:{provider:e.provider,model:""},{icon:e.icon})));return(e,n)=>(b(),c(le,{agent:t.value,size:"sm"},null,8,["agent"]))}}),re=r({__name:"ModelSelector",props:{selectedAgent:{},includeCustomAgents:{type:Boolean,default:!0},credentials:{},text:{type:Boolean},warnMissingCredentials:{type:Boolean,default:!1},agents:{},isLoading:{type:Boolean}},emits:["change","createCustomAgent","selectCredential"],setup(e,{expose:t,emit:r}){const u=r;function p(e,t){u("selectCredential",e,t)}function f(e,t){u("change",{provider:e,model:t})}const m=k(),h=x("dropdownRef"),C=N(),$=D(),S=E(),L=j(),P=H(),R=s(""),U=n((()=>e.selectedAgent?S.getCredentialById(e.credentials?.[e.selectedAgent.model.provider]??"")?.name:void 0)),G=n((()=>ee(e.selectedAgent?.model))),q=n((()=>e.warnMissingCredentials&&G.value&&e.selectedAgent?.model.provider&&!e.credentials?.[e.selectedAgent?.model.provider])),F=n((()=>be(e.agents,{includeCustomAgents:e.includeCustomAgents,isLoading:e.isLoading,i18n:m,settings:$.moduleSettings?.["chat-hub"]?.providers??{}}))),J=n((()=>_e(F.value,R.value,m))),K=n((()=>e.selectedAgent?.name??m.baseText("chatHub.models.selector.defaultLabel"))),X=n((()=>O(L.personalProject?.scopes).credential.create));function te(t){const n=W[t];0===S.getCredentialsByType(n).length&&X.value?C.openNewCredential(n):C.openModalWithData({name:Z,data:{provider:t,initialValue:e.credentials?.[t]??null,onSelect:p}})}function oe(e){if("agent::new"===e)return void u("createCustomAgent");const[,t]=e.split("::"),n=Q(e);if(n)if("configure"===t&&ee(n))te(n.provider);else{if("add-model"===t&&ee(n))return o=n.provider,void C.openModalWithData({name:Y,data:{provider:o,initialValue:null,onSelect:f}});var o;P.track("User selected model or agent",{...ne(n),is_custom:"custom-agent"===n.provider}),u("change",n)}}function ae(e){R.value=e.toLowerCase()}return t({open:()=>h.value?.open(),openCredentialSelector:e=>te(e)}),(t,n)=>(b(),c(l(z),{ref_key:"dropdownRef",ref:h,items:J.value,teleported:"",placement:"bottom-start","extra-popper-class":[t.$style.component,R.value?t.$style.searching:""].join(" "),searchable:"",emptyText:R.value?l(m).baseText("chatHub.models.selector.noMatch"):void 0,onSearch:ae,onSelect:oe},{trigger:_((()=>[d(l(I),{variant:"ghost",class:w(t.$style.dropdownButton),text:e.text,"data-test-id":"chat-model-selector"},{default:_((()=>[d(le,{agent:e.selectedAgent,size:U.value||!G.value?"md":"sm",class:w(t.$style.icon)},null,8,["agent","size","class"]),T("div",{class:w(t.$style.selected)},[T("div",null,o(l(V)(K.value,l(30))),1),U.value?(b(),c(l(A),{key:0,size:"xsmall",color:"text-light"},{default:_((()=>[y(o(l(V)(U.value,l(30))),1)])),_:1})):q.value?(b(),c(l(A),{key:1,size:"xsmall",color:"danger"},{default:_((()=>[d(l(M),{icon:"node-validation-error",size:"xsmall",class:w(t.$style.credentialsMissingIcon)},null,8,["class"]),y(" "+o(l(m).baseText("chatHub.agent.credentialsMissing")),1)])),_:1})):i("",!0)],2),d(l(M),{icon:"chevron-down",size:"medium"})])),_:1},8,["class","text"])])),"item-leading":_((({item:e})=>[e.data?.provider?(b(),c(de,{key:0,provider:e.data?.provider,icon:e.icon,class:w(t.$style.menuIcon)},null,8,["provider","icon","class"])):i("",!0)])),"item-label":_((({item:e,ui:n})=>[e.data?.parts?(b(),a("div",{key:0,class:w([t.$style.flattenedLabel,n.class])},[(b(!0),a(g,null,v(e.data.parts,((n,s)=>(b(),a(g,{key:s},[s>0?(b(),c(l(A),{key:0,color:"text-light",class:w(t.$style.separator)},{default:_((()=>[d(l(M),{icon:"chevron-right",size:"small"})])),_:1},8,["class"])):i("",!0),d(l(A),{size:"medium",color:s===e.data.parts.length-1?"text-dark":"text-base"},{default:_((()=>[y(o(n),1)])),_:2},1032,["color"])],64)))),128))],2)):(b(),c(l(A),{key:1,class:w(n.class),size:"medium",color:"text-dark"},{default:_((()=>[y(o(e.label),1)])),_:2},1032,["class"]))])),"item-trailing":_((({item:e,ui:n})=>[e.data?.description?(b(),c(l(B),{key:0,content:l(V)(e.data.description,200,0),class:w(n.class),"popper-class":t.$style.tooltip},{default:_((()=>[d(l(M),{icon:"info",size:"medium",color:"text-light",class:w(t.$style.infoIcon)},null,8,["class"])])),_:1},8,["content","class","popper-class"])):i("",!0)])),_:1},8,["items","extra-popper-class","emptyText"]))}}),e("r",S(re,[["__cssModules",{$style:{component:"_component_1abe6_125",dropdownButton:"_dropdownButton_1abe6_130",credentialsMissingIcon:"_credentialsMissingIcon_1abe6_139",selected:"_selected_1abe6_144",icon:"_icon_1abe6_151",infoIcon:"_infoIcon_1abe6_156",menuIcon:"_menuIcon_1abe6_157",avatarIcon:"_avatarIcon_1abe6_165",tooltip:"_tooltip_1abe6_169",flattenedLabel:"_flattenedLabel_1abe6_174",separator:"_separator_1abe6_183"}}]])),ce=r({__name:"ToolsSelector",props:{disabled:{type:Boolean},checkedToolIds:{},customAgentId:{},disabledTooltip:{}},emits:["toggle"],setup(e,{emit:t}){const r=e,u=t,f=L(),T=N(),C=oe(),A=k(),S=x("dropdownMenu"),j=s(""),H=n((()=>new Set(r.checkedToolIds))),E=n((()=>r.checkedToolIds.length)),D=n((()=>{const e=E.value>3?2:3;return C.configuredTools.filter((e=>H.value.has(e.definition.id))).slice(0,e).map((e=>f.getNodeType(e.definition.type,e.definition.typeVersion))).filter(Boolean)})),P=n((()=>E.value>3?E.value-2:0)),W=n((()=>{if(1===E.value){const e=r.checkedToolIds[0],t=C.configuredTools.find((t=>t.definition.id===e));if(t)return t.definition.name}return E.value>1?A.baseText("chatHub.tools.selector.label.count",{adjustToNumber:E.value}):A.baseText("chatHub.tools.selector.label.default")}));function O(){S.value?.close(),T.openModalWithData({name:U,data:{tools:C.configuredTools.filter((e=>H.value.has(e.definition.id))).map((e=>e.definition)),onConfirm:()=>{},customAgentId:r.customAgentId}})}const V=n((()=>{const e=j.value.toLowerCase();return C.configuredTools.filter((t=>{if(!e)return!0;const n=t.definition,o=f.getNodeType(n.type,n.typeVersion),a=n.name.toLowerCase().includes(e),i=o?.displayName.toLowerCase().includes(e);return a||i})).map((e=>({id:`tool::${e.definition.id}`,label:e.definition.name,checked:H.value.has(e.definition.id),data:{nodeType:f.getNodeType(e.definition.type,e.definition.typeVersion),tool:e.definition}})))}));function G(e){const[t,n]=e.split("::");"tool"===t&&u("toggle",n)}function q(e){j.value=e}return p((async()=>{await f.loadNodeTypesIfNotLoaded()})),(t,n)=>(b(),a("div",{class:w(t.$style.container)},[0===l(C).configuredTools.length?(b(),c(l(B),{key:0,content:e.disabledTooltip,disabled:!e.disabledTooltip||!e.disabled,placement:"bottom"},{default:_((()=>[d(l(I),{variant:"subtle","native-type":"button",class:w(t.$style.toolsButton),disabled:e.disabled,icon:"plus","data-test-id":"chat-tools-button",onClick:O},{default:_((()=>[y(o(W.value),1)])),_:1},8,["class","disabled"])])),_:1},8,["content","disabled"])):(b(),c(l(B),{key:1,content:e.disabledTooltip,disabled:!e.disabledTooltip||!e.disabled,placement:"bottom"},{default:_((()=>[d(l(z),{ref:"dropdownMenu",items:V.value,placement:"top-start","extra-popper-class":"tools-selector-dropdown",searchable:"","search-placeholder":l(A).baseText("chatHub.toolsManager.searchPlaceholder"),"empty-text":l(A).baseText("chatHub.toolsManager.noResults"),onSelect:G,onSearch:q},{trigger:_((()=>[d(l(I),{variant:"subtle","native-type":"button",disabled:e.disabled,icon:0===E.value?"plus":void 0,"data-test-id":"chat-tools-button"},{default:_((()=>[E.value>0?(b(),a("span",{key:0,class:w(t.$style.iconStack)},[(b(!0),a(g,null,v(D.value,((e,n)=>(b(),c(R,{key:`${e?.name}-${n}`,style:m({zIndex:n+1}),"node-type":e,class:w([t.$style.icon,{[t.$style.iconOverlap]:0!==n}]),circle:!0,size:12},null,8,["style","node-type","class"])))),128)),P.value>0?(b(),a("span",{key:0,class:w([t.$style.icon,t.$style.iconOverlap,t.$style.countBadge])}," +"+o(P.value),3)):i("",!0)],2)):i("",!0),y(" "+o(W.value),1)])),_:1},8,["disabled","icon"])])),"search-prefix":_((()=>[d(l(M),{icon:"search"})])),"search-suffix":_((()=>[d(l($),{icon:"settings",variant:"ghost",size:"medium",text:"",class:w(t.$style.settingsButton),onClick:h(O,["stop"])},null,8,["class"])])),"item-leading":_((({item:e})=>[e.data?.nodeType?(b(),c(R,{key:0,"node-type":e.data.nodeType,size:16},null,8,["node-type"])):i("",!0)])),"item-trailing":_((({item:e})=>[d(l($),{icon:"settings",variant:"ghost",size:"medium",text:"",class:w(t.$style.itemSettingsButton),onClick:h((t=>function(e){S.value?.close();const t=e.data?.tool;if(!t)return;const n=C.configuredTools.filter((e=>e.definition.id!==t.id)).map((e=>e.definition.name));T.openModalWithData({name:F,data:{node:{...t},existingToolNames:n,onConfirm:async e=>{await C.updateConfiguredTool(t.id,e)}}})}(e)),["stop"])},null,8,["class","onClick"]),e.checked?i("",!0):(b(),a("span",{key:0,class:w(t.$style.checkPlaceholder)},null,2))])),_:1},8,["items","search-placeholder","empty-text"])])),_:1},8,["content","disabled"]))],2))}}),e("n",S(ce,[["__cssModules",{$style:{container:"_container_i8oeh_125",toolsButton:"_toolsButton_i8oeh_130",transparentBg:"_transparentBg_i8oeh_135",iconStack:"_iconStack_i8oeh_139",icon:"_icon_i8oeh_139",iconOverlap:"_iconOverlap_i8oeh_154",countBadge:"_countBadge_i8oeh_158",settingsButton:"_settingsButton_i8oeh_171",itemSettingsButton:"_itemSettingsButton_i8oeh_179",checkPlaceholder:"_checkPlaceholder_i8oeh_183"}}]]))}}}));
//# sourceMappingURL=useCustomAgent-legacy-jghmHXuj.js.map