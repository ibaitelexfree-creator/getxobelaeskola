(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`06ba30f4-8870-4f26-9270-64a97ed6336b`,e._sentryDebugIdIdentifier=`sentry-dbid-06ba30f4-8870-4f26-9270-64a97ed6336b`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{C as t,Cn as n,D as r,E as i,Gt as a,It as o,M as s,P as c,T as l,Z as u,bn as d,bt as f,et as p,h as m,j as h,vn as g,w as _}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{bt as v,gt as y}from"./_MapCache-DjbOQyB7.js";import{At as b,Ci as ee,Hi as x,Oi as te,Q as ne,U as re,Vi as S,ji as C,st as w,wi as ie,zi as T}from"./src-CppJvwzX.js";import{t as E}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{fn as ae,qa as oe,r as se,t as ce,ur as le,yr as ue,zt as de}from"./users.store-pCkD7Zo0.js";import{t as D}from"./dialog-Ds437WFa.js";import{qo as fe}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import"./versions.store-1_eor2Ku.js";import{t as pe}from"./usePageRedirectionHelper-BoF8hzbN.js";import{t as me}from"./usage.store-CK5aU6GK.js";var O=[`href`],k=E(c({__name:`EulaAcceptanceModal`,props:{modelValue:{type:Boolean},eulaUrl:{}},emits:[`update:modelValue`,`accept`,`cancel`],setup(e,{emit:r}){let i=r,c=o(!1),u=t(()=>!c.value),d=()=>{c.value=!1,i(`cancel`)},m=()=>{i(`accept`)},v=()=>{i(`update:modelValue`,!1),d()};return(t,r)=>(p(),l(a(D),{"model-value":e.modelValue,title:a(y).baseText(`settings.usageAndPlan.dialog.eula.title`),"before-close":v,width:`540px`,"data-test-id":`eula-acceptance-modal`},{default:f(()=>[_(`div`,null,[s(a(S),{color:`text-base`,size:`medium`},{default:f(()=>[h(n(a(y).baseText(`settings.usageAndPlan.dialog.eula.description`)),1)]),_:1}),s(a(S),{class:g(t.$style.auditNotice),color:`text-base`,size:`medium`,tag:`p`},{default:f(()=>[_(`em`,null,n(a(y).baseText(`settings.usageAndPlan.dialog.eula.audit.notice`)),1)]),_:1},8,[`class`]),_(`div`,{class:g(t.$style.checkboxWrapper)},[s(a(w),{modelValue:c.value,"onUpdate:modelValue":r[0]||=e=>c.value=e,"data-test-id":`eula-checkbox`},{label:f(()=>[_(`span`,null,[h(n(a(y).baseText(`settings.usageAndPlan.dialog.eula.checkbox.label`))+` `+n(` `)+` `,1),_(`a`,{href:e.eulaUrl,target:`_blank`,rel:`noopener noreferrer`,"data-test-id":`eula-link`},n(a(y).baseText(`settings.usageAndPlan.dialog.eula.link.text`)),9,O),r[1]||=h(`. `,-1)])]),_:1},8,[`modelValue`])],2)])]),footer:f(()=>[_(`div`,{class:g(t.$style.footerActions)},[s(a(x),{variant:`subtle`,"data-test-id":`eula-cancel-button`,onClick:d},{default:f(()=>[h(n(a(y).baseText(`settings.usageAndPlan.dialog.eula.button.cancel`)),1)]),_:1}),s(a(x),{variant:`solid`,disabled:u.value,"data-test-id":`eula-accept-button`,onClick:m},{default:f(()=>[h(n(a(y).baseText(`settings.usageAndPlan.dialog.eula.button.accept`)),1)]),_:1},8,[`disabled`])],2)]),_:1},8,[`model-value`,`title`]))}}),[[`__cssModules`,{$style:{auditNotice:`_auditNotice_hanyh_125`,checkboxWrapper:`_checkboxWrapper_hanyh_129`,footerActions:`_footerActions_hanyh_133`}}]]),A={class:`settings-usage-and-plan`},j={key:0},M={key:0},N={key:1},P={key:0},F={key:1},I=[`href`],L=[`href`],R=E(c({__name:`SettingsUsageAndPlan`,setup(e){let c=me(),w=ee(),E=ie(),O=se(),R=ce(),z=ue(),he=ae(),ge=pe(),B=o(`callback=${encodeURIComponent(`${window.location.origin}${window.location.pathname}`)}`),_e=t(()=>`${c.viewPlansUrl}&${B.value}&source=usage_page`),ve=t(()=>`${c.managePlanUrl}&${B.value}`),V=o(!1),H=o(``),U=o(null),W=o(!1),G=o(``),K=t(()=>le([`rbac`],{rbac:{scope:`license:manage`}})),q=t(()=>{let[e,t]=c.planName.split(` `);return{name:t,badge:e}}),ye=t(()=>c.planName.toLowerCase()===`community`),be=t(()=>c.planName.toLowerCase()===`registered community`),xe=t(()=>fe(R.currentUser?.globalScopes).community.register),J=(e=!1)=>{let t=e?y.baseText(`settings.usageAndPlan.license.activation.success.message.eula`,{interpolate:{name:c.planName}}):y.baseText(`settings.usageAndPlan.license.activation.success.message`,{interpolate:{name:c.planName,type:c.planId?y.baseText(`settings.usageAndPlan.plan`):y.baseText(`settings.usageAndPlan.edition`)}});z.showMessage({type:`success`,title:y.baseText(`settings.usageAndPlan.license.activation.success.title`),message:t})},Y=e=>{z.showError(e,y.baseText(`settings.usageAndPlan.license.activation.error.title`))},Se=e=>{let t=e;return t.httpStatusCode===400&&!!t.meta?.eulaUrl},X=async e=>{try{await c.activateLicense(H.value.trim(),e?.trim()),V.value=!1,W.value=!1,H.value=``,J(!!e)}catch(e){if(Se(e)){G.value=e.meta.eulaUrl,W.value=!0,V.value=!1;return}Y(e)}},Ce=async()=>{try{await X(G.value)}catch(e){W.value=!1,Y(e)}},we=()=>{W.value=!1,G.value=``,H.value=``},Z=()=>{V.value=!1,H.value=``},Q=()=>{W.value||Z()};u(async()=>{if(he.set(y.baseText(`settings.usageAndPlan.title`)),c.setLoading(!0),w.query.key)try{await c.activateLicense(w.query.key),await E.replace({query:{}}),J(),c.setLoading(!1);return}catch(e){Y(e)}try{!w.query.key&&K.value?await c.refreshLicenseManagementToken():await c.getLicenseInfo(),c.setLoading(!1)}catch(e){e.name||=y.baseText(`settings.usageAndPlan.error`),z.showError(e,e.name,e.message)}});let $=e=>{let t=c.telemetryPayload;t.action=e,de.track(`User clicked button on usage page`,t)},Te=()=>{V.value=!0,$(`add_activation_key`)},Ee=()=>{ge.goToUpgrade(`usage_page`,`open`),$(`view_plans`)},De=()=>{$(`manage_plan`)},Oe=()=>{U.value?.focus()},ke=()=>{O.openModalWithData({name:oe,data:{customHeading:void 0}})};return(e,t)=>(p(),r(`div`,A,[s(a(T),{tag:`h2`,size:`2xlarge`},{default:f(()=>[h(n(a(y).baseText(`settings.usageAndPlan.title`)),1)]),_:1}),a(c).isLoading?i(``,!0):(p(),r(`div`,j,[s(a(T),{tag:`h3`,class:g(e.$style.title),size:`large`},{default:f(()=>[s(a(v),{keypath:`settings.usageAndPlan.description`,tag:`span`,scope:`global`},{name:f(()=>[h(n(q.value.name??a(c).planName),1)]),type:f(()=>[a(c).planId?(p(),r(`span`,M,n(a(y).baseText(`settings.usageAndPlan.plan`)),1)):(p(),r(`span`,N,n(a(y).baseText(`settings.usageAndPlan.edition`)),1))]),_:1}),q.value.badge&&q.value.name?(p(),r(`span`,{key:0,class:g(e.$style.titleTooltip)},[s(a(te),{placement:`top`},{content:f(()=>[be.value?(p(),l(a(v),{key:0,keypath:`settings.usageAndPlan.license.communityRegistered.tooltip`,scope:`global`})):i(``,!0)]),default:f(()=>[s(a(b),null,{default:f(()=>[h(n(q.value.badge),1)]),_:1})]),_:1})],2)):i(``,!0)]),_:1},8,[`class`]),ye.value&&xe.value?(p(),l(a(re),{key:0,class:`mt-0`,theme:`warning`},{default:f(()=>[s(a(v),{keypath:`settings.usageAndPlan.callOut`,scope:`global`},{link:f(()=>[s(a(x),{variant:`ghost`,class:`pl-0 pr-0`,label:a(y).baseText(`settings.usageAndPlan.callOut.link`),onClick:ke},null,8,[`label`])]),_:1})]),_:1})):i(``,!0),_(`div`,{class:g(e.$style.quota)},[s(a(S),{size:`medium`,color:`text-light`},{default:f(()=>[h(n(a(y).baseText(`settings.usageAndPlan.activeWorkflows`)),1)]),_:1}),_(`div`,{class:g(e.$style.chart)},[a(c).activeWorkflowTriggersLimit>0?(p(),r(`span`,{key:0,class:g(e.$style.chartLine)},[_(`span`,{class:g(e.$style.chartBar),style:d({width:`${a(c).executionPercentage}%`})},null,6)],2)):i(``,!0),s(a(v),{tag:`span`,class:g(e.$style.count),keypath:`settings.usageAndPlan.activeWorkflows.count`,scope:`global`},{count:f(()=>[h(n(a(c).activeWorkflowTriggersCount),1)]),limit:f(()=>[a(c).activeWorkflowTriggersLimit<0?(p(),r(`span`,P,n(a(y).baseText(`settings.usageAndPlan.activeWorkflows.unlimited`)),1)):(p(),r(`span`,F,n(a(c).activeWorkflowTriggersLimit),1))]),_:1},8,[`class`])],2)],2),s(a(ne),null,{default:f(()=>[h(n(a(y).baseText(`settings.usageAndPlan.activeWorkflows.hint`)),1)]),_:1}),_(`div`,{class:g(e.$style.buttons)},[K.value?(p(),l(a(x),{key:0,variant:`subtle`,class:g(e.$style.buttonTertiary),size:`large`,onClick:Te},{default:f(()=>[_(`span`,null,n(a(y).baseText(`settings.usageAndPlan.button.activation`)),1)]),_:1},8,[`class`])):i(``,!0),a(c).managementToken?(p(),l(a(x),{key:1,size:`large`,onClick:De},{default:f(()=>[_(`a`,{href:ve.value,target:`_blank`},n(a(y).baseText(`settings.usageAndPlan.button.manage`)),9,I)]),_:1})):(p(),l(a(x),{key:2,size:`large`,onClick:m(Ee,[`prevent`])},{default:f(()=>[_(`a`,{href:_e.value,target:`_blank`},n(a(y).baseText(`settings.usageAndPlan.button.plans`)),9,L)]),_:1}))],2),s(a(D),{modelValue:V.value,"onUpdate:modelValue":t[2]||=e=>V.value=e,width:`480px`,top:`0`,title:a(y).baseText(`settings.usageAndPlan.dialog.activation.title`),"modal-class":e.$style.center,onClosed:Q,onOpened:Oe},{default:f(()=>[s(a(C),{ref_key:`activationKeyInput`,ref:U,modelValue:H.value,"onUpdate:modelValue":t[0]||=e=>H.value=e,placeholder:a(y).baseText(`settings.usageAndPlan.dialog.activation.label`)},null,8,[`modelValue`,`placeholder`])]),footer:f(()=>[_(`div`,{class:g(e.$style.dialogButtonsContainer)},[s(a(x),{variant:`subtle`,onClick:Z},{default:f(()=>[h(n(a(y).baseText(`settings.usageAndPlan.dialog.activation.cancel`)),1)]),_:1}),s(a(x),{disabled:!H.value,onClick:t[1]||=()=>X()},{default:f(()=>[h(n(a(y).baseText(`settings.usageAndPlan.dialog.activation.activate`)),1)]),_:1},8,[`disabled`])],2)]),_:1},8,[`modelValue`,`title`,`modal-class`]),s(k,{modelValue:W.value,"onUpdate:modelValue":t[3]||=e=>W.value=e,"eula-url":G.value,onAccept:Ce,onCancel:we},null,8,[`modelValue`,`eula-url`])]))]))}}),[[`__cssModules`,{$style:{center:`_center_1weln_125`,actionBox:`_actionBox_1weln_129`,spacedFlex:`_spacedFlex_1weln_133`,title:`_title_1weln_139`,quota:`_quota_1weln_145`,count:`_count_1weln_157`,buttons:`_buttons_1weln_162`,chart:`_chart_1weln_178`,chartLine:`_chartLine_1weln_185`,chartBar:`_chartBar_1weln_195`,titleTooltip:`_titleTooltip_1weln_209`,dialogButtonsContainer:`_dialogButtonsContainer_1weln_215`}}],[`__scopeId`,`data-v-151c249f`]]);export{R as default};
//# sourceMappingURL=SettingsUsageAndPlan-B2d0KMnZ.js.map