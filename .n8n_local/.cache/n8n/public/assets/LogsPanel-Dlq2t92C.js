(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`767e587c-422a-4714-ba31-941be6f993b8`,e._sentryDebugIdIdentifier=`sentry-dbid-767e587c-422a-4714-ba31-941be6f993b8`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{C as t,Cn as n,D as r,E as i,G as a,Gt as o,Ht as s,I as c,It as l,J as u,M as d,Nt as f,P as p,Q as m,T as h,Vt as g,W as _,Z as v,_ as y,_t as b,at as x,bn as S,bt as C,ct as w,et as T,f as E,h as D,it as O,j as k,jt as A,k as ee,m as j,mt as M,nt as N,st as te,ut as ne,vn as P,w as F,xt as re,yn as I,z as L,zt as R}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{A as ie,B as z,b as ae,bt as oe,yt as B}from"./_MapCache-DjbOQyB7.js";import{Ci as V,Dt as se,Hi as H,I as U,Li as ce,Mi as W,Oi as G,Ui as K,Vi as q,gi as J,wi as le,z as ue}from"./src-CppJvwzX.js";import{t as Y}from"./_plugin-vue_export-helper-B_J4Khre.js";import{$ as de,Bt as fe,C as X,It as pe,Lt as Z,S as me,Sr as he,Tr as ge,Vt as _e,d as ve,fn as ye,qc as be,r as xe,s as Se,wr as Ce,yr as we,zr as Te}from"./users.store-pCkD7Zo0.js";import{Sc as Ee,Ss as De,rs as Oe}from"./constants-D1jZwsUK.js";import{r as ke}from"./_baseOrderBy-El3qbNHQ.js";import{t as Ae}from"./useClipboard-Duc7LjuO.js";import{n as je}from"./assistant.store-BGYzebcZ.js";import{n as Me,t as Ne}from"./RunData-DoJODYvb.js";import{t as Pe}from"./NDVEmptyState-Cd-QhxaI.js";import{t as Fe}from"./usePinnedData-C6FFXoty.js";import{_ as Ie,a as Le,c as Re,d as Q,f as ze,g as Be,h as Ve,i as He,l as Ue,m as We,o as Ge,p as Ke,r as qe,s as Je,t as Ye,u as $,v as Xe,y as Ze}from"./useCanvasOperations-BHGWcL34.js";import{t as Qe}from"./NodeIcon-Dv1e4Lvu.js";import{t as $e}from"./useRunWorkflow-DzzlHC01.js";import{t as et}from"./KeyboardShortcutTooltip-BuQeOxiO.js";import{t as tt}from"./useKeybindings-B_gtbMl6.js";import{t as nt}from"./fileUtils-CrAesjp5.js";import{_ as rt,a as it,b as at,f as ot,g as st,h as ct,i as lt,l as ut,m as dt,n as ft,p as pt,r as mt,s as ht,t as gt,u as _t,v as vt,y as yt}from"./useLogsTreeExpand-CjcPPamK.js";import{n as bt,t as xt}from"./useResizablePanel-Dt5N79tf.js";function St({chatTrigger:e,sessionId:n,executionResultData:r,onRunChatWorkflow:i,ws:a,onNewMessage:o}){let s=B(),{showError:c}=we(),u=l(0),d=l(!1),f=e=>{d.value=e};async function p(e){let t={};return await Promise.all(e.map(async(e,n)=>{let r=await nt(e),i=`data${n}`;t[i]=r})),t}function m(e){return{fileName:e.name,fileSize:`${e.size} bytes`,fileExtension:e.name.split(`.`).pop()??``,fileType:e.type.split(`/`)[0],mimeType:e.type}}async function h(t,l){let u=e.value;if(!u){c(Error(`Chat Trigger Node could not be found!`),`Trigger Node not found`);return}let f=dt(u),h={json:{sessionId:n.value,action:`sendMessage`,[f]:t}};if(l&&l.length>0){let e=l.map(e=>m(e)),t=await p(l);h.json.files=e,h.binary=t}let g={startTime:Date.now(),executionTime:0,executionIndex:0,executionStatus:`success`,data:{main:[[h]]},source:[null]};d.value=!0;let _=await i({triggerNode:u.name,nodeData:g,source:`RunData.ManualChatMessage`,message:t});if(d.value=!1,a.value=null,!_?.executionId||u.parameters.options?.responseMode===`responseNodes`)return;let v=r.value?ht(r.value,_.executionId,s.baseText(`chat.window.chat.response.empty`)):void 0;v!==void 0&&o(v)}async function g(t,r){if(u.value=0,t.trim()===``&&(!r||r.length===0)){c(Error(s.baseText(`chat.window.chat.provideMessage`)),s.baseText(`chat.window.chat.emptyChatMessage`));return}let i=Fe(e.value);if(i.hasData.value){if(await ge().confirm(s.baseText(`chat.window.chat.unpinAndExecute.description`),s.baseText(`chat.window.chat.unpinAndExecute.title`),{confirmButtonText:s.baseText(`chat.window.chat.unpinAndExecute.confirm`),cancelButtonText:s.baseText(`chat.window.chat.unpinAndExecute.cancel`)})!==`confirm`)return;i.unsetData(`unpin-and-send-chat-message-modal`)}let l={text:t,sender:`user`,sessionId:n.value,id:Te(),files:r};o(l),a.value?.readyState===WebSocket.OPEN&&!d.value?(a.value.send(JSON.stringify({sessionId:n.value,action:`sendMessage`,chatInput:t,files:await yt(r)})),d.value=!0):await h(l.text,r)}return{previousMessageIndex:u,isLoading:t(()=>d.value),setLoadingState:f,sendMessage:g}}var Ct=`Chat`;function wt(e){let n=B(),r=Se(),i=_e(),a=ke(),o=Le(),s=le(),c=pe(),{runWorkflow:u}=$e({router:s}),d=l(null),f=t(()=>o.chatSessionMessages),p=t(()=>o.chatSessionId),m=t(()=>r.getPastChatMessages),h=t(()=>r.allNodes.find(ve)??null),g=t(()=>h.value?.parameters?.options?.allowFileUploads===!0),_=t(()=>(h.value?.parameters?.options)?.allowedFilesMimeTypes?.toString()??``),v=t(()=>h.value?.parameters?.options?.responseMode===`responseNodes`),{sendMessage:y,isLoading:x,setLoadingState:S}=St({chatTrigger:h,sessionId:p,executionResultData:t(()=>r.getWorkflowExecution?.data?.resultData),onRunChatWorkflow:O,onNewMessage:o.addChatMessage,ws:d});function C(e){return{chatConfig:{messages:e.messages,sendMessage:e.sendMessage,initialMessages:l([]),currentSessionId:e.currentSessionId,waitingForResponse:e.isLoading,blockUserInput:l(!1)},chatOptions:{i18n:{en:{title:``,footer:``,subtitle:``,inputPlaceholder:e.locale.baseText(`chat.window.chat.placeholder`),getStarted:``,closeButtonTooltip:``}},webhookUrl:``,mode:`window`,showWindowCloseButton:!0,disabled:e.isDisabled,allowFileUploads:e.allowFileUploads,allowedFilesMimeTypes:_,messageComponents:{[Ie.WITH_BUTTONS]:Xe}}}}let{chatConfig:w,chatOptions:T}=C({messages:f,sendMessage:y,currentSessionId:p,isLoading:x,isDisabled:t(()=>e),allowFileUploads:g,locale:n}),E=t(()=>at(r.workflowExecutionData,n.baseText(`chat.window.chat.response.empty`)));N(Ct,w),N(Ve,T);async function D(){return await new Promise(e=>{let t=t=>{t||(n(),e())},n=b(()=>r.isWorkflowRunning,t);t(r.isWorkflowRunning)})}async function O(e){let t={triggerNode:e.triggerNode,nodeData:e.nodeData,source:e.source};r.chatPartialExecutionDestinationNode&&=(t.destinationNode={nodeName:r.chatPartialExecutionDestinationNode,mode:`inclusive`},null);let n=await u(t);if(n){if(v.value){let e=ze(a.urlBaseEditor,n.executionId,p.value,!1);d.value=new WebSocket(e),d.value.onmessage=e=>{if(e.data===`n8n|heartbeat`){d.value?.send(`n8n|heartbeat-ack`);return}if(e.data===`n8n|continue`){S(!0);return}S(!1);let t={...Ke(e.data),sessionId:p.value};w.blockUserInput.value=We(t),o.addChatMessage(t),o.isOpen&&Q.emit(`focusInput`)},d.value.onclose=()=>{S(!1),d.value=null,w.blockUserInput.value=!1}}return await D(),r.appendChatMessage(e.message),n}}function k(){i.setWorkflowExecutionData(null),c.updateNodesExecutionIssues(),o.resetChatSessionId(),o.resetMessages(),o.isOpen&&Q.emit(`focusInput`)}function A(e){let t=s.resolve({name:Oe.EXECUTION_PREVIEW,params:{name:r.workflowId,executionId:e}});window.open(t.href,`_blank`)}return b(()=>r.workflowId,(e,t)=>{t&&k()}),{currentSessionId:t(()=>o.chatSessionId),messages:t(()=>e?E.value:o.chatSessionMessages),previousChatMessages:m,sendMessage:y,refreshSession:k,displayExecution:A}}var Tt=Y(p({__name:`LogsPanelHeader`,props:{title:{},isClickable:{type:Boolean}},emits:[`click`],setup(e,{emit:t}){let i=t;function a(){e.isClickable&&i(`click`)}return(t,i)=>(T(),r(`header`,{class:P([t.$style.container,{[t.$style.clickable]:e.isClickable}]),onClick:a},[d(o(q),{class:P(t.$style.title),bold:!0,size:`small`},{default:C(()=>[x(t.$slots,`title`,{},()=>[k(n(e.title),1)])]),_:3},8,[`class`]),F(`div`,{class:P(t.$style.actions)},[x(t.$slots,`actions`)],2)],2))}}),[[`__cssModules`,{$style:{container:`_container_16vzt_125`,clickable:`_clickable_16vzt_137`,title:`_title_16vzt_145`,actions:`_actions_16vzt_153`}}]]),Et=e(de(),1),Dt=Y(p({__name:`LogsViewExecutionSummary`,props:{status:{},consumedTokens:{},startTime:{},timeTook:{}},setup(e){let r=B(),a=z({interval:1e3}),s=t(()=>e.status===`running`||e.status===`waiting`?r.baseText(`logs.overview.body.summaryText.for`,{interpolate:{status:(0,Et.default)(e.status),time:r.displayTimer(Math.floor((a.value-e.startTime)/1e3)*1e3,!0)}}):e.timeTook===void 0?(0,Et.default)(e.status):r.baseText(`logs.overview.body.summaryText.in`,{interpolate:{status:(0,Et.default)(e.status),time:r.displayTimer(e.timeTook,!0)}}));return(t,r)=>(T(),h(o(q),{tag:`div`,color:`text-light`,size:`small`,class:P(t.$style.container)},{default:C(()=>[F(`span`,null,n(s.value),1),e.consumedTokens.totalTokens>0?(T(),h(it,{key:0,"consumed-tokens":e.consumedTokens},null,8,[`consumed-tokens`])):i(``,!0)]),_:1},8,[`class`]))}}),[[`__cssModules`,{$style:{container:`_container_1dsxk_125`}}]]);function Ot(){let e=V(),n=Ce(),r=Se(),i=t(()=>r.workflowExecutionData),a=t(()=>r.isWorkflowRunning),o=t(()=>!!e?.meta?.readOnlyCanvas),{editableWorkflow:s}=Ye(),c=X(),l=t(()=>n.preferences.branchReadOnly),u=t(()=>s.value.nodes.filter(e=>c.isTriggerNode(e.type)).every(e=>e.disabled));return t(()=>!o.value&&!l.value&&!a.value&&!u.value&&!!i.value)}var kt=Y(p({__name:`LogsOverviewPanel`,props:{isOpen:{type:Boolean},selected:{},isReadOnly:{type:Boolean},isCompact:{type:Boolean},execution:{},entries:{},flatLogEntries:{},latestNodeInfo:{},isHeaderClickable:{type:Boolean}},emits:[`clickHeader`,`select`,`clearExecutionData`,`openNdv`,`toggleExpanded`],setup(e,{emit:a}){let s=a,c=B(),l=Ot(),u=t(()=>e.flatLogEntries.length===0||e.execution===void 0),f=t(()=>[{label:c.baseText(`logs.overview.header.switch.overview`),value:`overview`},{label:c.baseText(`logs.overview.header.switch.details`),value:`details`}]),p=be()>0,m=t(()=>st(...e.entries.map(e=>ct(e,!1)))),g=t(()=>e.execution?.startedAt&&e.execution.stoppedAt?new Date(e.execution.stoppedAt)-+new Date(e.execution.startedAt):void 0),_=t(()=>m.value.totalTokens>0||e.entries.some(e=>ct(e,!0).totalTokens>0));function v(t){s(`select`,t===`overview`?void 0:e.flatLogEntries[0])}return(t,a)=>(T(),r(`div`,{class:P([t.$style.container,p?t.$style.staticScrollBar:``]),"data-test-id":`logs-overview`},[d(Tt,{title:o(c).baseText(`logs.overview.header.title`),"data-test-id":`logs-overview-header`,"is-clickable":e.isHeaderClickable,onClick:a[1]||=e=>s(`clickHeader`)},{actions:C(()=>[o(l)?(T(),h(o(G),{key:0,content:o(c).baseText(`logs.overview.header.actions.clearExecution.tooltip`)},{default:C(()=>[d(o(H),{variant:`subtle`,size:`xsmall`,icon:`trash-2`,"icon-size":`medium`,"data-test-id":`clear-execution-data-button`,class:P(t.$style.clearButton),onClick:a[0]||=D(e=>s(`clearExecutionData`),[`stop`])},{default:C(()=>[k(n(o(c).baseText(`logs.overview.header.actions.clearExecution`)),1)]),_:1},8,[`class`])]),_:1},8,[`content`])):i(``,!0),x(t.$slots,`actions`)]),_:3},8,[`title`,`is-clickable`]),e.isOpen?(T(),r(`div`,{key:0,class:P([t.$style.content,u.value?t.$style.empty:``]),"data-test-id":`logs-overview-body`},[u.value||e.execution===void 0?(T(),h(o(q),{key:0,tag:`p`,size:`medium`,color:`text-base`,class:P(t.$style.emptyText),"data-test-id":`logs-overview-empty`},{default:C(()=>[k(n(o(c).baseText(`logs.overview.body.empty.message`)),1)]),_:1},8,[`class`])):(T(),r(y,{key:1},[d(Dt,{"data-test-id":`logs-overview-status`,class:P(t.$style.summary),status:e.execution.status,"consumed-tokens":m.value,"start-time":+new Date(e.execution.startedAt),"time-took":g.value},null,8,[`class`,`status`,`consumed-tokens`,`start-time`,`time-took`]),d(mt,{"is-read-only":e.isReadOnly,selected:e.selected,"is-compact":e.isCompact,"should-show-token-count-column":_.value,"latest-node-info":e.latestNodeInfo,"flat-log-entries":e.flatLogEntries,"can-open-ndv":!0,execution:e.execution,onToggleExpanded:a[2]||=e=>s(`toggleExpanded`,e),onOpenNdv:a[3]||=e=>s(`openNdv`,e),onSelect:a[4]||=e=>s(`select`,e)},null,8,[`is-read-only`,`selected`,`is-compact`,`should-show-token-count-column`,`latest-node-info`,`flat-log-entries`,`execution`]),d(o(ue),{size:`small-medium`,class:P(t.$style.switchViewButtons),"model-value":e.selected?`details`:`overview`,options:f.value,"onUpdate:modelValue":v},null,8,[`class`,`model-value`,`options`])],64))],2)):i(``,!0)],2))}}),[[`__cssModules`,{$style:{container:`_container_1qsnq_125`,clearButton:`_clearButton_1qsnq_135`,content:`_content_1qsnq_141`,empty:`_empty_1qsnq_151`,emptyText:`_emptyText_1qsnq_156`,summary:`_summary_1qsnq_161`,switchViewButtons:`_switchViewButtons_1qsnq_165`}}]]);function At(){return L(Be)}function jt(){return{options:L(Ve)}}function Mt(){let{options:e}=jt(),t=e?.defaultLanguage??`en`;function n(n){let r=e?.i18n?.[t]?.[n];return A(r)?r.value:r??n}function r(n){return!!e?.i18n?.[t]?.[n]}return{t:n,te:r}}var Nt={key:0,class:`chat-message-actions`},Pt={key:2,class:`chat-message-files`},Ft=p({__name:`Message`,props:{message:{}},setup(e,{expose:n}){let{message:a}=s(e),{options:u}=jt(),f=l(null),p=l({}),m=t(()=>a.value.text||`&lt;Empty response&gt;`),g=t(()=>({"chat-message-from-user":a.value.sender===`user`,"chat-message-from-bot":a.value.sender===`bot`,"chat-message-transparent":a.value.transparent===!0})),b=()=>{f.value?.scrollIntoView&&f.value.scrollIntoView({block:`start`})},S={...u?.messageComponents??{}};n({scrollToView:b});let C=async e=>await new Promise((t,n)=>{let r=new FileReader;r.onload=()=>t(r.result),r.onerror=n,r.readAsDataURL(e)});return v(async()=>{if(a.value.files)for(let e of a.value.files)try{let t=await C(e);p.value[e.name]=t}catch(e){console.error(`Error reading file:`,e)}}),(e,t)=>(T(),r(`div`,{ref_key:`messageContainer`,ref:f,class:P([`chat-message`,g.value])},[e.$slots.beforeMessage?(T(),r(`div`,Nt,[x(e.$slots,`beforeMessage`,I(c({message:o(a)})))])):i(``,!0),x(e.$slots,`default`,{},()=>[o(a).type===`component`&&S[o(a).key]?(T(),h(w(S[o(a).key]),I(_({key:0},o(a).arguments)),null,16)):(T(),h(Ze,{key:1,text:m.value},null,8,[`text`])),(o(a).files??[]).length>0?(T(),r(`div`,Pt,[(T(!0),r(y,null,O(o(a).files??[],e=>(T(),r(`div`,{key:e.name,class:`chat-message-file`},[d(bt,{file:e,"is-removable":!1,"is-previewable":!0},null,8,[`file`])]))),128))])):i(``,!0)])],2))}}),It={viewBox:`0 0 24 24`,width:`1.2em`,height:`1.2em`};function Lt(e,t){return T(),r(`svg`,It,[...t[0]||=[F(`path`,{fill:`currentColor`,d:`M16.5 6v11.5a4 4 0 0 1-4 4a4 4 0 0 1-4-4V5A2.5 2.5 0 0 1 11 2.5A2.5 2.5 0 0 1 13.5 5v10.5a1 1 0 0 1-1 1a1 1 0 0 1-1-1V6H10v9.5a2.5 2.5 0 0 0 2.5 2.5a2.5 2.5 0 0 0 2.5-2.5V5a4 4 0 0 0-4-4a4 4 0 0 0-4 4v12.5a5.5 5.5 0 0 0 5.5 5.5a5.5 5.5 0 0 0 5.5-5.5V6z`},null,-1)]])}var Rt={name:`mdi-paperclip`,render:Lt},zt={viewBox:`0 0 24 24`,width:`1.2em`,height:`1.2em`};function Bt(e,t){return T(),r(`svg`,zt,[...t[0]||=[F(`path`,{fill:`currentColor`,d:`m2 21l21-9L2 3v7l15 2l-15 2z`},null,-1)]])}var Vt={name:`mdi-send`,render:Bt},Ht={class:`chat-inputs`},Ut={key:0,class:`chat-input-left-panel`},Wt=[`disabled`,`placeholder`],Gt={class:`chat-inputs-controls`},Kt=[`disabled`],qt=[`disabled`],Jt={key:0,class:`chat-files`},Yt=Y(p({__name:`Input`,props:{placeholder:{default:`inputPlaceholder`}},emits:[`arrowKeyDown`,`escapeKeyDown`],setup(e,{emit:n}){let a=e,{t:s}=Mt(),c=n,{options:u}=jt(),f=At(),{waitingForResponse:p}=f,g=l(null),_=l(null),b=l(``),C=l(!1),w=l(null),k=l(!1),A=t(()=>f.blockUserInput.value?!0:k.value?!1:b.value===``||o(p)||u.disabled?.value===!0),ee=t(()=>u.disabled?.value===!0),M=t(()=>N.value&&o(p)&&!u.disabled?.value),N=t(()=>o(u.allowFileUploads)===!0),te=t(()=>o(u.allowedFilesMimeTypes)),ne=t(()=>{let e=N.value?2:1;return{"--controls-count":e}}),{open:P,reset:I,onChange:L}=ie({multiple:!0,reset:!1});L(e=>{if(!e)return;let t=new DataTransfer;if(g.value)for(let e=0;e<g.value.length;e++)t.items.add(g.value[e]);for(let n=0;n<e.length;n++)t.items.add(e[n]);g.value=t.files}),v(()=>{Q.on(`focusInput`,z),Q.on(`blurInput`,R),Q.on(`setInputValue`,ae),_.value&&(w.value=new ResizeObserver(e=>{for(let t of e)t.target===_.value&&K()}),w.value.observe(_.value))}),m(()=>{Q.off(`focusInput`,z),Q.off(`blurInput`,R),Q.off(`setInputValue`,ae),w.value&&=(w.value.disconnect(),null)});function R(){_.value&&_.value.blur()}function z(){_.value&&_.value.focus()}function ae(e){b.value=e,z()}function oe(){if(g.value){let e=Array.from(g.value);return I(),g.value=null,e}return[]}function B(e){if(u.webhookUrl&&f.currentSessionId.value)try{let t=ze(u.webhookUrl,e,f.currentSessionId.value,!0);f.ws=new WebSocket(t),f.ws.onmessage=e=>{if(e.data===`n8n|heartbeat`){f.ws?.send(`n8n|heartbeat-ack`);return}if(e.data===`n8n|continue`){k.value=!1,f.waitingForResponse.value=!0;return}let t=Ke(e.data);f.messages.value.push(t),k.value=!0,f.waitingForResponse.value=!1,f.blockUserInput.value=We(t)},f.ws.onclose=()=>{f.ws=null,k.value=!1,f.waitingForResponse.value=!1,f.blockUserInput.value=!1}}catch(e){console.error(`Error setting up websocket connection`,e)}}async function V(e){if(!e||e.length===0)return[];let t=e.map(async e=>new Promise((t,n)=>{let r=new FileReader;r.onload=()=>t({name:e.name,type:e.type,data:r.result}),r.onerror=()=>n(Error(`Error reading file: ${r.error?.message??`Unknown error`}`)),r.readAsDataURL(e)}));return await Promise.all(t)}async function se(e,t){let n={id:Te(),text:t,sender:`user`,files:g.value?oe():void 0};f.messages.value.push(n),e.send(JSON.stringify({sessionId:f.currentSessionId.value,action:`sendMessage`,chatInput:t,files:await V(n.files)})),f.waitingForResponse.value=!0,k.value=!1}async function H(e){if(e.preventDefault(),A.value)return;let t=b.value;if(b.value=``,C.value=!0,f.ws&&k.value){await se(f.ws,t);return}let n=await f.sendMessage(t,oe());n?.executionId&&B(n.executionId),C.value=!1}async function U(e){e.shiftKey||e.isComposing||(await H(e),K())}function ce(e){if(!g.value)return;let t=new DataTransfer;for(let n=0;n<g.value.length;n++){let r=g.value[n];e.name!==r.name&&t.items.add(r)}I(),g.value=t.files}function W(e){e.key===`ArrowUp`||e.key===`ArrowDown`?(e.preventDefault(),c(`arrowKeyDown`,{key:e.key,currentInputValue:b.value})):e.key===`Escape`&&(e.preventDefault(),c(`escapeKeyDown`,{currentInputValue:b.value}))}function G(){M.value||P({accept:o(te)})}function K(){let e=_.value;if(!e)return;e.style.height=`var(--chat--textarea--height)`;let t=Math.min(e.scrollHeight,480);e.style.height=`${t}px`}return(e,t)=>(T(),r(`div`,{class:`chat-input`,style:S(ne.value),onKeydown:D(W,[`stop`])},[F(`div`,Ht,[e.$slots.leftPanel?(T(),r(`div`,Ut,[x(e.$slots,`leftPanel`,{},void 0,!0)])):i(``,!0),re(F(`textarea`,{ref_key:`chatTextArea`,ref:_,"onUpdate:modelValue":t[0]||=e=>b.value=e,"data-test-id":`chat-input`,disabled:ee.value,placeholder:o(s)(a.placeholder),onKeydown:j(U,[`enter`]),onInput:K,onMousedown:K,onFocus:K},null,40,Wt),[[E,b.value]]),F(`div`,Gt,[N.value?(T(),r(`button`,{key:0,disabled:M.value,class:`chat-input-file-button`,"data-test-id":`chat-attach-file-button`,onClick:G},[d(o(Rt),{height:`24`,width:`24`})],8,Kt)):i(``,!0),F(`button`,{disabled:A.value,class:`chat-input-send-button`,onClick:H},[d(o(Vt),{height:`24`,width:`24`})],8,qt)])]),g.value?.length&&(!C.value||k.value)?(T(),r(`div`,Jt,[(T(!0),r(y,null,O(g.value,e=>(T(),h(bt,{key:e.name,file:e,"is-removable":!0,"is-previewable":!0,onRemove:ce},null,8,[`file`]))),128))])):i(``,!0)],36))}}),[[`__scopeId`,`data-v-a4112bfa`]]),Xt=p({__name:`MessageTyping`,props:{animation:{default:`bouncing`}},setup(e){let n=e,r={id:`typing`,text:``,sender:`bot`},i=l(),a=t(()=>({"chat-message-typing":!0,[`chat-message-typing-animation-${n.animation}`]:!0}));return v(()=>{i.value?.scrollToView()}),(e,t)=>(T(),h(o(Ft),{ref_key:`messageContainer`,ref:i,class:P(a.value),message:r,"data-test-id":`chat-message-typing`},{default:C(()=>[...t[0]||=[F(`div`,{class:`chat-message-typing-body`},[F(`span`,{class:`chat-message-typing-circle`}),F(`span`,{class:`chat-message-typing-circle`}),F(`span`,{class:`chat-message-typing-circle`})],-1)]]),_:1},8,[`class`]))}}),Zt={key:0,class:`empty-container`},Qt={class:`empty`,"data-test-id":`chat-messages-empty`},$t={key:1,class:`chat-messages-list`},en=p({__name:`MessagesList`,props:{messages:{},emptyText:{}},setup(e){let t=At(),a=l([]),{initialMessages:s,waitingForResponse:c}=t;return b(()=>a.value.length,()=>{let e=a.value[a.value.length-1];e&&e.scrollToView()}),(t,l)=>e.emptyText&&o(s).length===0&&e.messages.length===0?(T(),r(`div`,Zt,[F(`div`,Qt,[d(o(K),{icon:`message-circle`,size:`large`,class:`emptyIcon`}),d(o(q),{tag:`p`,size:`medium`,color:`text-base`},{default:C(()=>[k(n(e.emptyText),1)]),_:1})])])):(T(),r(`div`,$t,[(T(!0),r(y,null,O(o(s),e=>(T(),h(Ft,{key:e.id,message:e},null,8,[`message`]))),128)),(T(!0),r(y,null,O(e.messages,e=>(T(),h(Ft,{key:e.id,ref_for:!0,ref_key:`messageComponents`,ref:a,message:e},{beforeMessage:C(({message:e})=>[x(t.$slots,`beforeMessage`,_({ref_for:!0},{message:e}))]),_:2},1032,[`message`]))),128)),o(c)?(T(),h(Xt,{key:0})):i(``,!0)]))}}),tn=Y(p({__name:`MessageOptionTooltip`,props:{placement:{type:String,default:`top`}},setup(e){return(t,n)=>(T(),r(`div`,{class:P(t.$style.container)},[d(o(G),{placement:e.placement},{content:C(()=>[x(t.$slots,`default`)]),default:C(()=>[F(`span`,{class:P(t.$style.icon)},[d(o(K),{icon:`info`,size:`xsmall`})],2)]),_:3},8,[`placement`])],2))}}),[[`__cssModules`,{$style:{container:`_container_1lun2_125`,icon:`_icon_1lun2_131`}}]]),nn=Y(p({__name:`MessageOptionAction`,props:{label:{},icon:{},placement:{}},setup(e){let t=ne(),i=()=>{t.onClick?.()};return(t,a)=>(T(),r(`div`,{class:P(t.$style.container)},[d(o(G),{placement:e.placement},{content:C(()=>[k(n(e.label),1)]),default:C(()=>[d(o(K),{class:P(t.$style.icon),icon:e.icon,size:`xsmall`,onClick:i},null,8,[`class`,`icon`])]),_:1},8,[`placement`])],2))}}),[[`__cssModules`,{$style:{container:`_container_1clrm_125`,icon:`_icon_1clrm_131`}}]]),rn=[`onClick`],an=Y(p({__name:`ChatMessagesPanel`,props:{pastChatMessages:{},messages:{},sessionId:{},showCloseButton:{type:Boolean},isOpen:{type:Boolean,default:!0},isReadOnly:{type:Boolean,default:!1},isHeaderClickable:{type:Boolean}},emits:[`displayExecution`,`sendMessage`,`refreshSession`,`close`,`clickHeader`],setup(e,{emit:a}){let s=e,c=a,u=Ae(),f=B(),p=we(),m=l(-1),g=l(``),_=t(()=>f.baseText(`chat.window.session.id`,{interpolate:{id:`${s.sessionId.slice(0,5)}...`}})),v=t(()=>s.messages.length>0?f.baseText(`chat.window.chat.placeholder`):f.baseText(`chat.window.chat.placeholderPristine`));function y(e){return e.type===`text`||!e.type}function b(e){S(e.text)}function x(e){Q.emit(`setInputValue`,e.text)}function S(e){m.value=-1,g.value=``,c(`sendMessage`,e)}function w(){c(`refreshSession`)}function E({currentInputValue:e,key:t}){let n=s.pastChatMessages;if(n.length!==0){if(e.length===0&&m.value!==-1&&(m.value=-1,g.value=``),m.value===-1&&e.length>0&&(g.value=e),t===`ArrowUp`){Q.emit(`blurInput`),m.value===-1?m.value=n.length-1:m.value>0&&m.value--;let e=n[m.value];Q.emit(`setInputValue`,e),Q.emit(`focusInput`)}else if(t===`ArrowDown`){if(m.value===-1)return;if(Q.emit(`blurInput`),m.value<n.length-1){m.value++;let e=n[m.value];Q.emit(`setInputValue`,e)}else m.value=-1,Q.emit(`setInputValue`,g.value),g.value=``;Q.emit(`focusInput`)}}}function O(){m.value!==-1&&(m.value=-1,Q.emit(`setInputValue`,g.value),g.value=``)}async function A(){await u.copy(s.sessionId),p.showMessage({title:f.baseText(`generic.copiedToClipboard`),message:``,type:`success`})}return(t,a)=>(T(),r(`div`,{class:P([t.$style.chat,`ignore-key-press-canvas`]),"data-test-id":`workflow-lm-chat-dialog`,tabindex:`0`},[d(Tt,{"data-test-id":`chat-header`,title:o(f).baseText(`chat.window.title`),"is-clickable":e.isHeaderClickable,onClick:a[0]||=e=>c(`clickHeader`)},{actions:C(()=>[o(u).isSupported&&!e.isReadOnly?(T(),h(o(G),{key:0},{content:C(()=>[k(n(e.sessionId)+` `,1),a[3]||=F(`br`,null,null,-1),k(` `+n(o(f).baseText(`chat.window.session.id.copy`)),1)]),default:C(()=>[d(o(H),{variant:`ghost`,"data-test-id":`chat-session-id`,size:`xsmall`,class:P(t.$style.newHeaderButton),onClick:D(A,[`stop`])},{default:C(()=>[k(n(_.value),1)]),_:1},8,[`class`])]),_:1})):i(``,!0),e.messages.length>0&&!e.isReadOnly?(T(),h(o(G),{key:1,content:o(f).baseText(`chat.window.session.resetSession`)},{default:C(()=>[d(o(W),{variant:`ghost`,class:P(t.$style.newHeaderButton),"data-test-id":`refresh-session-button`,size:`xsmall`,"icon-size":`medium`,icon:`undo-2`,title:o(f).baseText(`chat.window.session.reset`),onClick:D(w,[`stop`])},null,8,[`class`,`title`])]),_:1},8,[`content`])):i(``,!0)]),_:1},8,[`title`,`is-clickable`]),e.isOpen?(T(),r(`main`,{key:0,class:P(t.$style.chatBody),"data-test-id":`canvas-chat-body`},[d(en,{messages:e.messages,class:P(t.$style.messages),"empty-text":o(f).baseText(`chat.window.chat.emptyChatMessage.v2`)},{beforeMessage:C(({message:t})=>[!e.isReadOnly&&t.sender===`bot`&&!t.id.includes(`preload`)?(T(),h(tn,{key:0,placement:`right`,"data-test-id":`execution-id-tooltip`},{default:C(()=>[k(n(o(f).baseText(`chat.window.chat.chatMessageOptions.executionId`))+`: `,1),F(`a`,{href:`#`,onClick:e=>c(`displayExecution`,t.id)},n(t.id),9,rn)]),_:2},1024)):i(``,!0),!e.isReadOnly&&y(t)&&t.sender===`user`?(T(),h(nn,{key:1,"data-test-id":`repost-message-button`,icon:`redo-2`,label:o(f).baseText(`chat.window.chat.chatMessageOptions.repostMessage`),placement:`left`,onClickOnce:e=>b(t)},null,8,[`label`,`onClickOnce`])):i(``,!0),!e.isReadOnly&&y(t)&&t.sender===`user`?(T(),h(nn,{key:2,"data-test-id":`reuse-message-button`,icon:`files`,label:o(f).baseText(`chat.window.chat.chatMessageOptions.reuseMessage`),placement:`left`,onClick:e=>x(t)},null,8,[`label`,`onClick`])):i(``,!0)]),_:1},8,[`messages`,`class`,`empty-text`])],2)):i(``,!0),e.isOpen?(T(),r(`div`,{key:1,class:P(t.$style.messagesInput)},[d(Yt,{"data-test-id":`lm-chat-inputs`,placeholder:v.value,onArrowKeyDown:E,onEscapeKeyDown:O},ee({_:2},[e.pastChatMessages.length>0?{name:`leftPanel`,fn:C(()=>[F(`div`,{class:P(t.$style.messagesHistory)},[d(o(H),{variant:`ghost`,title:`Navigate to previous message`,icon:`chevron-up`,size:`xsmall`,disabled:m.value===0,onClick:a[1]||=e=>E({currentInputValue:``,key:`ArrowUp`})},null,8,[`disabled`]),d(o(H),{variant:`ghost`,title:`Navigate to next message`,icon:`chevron-down`,size:`xsmall`,disabled:m.value===-1,onClick:a[2]||=e=>E({currentInputValue:``,key:`ArrowDown`})},null,8,[`disabled`])],2)]),key:`0`}:void 0]),1032,[`placeholder`])],2)):i(``,!0)],2))}}),[[`__cssModules`,{$style:{chat:`_chat_14gab_125`,chatHeader:`_chatHeader_14gab_185`,chatTitle:`_chatTitle_14gab_198`,session:`_session_14gab_202`,sessionId:`_sessionId_14gab_210`,copyable:`_copyable_14gab_216`,headerButton:`_headerButton_14gab_220`,newHeaderButton:`_newHeaderButton_14gab_225`,chatBody:`_chatBody_14gab_230`,messages:`_messages_14gab_239`,messagesInput:`_messagesInput_14gab_250`,messagesHistory:`_messagesHistory_14gab_284`}}]]),on=Y(p({__name:`LogsViewRunData`,props:{title:{},paneType:{},logEntry:{},collapsingTableColumnName:{},searchShortcut:{}},emits:[`collapsingTableColumnChanged`],setup(e,{emit:r}){let a=r,s=B(),c=fe(),u=L(Ee,l()),f=l(e.paneType===`input`?`schema`:`table`),p=t(()=>e.paneType===`input`&&(e.logEntry.runData?.source.length??0)>1),m=t(()=>{if(vt(e.logEntry)||e.paneType===`output`)return{node:e.logEntry.node,runIndex:e.logEntry.runIndex};let t=e.logEntry.runData?.source[0],n=t&&e.logEntry.workflow.getNode(t.previousNode);if(!(!t||!n))return{node:{...n,disabled:!1},runIndex:t.previousNodeRun??0,overrideOutputs:[t.previousNodeOutput??0]}}),g=t(()=>e.paneType===`output`&&(e.logEntry.runData?.executionStatus===`running`||e.logEntry.runData?.executionStatus===`waiting`));function v(){c.setActiveNodeName(e.logEntry.node.name,`logs_view`)}function y(e){f.value=e}return(t,r)=>{let c=te(`n8n-html`);return m.value?(T(),h(Ne,_({key:0},m.value,{key:`run-data${o(u)?`-pop-out`:``}`,class:t.$style.component,"workflow-object":e.logEntry.workflow,"workflow-execution":e.logEntry.execution,"no-data-in-branch-message":o(s).baseText(`ndv.output.noOutputDataInBranch`),"executing-message":o(s).baseText(`ndv.output.executing`),"pane-type":e.paneType,"disable-run-index-selection":!0,compact:!0,"show-actions-on-hover":!0,"disable-pin":!0,"disable-edit":!0,"disable-hover-highlight":!0,"disable-settings-hint":!0,"display-mode":f.value,"disable-ai-content":!o(vt)(e.logEntry),"is-executing":g.value,"table-header-bg-color":`light`,"collapsing-table-column-name":e.collapsingTableColumnName,"search-shortcut":e.searchShortcut,onDisplayModeChange:y,onCollapsingTableColumnChanged:r[0]||=e=>a(`collapsingTableColumnChanged`,e)}),ee({header:C(()=>[d(o(q),{class:P(t.$style.title),bold:!0,color:`text-light`,size:`small`},{default:C(()=>[k(n(e.title),1)]),_:1},8,[`class`])]),"header-end":C(e=>[d(Me,_(e,{search:f.value===`schema`?``:e.search}),null,16,[`search`])]),"no-output-data":C(()=>[d(Pe,{title:o(s).baseText(`ndv.output.noOutputData.title`)},null,8,[`title`])]),"node-waiting":C(()=>[d(Pe,{title:o(s).baseText(`ndv.output.waitNodeWaiting.title`),wide:``},{default:C(()=>[re(F(`span`,null,null,512),[[c,o(me)(e.logEntry.node,e.logEntry.workflow)]])]),_:1},8,[`title`])]),_:2},[p.value?{name:`content`,fn:C(()=>[]),key:`0`}:void 0,p.value?{name:`callout-message`,fn:C(()=>[d(o(oe),{keypath:`logs.details.body.multipleInputs`,scope:`global`},{button:C(()=>[d(o(J),{size:`small`,onClick:v},{default:C(()=>[k(n(o(s).baseText(`logs.details.body.multipleInputs.openingTheNode`)),1)]),_:1})]),_:1})]),key:`1`}:void 0]),1040,[`class`,`workflow-object`,`workflow-execution`,`no-data-in-branch-message`,`executing-message`,`pane-type`,`display-mode`,`disable-ai-content`,`is-executing`,`collapsing-table-column-name`,`search-shortcut`])):i(``,!0)}}}),[[`__cssModules`,{$style:{component:`_component_7mlt9_125`,title:`_title_7mlt9_129`}}]]),sn=200,cn=Y(p({__name:`LogDetailsPanel`,props:{isOpen:{type:Boolean},logEntry:{},window:{},latestInfo:{},panels:{},collapsingInputTableColumnName:{},collapsingOutputTableColumnName:{},isHeaderClickable:{type:Boolean}},emits:[`clickHeader`,`toggleInputOpen`,`toggleOutputOpen`,`collapsingInputTableColumnChanged`,`collapsingOutputTableColumnChanged`],setup(e,{emit:a}){let s=a,c=B(),l=X(),u=fe(),f=He(),p=t(()=>l.getNodeType(e.logEntry.node.type)),m=t(()=>ct(e.logEntry,!1)),g=t(()=>p.value?.group.includes(`trigger`)),_=M(`container`),v=xt(`N8N_LOGS_INPUT_PANEL_WIDTH`,{container:_,defaultSize:e=>e/2,minSize:sn,maxSize:e=>e-sn,allowCollapse:!0,allowFullSize:!0}),b=t(()=>e.panels===$.BOTH),w=t(()=>u.isNDVOpen||f.isMapperOpen?void 0:e.panels===$.INPUT?`input`:`output`);function E(){v.isCollapsed.value&&s(`toggleInputOpen`,!1),v.isFullSize.value&&s(`toggleOutputOpen`,!1),v.onResizeEnd()}return(t,a)=>(T(),r(`div`,{ref_key:`container`,ref:_,class:P(t.$style.container),"data-test-id":`log-details`},[d(Tt,{"data-test-id":`log-details-header`,class:P(t.$style.header),"is-clickable":e.isHeaderClickable,onClick:a[2]||=e=>s(`clickHeader`)},{title:C(()=>[F(`div`,{class:P(t.$style.title)},[d(Qe,{"node-type":p.value,size:16,class:P(t.$style.icon)},null,8,[`node-type`,`class`]),d(lt,{name:e.latestInfo?.name??e.logEntry.node.name,"is-deleted":e.latestInfo?.deleted??!1},null,8,[`name`,`is-deleted`]),e.isOpen&&e.logEntry.runData!==void 0?(T(),h(Dt,{key:0,class:P(t.$style.executionSummary),status:e.logEntry.runData.executionStatus??`unknown`,"consumed-tokens":m.value,"start-time":e.logEntry.runData.startTime,"time-took":e.logEntry.runData.executionTime},null,8,[`class`,`status`,`consumed-tokens`,`start-time`,`time-took`])):i(``,!0)],2)]),actions:C(()=>[e.isOpen&&!g.value&&!o(rt)(e.logEntry)?(T(),r(`div`,{key:0,class:P(t.$style.actions)},[d(et,{label:o(c).baseText(`generic.shortcutHint`),shortcut:{keys:[`i`]}},{default:C(()=>[d(o(H),{variant:`subtle`,size:`xsmall`,class:P(e.panels===o($).OUTPUT?``:t.$style.pressed),onClick:a[0]||=D(e=>s(`toggleInputOpen`),[`stop`])},{default:C(()=>[k(n(o(c).baseText(`logs.details.header.actions.input`)),1)]),_:1},8,[`class`])]),_:1},8,[`label`]),d(et,{label:o(c).baseText(`generic.shortcutHint`),shortcut:{keys:[`o`]}},{default:C(()=>[d(o(H),{variant:`subtle`,size:`xsmall`,class:P(e.panels===o($).INPUT?``:t.$style.pressed),onClick:a[1]||=D(e=>s(`toggleOutputOpen`),[`stop`])},{default:C(()=>[k(n(o(c).baseText(`logs.details.header.actions.output`)),1)]),_:1},8,[`class`])]),_:1},8,[`label`])],2)):i(``,!0),x(t.$slots,`actions`)]),_:3},8,[`class`,`is-clickable`]),e.isOpen?(T(),r(`div`,{key:0,class:P(t.$style.content),"data-test-id":`logs-details-body`},[o(rt)(e.logEntry)?(T(),r(`div`,{key:0,class:P(t.$style.placeholder)},[d(o(q),{color:`text-base`},{default:C(()=>[k(n(o(c).baseText(`ndv.output.runNodeHint`)),1)]),_:1})],2)):(T(),r(y,{key:1},[!g.value&&e.panels!==o($).OUTPUT?(T(),h(o(U),{key:0,class:P({[t.$style.inputResizer]:!0,[t.$style.collapsed]:o(v).isCollapsed.value,[t.$style.full]:o(v).isFullSize.value}),width:o(v).size.value,style:S(b.value?{width:`${o(v).size.value??0}px`}:void 0),"supported-directions":[`right`],"is-resizing-enabled":b.value,window:e.window,onResize:o(v).onResize,onResizeend:E},{default:C(()=>[d(on,{"data-test-id":`log-details-input`,"pane-type":`input`,title:o(c).baseText(`logs.details.header.actions.input`),"log-entry":e.logEntry,"collapsing-table-column-name":e.collapsingInputTableColumnName,"search-shortcut":w.value===`input`?`ctrl+f`:void 0,onCollapsingTableColumnChanged:a[3]||=e=>s(`collapsingInputTableColumnChanged`,e)},null,8,[`title`,`log-entry`,`collapsing-table-column-name`,`search-shortcut`])]),_:1},8,[`class`,`width`,`style`,`is-resizing-enabled`,`window`,`onResize`])):i(``,!0),g.value||e.panels!==o($).INPUT?(T(),h(on,{key:1,"data-test-id":`log-details-output`,"pane-type":`output`,class:P(t.$style.outputPanel),title:o(c).baseText(`logs.details.header.actions.output`),"log-entry":e.logEntry,"collapsing-table-column-name":e.collapsingOutputTableColumnName,"search-shortcut":w.value===`output`?`ctrl+f`:void 0,onCollapsingTableColumnChanged:a[4]||=e=>s(`collapsingOutputTableColumnChanged`,e)},null,8,[`class`,`title`,`log-entry`,`collapsing-table-column-name`,`search-shortcut`])):i(``,!0)],64))],2)):i(``,!0)],2))}}),[[`__cssModules`,{$style:{container:`_container_1du2i_125`,header:`_header_1du2i_134`,actions:`_actions_1du2i_138`,pressed:`_pressed_1du2i_144`,title:`_title_1du2i_148`,icon:`_icon_1du2i_154`,executionSummary:`_executionSummary_1du2i_158`,content:`_content_1du2i_162`,outputPanel:`_outputPanel_1du2i_170`,inputResizer:`_inputResizer_1du2i_175`,collapsed:`_collapsed_1du2i_179`,full:`_full_1du2i_179`,placeholder:`_placeholder_1du2i_183`}}]]),ln=Y(p({__name:`LogsPanelActions`,props:{isOpen:{type:Boolean},isSyncSelectionEnabled:{type:Boolean},showToggleButton:{type:Boolean},showPopOutButton:{type:Boolean}},emits:[`popOut`,`toggleOpen`,`toggleSyncSelection`],setup(e,{emit:n}){let a=n,s=B(),c=t(()=>s.baseText(`runData.panel.actions.popOut`)),l=t(()=>s.baseText(e.isOpen?`runData.panel.actions.collapse`:`runData.panel.actions.open`)),u=t(()=>[{id:`toggleSyncSelection`,label:s.baseText(`runData.panel.actions.sync`),checked:e.isSyncSelectionEnabled},...e.showPopOutButton?[{id:`popOut`,label:c.value}]:[]]);function f(e){switch(e){case`popOut`:a(e);return;case`toggleSyncSelection`:a(e);return}}return(t,n)=>(T(),r(`div`,{class:P(t.$style.container)},[!e.isOpen&&e.showPopOutButton?(T(),h(o(G),{key:0,content:c.value},{default:C(()=>[d(o(W),{variant:`ghost`,icon:`pop-out`,size:`small`,"icon-size":`medium`,"aria-label":c.value,onClick:n[0]||=D(e=>a(`popOut`),[`stop`])},null,8,[`aria-label`])]),_:1},8,[`content`])):i(``,!0),e.isOpen?(T(),h(o(se),{key:1,"icon-size":`small`,"activator-icon":`ellipsis`,"activator-size":`small`,items:u.value,teleported:!1,onSelect:f,onClick:n[1]||=D(()=>{},[`stop`])},null,8,[`items`])):i(``,!0),e.showToggleButton?(T(),h(et,{key:`tooltip-${e.isOpen}`,label:o(s).baseText(`generic.shortcutHint`),shortcut:{keys:[`l`]}},{default:C(()=>[d(o(W),{variant:`ghost`,size:`small`,"icon-size":`medium`,icon:e.isOpen?`chevron-down`:`chevron-up`,"aria-label":l.value,onClick:n[2]||=D(e=>a(`toggleOpen`),[`stop`])},null,8,[`icon`,`aria-label`])]),_:1},8,[`label`])):i(``,!0)],2))}}),[[`__cssModules`,{$style:{container:`_container_1g4ug_125`}}]]);function un(e,n,r,i){let a=Z(),o=R({type:`initial`}),s=R(),c=t(()=>e.value?.stoppedAt!==void 0),l=t(()=>_t(o.value,n.value,!c.value)),u=Le(),d=xe(),f=he(),p=Se();function m(e){u.isLogSelectionSyncedWithCanvas&&qe.emit(`nodes:select`,{ids:[e.node.id],panIntoView:!0})}function h(t){o.value=t===void 0?{type:`none`}:{type:`selected`,entry:t},t&&(m(t),a.track(`User selected node in log view`,{node_type:t.node.type,node_id:t.node.id,execution_id:e.value?.id,workflow_id:e.value?.workflowData.id,subworkflow_depth:ot(t)}))}function g(){let e=r.value;if(e.length===0)return;let t=l.value?pt(e,l.value.id,-1)??e[0]:e[e.length-1];o.value={type:`selected`,entry:t},m(t)}function _(){let e=r.value;if(e.length===0)return;let t=l.value?pt(e,l.value.id,1)??e[e.length-1]:e[0];o.value={type:`selected`,entry:t},m(t)}return b(l,e=>{e&&u.setSubNodeSelected(vt(e))},{immediate:!0}),b([()=>d.lastSelectedNode,()=>u.isLogSelectionSyncedWithCanvas],([e,t])=>{let n=e?p.nodesByName[e]?.id:void 0;s.value=t&&!f.hasRangeSelection&&l.value?.node.id!==n?n:void 0},{immediate:!0}),b([n,s],([e,t])=>{if(t===void 0)return;let n=ut(e=>e.node.id===t,e);if(!n)return;s.value=void 0,o.value={type:`selected`,entry:n};let r=n.parent;for(;r!==void 0;)i(r,!0),r=r.parent},{immediate:!0}),{selected:l,select:h,selectPrev:g,selectNext:_}}function dn(e){return e instanceof HTMLStyleElement||e instanceof HTMLLinkElement&&e.rel===`stylesheet`}function fn(e,t){let n=e.document.head.querySelectorAll(`style, link[rel="stylesheet"]`);for(let r of t){for(let t of r.addedNodes)dn(t)&&e.document.head.appendChild(t.cloneNode(!0));for(let e of r.removedNodes)if(dn(e))for(let t of n)t.isEqualNode(e)&&t.remove()}}function pn(e,t){let n=e.document.querySelector(`link[rel=icon]`)?.getAttribute(`href`);if(n){let e=t.document.createElement(`link`);e.setAttribute(`rel`,`icon`),e.setAttribute(`href`,n),t.document.head.appendChild(e)}}function mn({title:e,container:n,content:r,initialHeight:i,initialWidth:a,shouldPopOut:o,onRequestClose:s}){let c=l(),d=l(!1),p=t(()=>window.parent===window),m=t(()=>!!c.value),h=t(()=>m.value?r.value??void 0:void 0),g=new MutationObserver(e=>{c.value&&fn(c.value,e)}),_=ye(c);g.observe(document.head,{childList:!0,subtree:!0}),N(Ee,c),ce(h);async function v(){if(r.value){if(!c.value){let e=`popup=yes,width=${a},height=${i},left=100,top=100,toolbar=no,menubar=no,scrollbars=yes,resizable=yes`;c.value=window.open(``,`_blank`,e)??void 0}if(c.value){pn(window,c.value);for(let e of[...document.styleSheets])try{let t=[...e.cssRules].map(e=>e.cssText).join(``),n=document.createElement(`style`);n.textContent=t,c.value.document.head.appendChild(n)}catch{let t=document.createElement(`link`);t.rel=`stylesheet`,t.type=e.type,t.media=e.media,t.href=e.href,c.value.document.head.appendChild(t)}c.value.document.body.append(r.value),c.value.addEventListener(`pagehide`,()=>!d.value&&s())}}}function y(){c.value?.close(),c.value=void 0,r.value&&n.value?.appendChild(r.value)}return b(o,e=>e?requestAnimationFrame(v):y(),{immediate:!0}),b([e,c],([e,t])=>{t&&_.set(e)},{immediate:!0}),f(()=>{g.disconnect()}),u(()=>{d.value=!0,c.value&&(c.value.close(),s())}),{canPopOut:p,isPoppedOut:m,popOutWindow:c}}var hn=400,gn=32;function _n(e,n,r,i,a){let o=Le(),s=Z(),c=xt(Je,{container:document.body,position:`bottom`,snap:!1,defaultSize:e=>e*.3,minSize:160,maxSize:e=>e*.75,allowCollapse:!0}),l=xt(Re,{container:i,defaultSize:e=>Math.min(800,e*.3),minSize:240,maxSize:e=>e*.8}),d=xt(Ge,{container:a,defaultSize:e=>Math.min(240,e*.2),minSize:80,maxSize:500,allowFullSize:!0}),f=t(()=>o.isOpen?!c.isCollapsed.value:c.isResizing.value&&c.size.value>0),p=t(()=>d.isFullSize.value),m=t(()=>`Logs - ${e.value}`),h=t(()=>o.state===Ue.FLOATING),{canPopOut:g,isPoppedOut:_,popOutWindow:v}=mn({title:m,initialHeight:hn,initialWidth:window.document.body.offsetWidth*.8,container:n,content:r,shouldPopOut:h,onRequestClose:()=>{f.value&&(s.track(`User toggled log view`,{new_state:`attached`}),o.setPreferPoppedOut(!1))}});function y(e){let t=o.isOpen;e!==t&&(o.toggleOpen(e),s.track(`User toggled log view`,{new_state:t?`collapsed`:`attached`}))}function x(){s.track(`User toggled log view`,{new_state:`floating`}),o.toggleOpen(!0),o.setPreferPoppedOut(!0)}function S(){!o.isOpen&&!c.isCollapsed.value&&y(!0),c.isCollapsed.value&&y(!1),c.onResizeEnd()}return b([()=>o.state,c.size,_],([e,t])=>{let n=e===Ue.FLOATING?0:e===Ue.ATTACHED?t:gn;e===Ue.FLOATING?v?.value?.document.documentElement.style.setProperty(`--logs-panel--height`,`100vh`):document.documentElement.style.setProperty(`--logs-panel--height`,`${n}px`),o.setHeight(n)},{immediate:!0}),u(()=>o.setHeight(0)),{height:c.size,chatPanelWidth:l.size,overviewPanelWidth:d.size,canPopOut:g,isOpen:f,isCollapsingDetailsPanel:p,isPoppedOut:_,isOverviewPanelFullWidth:d.isFullSize,popOutWindow:v,onToggleOpen:y,onPopOut:x,onResize:c.onResize,onResizeEnd:S,onChatPanelResize:l.onResize,onChatPanelResizeEnd:l.onResizeEnd,onOverviewPanelResize:d.onResize,onOverviewPanelResizeEnd:d.onResizeEnd}}var vn=p({__name:`LogsViewKeyboardEventListener`,props:{keyMap:{},container:{}},setup(e){let n=L(Ee,l()),i=ae({window:n?.value}),a=t(()=>n?.value?n.value.document.activeElement===null:!i.value||!e.container||!e.container.contains(i.value)&&e.container!==i.value);return tt(g(()=>e.keyMap),{disabled:a}),(e,t)=>(T(),r(`div`))}}),yn=Y(p({__name:`LogsPanel`,props:{isReadOnly:{type:Boolean,default:!1}},setup(e){let n=e,s=M(`container`),c=M(`logsContainer`),u=M(`popOutContainer`),f=M(`popOutContent`),p=Le(),m=fe(),g=Se(),{height:v,chatPanelWidth:y,overviewPanelWidth:b,canPopOut:x,isOpen:w,isPoppedOut:E,isCollapsingDetailsPanel:D,isOverviewPanelFullWidth:O,popOutWindow:k,onResize:A,onResizeEnd:ee,onToggleOpen:j,onPopOut:N,onChatPanelResize:te,onChatPanelResizeEnd:ne,onOverviewPanelResize:re,onOverviewPanelResizeEnd:L}=_n(t(()=>g.workflow.name),u,f,s,c),{currentSessionId:R,messages:ie,previousChatMessages:z,sendMessage:ae,refreshSession:oe,displayExecution:B}=wt(n.isReadOnly),{entries:V,execution:se,hasChat:H,latestNodeNameById:ce,resetExecutionData:W,loadSubExecution:G}=ft({isEnabled:w}),{flatLogEntries:K,toggleExpanded:q}=gt(V,G),{selected:J,select:le,selectNext:ue,selectPrev:Y}=un(se,V,K,q),de=l(),X=l(),pe=t(()=>w.value&&J.value!==void 0),Z=t(()=>pe.value&&!D.value),me=t(()=>({isOpen:w.value,isSyncSelectionEnabled:p.isLogSelectionSyncedWithCanvas,showToggleButton:!E.value,showPopOutButton:x.value&&!E.value,onPopOut:N,onToggleOpen:j,onToggleSyncSelection:p.toggleLogSelectionSync})),he=t(()=>de.value?.nodeName===J.value?.node.name?de.value?.columnName??null:null),ge=t(()=>X.value?.nodeName===J.value?.node.name?X.value?.columnName??null:null),_e=t(()=>({j:ue,k:Y,Escape:()=>le(void 0),ArrowDown:ue,ArrowUp:Y,Space:()=>J.value&&q(J.value),Enter:()=>J.value&&ye(J.value),...E.value?{i:()=>p.toggleInputOpen(),o:()=>p.toggleOutputOpen()}:{}}));function ve(){O.value&&le(void 0),L()}function ye(e){m.setActiveNodeName(e.node.name,`logs_view`),a(()=>{let t=e.runData?.source[0],n=t?.previousNodeOutput??0;je.emit(`updateInputNodeName`,t?.previousNode),je.emit(`setInputBranchIndex`,n),m.setOutputRunIndex(e.runIndex)})}function be(e){de.value=e&&J.value?{nodeName:J.value.node.name,columnName:e}:void 0}function xe(e){X.value=e&&J.value?{nodeName:J.value.node.name,columnName:e}:void 0}return(t,a)=>(T(),r(`div`,{ref_key:`popOutContainer`,ref:u,"data-test-id":`logs-panel`},[(T(),h(vn,{key:String(!!o(k)),"key-map":_e.value,container:s.value},null,8,[`key-map`,`container`])),F(`div`,{ref_key:`popOutContent`,ref:f,class:P([t.$style.popOutContent,o(E)?t.$style.poppedOut:``])},[d(o(U),{height:o(E)?void 0:o(v),"supported-directions":[`top`],"is-resizing-enabled":!o(E),class:P(t.$style.resizeWrapper),style:S({height:o(w)&&!o(E)?`${o(v)}px`:`auto`}),onResize:o(A),onResizeend:o(ee)},{default:C(()=>[F(`div`,{ref_key:`container`,ref:s,class:P(t.$style.container),tabindex:`-1`},[o(H)&&(!n.isReadOnly||o(ie).length>0)?(T(),h(o(U),{key:0,"supported-directions":[`right`],"is-resizing-enabled":o(w),width:o(y),style:S({width:`${o(y)}px`}),class:P(t.$style.chat),window:o(k),onResize:o(te),onResizeend:o(ne)},{default:C(()=>[(T(),h(an,{key:`canvas-chat-${o(R)}${o(E)?`-pop-out`:``}`,"data-test-id":`canvas-chat`,"is-open":o(w),"is-read-only":e.isReadOnly,messages:o(ie),"session-id":o(R),"past-chat-messages":o(z),"show-close-button":!1,"is-new-logs-enabled":!0,"is-header-clickable":!o(E),onClose:o(j),onRefreshSession:o(oe),onDisplayExecution:o(B),onSendMessage:o(ae),onClickHeader:o(j)},null,8,[`is-open`,`is-read-only`,`messages`,`session-id`,`past-chat-messages`,`is-header-clickable`,`onClose`,`onRefreshSession`,`onDisplayExecution`,`onSendMessage`,`onClickHeader`]))]),_:1},8,[`is-resizing-enabled`,`width`,`style`,`class`,`window`,`onResize`,`onResizeend`])):i(``,!0),F(`div`,{ref_key:`logsContainer`,ref:c,class:P(t.$style.logsContainer)},[d(o(U),{class:P(t.$style.overviewResizer),width:o(b),style:S({width:Z.value?`${o(b)}px`:``}),"supported-directions":[`right`],"is-resizing-enabled":pe.value,window:o(k),onResize:o(re),onResizeend:ve},{default:C(()=>[d(kt,{class:P(t.$style.logsOverview),"is-open":o(w),"is-read-only":e.isReadOnly,"is-compact":Z.value,selected:o(J),execution:o(se),entries:o(V),"latest-node-info":o(ce),"flat-log-entries":o(K),"is-header-clickable":!o(E),onClickHeader:o(j),onSelect:o(le),onClearExecutionData:o(W),onToggleExpanded:o(q),onOpenNdv:ye},{actions:C(()=>[Z.value?i(``,!0):(T(),h(ln,I(_({key:0},me.value)),null,16))]),_:1},8,[`class`,`is-open`,`is-read-only`,`is-compact`,`selected`,`execution`,`entries`,`latest-node-info`,`flat-log-entries`,`is-header-clickable`,`onClickHeader`,`onSelect`,`onClearExecutionData`,`onToggleExpanded`])]),_:1},8,[`class`,`width`,`style`,`is-resizing-enabled`,`window`,`onResize`]),Z.value&&o(J)?(T(),h(cn,{key:0,class:P(t.$style.logDetails),"is-open":o(w),"log-entry":o(J),window:o(k),"latest-info":o(ce)[o(J).node.id],panels:o(p).detailsState,"collapsing-input-table-column-name":he.value,"collapsing-output-table-column-name":ge.value,"is-header-clickable":!o(E),onClickHeader:o(j),onToggleInputOpen:o(p).toggleInputOpen,onToggleOutputOpen:o(p).toggleOutputOpen,onCollapsingInputTableColumnChanged:be,onCollapsingOutputTableColumnChanged:xe},{actions:C(()=>[Z.value?(T(),h(ln,I(_({key:0},me.value)),null,16)):i(``,!0)]),_:1},8,[`class`,`is-open`,`log-entry`,`window`,`latest-info`,`panels`,`collapsing-input-table-column-name`,`collapsing-output-table-column-name`,`is-header-clickable`,`onClickHeader`,`onToggleInputOpen`,`onToggleOutputOpen`])):i(``,!0)],2)],2)]),_:1},8,[`height`,`is-resizing-enabled`,`class`,`style`,`onResize`,`onResizeend`])],2)],512))}}),[[`__cssModules`,{$style:{popOutContent:`_popOutContent_14az5_125`,resizeWrapper:`_resizeWrapper_14az5_131`,poppedOut:`_poppedOut_14az5_138`,container:`_container_14az5_142`,chat:`_chat_14az5_151`,logsContainer:`_logsContainer_14az5_155`,overviewResizer:`_overviewResizer_14az5_165`,logsOverview:`_logsOverview_14az5_173`,logsDetails:`_logsDetails_14az5_177`}}]]);export{yn as t};
//# sourceMappingURL=LogsPanel-Dlq2t92C.js.map