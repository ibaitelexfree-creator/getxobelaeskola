!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"n8n@2.9.4"}}catch(e){}}(),System.register(["./chunk-legacy-BCpDjeTS.js","./vue.runtime.esm-bundler-legacy-BquwEXRp.js","./_MapCache-legacy-BR_CVmoL.js","./src-legacy-kcwUfEuS.js","./users.store-legacy-B-bVJKl3.js","./constants-legacy-DVkAm8xO.js","./_baseOrderBy-legacy-BnyL5wLN.js","./executions.store-legacy-OEeCPZk_.js","./useCanvasOperations-legacy-CEMGNuuE.js","./retry-legacy-CDSgFS2P.js","./pushConnection.store-legacy-C36NF7Lj.js"],(function(e,t){var n,o,a,i,s,r,c,d,u,l,f,g,w,N,p,y,m,h,v,b,E,k,D,T,x,A,R,S,C,I,M,_,j,W,O,P,B,q,U,L,V,F,G,$,H;function Y(e){if(null===e)return{type:"null"};const t=typeof e;return function(e){return["string","number","boolean"].includes(e)}(t)?{type:t}:Array.isArray(e)?{type:"array",items:(n=e).length>0?Y(n[0]):{}}:e&&"object"===t?function(e){const t={};return Object.entries(e).forEach((([e,n])=>{t[e]=Y(n)})),{type:"object",properties:t}}(e):{type:"string"};var n}function J(e,t,n,o,a){if(e instanceof p)return e.commands.some((n=>J(n,t,e.commands,o,a)));if(e instanceof v)return e.connectionData[1]?.node===t;if(e instanceof x){const[o,a]=e.connectionData;return a.node===t&&n.some((e=>e instanceof g&&e.node.name===o.node))}const i=Object.values(o(t)).flat().flat().filter((e=>null!==e)).map((e=>e.node));return e instanceof m?i.includes(e.node.name):e instanceof f&&i.includes(e.nodeName)&&(e.newState||Object.keys(a(e.nodeName)).some((e=>e!==_.Main)))}function X(e,t,n){const o=t.indexOf(e);if(o>=0)return t.slice(o);const a=[...t,e];for(const[i,s]of Object.entries(n(e)))if(i===_.Main)for(const e of s)for(const{node:t}of e??[]){const e=X(t,a,n);if(e)return e}}function z(){const e=w(),t=E();function n(e){return Object.entries(t.incomingConnectionsByNodeName(e)).filter((([e])=>e!==_.Main)).flatMap((([,e])=>e.flat().filter((e=>null!==e))))}function a(e,o){if((t.getParametersLastUpdate(e)??0)>o)return k.PARAMETERS_UPDATED;for(const t of n(e))if(void 0!==a(t.node,o))return k.UPSTREAM_DIRTY}function i(o,a){for(let n=e.undoStack.length-1;n>=0;n--){const i=e.undoStack[n];if(i.getTimestamp()<a)break;if(J(i,o,[],t.incomingConnectionsByNodeName,t.outgoingConnectionsByNodeName))return k.INCOMING_CONNECTIONS_UPDATED}for(const e of n(o))if(void 0!==i(e.node,a))return k.UPSTREAM_DIRTY}const s=o((()=>{const e={};function n(o,a,i){if(i.has(o))return;const s=new Set(i);s.add(o);for(const[r,c]of Object.entries(t.outgoingConnectionsByNodeName(o)))if(r===_.Main)for(const t of c)for(const{node:o}of t??[])(!e[o]||e[o]>a)&&(e[o]=a),n(o,a+1,s)}for(const o of t.allNodes)Object.keys(t.incomingConnectionsByNodeName(o.name)).length>0||(e[o.name]=0,n(o.name,1,new Set));return e}));return{dirtinessByName:o((()=>{const e={},n=t.getWorkflowRunData??{};function o(n,o){e[n]=e[n]??o;const a=X(n,[],t.incomingConnectionsByNodeName);if(!a)return;const i=[...a].sort(((e,t)=>(s.value[e]??Number.MAX_SAFE_INTEGER)-(s.value[t]??Number.MAX_SAFE_INTEGER)))?.[0];i&&s.value[i]&&(e[i]=e[i]??k.UPSTREAM_DIRTY)}for(const[s,r]of Object.entries(n)){const e=r[0]?.startTime??0;if(!e)continue;const n=a(s,e);if(n){o(s,n);continue}const c=i(s,e);c?o(s,c):(Object.values(t.incomingConnectionsByNodeName(s)).flat().flat().filter((e=>null!==e)).some((n=>(t.getPinnedDataLastUpdate(n.node)??0)>e))||(t.getPinnedDataLastRemovedAt(s)??0)>e)&&o(s,k.PINNED_DATA_UPDATED)}return e}))}}return e({r:z,t:function(e){const t=u(),n=s(),a=A(),i=d(),r=T(),f=D(),g=$(),w=P(),p=L(),m=E(),v=e.workflowState??l(),k=c({workflowState:v}),x=b({router:e.router,workflowState:v}),C=B(),{dirtinessByName:j}=z(),{startChat:W}=q(),O=o((()=>m.workflowObject));function V(e){return[...e].sort(((e,t)=>{const n=m.getNodeByName(e)?.position??[0,0],o=m.getNodeByName(t)?.position??[0,0],a=n[1],i=o[1];return a===i?0:a>i?1:-1}))}async function F(e){if(!p.isConnected)throw new Error(n.baseText("workflowRun.noActiveConnectionToTheServer"));let t;v.setActiveExecutionId(null);try{t=await m.runWorkflow(e)}catch(i){throw v.setActiveExecutionId(void 0),i}const o=m.previousExecutionId!==t.executionId,a=null===m.activeExecutionId;return t.executionId&&o&&a&&v.setActiveExecutionId(t.executionId),!0===t.waitingForWebhook&&(m.executionWaitingForWebhook=!0),t}async function G(e){if(!m.activeExecutionId){a.clearAllStickyNotifications();try{let i=[];void 0!==e.destinationNode&&(i=O.value.getParentNodes(e.destinationNode.nodeName,_.Main,-1));const s=m.getWorkflowRunData;m.isWorkflowSaved[m.workflowId]||await x.saveCurrentWorkflow();const c=await t.getWorkflowDataToSave();if("default"===w.binaryDataMode&&"combined"===c.settings?.binaryMode)return void a.showMessage({title:n.baseText("workflowRun.showError.unsupportedExecutionLogic.title"),message:n.baseText("workflowRun.showError.unsupportedExecutionLogic.description"),type:"error"});const{startNodeNames:d}=Y(i,s,c.pinData,O.value),u=e.destinationNode?m.getNodeByName(e.destinationNode.nodeName)?.type:"";let l,f;if(0===d.length&&0===i.length&&"destinationNode"in e&&void 0!==e.destinationNode?(l=e.destinationNode.nodeName,d.push(e.destinationNode.nodeName)):e.triggerNode&&e.nodeData&&!e.rerunTriggerNode?d.push(...O.value.getChildNodes(e.triggerNode,_.Main,1)):e.destinationNode&&(l=e.destinationNode.nodeName),e.triggerNode&&(f={name:e.triggerNode,data:e.nodeData}),e.destinationNode&&(m.checkIfNodeHasChatParent(e.destinationNode.nodeName)||"@n8n/n8n-nodes-langchain.chatTrigger"===u)&&"RunData.ManualChatMessage"!==e.source){const t=O.value.getStartNode(e.destinationNode.nodeName);if(t&&"@n8n/n8n-nodes-langchain.chatTrigger"===t.type){const n=k.getNodeInputData(t,0,0,"input")?.length>0,o=!!c.pinData?.[t.name];if(!n&&!o)return m.chatPartialExecutionDestinationNode=e.destinationNode.nodeName,void W()}}const p=c.nodes.filter((e=>!e.disabled&&e.type.toLowerCase().includes("trigger"))),h=p.find((e=>e.type===R)),b=h?.parameters?.options;e.triggerNode===h?.name&&"responseNodes"===b?.responseMode&&(c.nodes.filter((e=>!e.disabled&&("@n8n/n8n-nodes-langchain.chat"===e.type||"@n8n/n8n-nodes-langchain.chatTool"===e.type||"@n8n/n8n-nodes-langchain.chatHitlTool"===e.type||"n8n-nodes-base.respondToWebhook"===e.type)))?.length||a.showMessage({title:n.baseText("workflowRun.showWarning.noChatResponseNodes.title"),message:n.baseText("workflowRun.showWarning.noChatResponseNodes.description"),type:"warning"})),!e.destinationNode&&"RunData.ManualChatMessage"!==e.source&&h&&p.filter((e=>"@n8n/n8n-nodes-langchain.chatTrigger"!==e.type)).length&&(h.disabled=!0);const E=void 0!==e.destinationNode,D=V(d).map((e=>{let n=(0,H.default)(s,[e,0,"source",0],null);if(null===n){const o=O.value.getParentNodes(e,_.Main,1);n=(0,H.default)(t.executeData(O.value.connectionsBySourceNode,o,e,_.Main,0),["source",_.Main,0],null)}return{name:e,sourceData:n}})).filter((t=>!e.destinationNode||!m.checkIfNodeHasChatParent(e.destinationNode.nodeName)||t.name!==e.destinationNode.nodeName)),T={workflowData:c,runData:E?s??void 0:void 0,startNodes:D,triggerToStartFrom:f};if("destinationNode"in e){T.destinationNode=e.destinationNode;const t=m.getNodeByName(e.destinationNode?.nodeName??"")?.id;if(O.value.id&&t){const e=g.getAgentRequest(O.value.id,t);e&&(T.agentRequest={query:e.query??{},tool:{name:e.toolName??""}})}}if(T.runData){const e=Object.entries(j.value).flatMap((([e,t])=>t?[e]:[]));T.dirtyNodeNames=e.length>0?e:void 0}const A={id:S,finished:!1,mode:"manual",status:"running",createdAt:new Date,startedAt:new Date,stoppedAt:void 0,workflowId:O.value.id,executedNode:l,triggerNode:f?.name,data:I({resultData:{runData:T.runData??{},pinData:c.pinData}}),workflowData:{id:m.workflowId,name:c.name,active:c.active,createdAt:0,updatedAt:0,...c}};v.setWorkflowExecutionData(A),k.updateNodesExecutionIssues(),N().setDocumentTitle(O.value.name,"EXECUTING");const C=await F(T),M=c.pinData??{},P=e=>{const t=e.parameters.path||e.parameters.options?.path||e.webhookId;return`${w.formTestUrl}/${t}`};try{await y({nodes:c.nodes,runData:m.getWorkflowExecution?.data?.resultData?.runData,destinationNode:e.destinationNode?.nodeName,triggerNode:e.triggerNode,pinData:M,directParentNodes:i,source:e.source,getTestUrl:P})}catch(o){}return await r.run("workflowRun.runWorkflow",{nodeName:e.destinationNode?.nodeName,source:e.source}),C}catch(o){return console.error(o),v.setWorkflowExecutionData(null),N().setDocumentTitle(O.value.name,"ERROR"),void a.showError(o,n.baseText("workflowRun.showError.title"))}}}function Y(e,t,n,o){const a=new Set;let i;if(null!==t&&0!==Object.keys(t).length){i={};for(const s of e){const e=o.getParentNodes(s,_.Main);if(!o.nodes[s].disabled){e.push(s);for(const o of e){if(!t[o]?.length&&!n?.[o]?.length||void 0!==t[o]?.[0]?.error){a.add(o);break}t[o]&&!t[o]?.[0]?.error&&(i[o]=t[o]?.slice(0,1))}}}h(i)&&(i=void 0)}return{runData:i,startNodeNames:[...a]}}return{consolidateRunDataAndStartNodes:Y,runEntireWorkflow:async function(e,n){t.getWorkflowDataToSave().then((n=>{const o={workflow_id:O.value.id,node_graph_string:JSON.stringify(M(n,t.getNodeTypes(),{isCloudDeployment:f.isCloudDeployment}).nodeGraph),button_type:e};i.track("User clicked execute workflow button",o),r.run("nodeView.onRunWorkflow",o)}));let o=n??m.selectedTriggerNodeName;if(!o){const e=Object.values(O.value.nodes).filter((e=>!e.disabled&&e.type.toLowerCase().includes("trigger")));1===e.length&&(o=e[0].name)}G({triggerNode:o})},runWorkflow:G,runWorkflowApi:F,stopCurrentExecution:async function(){const e=m.activeExecutionId;let t;if(e)try{t=await C.stopCurrentExecution(e)}catch(o){const t=await m.getExecution(e);if(void 0===t)a.showMessage({title:n.baseText("nodeView.showMessage.stopExecutionCatch.unsaved.title"),message:n.baseText("nodeView.showMessage.stopExecutionCatch.unsaved.message"),type:"success"});else if(t?.finished){const e={data:t.data,workflowData:m.workflow,finished:t.finished,mode:t.mode,startedAt:t.startedAt,stoppedAt:t.stoppedAt};v.setWorkflowExecutionData(e),a.showMessage({title:n.baseText("nodeView.showMessage.stopExecutionCatch.title"),message:n.baseText("nodeView.showMessage.stopExecutionCatch.message"),type:"success"})}else a.showError(o,n.baseText("nodeView.showError.stopExecution.title"))}finally{await U((async()=>{const n=await m.getExecution(e);return!["running","waiting"].includes(n?.status)&&(v.markExecutionAsStopped(t),!0)}),250,20)||v.markExecutionAsStopped(t)}},stopWaitingForWebhook:async function(){try{await m.removeTestWebhook(m.workflowId)}catch(e){return void a.showError(e,n.baseText("nodeView.showError.stopWaitingForWebhook.title"))}},sortNodesByYPosition:V}}}),{setters:[function(e){n=e.o},function(e){o=e.C,a=e.Pt},function(e){i=e.M,s=e.yt},function(e){r=e.m},function(e){c=e.It,d=e.Lt,u=e.Tt,l=e.Vt,f=e._i,g=e.bi,w=e.fi,N=e.fn,p=e.hi,y=e.m,m=e.mi,h=e.oa,v=e.pi,b=e.pn,E=e.s,k=e.ui,D=e.ws,T=e.xr,x=e.yi,A=e.yr},function(e){R=e.Gt,e.Ht,S=e.N,C=e.Ri,e.Ut,e.Wt,I=e.ea,e.ho,M=e.oa,_=e.so,e.tr,j=e.zi},function(e){W=e.j,O=e.m,P=e.r},function(e){B=e.t},function(e){q=e.t},function(e){U=e.t},function(e){L=e.t}],execute:function(){try{t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},(o=(new t.Error).stack)&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[o]="5ca7a291-8c72-45b0-8381-2b4eb7c430cb",t._sentryDebugIdIdentifier="sentry-dbid-5ca7a291-8c72-45b0-8381-2b4eb7c430cb")}catch(t){}var t,o;V=e=>e.toString().split(".").concat(["0","0"]).slice(0,3).join("."),F=e=>!!e&&"object"==typeof e&&"type"in e&&"properties"in e&&!h(e.properties),G=async(e,t)=>{const{nodeType:n,version:o,resource:a,operation:i}=t,s=V(o),r=await O({method:"GET",baseURL:e,endpoint:`${["schemas",n.replace("@n8n/",""),s,a,i].filter(Boolean).join("/")}.json`,withCredentials:!1});if(!F(r))throw new Error("Invalid JSON schema");return r},e("i",W("schemaPreview",(()=>{const e=a(new Map),t=P(),n=d(),o=E();function i({nodeType:e,version:t,operation:n,resource:o}){return`${e}_${t}_${o?.toString()??"all"}_${n?.toString()??"all"}`}return{getSchemaPreview:async function(n){const o=i(n),a=e.get(o);if(a)return a;try{const a=j(await G(t.baseUrl,n));return e.set(o,a),a}catch(s){const t=C(s);return e.set(o,t),t}},trackSchemaPreviewExecution:async function(t){if(0===e.size||"success"!==t.data.executionStatus)return;const a=o.getNodeByName(t.nodeName);if(!a)return;const{id:s,type:r,typeVersion:c,parameters:{resource:d,operation:u}}=a,l=e.get(i({nodeType:r,version:c,resource:d,operation:u}));var f;l?.ok&&n.track("User executed node with schema preview",{node_id:s,node_type:r,node_version:c,node_resource:d,node_operation:u,schema_preview:JSON.stringify(l.result),output_schema:JSON.stringify((f=t.data.data?.main?.[0]?.[0]?.json,Y(f))),workflow_id:o.workflowId})}}}))),e("n",$=W("agentRequest",(()=>{const e=i("N8N_AGENT_REQUESTS",{});return{agentRequests:e,getAgentRequests:(t,n)=>e.value[t]?.[n]?.query||{},getQueryValue:(t,n,o,a)=>{const i=e.value[t]?.[n]?.query?.[o];return"string"!=typeof i&&a?i?.[a]:i},setAgentRequestForNode:(t,n,o)=>{((t,n)=>{e.value[t]||(e.value[t]={}),e.value[t][n]||(e.value[t][n]={query:{}})})(t,n),e.value[t][n]={...o,query:{...o.query}}},clearAgentRequests:(t,n)=>{e.value[t]&&(e.value[t][n]={query:{}})},clearAllAgentRequests:t=>{t?e.value[t]={}:e.value={}},getAgentRequest:(t,n)=>{if(e.value[t])return e.value[t]?.[n]}}}))),H=n(r(),1)}}}));
//# sourceMappingURL=useRunWorkflow-legacy-4stFR283.js.map