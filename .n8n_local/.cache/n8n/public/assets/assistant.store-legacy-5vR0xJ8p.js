!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"n8n@2.9.4"}}catch(e){}}(),System.register(["./vue.runtime.esm-bundler-legacy-BquwEXRp.js","./_MapCache-legacy-BR_CVmoL.js","./src-legacy-kcwUfEuS.js","./users.store-legacy-B-bVJKl3.js","./constants-legacy-DVkAm8xO.js","./_baseOrderBy-legacy-BnyL5wLN.js"],(function(e,t){var a,s,n,i,o,r,u,l,d,c,v,p,f,y,g,m,h,w,x,k,N,_,b,I,A,S,T,E,D,C,U,P,R,V,q,j,M,F,O;return{setters:[function(e){a=e.C,s=e.Cn,n=e.D,i=e.Gt,o=e.It,r=e.L,u=e.P,l=e._t,d=e.et,c=e.j,v=e.w},function(e){p=e.yt},function(e){f=e.Ci,y=e._t},function(e){g=e.Bt,m=e.Lt,e.Ua,h=e.Wc,w=e.it,x=e.jr,k=e.ot,N=e.r,_=e.rt,b=e.s,I=e.st,A=e.t,S=e.ur,T=e.ws,E=e.xa,D=e.yr,C=e.zr},function(e){U=e.Ha,P=e.ts},function(e){R=e.j,V=e.r,q=e.v}],execute:function(){try{t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},(B=(new t.Error).stack)&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[B]="c64b329b-65a8-4715-ac50-56dad795fd87",t._sentryDebugIdIdentifier="sentry-dbid-c64b329b-65a8-4715-ac50-56dad795fd87")}catch(t){}var t,B;e("n",j=y()),M=["data-action-parameter-node"],F=u({__name:"AiUpdatedCodeMessage",props:{nodeName:{}},setup(e){const t=p();return(a,o)=>(d(),n("div",null,[c(s(i(t).baseText("aiAssistant.codeUpdated.message.body1"))+" ",1),v("a",{"data-action":"openNodeDetail","data-action-parameter-node":e.nodeName},s(e.nodeName),9,M),c(" "+s(i(t).baseText("aiAssistant.codeUpdated.message.body2")),1)]))}}),O=["code-diff","text","block"],e("t",R(h.ASSISTANT,(()=>{const e=T(),s=V(),n=x(),i=o([]),u=A(),d=N(),c=b(),v=f(),y=o(),h=g(),R=p(),M=m(),B=I(),H=o({}),L=o(),$=o(),W=o(),z=o(void 0),G=o(),Y=o(),J=o("not_executed"),K=o(),Q=o(),X=o(!0),Z=o(!0),ee=a((()=>i.value.filter((e=>"assistant"===e.role)))),te=a((()=>i.value.filter((e=>"user"===e.role)))),ae=a((()=>{const e=ee.value[ee.value.length-1],t="event"===e?.type&&"end-session"===e?.eventName;return!(void 0!==W.value)||t})),se=a((()=>e.isAiAssistantEnabled)),ne=a((()=>P.includes(v.name)&&!c.activeNode())),ie=a((()=>i.value.filter((e=>O.includes(e.type)&&"assistant"===e.role&&!e.read)).length)),oe=a((()=>!n.isOpen&&!ne.value&&se.value&&P.includes(v.name))),re=a((()=>S(["rbac"],{rbac:{scope:"aiAssistant:manage"}}))),ue=a((()=>e.settings.ai.allowSendingParameterValues));function le(){i.value=[],W.value=void 0,$.value=void 0,Y.value=void 0,z.value=void 0,H.value={},J.value="not_executed",L.value=void 0,Q.value=void 0,G.value=c.workflowId}function de(e,t){const a=n.isOpen&&"assistant"===n.activeMode,s=[...i.value].filter((e=>!(e.id===t&&"assistant"===e.role)));K.value=void 0,(e??[]).forEach((e=>{"message"===e.type?s.push({id:t,type:"text",role:"assistant",content:e.text,quickReplies:e.quickReplies,codeSnippet:e.codeSnippet,read:a}):"code-diff"===e.type?s.push({id:t,role:"assistant",type:"code-diff",description:e.description,codeDiff:e.codeDiff,suggestionId:e.suggestionId,quickReplies:e.quickReplies,read:a}):"summary"===e.type?s.push({id:t,type:"block",role:"assistant",title:e.title,content:e.content,quickReplies:e.quickReplies,read:a}):"event"===e.type?s.push({id:t,type:"event",role:"assistant",eventName:e.eventName,read:!0}):"agent-suggestion"===e.type?s.push({id:t,type:"block",role:"assistant",title:e.title,content:e.text,quickReplies:e.quickReplies,read:a}):"intermediate-step"===e.type&&(K.value=e.text)})),i.value=s}function ce(e){const t=e.node.name;return"error"===Q.value&&c.activeExecutionId===z.value&&t===$.value?.node.name}function ve(){y.value=!1}function pe(e){K.value=e}function fe(e,t){i.value.push({id:t,role:"user",type:"text",content:e,read:!0})}function ye(e,t,a){q(e instanceof Error),ve(),K.value=void 0,function(e,t,a){i.value.push({id:t,role:"assistant",type:"error",content:e,read:!0,retry:a})}(R.baseText("aiAssistant.serviceError.message",{interpolate:{message:e.message}}),t,a)}function ge(e,t){if(e.sessionId&&!W.value)W.value=e.sessionId,M.track("Assistant session started",{chat_session_id:W.value,task:Q.value,node_type:$.value?.node.type,credential_type:L.value?.name}),1===te.value.length&&"support"===Q.value&&Ne(te.value[0].content,!1);else if(W.value!==e.sessionId)return;de(e.messages,t)}function me(){return`${Math.floor(1e8*Math.random())}`}function he(e){ve(),X.value=!1,Z.value=!1,Y.value=i.value.find((t=>t.id===e&&!t.read&&"assistant"===t.role&&O.includes(t.type))),setTimeout((()=>{Y.value?.id===e&&(Y.value=void 0)}),4e3)}async function we(e){if("error"===Q.value)return{aiUsageSettings:{allowSendingParameterValues:ue.value}};const t=v.name,a=c.activeNode(),s=a?await B.processNodeForAssistant(a,["position","parameters.notice"],{excludeParameterValues:!ue.value}):null,n=d.activeModals.includes("editCredential")?_().getCredentialTypeByName(d.activeCredentialType??""):void 0,i=c.workflowExecutionData?.data?.resultData,o=Boolean(i?.runData?.hasOwnProperty(a?.name??"")),r=i?.error&&"node"in i.error&&i.error.node?.name===a?.name?i.error:void 0,u=o?{status:r?"error":"success",error:r?B.simplifyErrorForAssistant(r):void 0}:void 0;return{aiUsageSettings:{allowSendingParameterValues:ue.value},currentView:{name:t,description:B.getCurrentViewDescription(t)},activeNodeInfo:{node:s??void 0,nodeIssues:o?void 0:a?.issues,executionStatus:u,nodeInputData:e?.nodeInputData,referencedNodes:e?.schemas},activeCredentials:n?{name:n?.name,displayName:n?.displayName,authType:e?.authType?.name}:void 0,currentWorkflow:X.value?await B.simplifyWorkflowForAssistant(c.workflow,{excludeParameterValues:!ue.value}):void 0,executionData:Z.value&&i?B.simplifyResultData(i,{removeParameterValues:!ue.value}):void 0}}async function xe(e,t){le(),Q.value=t?"credentials":"support";const a=c.activeNode(),n=B.getNodeInfoForAssistant(a,{excludeParameterValues:!ue.value}),i="support"===Q.value?await we(n):{aiUsageSettings:{allowSendingParameterValues:ue.value}};n.authType&&"credentials"===Q.value&&(e+=` I am using ${n.authType.name}.`);const o=me();L.value=t,fe(e,o),pe(R.baseText("aiAssistant.thinkingSteps.thinking")),y.value=!0;let r={role:"user",type:"init-support-chat",user:{firstName:u.currentUser?.firstName??""},context:i,question:e};t&&(r={...r,type:"init-cred-help",credentialType:{name:t.name,displayName:t.displayName}}),w(s.restApiContext,{payload:r},(e=>ge(e,o)),(()=>he(o)),(a=>ye(a,o,(async()=>await xe(e,t)))))}async function ke(e,t){if(ae.value||y.value)return;q(W.value);const a=me();pe(R.baseText("aiAssistant.thinkingSteps.thinking")),y.value=!0,w(s.restApiContext,{payload:{role:"user",type:"event",eventName:e,error:t},sessionId:W.value},(e=>ge(e,a)),(()=>he(a)),(s=>ye(s,a,(async()=>await ke(e,t)))))}function Ne(e,t){W.value&&M.track("User sent message in Assistant",{message:e,is_quick_reply:t,chat_session_id:W.value,message_number:te.value.length,task:Q.value,allow_sending_parameter_values:ue.value})}function _e({source:e,task:t,has_existing_session:a}){const n=0===c.allNodes.length?"empty":"existing_workflow";M.track("User opened assistant",{source:e,task:t,has_existing_session:a,instance_id:s.instanceId,workflow_id:c.workflowId,canvas_status:n,node_type:$.value?.node?.type,error:$.value?.error,chat_session_id:W.value})}function be(e,t,a){h.activeNodeName===t?Object.keys(a).forEach((e=>{const s={node:t,name:`parameters.${e}`,value:a[e]};j.emit("updateParameterValue",s)})):e.setNodeParameters({name:t,value:a},!0)}function Ie(e){e!==h.activeNodeName&&D().showMessage({type:"success",title:R.baseText("aiAssistant.codeUpdated.message.title"),message:r(F,{nodeName:e}),duration:4e3})}return l(v,(()=>{const e=c.workflowId;W.value&&G.value&&G.value!==e&&le()})),l((()=>d.stateIsDirty),(()=>{X.value=!0})),l((()=>c.workflowExecutionResultDataLastUpdate),(()=>{Z.value=!0}),{immediate:!0}),{isAssistantEnabled:se,hideAssistantFloatingButton:ne,chatMessages:i,unreadCount:ie,streaming:y,currentSessionId:W,lastUnread:Y,isSessionEnded:ae,isFloatingButtonShown:oe,canManageAISettings:re,onNodeExecution:async function(e){$.value&&e.nodeName===$.value.node.name&&"success"!==J.value&&(e.data.error&&"error"!==J.value?(await ke("node-execution-errored",e.data.error),J.value="error",M.track("User executed node after assistant suggestion",{task:Q.value,chat_session_id:W.value,success:!1})):"success"===e.data.executionStatus&&["error","not_executed"].includes(J.value)&&(await ke("node-execution-succeeded"),J.value="success",M.track("User executed node after assistant suggestion",{task:Q.value,chat_session_id:W.value,success:!0})))},trackUserOpenedAssistant:_e,isNodeErrorActive:ce,initErrorHelper:async function e(t){const a=me();if($.value&&ce(t))return;le(),Q.value="error",$.value=t,G.value=c.workflowId,c.activeExecutionId&&(z.value=c.activeExecutionId);const{authType:n,nodeInputData:i,schemas:o}=B.getNodeInfoForAssistant(t.node,{excludeParameterValues:!ue.value});pe(R.baseText("aiAssistant.thinkingSteps.analyzingError")),y.value=!0;const r={role:"user",type:"init-error-helper",user:{firstName:u.currentUser?.firstName??""},error:t.error,node:await B.processNodeForAssistant(t.node,["position","parameters.notice"],{excludeParameterValues:!ue.value}),nodeInputData:i,executionSchema:o,authType:n,context:{aiUsageSettings:{allowSendingParameterValues:ue.value}}};w(s.restApiContext,{payload:r},(e=>ge(e,a)),(()=>he(a)),(s=>ye(s,a,(async()=>await e(t)))))},initSupportChat:xe,sendMessage:async function e(a){if(ae.value||y.value)return;const n=me(),o=async()=>{i.value=i.value.filter((e=>e.id!==n)),await e(a)};try{fe(a.text,n),pe(R.baseText("aiAssistant.thinkingSteps.thinking")),y.value=!0,q(W.value),"new-suggestion"===a.quickReplyType&&"not_executed"!==J.value&&(J.value="not_executed");const e=c.activeNode(),t=await we(B.getNodeInfoForAssistant(e,{excludeParameterValues:!ue.value}));w(s.restApiContext,{payload:{id:C(),role:"user",type:"message",text:a.text,quickReplyType:a.quickReplyType,context:t},sessionId:W.value},(e=>ge(e,n)),(()=>he(n)),(e=>ye(e,n,o))),Ne(a.text,!!a.quickReplyType)}catch(t){ye(t,n,o)}},applyCodeDiff:async function(e,a){const n=i.value[a];if(!n||"code-diff"!==n.type)throw new Error("No code diff to apply");try{q($.value),q(W.value),n.replacing=!0;const t=n.suggestionId,a=c.workflowObject.getNode($.value.node.name);q(a);const i=H.value[t];if(i)be(e,a.name,i.suggested);else{const{parameters:i}=await k(s.restApiContext,{suggestionId:n.suggestionId,sessionId:W.value});H.value[t]={previous:(o=a.parameters,r=Object.keys(i),r.reduce(((e,t)=>(e[t]=U(o[t]),e)),{})),suggested:i},be(e,a.name,i)}n.replaced=!0,E.emit("codeDiffApplied"),Ie(a.name)}catch(t){console.error(t),n.error=!0}var o,r;n.replacing=!1},undoCodeDiff:async function(e,a){const s=i.value[a];if(!s||"code-diff"!==s.type)throw new Error("No code diff to apply");try{q($.value),q(W.value),s.replacing=!0;const t=s.suggestionId,a=H.value[t];q(a);const n=c.workflowObject.getNode($.value.node.name);q(n);const i=a.previous;be(e,n.name,i),s.replaced=!1,E.emit("codeDiffApplied"),Ie(n.name)}catch(t){console.error(t),s.error=!0}s.replacing=!1},resetAssistantChat:le,addAssistantMessages:de,assistantThinkingMessage:K,chatSessionError:$,chatSessionTask:Q,initCredHelp:async function(e){const t=!!W.value;await xe(`How do I set up the credentials for ${e.displayName}?`,e),_e({source:"credential",task:"credentials",has_existing_session:t})},isCredTypeActive:function(e){return"credentials"===Q.value&&e.name===L.value?.name},handleServiceError:ye}})))}}}));
//# sourceMappingURL=assistant.store-legacy-5vR0xJ8p.js.map