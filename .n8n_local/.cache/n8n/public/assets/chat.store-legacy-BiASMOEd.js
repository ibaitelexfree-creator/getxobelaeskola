!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"n8n@2.9.4"}}catch(e){}}(),System.register(["./vue.runtime.esm-bundler-legacy-BquwEXRp.js","./_MapCache-legacy-BR_CVmoL.js","./users.store-legacy-B-bVJKl3.js","./constants-legacy-DVkAm8xO.js","./_baseOrderBy-legacy-BnyL5wLN.js","./retry-legacy-CDSgFS2P.js","./constants-legacy-CLWGezV2.js","./fileUtils-legacy-pDkwNHwV.js"],(function(e,t){var n,s,a,o,i,r,c,l,d,u,g,m,f,p,v,h,I,y,w,M,b,x,C,T,A,S,O,k,E,D,$,P,_,N,j,H;function L(e,t){const n=new Date(t),s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(s);a.setDate(a.getDate()-1);const o=new Date(s);o.setDate(o.getDate()-7);const i=new Date(n.getFullYear(),n.getMonth(),n.getDate());return i.getTime()===s.getTime()?"Today":i.getTime()===a.getTime()?"Yesterday":i>=o?"This week":"Older"}function W(e){return{provider:e.provider,model:"n8n"===e?.provider||"custom-agent"===e?.provider?null:e?.model??null,workflowId:"n8n"===e?.provider?e.workflowId:null,agentId:"custom-agent"===e?.provider?e.agentId:null}}function U(e){if(null===e.provider)return null;switch(e.provider){case"custom-agent":return e.agentId?{provider:"custom-agent",agentId:e.agentId}:null;case"n8n":return e.workflowId?{provider:"n8n",workflowId:e.workflowId}:null;default:return null===e.model?null:{provider:e.provider,model:e.model}}}function R(e,t,n){return{id:t,sessionId:e,type:"ai",name:"AI",content:[],executionId:n?.executionId??null,status:"running",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),previousMessageId:n?.previousMessageId??null,retryOfMessageId:n?.retryOfMessageId??null,revisionOfMessageId:null,responses:[],alternatives:[],attachments:[],...n?.agent?W(n.agent.model):{provider:null,model:null,workflowId:null,agentId:null}}}function B(e){return"n8n"!==e&&"custom-agent"!==e}function F({enabled:e=!0,allowedModels:t},n){return e&&(0===t.length||t.some((e=>"model"in n&&e.model===n.model)))}function q(e,t){return{model:e,name:t?.name||"",description:null,icon:t?.icon??null,createdAt:null,updatedAt:null,metadata:{inputModalities:["text","file"],capabilities:{functionCalling:"n8n"!==e.provider},available:!0},groupName:null,groupIcon:null}}function G(e,t){const n=[...e];let s=t;if(n.length>0){const e=n[n.length-1];"hidden"===e.type?(s=e.content+t,n.pop()):"artifact-create"!==e.type&&"artifact-edit"!==e.type||!e.isIncomplete||(s=e.content+t,n.pop())}const a=function(e){if(!e.startsWith("{"))return null;try{const t=JSON.parse(e),n=u.safeParse(t);if(n.success)return{type:"with-buttons",content:n.data.text,buttons:n.data.buttons,blockUserInput:n.data.blockUserInput}}catch{}return null}(s);if(a)return n.push(a),n;let o=0;const i=/<command:artifact-create>/g,r=/<command:artifact-edit>/g;for(;o<s.length;){i.lastIndex=o,r.lastIndex=o;const e=i.exec(s),t=r.exec(s);let a=null,c=null;if(e&&t?e.index<t.index?(a=e,c="create"):(a=t,c="edit"):e?(a=e,c="create"):t&&(a=t,c="edit"),!a||!c){const e=s.slice(o);if(e){const{text:t,hiddenPrefix:s}=Y(e);t&&Z(n,t),s&&n.push({type:"hidden",content:s})}break}a.index>o&&Z(n,s.slice(o,a.index));const l=a.index,d=s.slice(l);if("create"===c){const e=z(d);n.push(e.item),o=l+e.consumed}else{const e=J(d);n.push(e.item),o=l+e.consumed}}return n}function Z(e,t){if(""!==t){if(e.length>0){const n=e[e.length-1];if("text"===n.type)return void(e[e.length-1]={type:"text",content:n.content+t})}e.push({type:"text",content:t})}}function Y(e){const t=["<command:artifact-create>","<command:artifact-edit>"];for(let n=1;n<=Math.min(e.length,30);n++){const s=e.slice(-n);for(const a of t)if(a.startsWith(s))return{text:e.slice(0,-n),hiddenPrefix:s}}return{text:e,hiddenPrefix:""}}function z(e){const t=e.indexOf("</command:artifact-create>"),n=-1===t,s=n?e:e.slice(0,t+26);return{item:{type:"artifact-create",content:s,command:{title:K(s,"title")??"",type:K(s,"type")??"",content:K(s,"content")??""},isIncomplete:n},consumed:s.length}}function J(e){const t=e.indexOf("</command:artifact-edit>"),n=-1===t,s=n?e:e.slice(0,t+24);return{item:{type:"artifact-edit",content:s,command:{title:K(s,"title")??"",oldString:K(s,"oldString")??"",newString:K(s,"newString")??"",replaceAll:"true"===(K(s,"replaceAll")??"false").toLowerCase()},isIncomplete:n},consumed:s.length}}function K(e,t){const n=`<${t}>`,s=`</${t}>`,a=e.indexOf(n);if(-1===a)return null;const o=a+n.length,i=e.indexOf(s,o);if(-1===i){let t=e.slice(o);for(let e=1;e<s.length;e++){const n=s.slice(0,e);if(t.endsWith(n)){t=t.slice(0,-e);break}}return t.length>0?t:null}return e.slice(o,i)}return e({S:function(e,t,n,s){return`${e.baseUrl}/chat/conversations/${t}/messages/${n}/attachments/${s}`},a:function(e,t){let n=e;if(t.search.trim()){const e=t.search.toLowerCase();n=n.filter((t=>t.name.toLowerCase().includes(e)))}return n=[...n].sort(((e,n)=>{const s=e[t.sortBy],a=n[t.sortBy],o=s?Date.parse(s):void 0,i=a?Date.parse(a):void 0;return o&&i?i-o:o&&!i?-1:!o&&i?1:0})),n},b:U,c:function(e){const[t,n]=e.split("::"),s=l.safeParse(t).data;if(s)return"n8n"===s?{provider:"n8n",workflowId:n}:"custom-agent"===s?{provider:"custom-agent",agentId:n}:{provider:s,model:n}},d:F,g:function(e){return!(!e||"waiting"!==e.status)&&e.content.some((e=>"with-buttons"===e.type&&e.blockUserInput))},i:function(e){if(e.includes("file"))return"*/*";const t=["text/*"];for(const n of e)"image"===n&&t.push("image/*"),"audio"===n&&t.push("audio/*"),"video"===n&&t.push("video/*");return t.join(",")},l:function(e){return"n8n"===e.provider?{name:I,query:{workflowId:e.workflowId}}:"custom-agent"===e.provider?{name:I,query:{agentId:e.agentId}}:{name:I,query:{provider:e.provider,model:e.model}}},m:function(e){return B(e?.provider)},n:function(e){const t=[];for(const n of e)if("artifact-create"===n.type){if(!n.command.title)continue;t.push({title:n.command.title,type:n.command.type,content:n.command.content})}else if("artifact-edit"===n.type){const e=t.find((e=>e.title===n.command.title));e&&(n.command.replaceAll?e.content=e.content.split(n.command.oldString).join(n.command.newString):e.content=e.content.replace(n.command.oldString,n.command.newString))}return t},o:function(e,t){for(const n of l.options){let s,a=-1/0;const o=B(n)?t[n]:void 0,i=e[n].models.filter((e=>!o||F(o,e.model)));for(const e of i){const t=e.metadata.priority??0;t>a&&(a=t,s=e)}if(s)return s}},p:B,r:q,s:W,u:function(e){const t=new Date,n=new Map;for(const s of e){const e=L(t,s.lastMessageAt??s.updatedAt);n.has(e)||n.set(e,[]),n.get(e).push(s)}return["Today","Yesterday","This week","Older"].flatMap((e=>{const t=n.get(e)??[];return t.length>0?[{group:e,sessions:t.sort(((e,t)=>Date.parse(t.lastMessageAt??t.updatedAt)-Date.parse(e.lastMessageAt??e.updatedAt)))}]:[]}))},v:function(e){if(!e)return[];const t=[];let n="",s={type:"normal"};const a=e.split("\n"),o=()=>{n.trim()&&(t.push(n.trimEnd()),n="")};for(let i=0;i<a.length;i++){const e=a[i],t=i<a.length-1?a[i+1]:"",r=e.trim(),c=/^( {4}|\t)/.test(e),l=/^( {0,3})(`{3,}|~{3,})/.test(e);if("backtick-fence"===s.type){if(l&&r.startsWith("```")){const t=r.match(/^(`+)/);if((t?t[1].length:0)>=s.count){n+=e+"\n",s={type:"normal"},o();continue}}}else if("tilde-fence"===s.type){if(l&&r.startsWith("~~~")){const t=r.match(/^(~+)/);if((t?t[1].length:0)>=s.count){n+=e+"\n",s={type:"normal"},o();continue}}}else if("indented"===s.type)c||""===r||(s={type:"normal"},o());else if(l&&r.startsWith("```")){const e=r.match(/^(`+)/);s={type:"backtick-fence",count:e?e[1].length:0}}else if(l&&r.startsWith("~~~")){const e=r.match(/^(~+)/);s={type:"tilde-fence",count:e?e[1].length:0}}else c&&""!==r&&(o(),s={type:"indented"});if(n+=e+"\n","normal"===s.type){const e=""===r,n=""===t.trim(),s=t.trim().startsWith("#");(e&&n||e&&s)&&o()}}return o(),t},y:function(e){return`${e.provider}::${"custom-agent"===e.provider?e.agentId:"n8n"===e.provider?e.workflowId:e.model}`}}),{setters:[function(e){n=e.C,s=e.It},function(e){a=e.yt},function(e){o=e.Lt,i=e.yr,r=e.zr},function(e){c=e.Ha,l=e.di,d=e.fi,u=e.ui},function(e){g=e.a,m=e.c,f=e.d,p=e.j,v=e.r},function(e){h=e.t},function(e){I=e.l,e.s},function(e){y=e.t}],execute:function(){try{t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},(l=(new t.Error).stack)&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[l]="e0df17c3-b315-49d0-88dd-2a01b9b2393f",t._sentryDebugIdIdentifier="sentry-dbid-e0df17c3-b315-49d0-88dd-2a01b9b2393f")}catch(t){}var t,l;e("C",w=async(e,t)=>await f(e,"POST","/chat/models",t)),M=async(e,t,n)=>{await f(e,"POST",`/chat/conversations/${t}/messages/${n}/stop`)},b=async(e,t,n)=>{const s=new URLSearchParams;return s.append("limit",t.toString()),n&&s.append("cursor",n),await f(e,"GET",`/chat/conversations?${s.toString()}`)},x=async(e,t,n)=>await f(e,"PATCH",`/chat/conversations/${t}`,n),C=async(e,t,n)=>await x(e,t,{title:n}),T=async(e,t)=>{await f(e,"DELETE",`/chat/conversations/${t}`)},A=async(e,t)=>await f(e,"GET",`/chat/conversations/${t}`),S=async(e,t)=>await f(e,"GET",`/chat/agents/${t}`),O=async(e,t)=>await f(e,"POST","/chat/agents",t),k=async(e,t,n)=>await f(e,"POST",`/chat/agents/${t}`,n),E=async(e,t)=>{await f(e,"DELETE",`/chat/agents/${t}`)},D=async e=>(await f(e,"GET","/chat/settings")).providers,$=async(e,t)=>(await f(e,"GET","/chat/settings/"+t)).settings,P=async(e,t)=>await f(e,"POST","/chat/settings",{payload:t}),_=async e=>await f(e,"GET","/chat/tools"),N=async(e,t)=>await f(e,"POST","/chat/tools",{definition:t}),j=async(e,t,n)=>await f(e,"PATCH",`/chat/tools/${t}`,n),H=async(e,t)=>{await f(e,"DELETE",`/chat/tools/${t}`)},e("_",{type:"icon",value:"message-square"}),e("x",{type:"icon",value:"bot"}),e("f",(e=>"success"===e.status&&"ai"!==e.type)),e("h",(e=>"ai"===e.type)),e("t",p(g.CHAT_HUB,(()=>{const e=v(),l=i(),u=o(),g=a(),p=s(null);let I=null;const L=s({}),B=s({byId:{},ids:null,hasMore:!1,nextCursor:null}),F=s(!1),Z=s(),Y=s(!1),z=s(null),J=s([]),K=s(!1),Q=s(new Map),V=e=>Q.value.get(e);function X(e){Q.value.has(e)||Q.value.set(e,{messages:{},activeMessageChain:[]});const t=Q.value.get(e);if(!t)throw new Error(`Conversation for session ID ${e} not found`);return t}function ee(e){const t=V(e);if(!t||0===t.activeMessageChain.length)return null;const n=t.activeMessageChain[t.activeMessageChain.length-1];return t.messages[n]??null}function te(e,t){const n=[];if(!t)return n;let s=t;for(;;){const t=e[s].responses;if(0===t.length)break;s=t[t.length-1]}let a=s;const o=new Set;for(;a&&!o.has(a);)n.unshift(a),o.add(a),a=e[a]?.previousMessageId??null;return n}function ne(e){const t={};for(const s of e)t[s.id]={...s,responses:[],alternatives:[]};for(const s of Object.values(t))s.previousMessageId&&t[s.previousMessageId]&&t[s.previousMessageId].responses.push(s.id),s.retryOfMessageId&&t[s.retryOfMessageId]&&t[s.retryOfMessageId].alternatives.push(s.id),s.revisionOfMessageId&&t[s.revisionOfMessageId]&&t[s.revisionOfMessageId].alternatives.push(s.id);const n=(e,n)=>{const s=t[e],a=t[n];return s.createdAt!==a.createdAt?s.createdAt<a.createdAt?-1:1:s.id<a.id?-1:1};for(const s of Object.values(t)){if(s.alternatives.includes(s.id)||s.alternatives.push(s.id),s.retryOfMessageId&&t[s.retryOfMessageId]){s.alternatives.push(s.retryOfMessageId);for(const e of t[s.retryOfMessageId].alternatives)e===s.id||s.alternatives.includes(e)||s.alternatives.push(e)}if(s.revisionOfMessageId&&t[s.revisionOfMessageId]){s.alternatives.push(s.revisionOfMessageId);for(const e of t[s.revisionOfMessageId].alternatives)e===s.id||s.alternatives.includes(e)||s.alternatives.push(e)}s.responses.sort(n),s.alternatives.sort(n)}return t}function se(e,t){const n=X(e);return n.messages[t.id]=t,n.messages=ne(Object.values(n.messages)),n.activeMessageChain=te(n.messages,t.id),t}function ae(e,t,n){const s=X(e).messages[t];if(!s)throw new Error(`Message with ID ${t} not found in session ${e}`);s.content=G(s.content,n)}function oe(e,t,n,s){const a=X(e).messages[t];if(!a)throw new Error(`Message with ID ${t} not found in session ${e}`);a.status=n,s&&(a.content=s),a.updatedAt=(new Date).toISOString()}async function ie(t,n={}){return I??=w(e.restApiContext,{credentials:t}).finally((()=>{I=null})),[p.value]=await Promise.all([I,new Promise((e=>setTimeout(e,n.minLoadingTime??0)))]),p.value}async function re(t,n={}){if(!F.value&&(t||!B.value||B.value.hasMore||!((B.value.ids??[]).length>0))){t||(F.value=!0);try{const s=t?void 0:B.value?.nextCursor??void 0,[a]=await Promise.all([b(e.restApiContext,18,s),new Promise((e=>setTimeout(e,n.minLoadingTime??0)))]);(t||null===B.value.ids)&&(B.value.ids=[]),B.value.hasMore=a.hasMore,B.value.nextCursor=a.nextCursor;for(const e of a.data){B.value.ids.push(e.id);const t=B.value.byId[e.id];B.value.byId[e.id]={...e,toolIds:t?.toolIds??e.toolIds}}}finally{F.value=!1}}}async function ce(n){const s=B.value.byId[n];s&&"New Chat"!==s.title||await h((async()=>{try{return"New Chat"!==(await A(e.restApiContext,n)).session.title}catch(t){return!1}}),2e3,10),await re(!0)}function le(e,t){const n=X(e).messages[t];return n||se(e,R(e,t,Z.value))}async function de(e){if(!Z.value)return;const t=e instanceof m?new Error(function(e,t){const n={413:g.baseText("chatHub.error.payloadTooLarge"),400:t??g.baseText("chatHub.error.badRequest"),403:g.baseText("chatHub.error.forbidden"),500:t?g.baseText("chatHub.error.serverErrorWithReason",{interpolate:{error:t}}):g.baseText("chatHub.error.serverError")};return e&&n[e]||t||g.baseText("chatHub.error.unknown")}(e.httpStatusCode,e.message)):e instanceof Error&&e.message.includes("Failed to fetch")?new Error(g.baseText("chatHub.error.noConnection")):e;l.showError(t,g.baseText("chatHub.error.sendMessageFailed"));const{sessionId:n}=Z.value;Z.value=void 0,await ce(n)}function ue(e,t){const n=B.value.byId[e];n&&(B.value.byId[e]={...n,...t})}function ge(e,t){const n=p.value?.[e.provider]?.models.find((t=>function(e,t){return"n8n"===t.provider?"n8n"===e.model.provider&&e.model.workflowId===t.workflowId:"custom-agent"===t.provider?"custom-agent"===e.model.provider&&e.model.agentId===t.agentId:e.model.provider===t.provider&&e.model.model===t.model}(t,e)));return n||q(e,t)}return{agents:n((()=>p.value??d)),agentsReady:n((()=>null!==p.value)),customAgents:L,getAgent:ge,fetchAgents:ie,getCustomAgent:function(e){return p.value?.["custom-agent"].models.find((t=>"agentId"in t&&t.agentId===e))},fetchCustomAgent:async function(t){const n=await S(e.restApiContext,t);L.value[t]=n},createCustomAgent:async function(t,n){const s=await O(e.restApiContext,t),a=p.value?.[s.provider]?.models.find((e=>e.name===s.model)),o={model:{provider:"custom-agent",agentId:s.id},name:s.name,description:s.description??null,icon:s.icon,createdAt:s.createdAt,updatedAt:s.updatedAt,metadata:a?.metadata??{capabilities:{functionCalling:!1},inputModalities:[],available:!0},groupName:null,groupIcon:null};return p.value?.["custom-agent"].models.push(o),L.value[s.id]=s,await ie(n),u.track("User created agent",{...W(t)}),o},updateCustomAgent:async function(t,n,s){const a=await k(e.restApiContext,t,n);return p.value?.["custom-agent"]&&(p.value["custom-agent"].models=p.value["custom-agent"].models.map((e=>"agentId"in e&&e.agentId===t?{...e,name:a.name}:e))),L.value[t]=a,await ie(s),a},deleteCustomAgent:async function(t,n){await E(e.restApiContext,t),p.value?.["custom-agent"]&&(p.value["custom-agent"].models=p.value["custom-agent"].models.filter((e=>!("agentId"in e)||e.agentId!==t))),delete L.value[t],await ie(n)},configuredTools:J,configuredToolsLoaded:K,fetchConfiguredTools:async function(){const t=await _(e.restApiContext);return J.value=t,K.value=!0,t},addConfiguredTool:async function(t){const n=await N(e.restApiContext,t);return J.value=[...J.value,n],n},updateConfiguredTool:async function(t,n){const s=await j(e.restApiContext,t,{definition:n});return J.value=J.value.map((e=>e.definition.id===t?s:e)),s},toggleToolEnabled:async function(t,n){const s=await j(e.restApiContext,t,{enabled:n});return J.value=J.value.map((e=>e.definition.id===t?s:e)),s},removeConfiguredTool:async function(t){await H(e.restApiContext,t),J.value=J.value.filter((e=>e.definition.id!==t))},sessions:B,sessionsReady:n((()=>null!==B.value.ids)),sessionsLoading:n((()=>F.value)),fetchSessions:re,fetchMoreSessions:async function(e={}){B.value?.hasMore&&!F.value&&await re(!1,e)},renameSession:async function(t,n){ue(t,(await C(e.restApiContext,t,n)).session)},updateSessionModel:async function(t,n,s){ue(t,(await x(e.restApiContext,t,{agent:{model:n,name:s}})).session)},deleteSession:async function(t){await T(e.restApiContext,t),delete B.value.byId[t],B.value.ids=B.value.ids?.filter((e=>e!==t))??null},toggleSessionTool:async function(t,n){const s=B.value?.byId[t];if(!s)throw new Error(`Session with ID ${t} not found`);const a=s.toolIds??[],o=a.includes(n)?a.filter((e=>e!==n)):[...a,n];ue(t,(await x(e.restApiContext,t,{toolIds:o})).session)},toggleCustomAgentTool:async function(t,n){const s=L.value[t];if(!s)throw new Error(`Custom agent with ID ${t} not found`);const a=s.toolIds??[],o=a.includes(n)?a.filter((e=>e!==n)):[...a,n];L.value[t]={...s,toolIds:o},await k(e.restApiContext,t,{toolIds:o})},conversationsBySession:Q,getConversation:V,fetchMessages:async function(t){const{conversation:n,session:s}=await A(e.restApiContext,t),a=ne(Object.values(n.messages)),o=te(a,Object.values(a).sort(((e,t)=>e.createdAt<t.createdAt?-1:1)).pop()?.id??null);Q.value.set(t,{messages:a,activeMessageChain:o}),B.value.byId[t]=s},getActiveMessages:e=>{const t=V(e);return t?function(e,t,n){const s=[];let a=!1;for(let o=0;o<t.activeMessageChain.length;o++){const i=t.activeMessageChain[o],r=t.messages[i];r&&(a=a||"running"===r.status,a||n?.sessionId!==e||"ai"!==r.type?s.push(r):n.retryOfMessageId!==i||n.messageId?n.messageId&&o===t.activeMessageChain.length-1?(s.push({...r,status:"running"}),a=!0):s.push(r):(s.push({...r,content:[],status:"running",...W(n.agent.model)}),a=!0))}return s}(e,t,Z.value):[]},switchAlternative:function(e,t){const n=V(e);if(!n?.messages[t])throw new Error(`Message with ID ${t} not found in session ${e}`);n.activeMessageChain=te(n.messages,t)},lastMessage:ee,streaming:Z,isResponding:function(e){return Z.value?.sessionId===e},sendMessage:async function(t,n,s,a,o=[]){const i=r(),c=X(t),l=c.activeMessageChain.length?c.activeMessageChain[c.activeMessageChain.length-1]:null,d=(await Promise.all(o.map(y))).map((e=>({fileName:e.fileName??"unnamed file",mimeType:e.mimeType,data:e.data})));Z.value={promptPreviousMessageId:l,promptId:i,promptText:n,sessionId:t,retryOfMessageId:null,revisionOfMessageId:null,attachments:d,agent:s},u.track("User sent chat hub message",{...W(s.model),is_custom:"custom-agent"===s.model.provider,chat_session_id:t});const g={model:s.model,messageId:i,sessionId:t,message:n,credentials:a,previousMessageId:l,attachments:d,agentName:s.name,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};try{B.value.byId[t]||(B.value.byId[t]=function(e,t){return{id:e.sessionId,title:"New Chat",ownerId:"",lastMessageAt:(new Date).toISOString(),credentialId:null,agentName:e.agent.name,agentIcon:e.agent.icon,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),toolIds:t,...W(e.agent.model)}}(Z.value,J.value.filter((e=>e.enabled)).map((e=>e.definition.id))),B.value.ids??=[],B.value.ids.unshift(t)),await async function(e,t){return await f(e,"POST","/chat/conversations/send",t)}(e.restApiContext,g)}catch(m){await de(m)}},editMessage:async function(t,n,s,a,o,i=[],c=[]){const l=r(),d=X(t).messages[n],g=d?.previousMessageId??null,m=await Promise.all(c.map(y)),p={model:a.model,messageId:l,message:s,credentials:o,newAttachments:m.map((e=>({fileName:e.fileName??"unnamed file",mimeType:e.mimeType,data:e.data}))),keepAttachmentIndices:i,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};"ai"===d?.type&&function(e,t,n){const s=X(e).messages[t];if(!s)throw new Error(`Message with ID ${t} not found in session ${e}`);s.content=[{type:"text",content:n}]}(t,n,s),Z.value={promptPreviousMessageId:g,promptId:l,promptText:s,sessionId:t,agent:a,retryOfMessageId:null,revisionOfMessageId:n,attachments:[...i.flatMap((e=>{const t=d?.attachments[e];return t?[{fileName:t.fileName??"unnamed file",mimeType:t.mimeType??"application/octet-stream",data:""}]:[]})),...m]},u.track("User edited chat hub message",{...W(a.model),is_custom:"custom-agent"===a.model.provider,chat_session_id:t,chat_message_id:n});try{await async function(e,t){return await f(e,"POST",`/chat/conversations/${t.sessionId}/messages/${t.editId}/edit`,t.payload)}(e.restApiContext,{sessionId:t,editId:n,payload:p})}catch(v){await de(v)}},regenerateMessage:async function(t,n,s,a){const o=X(t).messages[n]?.previousMessageId??null,i={model:s.model,credentials:a,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};if(!o)throw new Error("No previous message to base regeneration on");Z.value={promptPreviousMessageId:o,promptId:n,promptText:"",sessionId:t,agent:s,retryOfMessageId:n,revisionOfMessageId:null,attachments:[]},u.track("User regenerated chat hub message",{...W(s.model),is_custom:"custom-agent"===s.model.provider,chat_session_id:t,chat_message_id:n});try{await async function(e,t){return await f(e,"POST",`/chat/conversations/${t.sessionId}/messages/${t.retryId}/regenerate`,t.payload)}(e.restApiContext,{sessionId:t,retryId:n,payload:i})}catch(r){await de(r)}},stopStreamingMessage:async function(t){const n=ee(t);n&&"running"===n.status&&(oe(t,n.id,"cancelled"),await M(e.restApiContext,t,n.id),Z.value?.sessionId===t&&(Z.value=void 0,await ce(t)))},settings:z,settingsLoading:Y,fetchAllChatSettings:async function(){try{Y.value=!0,z.value=await D(e.restApiContext)}finally{Y.value=!1}return z.value},fetchProviderSettings:async function(t){const n=await $(e.restApiContext,t);return z.value&&(z.value[t]=c(n)),n},updateProviderSettings:async function(t){t.enabled||(t.allowedModels=[]);const n=await P(e.restApiContext,t);return z.value&&(z.value[t.provider]=c(n)),n},handleWebSocketExecutionBegin:function(e){const{sessionId:t}=e;if(Z.value?.sessionId===t)return;const n=B.value.byId[t];if(!n)return;const s=U(n);s&&(Z.value={promptPreviousMessageId:null,promptId:"",promptText:"",sessionId:t,retryOfMessageId:null,revisionOfMessageId:null,attachments:[],agent:ge(s,{name:n.agentName,icon:n.agentIcon})})},handleWebSocketExecutionEnd:function(e){const{sessionId:t,status:n}=e;if(Z.value?.sessionId===t){const e=Z.value.sessionId;if(Z.value.messageId){const e=V(t)?.messages[Z.value.messageId];e&&"running"===e.status&&oe(t,Z.value.messageId,n)}Z.value=void 0,"error"===n&&l.showError(new Error("Execution failed"),g.baseText("chatHub.error.unknown")),ce(e)}},handleWebSocketStreamBegin:function(e){const{sessionId:t,messageId:n,previousMessageId:s,retryOfMessageId:a}=e;Z.value?.sessionId===t&&(Z.value.messageId=n,Z.value.promptPreviousMessageId=s,Z.value.retryOfMessageId=a);const o=V(t);if(o?.messages[n])return;s&&"waiting"===o?.messages[s]?.status&&oe(t,s,"success");const i=R(t,n,Z.value?.sessionId===t?Z.value:void 0);i.previousMessageId=s,i.retryOfMessageId=a,se(t,i)},handleWebSocketStreamChunk:function(e){const{sessionId:t,messageId:n,content:s}=e;V(t)?.messages[n]||le(t,n),ae(t,n,s)},handleWebSocketStreamEnd:function(e){const{sessionId:t,messageId:n,status:s}=e;oe(t,n,s)},handleWebSocketStreamError:function(e){const{sessionId:t,messageId:n,error:s}=e,a=le(t,n);a.content?a.content=G(a.content,"\n\n"+s):a.content=[{type:"text",content:s}],a.status="error",oe(t,n,"error",a.content)},handleHumanMessageCreated:function(e){const t=Q.value.get(e.sessionId);if(!t)return;if(t.messages[e.messageId])return;const n={id:e.messageId,sessionId:e.sessionId,type:"human",name:"User",content:[{type:"text",content:e.content}],previousMessageId:e.previousMessageId,retryOfMessageId:null,revisionOfMessageId:null,status:"success",attachments:e.attachments.map((e=>({fileName:e.fileName,mimeType:e.mimeType}))),provider:null,model:null,workflowId:null,agentId:null,executionId:null,createdAt:new Date(e.timestamp).toISOString(),updatedAt:new Date(e.timestamp).toISOString(),responses:[],alternatives:[]};se(e.sessionId,n)},handleMessageEdited:function(e){const t=Q.value.get(e.sessionId);if(!t)return;if(t.messages[e.messageId])return;const n=t.messages[e.revisionOfMessageId],s={id:e.messageId,sessionId:e.sessionId,type:"human",name:n?.name??"User",content:[{type:"text",content:e.content}],previousMessageId:n?.previousMessageId??null,retryOfMessageId:null,revisionOfMessageId:e.revisionOfMessageId,status:"success",attachments:e.attachments.map((e=>({fileName:e.fileName,mimeType:e.mimeType}))),provider:n?.provider??null,model:n?.model??null,workflowId:n?.workflowId??null,agentId:n?.agentId??null,executionId:null,createdAt:new Date(e.timestamp).toISOString(),updatedAt:new Date(e.timestamp).toISOString(),responses:[],alternatives:[]};se(e.sessionId,s)},reconnectToStream:async function(t,n){try{const s=await async function(e,t,n){return await f(e,"POST",`/chat/conversations/${t}/reconnect${void 0!==n?`?lastSequence=${n}`:""}`,{})}(e.restApiContext,t,n);if(s.pendingChunks&&s.pendingChunks.length>0)for(const e of s.pendingChunks)s.currentMessageId&&ae(t,s.currentMessageId,e.content);return s}catch(s){return null}}}})))}}}));
//# sourceMappingURL=chat.store-legacy-BiASMOEd.js.map