(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`90fb4e01-1eae-4f45-933a-0d28f0575ccb`,e._sentryDebugIdIdentifier=`sentry-dbid-90fb4e01-1eae-4f45-933a-0d28f0575ccb`)})()}catch{}import{C as e,Cn as t,D as n,E as r,Gt as i,It as a,M as o,P as ee,Pt as s,T as c,Z as l,_t as te,bt as u,et as d,j as f,vn as p,w as m}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{bt as h,yt as ne}from"./_MapCache-DjbOQyB7.js";import{Bi as g,Hi as _,Oi as v,Pi as y,U as b,at as x,mt as S,st as re,zi as C}from"./src-CppJvwzX.js";import{t as w}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{Cr as T,Tr as E,fn as D,wr as O,yr as k}from"./users.store-pCkD7Zo0.js";import{Ss as A}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import"./versions.store-1_eor2Ku.js";import{t as j}from"./usePageRedirectionHelper-BoF8hzbN.js";import"./useClipboard-Duc7LjuO.js";import{t as M}from"./CopyInput-DChEtJl3.js";var N={key:0,"data-test-id":`source-control-content-licensed`},P=[`href`],F={for:`connectionType`},I={for:`repoUrl`},L={for:`httpsUsername`},R={for:`httpsPassword`},z=[`href`],B={key:5,"data-test-id":`source-control-connected-content`},V=[`href`],H=w(ee({__name:`SettingsSourceControl`,setup(ee){let w=ne(),A=O(),H=j(),U=k(),W=E(),G=D(),K=T(),q=a(!1),J=a(`ssh`),Y=a(``),X=a(``),ie=e(()=>A.preferences.branches.map(e=>({value:e,label:e}))),ae=[{value:`ssh`,label:`SSH`},{value:`https`,label:`HTTPS`}],oe=async()=>{K.startLoading(),K.setLoadingText(w.baseText(`settings.sourceControl.loading.connecting`));try{let e={repositoryUrl:A.preferences.repositoryUrl,connectionType:J.value};J.value===`https`&&(e.httpsUsername=Y.value,e.httpsPassword=X.value),await A.savePreferences(e),await A.getBranches(),q.value=!0,U.showMessage({title:w.baseText(`settings.sourceControl.toast.connected.title`),message:w.baseText(`settings.sourceControl.toast.connected.message`),type:`success`})}catch(e){U.showError(e,w.baseText(`settings.sourceControl.toast.connected.error`))}K.stopLoading()},se=async()=>{try{await W.confirm(w.baseText(`settings.sourceControl.modals.disconnect.message`),w.baseText(`settings.sourceControl.modals.disconnect.title`),{confirmButtonText:w.baseText(`settings.sourceControl.modals.disconnect.confirm`),cancelButtonText:w.baseText(`settings.sourceControl.modals.disconnect.cancel`)})===`confirm`&&(K.startLoading(),await A.disconnect(!0),q.value=!1,Y.value=``,X.value=``,U.showMessage({title:w.baseText(`settings.sourceControl.toast.disconnected.title`),message:w.baseText(`settings.sourceControl.toast.disconnected.message`),type:`success`}))}catch(e){U.showError(e,w.baseText(`settings.sourceControl.toast.disconnected.error`))}K.stopLoading()},ce=async()=>{K.startLoading();try{await A.updatePreferences({branchName:A.preferences.branchName,branchReadOnly:A.preferences.branchReadOnly,branchColor:A.preferences.branchColor}),U.showMessage({title:w.baseText(`settings.sourceControl.saved.title`),type:`success`})}catch(e){U.showError(e,w.baseText(`settings.sourceControl.saved.error`))}K.stopLoading()},le=e=>{e!==A.preferences.branchName&&(A.preferences.branchName=e)},ue=()=>{H.goToUpgrade(`source-control`,`upgrade-source-control`)},de=async()=>{await A.getPreferences(),A.preferences.connected&&(q.value=!0,J.value=A.preferences.connectionType||`ssh`,A.getBranches())};l(async()=>{G.set(w.baseText(`settings.sourceControl.title`)),A.isEnterpriseSourceControlEnabled&&await de()});let Z=s({repoUrl:!1,keyGeneratorType:!1,httpsUsername:!1,httpsPassword:!1});function Q(e,t){Z[e]=t}let fe=e(()=>{let e=[{name:`REQUIRED`}];return J.value===`ssh`?e.push({name:`MATCH_REGEX`,config:{regex:/^(?:git@|ssh:\/\/git@|[\w.-]+@)(?:[\w.-]+|\[[0-9a-fA-F:]+])(?::\d+)?[:\/][\w\-~.]+(?:\/[\w\-~.]+)*(?:\.git)?(?:\/.*)?$/,message:w.baseText(`settings.sourceControl.repoUrlInvalid`)}}):e.push({name:`MATCH_REGEX`,config:{regex:/^https:\/\/.+$/,message:w.baseText(`settings.sourceControl.enterValidHttpsUrl`)}}),e}),pe=[{name:`REQUIRED`}],$=[{name:`REQUIRED`}],me=e(()=>J.value===`ssh`?Z.repoUrl:Z.repoUrl&&Z.httpsUsername&&Z.httpsPassword),he=[{name:`REQUIRED`}];async function ge(){try{await W.confirm(w.baseText(`settings.sourceControl.modals.refreshSshKey.message`),w.baseText(`settings.sourceControl.modals.refreshSshKey.title`),{confirmButtonText:w.baseText(`settings.sourceControl.modals.refreshSshKey.confirm`),cancelButtonText:w.baseText(`settings.sourceControl.modals.refreshSshKey.cancel`)})===`confirm`&&(await A.generateKeyPair(A.preferences.keyGeneratorType),U.showMessage({title:w.baseText(`settings.sourceControl.refreshSshKey.successful.title`),type:`success`}))}catch(e){U.showError(e,w.baseText(`settings.sourceControl.refreshSshKey.error.title`))}}let _e=async()=>{try{await A.getBranches(),U.showMessage({title:w.baseText(`settings.sourceControl.refreshBranches.success`),type:`success`})}catch(e){U.showError(e,w.baseText(`settings.sourceControl.refreshBranches.error`))}},ve=e=>{let t=e;t!==A.preferences.keyGeneratorType&&(A.preferences.keyGeneratorType=t)};return te(J,()=>{Z.repoUrl=!1,Z.httpsUsername=!1,Z.httpsPassword=!1,q.value||(A.preferences.repositoryUrl=``)}),(e,a)=>(d(),n(`div`,null,[o(i(C),{size:`2xlarge`,tag:`h1`},{default:u(()=>[f(t(i(w).baseText(`settings.sourceControl.title`)),1)]),_:1}),i(A).isEnterpriseSourceControlEnabled?(d(),n(`div`,N,[o(i(g),{theme:`secondary`,icon:`info`,class:`mt-2xl mb-l`},{default:u(()=>[o(i(h),{keypath:`settings.sourceControl.description`,tag:`span`,scope:`global`},{link:u(()=>[m(`a`,{href:i(w).baseText(`settings.sourceControl.docs.url`),target:`_blank`},t(i(w).baseText(`settings.sourceControl.description.link`)),9,P)]),_:1})]),_:1}),o(i(C),{size:`xlarge`,tag:`h2`,class:`mb-s`},{default:u(()=>[f(t(i(w).baseText(`settings.sourceControl.gitConfig`)),1)]),_:1}),q.value?r(``,!0):(d(),n(`div`,{key:0,class:p(e.$style.group)},[m(`label`,F,t(i(w).baseText(`settings.sourceControl.connectionType`)),1),o(i(x),{id:`connectionType`,modelValue:J.value,"onUpdate:modelValue":a[0]||=e=>J.value=e,label:``,type:`select`,name:`connectionType`,options:ae,"data-test-id":`source-control-connection-type-select`},null,8,[`modelValue`])],2)),m(`div`,{class:p(e.$style.group)},[m(`label`,I,t(J.value===`ssh`?i(w).baseText(`settings.sourceControl.sshRepoUrl`):i(w).baseText(`settings.sourceControl.httpsRepoUrl`)),1),m(`div`,{class:p(e.$style.groupFlex)},[o(i(x),{id:`repoUrl`,modelValue:i(A).preferences.repositoryUrl,"onUpdate:modelValue":a[1]||=e=>i(A).preferences.repositoryUrl=e,label:``,class:`ml-0`,name:`repoUrl`,"validate-on-blur":``,"validation-rules":fe.value,disabled:q.value,placeholder:J.value===`ssh`?i(w).baseText(`settings.sourceControl.sshRepoUrlPlaceholder`):i(w).baseText(`settings.sourceControl.httpsRepoUrlPlaceholder`),onValidate:a[2]||=e=>Q(`repoUrl`,e)},null,8,[`modelValue`,`validation-rules`,`disabled`,`placeholder`]),q.value?(d(),c(i(_),{key:0,variant:`subtle`,class:p(e.$style.disconnectButton),size:`large`,icon:`trash-2`,"data-test-id":`source-control-disconnect-button`,onClick:se},{default:u(()=>[f(t(i(w).baseText(`settings.sourceControl.button.disconnect`)),1)]),_:1},8,[`class`])):r(``,!0)],2),!q.value&&J.value===`ssh`?(d(),c(i(b),{key:0,type:`info`,class:`mt-s`},{default:u(()=>[f(t(i(w).baseText(`settings.sourceControl.sshFormatNotice`)),1)]),_:1})):r(``,!0),!q.value&&J.value===`https`?(d(),c(i(b),{key:1,type:`info`,class:`mt-s`},{default:u(()=>[f(t(i(w).baseText(`settings.sourceControl.httpsFormatNotice`)),1)]),_:1})):r(``,!0)],2),J.value===`https`&&!q.value?(d(),n(`div`,{key:1,class:p(e.$style.group)},[m(`label`,L,t(i(w).baseText(`settings.sourceControl.httpsUsername`)),1),o(i(x),{id:`httpsUsername`,modelValue:Y.value,"onUpdate:modelValue":a[3]||=e=>Y.value=e,label:``,name:`httpsUsername`,type:`text`,"validate-on-blur":``,"validation-rules":$,placeholder:i(w).baseText(`settings.sourceControl.httpsUsernamePlaceholder`),onValidate:a[4]||=e=>Q(`httpsUsername`,e)},null,8,[`modelValue`,`placeholder`])],2)):r(``,!0),J.value===`https`&&!q.value?(d(),n(`div`,{key:2,class:p(e.$style.group)},[m(`label`,R,t(i(w).baseText(`settings.sourceControl.httpsPersonalAccessToken`)),1),o(i(x),{id:`httpsPassword`,modelValue:X.value,"onUpdate:modelValue":a[5]||=e=>X.value=e,label:``,name:`httpsPassword`,type:`password`,"validate-on-blur":``,"validation-rules":$,placeholder:i(w).baseText(`settings.sourceControl.httpsPersonalAccessTokenPlaceholder`),onValidate:a[6]||=e=>Q(`httpsPassword`,e)},null,8,[`modelValue`,`placeholder`]),o(i(b),{type:`warning`,class:`mt-s`},{default:u(()=>[o(i(h),{keypath:`settings.sourceControl.httpsWarningNotice`,tag:`span`,scope:`global`},{strong:u(()=>[m(`strong`,null,t(i(w).baseText(`settings.sourceControl.httpsWarningNotice.strong`)),1)]),repo:u(()=>[...a[11]||=[m(`code`,null,`repo`,-1)]]),publicRepo:u(()=>[...a[12]||=[m(`code`,null,`public_repo`,-1)]]),_:1})]),_:1})],2)):r(``,!0),J.value===`ssh`&&i(A).preferences.publicKey?(d(),n(`div`,{key:3,class:p(e.$style.group)},[m(`label`,null,t(i(w).baseText(`settings.sourceControl.sshKey`)),1),m(`div`,{class:p({[e.$style.sshInput]:!q.value})},[q.value?r(``,!0):(d(),c(i(x),{key:0,id:`keyGeneratorType`,class:p(e.$style.sshKeyTypeSelect),label:``,type:`select`,name:`keyGeneratorType`,"data-test-id":`source-control-ssh-key-type-select`,"validate-on-blur":``,"validation-rules":pe,options:i(A).sshKeyTypesWithLabel,"model-value":i(A).preferences.keyGeneratorType,onValidate:a[7]||=e=>Q(`keyGeneratorType`,e),"onUpdate:modelValue":ve},null,8,[`class`,`options`,`model-value`])),o(M,{class:p(e.$style.copyInput),collapse:``,size:`medium`,value:i(A).preferences.publicKey,"copy-button-text":i(w).baseText(`generic.clickToCopy`)},null,8,[`class`,`value`,`copy-button-text`]),q.value?r(``,!0):(d(),c(i(_),{key:1,variant:`subtle`,size:`large`,icon:`refresh-cw`,"data-test-id":`source-control-refresh-ssh-key-button`,onClick:ge},{default:u(()=>[f(t(i(w).baseText(`settings.sourceControl.refreshSshKey`)),1)]),_:1}))],2),o(i(b),{type:`info`,class:`mt-s`},{default:u(()=>[o(i(h),{keypath:`settings.sourceControl.sshKeyDescription`,tag:`span`,scope:`global`},{link:u(()=>[m(`a`,{href:i(w).baseText(`settings.sourceControl.docs.setup.ssh.url`),target:`_blank`},t(i(w).baseText(`settings.sourceControl.sshKeyDescriptionLink`)),9,z)]),_:1})]),_:1})],2)):r(``,!0),q.value?r(``,!0):(d(),c(i(_),{key:4,size:`large`,disabled:!me.value,class:p(e.$style.connect),"data-test-id":`source-control-connect-button`,onClick:oe},{default:u(()=>[f(t(i(w).baseText(`settings.sourceControl.button.connect`)),1)]),_:1},8,[`disabled`,`class`])),q.value?(d(),n(`div`,B,[m(`div`,{class:p(e.$style.group)},[a[13]||=m(`hr`,null,null,-1),o(i(C),{size:`xlarge`,tag:`h2`,class:`mb-s`},{default:u(()=>[f(t(i(w).baseText(`settings.sourceControl.instanceSettings`)),1)]),_:1}),m(`label`,null,t(i(w).baseText(`settings.sourceControl.branches`)),1),m(`div`,{class:p(e.$style.branchSelection)},[o(i(x),{id:`branchName`,label:``,type:`select`,name:`branchName`,class:`mb-s`,"data-test-id":`source-control-branch-select`,"validate-on-blur":``,"validation-rules":he,options:ie.value,"model-value":i(A).preferences.branchName,onValidate:a[8]||=e=>Q(`branchName`,e),"onUpdate:modelValue":le},null,8,[`options`,`model-value`]),o(i(v),{placement:`top`},{content:u(()=>[m(`span`,null,t(i(w).baseText(`settings.sourceControl.refreshBranches.tooltip`)),1)]),default:u(()=>[o(i(_),{variant:`subtle`,iconOnly:``,size:`xlarge`,icon:`refresh-cw`,"data-test-id":`source-control-refresh-branches-button`,class:p(e.$style.refreshBranches),onClick:_e},null,8,[`class`])]),_:1})],2),o(i(re),{modelValue:i(A).preferences.branchReadOnly,"onUpdate:modelValue":a[9]||=e=>i(A).preferences.branchReadOnly=e,class:p(e.$style.readOnly),"data-test-id":`source-control-read-only-checkbox`},{label:u(()=>[o(i(h),{keypath:`settings.sourceControl.protected`,tag:`span`,scope:`global`},{bold:u(()=>[m(`strong`,null,t(i(w).baseText(`settings.sourceControl.protected.bold`)),1)]),_:1})]),_:1},8,[`modelValue`,`class`])],2),m(`div`,{class:p(e.$style.group)},[m(`label`,null,t(i(w).baseText(`settings.sourceControl.color`)),1),m(`div`,null,[o(i(S),{modelValue:i(A).preferences.branchColor,"onUpdate:modelValue":a[10]||=e=>i(A).preferences.branchColor=e,size:`small`},null,8,[`modelValue`])])],2),m(`div`,{class:p([e.$style.group,`pt-s`])},[o(i(_),{size:`large`,disabled:!i(A).preferences.branchName,"data-test-id":`source-control-save-settings-button`,onClick:ce},{default:u(()=>[f(t(i(w).baseText(`settings.sourceControl.button.save`)),1)]),_:1},8,[`disabled`])],2)])):r(``,!0)])):(d(),c(i(y),{key:1,"data-test-id":`source-control-content-unlicensed`,class:p(e.$style.actionBox),description:i(w).baseText(`settings.sourceControl.actionBox.description`),"button-text":i(w).baseText(`settings.sourceControl.actionBox.buttonText`),"onClick:button":ue},{heading:u(()=>[m(`span`,null,t(i(w).baseText(`settings.sourceControl.actionBox.title`)),1)]),description:u(()=>[f(t(i(w).baseText(`settings.sourceControl.actionBox.description`))+` `,1),m(`a`,{href:i(w).baseText(`settings.sourceControl.docs.url`),target:`_blank`},t(i(w).baseText(`settings.sourceControl.actionBox.description.link`)),9,V)]),_:1},8,[`class`,`description`,`button-text`]))]))}}),[[`__cssModules`,{$style:{group:`_group_o0gi6_125`,readOnly:`_readOnly_o0gi6_146`,groupFlex:`_groupFlex_o0gi6_150`,connect:`_connect_o0gi6_164`,disconnectButton:`_disconnectButton_o0gi6_168`,actionBox:`_actionBox_o0gi6_173`,sshInput:`_sshInput_o0gi6_177`,copyInput:`_copyInput_o0gi6_188`,sshKeyTypeSelect:`_sshKeyTypeSelect_o0gi6_192`,branchSelection:`_branchSelection_o0gi6_200`,refreshBranches:`_refreshBranches_o0gi6_209`}}]]);export{H as default};
//# sourceMappingURL=SettingsSourceControl-DDK5GE7H.js.map