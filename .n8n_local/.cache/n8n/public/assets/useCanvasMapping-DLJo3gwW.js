(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`c92b59f4-d632-44a9-98d3-9e84cd0529c7`,e._sentryDebugIdIdentifier=`sentry-dbid-c92b59f4-d632-44a9-98d3-9e84cd0529c7`)})()}catch{}import{o as e,t}from"./chunk-Din3qlHY.js";import{C as n,Cn as r,D as i,E as a,G as o,Gt as s,I as c,It as l,J as u,L as d,M as f,P as p,Q as m,T as h,U as g,Vt as _,W as v,Z as y,_ as b,_t as x,at as S,b as C,bn as w,bt as T,c as E,ct as D,et as O,ft as k,h as A,it as j,j as M,k as N,n as P,nt as F,p as I,pt as ee,ut as L,vn as R,vt as z,w as B,xt as V,y as H,yn as U,z as te}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{_ as ne,lt as re,st as ie,ut as W,y as ae,yt as G}from"./_MapCache-DjbOQyB7.js";import{Ci as oe,Dt as se,Hi as ce,Mi as K,Oi as q,P as le,Ui as J,V as ue,Vi as de,_t as fe,gi as pe,kt as me,wi as he}from"./src-CppJvwzX.js";import{t as Y}from"./_plugin-vue_export-helper-B_J4Khre.js";import{$n as ge,Ar as _e,Bn as ve,Bt as ye,C as be,Cn as xe,Dn as Se,Fn as Ce,Gn as we,Hn as Te,It as Ee,Jn as De,Kn as Oe,Pt as ke,Qn as Ae,Tn as je,Un as Me,Vi as Ne,Vn as Pe,Vt as Fe,Wn as Ie,Xc as Le,Xn as Re,Yc as ze,Yn as Be,Zn as Ve,ai as He,ar as Ue,br as We,ca as Ge,cr as Ke,di as X,er as qe,ga as Je,ir as Ye,jr as Xe,kn as Ze,li as Z,nr as Qe,or as $e,qn as et,r as tt,rr as nt,rt,s as it,sr as at,tr as ot,ui as st,wr as ct,ws as lt,xn as ut}from"./users.store-pCkD7Zo0.js";import{j as dt}from"./ParameterInputList-BmOOAGJV.js";import{Ao as ft,Gt as pt,I as mt,Mo as ht,No as gt,Nt as _t,Po as vt,Pt as yt,Sa as bt,Sr as xt,Tt as St,Ua as Ct,Un as wt,Xc as Tt,Zn as Et,_a as Dt,_c as Ot,ba as kt,da as At,hn as jt,hr as Mt,lr as Nt,qo as Pt,ra as Ft,rs as It,so as Q,ua as Lt,ur as Rt,vc as zt,xa as Bt,xc as Vt,yc as Ht}from"./constants-D1jZwsUK.js";import{t as Ut}from"./assistant.store-BGYzebcZ.js";import{t as Wt}from"./chatPanel.store-YdM_XYGp.js";import{t as Gt}from"./usePinnedData-C6FFXoty.js";import{t as Kt}from"./nodeIcon--7uU1Imq.js";import{c as qt,n as Jt,o as Yt,r as Xt,s as Zt,t as Qt}from"./canvas.utils-C8dCdoZZ.js";import{t as $t}from"./nodeCreator.store-KD9kt9dE.js";import{a as en,i as tn,t as nn}from"./useCanvasOperations-BHGWcL34.js";import{t as rn}from"./useDynamicCredentials-BSZ25lEI.js";import{t as an}from"./NodeIcon-Dv1e4Lvu.js";import{t as on}from"./useTelemetryContext-Dq1_6uNp.js";import{r as sn,t as cn}from"./useRunWorkflow-DzzlHC01.js";import{t as ln}from"./collaboration.store-QKYwE2H2.js";import{t as un}from"./NodeSettings-BBj2nP6A.js";import{t as dn}from"./KeyboardShortcutTooltip-BuQeOxiO.js";import{t as fn}from"./useKeybindings-B_gtbMl6.js";import{t as pn}from"./injectStrict-CjZBqt9B.js";var mn=[`id`,`x`,`y`,`width`,`height`,`patternTransform`],hn=[`d`,`stroke-width`],gn=Y(p({__name:`CanvasBackgroundStripedPattern`,props:{id:{},x:{},y:{},zoom:{}},setup(e){let t=e,r=n(()=>20*t.zoom||1),a=n(()=>r.value/2);return(t,n)=>(O(),i(`pattern`,{id:e.id,patternUnits:`userSpaceOnUse`,x:e.x%r.value,y:e.y%r.value,width:r.value,height:r.value,patternTransform:`rotate(135) translate(-${a.value},-${a.value})`},[B(`path`,{d:`M0 ${r.value/2} H${r.value}`,"stroke-width":r.value/2},null,8,hn)],8,mn))}}),[[`__scopeId`,`data-v-c74a9681`]]),_n=(e=>(e.Lines=`lines`,e.Dots=`dots`,e))(_n||{}),vn=function({dimensions:e,size:t,color:n}){return d(`path`,{stroke:n,"stroke-width":t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`})},yn=function({radius:e,color:t}){return d(`circle`,{cx:e,cy:e,r:e,fill:t})};_n.Lines,_n.Dots;var bn={[_n.Dots]:`#81818a`,[_n.Lines]:`#eee`},xn=[`id`,`x`,`y`,`width`,`height`,`patternTransform`],Sn={key:2,height:`100`,width:`100`},Cn=[`fill`],wn=[`x`,`y`,`fill`],Tn=p({name:`Background`,compatConfig:{MODE:3},props:{id:{},variant:{default:()=>_n.Dots},gap:{default:20},size:{default:1},lineWidth:{default:1},patternColor:{},color:{},bgColor:{},height:{default:100},width:{default:100},x:{default:0},y:{default:0},offset:{default:0}},setup(e){let{id:t,viewport:r}=Ye(),o=n(()=>{let t=r.value.zoom,[n,i]=Array.isArray(e.gap)?e.gap:[e.gap,e.gap],a=[n*t||1,i*t||1],o=e.size*t,[s,c]=Array.isArray(e.offset)?e.offset:[e.offset,e.offset];return{scaledGap:a,offset:[s*t||1+a[0]/2,c*t||1+a[1]/2],size:o}}),c=_(()=>`pattern-${t}${e.id?`-${e.id}`:``}`),l=_(()=>e.color||e.patternColor||bn[e.variant||_n.Dots]);return(e,t)=>(O(),i(`svg`,{class:`vue-flow__background vue-flow__container`,style:w({height:`${e.height>100?100:e.height}%`,width:`${e.width>100?100:e.width}%`})},[S(e.$slots,`pattern-container`,{id:c.value},()=>[B(`pattern`,{id:c.value,x:s(r).x%o.value.scaledGap[0],y:s(r).y%o.value.scaledGap[1],width:o.value.scaledGap[0],height:o.value.scaledGap[1],patternTransform:`translate(-${o.value.offset[0]},-${o.value.offset[1]})`,patternUnits:`userSpaceOnUse`},[S(e.$slots,`pattern`,{},()=>[e.variant===s(_n).Lines?(O(),h(s(vn),{key:0,size:e.lineWidth,color:l.value,dimensions:o.value.scaledGap},null,8,[`size`,`color`,`dimensions`])):e.variant===s(_n).Dots?(O(),h(s(yn),{key:1,color:l.value,radius:o.value.size/2},null,8,[`color`,`radius`])):a(``,!0),e.bgColor?(O(),i(`svg`,Sn,[B(`rect`,{width:`100%`,height:`100%`,fill:e.bgColor},null,8,Cn)])):a(``,!0)])],8,xn)]),B(`rect`,{x:e.x,y:e.y,width:`100%`,height:`100%`,fill:`url(#${c.value})`},null,8,wn),S(e.$slots,`default`,{id:c.value})],4))}}),En=p({__name:`CanvasBackground`,props:{striped:{type:Boolean},viewport:{}},setup(e){return(t,n)=>(O(),h(s(Tn),{"data-test-id":`canvas-background`,"pattern-color":`var(--canvas--dot--color)`,gap:s(16)},N({_:2},[e.striped?{name:`pattern-container`,fn:T(t=>[f(gn,{id:t.id,"data-test-id":`canvas-background-striped-pattern`,x:e.viewport.x,y:e.viewport.y,zoom:e.viewport.zoom},null,8,[`id`,`x`,`y`,`zoom`])]),key:`0`}:void 0]),1032,[`gap`]))}});function Dn(e){let t=tt(),r=be(),i=it(),a=ct(),o=ln(),s=_e(),c=G(),l=n(()=>i.workflowObject),u=n(()=>Pt(i.workflow.scopes).workflow),d=n(()=>a.preferences.branchReadOnly||t.isReadOnlyView||!u.value.update||i.workflow.isArchived||o.shouldBeReadOnly),f=n(()=>{if(p.value.length!==1)return!1;let e=p.value[0];return bt(e)?!!Dt(e):!1}),p=n(()=>e.value.map(e=>i.getNodeById(e)).filter(Ge)),m=e=>{let t=i.allNodes.filter(t=>t.type===e.name);return e.maxNodes===void 0||t.length<e.maxNodes},h=e=>{let t=r.getNodeType(e.type,e.typeVersion);return!t||wt.includes(t.name)?!1:m(t)},g=e=>!!i.pinDataByNodeName(e.name),_=e=>{let t=l.value.getNode(e.name),n=r.getNodeType(t.type,t.typeVersion);return kt(l.value,t,n)},v=e=>e.type===`n8n-nodes-base.webhook`?!0:!(!e.webhookId||!e.type.toLocaleLowerCase().includes(`trigger`)||!_(e));return n(()=>{let e=p.value,t=e.every(e=>e.type===Mt),n={adjustToNumber:e.length,interpolate:{subject:t?c.baseText(`contextMenu.sticky`,{adjustToNumber:e.length}):c.baseText(`contextMenu.node`,{adjustToNumber:e.length})}},r=[{id:`select_all`,divided:!0,label:c.baseText(`contextMenu.selectAll`),shortcut:{metaKey:!0,keys:[`A`]},disabled:e.length===i.allNodes.length},{id:`deselect_all`,label:c.baseText(`contextMenu.deselectAll`),disabled:e.length===0}],a=[{id:`extract_sub_workflow`,divided:!0,label:c.baseText(`contextMenu.extract`,{adjustToNumber:e.length}),shortcut:{altKey:!0,keys:[`X`]},disabled:d.value}],o=[!t&&s.isFeatureEnabled&&{id:`focus_ai_on_selected`,divided:!0,label:c.baseText(`contextMenu.focusAiOnSelected`,{adjustToNumber:e.length,interpolate:{count:e.length}}),shortcut:{altKey:!0,keys:[`I`]},disabled:d.value}].filter(Boolean),l=[{id:`tidy_up`,divided:!0,label:c.baseText(e.length<2?`contextMenu.tidyUpWorkflow`:`contextMenu.tidyUpSelection`),shortcut:{shiftKey:!0,altKey:!0,keys:[`T`]},disabled:d.value}];if(e.length===0)return[{id:`add_node`,shortcut:{keys:[`Tab`]},label:c.baseText(`contextMenu.addNode`),disabled:d.value},{id:`add_sticky`,shortcut:{shiftKey:!0,keys:[`s`]},label:c.baseText(`contextMenu.addSticky`),disabled:d.value},...l,...r];{let s=[!t&&{id:`toggle_activation`,label:e.every(e=>e.disabled)?c.baseText(`contextMenu.activate`,n):c.baseText(`contextMenu.deactivate`,n),shortcut:{keys:[`D`]},disabled:d.value},!t&&{id:`toggle_pin`,label:e.every(e=>g(e))?c.baseText(`contextMenu.unpin`,n):c.baseText(`contextMenu.pin`,n),shortcut:{keys:[`p`]},disabled:d.value||!e.every(e=>Gt(e).canPinNode(!0))},{id:`copy`,label:c.baseText(`contextMenu.copy`,n),shortcut:{metaKey:!0,keys:[`C`]}},{id:`duplicate`,label:c.baseText(`contextMenu.duplicate`,n),shortcut:{metaKey:!0,keys:[`D`]},disabled:d.value||!e.every(h)},...l,...a,...o,...r,{id:`delete`,divided:!0,label:c.baseText(`contextMenu.delete`,n),shortcut:{keys:[`Del`]},disabled:d.value}].filter(Boolean);if(e.length===1){let n=[];if(v(e[0])){let t=Et.includes(e[0].type),r=i.workflow.active;t||n.push({divided:!0,id:`copy_test_url`,label:c.baseText(`contextMenu.copyTestUrl`),shortcut:{shiftKey:!0,altKey:!0,keys:[`U`]},disabled:!1}),r&&n.push({divided:t,id:`copy_production_url`,label:c.baseText(`contextMenu.copyProductionUrl`),shortcut:{altKey:!0,keys:[`U`]},disabled:!1})}let r=t?[{id:`open`,label:c.baseText(`contextMenu.editSticky`),shortcut:{keys:[`↵`]},disabled:d.value},{id:`change_color`,label:c.baseText(`contextMenu.changeColor`),disabled:d.value}]:[{id:`open`,label:c.baseText(`contextMenu.open`),shortcut:{keys:[`↵`]}},{id:`execute`,label:c.baseText(`contextMenu.test`),disabled:d.value||!_(e[0])},...n,{divided:!!n.length,id:`rename`,label:c.baseText(`contextMenu.rename`),shortcut:{keys:[`Space`]},disabled:d.value},{id:`replace`,label:c.baseText(`contextMenu.replace`),shortcut:{keys:[`R`]},disabled:d.value}];bt(e[0])&&r.push({id:`open_sub_workflow`,label:c.baseText(`contextMenu.openSubworkflow`),shortcut:{shiftKey:!0,metaKey:!0,keys:[`O`]},disabled:!f.value}),s.unshift(...r)}return s}})}var On=l([0,0]),kn=l();const An=()=>{let e=tt(),t=n(()=>kn.value!==void 0),r=n(()=>{if(!kn.value)return[];let e=kn.value;return e.source===`canvas`?e.nodeIds:[e.nodeId]}),i=()=>{kn.value=void 0,On.value=[0,0]},a=(e,n)=>{if(e.stopPropagation(),t.value&&n.source===kn.value?.source&&n.nodeId===kn.value?.nodeId){i();return}e.preventDefault(),kn.value=n,On.value=Ce(e)},o=Dn(r);return x(()=>e.nodeViewOffsetPosition,i),{isOpen:t,position:On,target:kn,actions:n(()=>t.value?o.value:[]),targetNodeIds:r,open:a,close:i}};var jn=Y(p({__name:`ContextMenu`,emits:[`action`],setup(e,{emit:t}){let n=An(),{position:r,isOpen:i,actions:o,target:c}=n,u=l(),d=t,{APP_Z_INDEXES:p}=We();x(i,()=>{i?u.value?.open():u.value?.close()},{flush:`post`});function m(e){d(`action`,e,n.targetNodeIds.value)}function g(e){e||n.close()}return(e,t)=>s(i)?(O(),h(C,{key:0,to:`body`},[B(`div`,{class:R(e.$style.contextMenu),style:w({left:`${s(r)[0]}px`,top:`${s(r)[1]}px`,zIndex:s(p).CONTEXT_MENU})},[f(s(se),{ref_key:`dropdown`,ref:u,items:s(o),placement:`bottom-start`,"data-test-id":`context-menu`,"hide-arrow":s(c)?.source!==`node-button`,teleported:!1,onSelect:m,onVisibleChange:g},{activator:T(()=>[B(`div`,{class:R(e.$style.activator)},null,2)]),_:1},8,[`items`,`hide-arrow`])],6)])):a(``,!0)}}),[[`__cssModules`,{$style:{contextMenu:`_contextMenu_ia9tx_125`,activator:`_activator_ia9tx_129`}}]]),Mn=t(((e,t)=>{var n=`\0`,r=`\0`,i=``,a=class{_isDirected=!0;_isMultigraph=!1;_isCompound=!1;_label;_defaultNodeLabelFn=()=>void 0;_defaultEdgeLabelFn=()=>void 0;_nodes={};_in={};_preds={};_out={};_sucs={};_edgeObjs={};_edgeLabels={};_nodeCount=0;_edgeCount=0;_parent;_children;constructor(e){e&&(this._isDirected=Object.hasOwn(e,`directed`)?e.directed:!0,this._isMultigraph=Object.hasOwn(e,`multigraph`)?e.multigraph:!1,this._isCompound=Object.hasOwn(e,`compound`)?e.compound:!1),this._isCompound&&(this._parent={},this._children={},this._children[r]={})}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(e){return this._label=e,this}graph(){return this._label}setDefaultNodeLabel(e){return this._defaultNodeLabelFn=e,typeof e!=`function`&&(this._defaultNodeLabelFn=()=>e),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var e=this;return this.nodes().filter(t=>Object.keys(e._in[t]).length===0)}sinks(){var e=this;return this.nodes().filter(t=>Object.keys(e._out[t]).length===0)}setNodes(e,t){var n=arguments,r=this;return e.forEach(function(e){n.length>1?r.setNode(e,t):r.setNode(e)}),this}setNode(e,t){return Object.hasOwn(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=t),this):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]=r,this._children[e]={},this._children[r][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)}node(e){return this._nodes[e]}hasNode(e){return Object.hasOwn(this._nodes,e)}removeNode(e){var t=this;if(Object.hasOwn(this._nodes,e)){var n=e=>t.removeEdge(t._edgeObjs[e]);delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],this.children(e).forEach(function(e){t.setParent(e)}),delete this._children[e]),Object.keys(this._in[e]).forEach(n),delete this._in[e],delete this._preds[e],Object.keys(this._out[e]).forEach(n),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this}setParent(e,t){if(!this._isCompound)throw Error(`Cannot set parent in a non-compound graph`);if(t===void 0)t=r;else{t+=``;for(var n=t;n!==void 0;n=this.parent(n))if(n===e)throw Error(`Setting `+t+` as parent of `+e+` would create a cycle`);this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this}_removeFromParentsChildList(e){delete this._children[this._parent[e]][e]}parent(e){if(this._isCompound){var t=this._parent[e];if(t!==r)return t}}children(e=r){if(this._isCompound){var t=this._children[e];if(t)return Object.keys(t)}else if(e===r)return this.nodes();else if(this.hasNode(e))return[]}predecessors(e){var t=this._preds[e];if(t)return Object.keys(t)}successors(e){var t=this._sucs[e];if(t)return Object.keys(t)}neighbors(e){var t=this.predecessors(e);if(t){let r=new Set(t);for(var n of this.successors(e))r.add(n);return Array.from(r.values())}}isLeaf(e){return(this.isDirected()?this.successors(e):this.neighbors(e)).length===0}filterNodes(e){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph());var n=this;Object.entries(this._nodes).forEach(function([n,r]){e(n)&&t.setNode(n,r)}),Object.values(this._edgeObjs).forEach(function(e){t.hasNode(e.v)&&t.hasNode(e.w)&&t.setEdge(e,n.edge(e))});var r={};function i(e){var a=n.parent(e);return a===void 0||t.hasNode(a)?(r[e]=a,a):a in r?r[a]:i(a)}return this._isCompound&&t.nodes().forEach(e=>t.setParent(e,i(e))),t}setDefaultEdgeLabel(e){return this._defaultEdgeLabelFn=e,typeof e!=`function`&&(this._defaultEdgeLabelFn=()=>e),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(e,t){var n=this,r=arguments;return e.reduce(function(e,i){return r.length>1?n.setEdge(e,i,t):n.setEdge(e,i),i}),this}setEdge(){var e,t,n,r,i=!1,a=arguments[0];typeof a==`object`&&a&&`v`in a?(e=a.v,t=a.w,n=a.name,arguments.length===2&&(r=arguments[1],i=!0)):(e=a,t=arguments[1],n=arguments[3],arguments.length>2&&(r=arguments[2],i=!0)),e=``+e,t=``+t,n!==void 0&&(n=``+n);var s=c(this._isDirected,e,t,n);if(Object.hasOwn(this._edgeLabels,s))return i&&(this._edgeLabels[s]=r),this;if(n!==void 0&&!this._isMultigraph)throw Error(`Cannot set a named edge when isMultigraph = false`);this.setNode(e),this.setNode(t),this._edgeLabels[s]=i?r:this._defaultEdgeLabelFn(e,t,n);var u=l(this._isDirected,e,t,n);return e=u.v,t=u.w,Object.freeze(u),this._edgeObjs[s]=u,o(this._preds[t],e),o(this._sucs[e],t),this._in[t][s]=u,this._out[e][s]=u,this._edgeCount++,this}edge(e,t,n){var r=arguments.length===1?u(this._isDirected,arguments[0]):c(this._isDirected,e,t,n);return this._edgeLabels[r]}edgeAsObj(){let e=this.edge(...arguments);return typeof e==`object`?e:{label:e}}hasEdge(e,t,n){var r=arguments.length===1?u(this._isDirected,arguments[0]):c(this._isDirected,e,t,n);return Object.hasOwn(this._edgeLabels,r)}removeEdge(e,t,n){var r=arguments.length===1?u(this._isDirected,arguments[0]):c(this._isDirected,e,t,n),i=this._edgeObjs[r];return i&&(e=i.v,t=i.w,delete this._edgeLabels[r],delete this._edgeObjs[r],s(this._preds[t],e),s(this._sucs[e],t),delete this._in[t][r],delete this._out[e][r],this._edgeCount--),this}inEdges(e,t){var n=this._in[e];if(n){var r=Object.values(n);return t?r.filter(e=>e.v===t):r}}outEdges(e,t){var n=this._out[e];if(n){var r=Object.values(n);return t?r.filter(e=>e.w===t):r}}nodeEdges(e,t){var n=this.inEdges(e,t);if(n)return n.concat(this.outEdges(e,t))}};function o(e,t){e[t]?e[t]++:e[t]=1}function s(e,t){--e[t]||delete e[t]}function c(e,t,r,a){var o=``+t,s=``+r;if(!e&&o>s){var c=o;o=s,s=c}return o+i+s+i+(a===void 0?n:a)}function l(e,t,n,r){var i=``+t,a=``+n;if(!e&&i>a){var o=i;i=a,a=o}var s={v:i,w:a};return r&&(s.name=r),s}function u(e,t){return c(e,t.v,t.w,t.name)}t.exports=a})),Nn=t(((e,t)=>{t.exports=`2.2.4`})),Pn=t(((e,t)=>{t.exports={Graph:Mn(),version:Nn()}})),Fn=t(((e,t)=>{var n=Mn();t.exports={write:r,read:o};function r(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:i(e),edges:a(e)};return e.graph()!==void 0&&(t.value=structuredClone(e.graph())),t}function i(e){return e.nodes().map(function(t){var n=e.node(t),r=e.parent(t),i={v:t};return n!==void 0&&(i.value=n),r!==void 0&&(i.parent=r),i})}function a(e){return e.edges().map(function(t){var n=e.edge(t),r={v:t.v,w:t.w};return t.name!==void 0&&(r.name=t.name),n!==void 0&&(r.value=n),r})}function o(e){var t=new n(e.options).setGraph(e.value);return e.nodes.forEach(function(e){t.setNode(e.v,e.value),e.parent&&t.setParent(e.v,e.parent)}),e.edges.forEach(function(e){t.setEdge({v:e.v,w:e.w,name:e.name},e.value)}),t}})),In=t(((e,t)=>{t.exports=n;function n(e){var t={},n=[],r;function i(n){Object.hasOwn(t,n)||(t[n]=!0,r.push(n),e.successors(n).forEach(i),e.predecessors(n).forEach(i))}return e.nodes().forEach(function(e){r=[],i(e),r.length&&n.push(r)}),n}})),Ln=t(((e,t)=>{t.exports=class{_arr=[];_keyIndices={};size(){return this._arr.length}keys(){return this._arr.map(function(e){return e.key})}has(e){return Object.hasOwn(this._keyIndices,e)}priority(e){var t=this._keyIndices[e];if(t!==void 0)return this._arr[t].priority}min(){if(this.size()===0)throw Error(`Queue underflow`);return this._arr[0].key}add(e,t){var n=this._keyIndices;if(e=String(e),!Object.hasOwn(n,e)){var r=this._arr,i=r.length;return n[e]=i,r.push({key:e,priority:t}),this._decrease(i),!0}return!1}removeMin(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key}decrease(e,t){var n=this._keyIndices[e];if(t>this._arr[n].priority)throw Error(`New priority is greater than current priority. Key: `+e+` Old: `+this._arr[n].priority+` New: `+t);this._arr[n].priority=t,this._decrease(n)}_heapify(e){var t=this._arr,n=2*e,r=n+1,i=e;n<t.length&&(i=t[n].priority<t[i].priority?n:i,r<t.length&&(i=t[r].priority<t[i].priority?r:i),i!==e&&(this._swap(e,i),this._heapify(i)))}_decrease(e){for(var t=this._arr,n=t[e].priority,r;e!==0&&(r=e>>1,!(t[r].priority<n));)this._swap(e,r),e=r}_swap(e,t){var n=this._arr,r=this._keyIndices,i=n[e],a=n[t];n[e]=a,n[t]=i,r[a.key]=e,r[i.key]=t}}})),Rn=t(((e,t)=>{var n=Ln();t.exports=i;var r=()=>1;function i(e,t,n,i){return a(e,String(t),n||r,i||function(t){return e.outEdges(t)})}function a(e,t,r,i){var a={},o=new n,s,c,l=function(e){var t=e.v===s?e.w:e.v,n=a[t],i=r(e),l=c.distance+i;if(i<0)throw Error(`dijkstra does not allow negative edge weights. Bad edge: `+e+` Weight: `+i);l<n.distance&&(n.distance=l,n.predecessor=s,o.decrease(t,l))};for(e.nodes().forEach(function(e){var n=e===t?0:1/0;a[e]={distance:n},o.add(e,n)});o.size()>0&&(s=o.removeMin(),c=a[s],c.distance!==1/0);)i(s).forEach(l);return a}})),zn=t(((e,t)=>{var n=Rn();t.exports=r;function r(e,t,r){return e.nodes().reduce(function(i,a){return i[a]=n(e,a,t,r),i},{})}})),Bn=t(((e,t)=>{t.exports=n;function n(e){var t=0,n=[],r={},i=[];function a(o){var s=r[o]={onStack:!0,lowlink:t,index:t++};if(n.push(o),e.successors(o).forEach(function(e){Object.hasOwn(r,e)?r[e].onStack&&(s.lowlink=Math.min(s.lowlink,r[e].index)):(a(e),s.lowlink=Math.min(s.lowlink,r[e].lowlink))}),s.lowlink===s.index){var c=[],l;do l=n.pop(),r[l].onStack=!1,c.push(l);while(o!==l);i.push(c)}}return e.nodes().forEach(function(e){Object.hasOwn(r,e)||a(e)}),i}})),Vn=t(((e,t)=>{var n=Bn();t.exports=r;function r(e){return n(e).filter(function(t){return t.length>1||t.length===1&&e.hasEdge(t[0],t[0])})}})),Hn=t(((e,t)=>{t.exports=r;var n=()=>1;function r(e,t,r){return i(e,t||n,r||function(t){return e.outEdges(t)})}function i(e,t,n){var r={},i=e.nodes();return i.forEach(function(e){r[e]={},r[e][e]={distance:0},i.forEach(function(t){e!==t&&(r[e][t]={distance:1/0})}),n(e).forEach(function(n){var i=n.v===e?n.w:n.v,a=t(n);r[e][i]={distance:a,predecessor:e}})}),i.forEach(function(e){var t=r[e];i.forEach(function(n){var a=r[n];i.forEach(function(n){var r=a[e],i=t[n],o=a[n],s=r.distance+i.distance;s<o.distance&&(o.distance=s,o.predecessor=i.predecessor)})})}),r}})),Un=t(((e,t)=>{function n(e){var t={},n={},i=[];function a(o){if(Object.hasOwn(n,o))throw new r;Object.hasOwn(t,o)||(n[o]=!0,t[o]=!0,e.predecessors(o).forEach(a),delete n[o],i.push(o))}if(e.sinks().forEach(a),Object.keys(t).length!==e.nodeCount())throw new r;return i}var r=class extends Error{constructor(){super(...arguments)}};t.exports=n,n.CycleException=r})),Wn=t(((e,t)=>{var n=Un();t.exports=r;function r(e){try{n(e)}catch(e){if(e instanceof n.CycleException)return!1;throw e}return!0}})),Gn=t(((e,t)=>{t.exports=n;function n(e,t,n){Array.isArray(t)||(t=[t]);var a=e.isDirected()?t=>e.successors(t):t=>e.neighbors(t),o=n===`post`?r:i,s=[],c={};return t.forEach(t=>{if(!e.hasNode(t))throw Error(`Graph does not have node: `+t);o(t,a,c,s)}),s}function r(e,t,n,r){for(var i=[[e,!1]];i.length>0;){var o=i.pop();o[1]?r.push(o[0]):Object.hasOwn(n,o[0])||(n[o[0]]=!0,i.push([o[0],!0]),a(t(o[0]),e=>i.push([e,!1])))}}function i(e,t,n,r){for(var i=[e];i.length>0;){var o=i.pop();Object.hasOwn(n,o)||(n[o]=!0,r.push(o),a(t(o),e=>i.push(e)))}}function a(e,t){for(var n=e.length;n--;)t(e[n],n,e);return e}})),Kn=t(((e,t)=>{var n=Gn();t.exports=r;function r(e,t){return n(e,t,`post`)}})),qn=t(((e,t)=>{var n=Gn();t.exports=r;function r(e,t){return n(e,t,`pre`)}})),Jn=t(((e,t)=>{var n=Mn(),r=Ln();t.exports=i;function i(e,t){var i=new n,a={},o=new r,s;function c(e){var n=e.v===s?e.w:e.v,r=o.priority(n);if(r!==void 0){var i=t(e);i<r&&(a[n]=s,o.decrease(n,i))}}if(e.nodeCount()===0)return i;e.nodes().forEach(function(e){o.add(e,1/0),i.setNode(e)}),o.decrease(e.nodes()[0],0);for(var l=!1;o.size()>0;){if(s=o.removeMin(),Object.hasOwn(a,s))i.setEdge(s,a[s]);else if(l)throw Error(`Input graph is not connected: `+e);else l=!0;e.nodeEdges(s).forEach(c)}return i}})),Yn=t(((e,t)=>{t.exports={components:In(),dijkstra:Rn(),dijkstraAll:zn(),findCycles:Vn(),floydWarshall:Hn(),isAcyclic:Wn(),postorder:Kn(),preorder:qn(),prim:Jn(),tarjan:Bn(),topsort:Un()}})),Xn=t(((e,t)=>{var n=Pn();t.exports={Graph:n.Graph,json:Fn(),alg:Yn(),version:n.version}})),Zn=t(((e,t)=>{var n=class{constructor(){let e={};e._next=e._prev=e,this._sentinel=e}dequeue(){let e=this._sentinel,t=e._prev;if(t!==e)return r(t),t}enqueue(e){let t=this._sentinel;e._prev&&e._next&&r(e),e._next=t._next,t._next._prev=e,t._next=e,e._prev=t}toString(){let e=[],t=this._sentinel,n=t._prev;for(;n!==t;)e.push(JSON.stringify(n,i)),n=n._prev;return`[`+e.join(`, `)+`]`}};function r(e){e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev}function i(e,t){if(e!==`_next`&&e!==`_prev`)return t}t.exports=n})),Qn=t(((e,t)=>{var n=Xn().Graph,r=Zn();t.exports=a;var i=()=>1;function a(e,t){if(e.nodeCount()<=1)return[];let n=c(e,t||i);return o(n.graph,n.buckets,n.zeroIdx).flatMap(t=>e.outEdges(t.v,t.w))}function o(e,t,n){let r=[],i=t[t.length-1],a=t[0],o;for(;e.nodeCount();){for(;o=a.dequeue();)s(e,t,n,o);for(;o=i.dequeue();)s(e,t,n,o);if(e.nodeCount()){for(let i=t.length-2;i>0;--i)if(o=t[i].dequeue(),o){r=r.concat(s(e,t,n,o,!0));break}}}return r}function s(e,t,n,r,i){let a=i?[]:void 0;return e.inEdges(r.v).forEach(r=>{let o=e.edge(r),s=e.node(r.v);i&&a.push({v:r.v,w:r.w}),s.out-=o,l(t,n,s)}),e.outEdges(r.v).forEach(r=>{let i=e.edge(r),a=r.w,o=e.node(a);o.in-=i,l(t,n,o)}),e.removeNode(r.v),a}function c(e,t){let i=new n,a=0,o=0;e.nodes().forEach(e=>{i.setNode(e,{v:e,in:0,out:0})}),e.edges().forEach(e=>{let n=i.edge(e.v,e.w)||0,r=t(e),s=n+r;i.setEdge(e.v,e.w,s),o=Math.max(o,i.node(e.v).out+=r),a=Math.max(a,i.node(e.w).in+=r)});let s=u(o+a+3).map(()=>new r),c=a+1;return i.nodes().forEach(e=>{l(s,c,i.node(e))}),{graph:i,buckets:s,zeroIdx:c}}function l(e,t,n){n.out?n.in?e[n.out-n.in+t].enqueue(n):e[e.length-1].enqueue(n):e[0].enqueue(n)}function u(e){let t=[];for(let n=0;n<e;n++)t.push(n);return t}})),$=t(((e,t)=>{var n=Xn().Graph;t.exports={addBorderNode:f,addDummyNode:r,applyWithChunking:h,asNonCompoundGraph:a,buildLayerMatrix:l,intersectRect:c,mapValues:w,maxRank:g,normalizeRanks:u,notime:y,partition:_,pick:C,predecessorWeights:s,range:S,removeEmptyRanks:d,simplify:i,successorWeights:o,time:v,uniqueId:x,zipObject:T};function r(e,t,n,r){let i;do i=x(r);while(e.hasNode(i));return n.dummy=t,e.setNode(i,n),i}function i(e){let t=new n().setGraph(e.graph());return e.nodes().forEach(n=>t.setNode(n,e.node(n))),e.edges().forEach(n=>{let r=t.edge(n.v,n.w)||{weight:0,minlen:1},i=e.edge(n);t.setEdge(n.v,n.w,{weight:r.weight+i.weight,minlen:Math.max(r.minlen,i.minlen)})}),t}function a(e){let t=new n({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach(n=>{e.children(n).length||t.setNode(n,e.node(n))}),e.edges().forEach(n=>{t.setEdge(n,e.edge(n))}),t}function o(e){let t=e.nodes().map(t=>{let n={};return e.outEdges(t).forEach(t=>{n[t.w]=(n[t.w]||0)+e.edge(t).weight}),n});return T(e.nodes(),t)}function s(e){let t=e.nodes().map(t=>{let n={};return e.inEdges(t).forEach(t=>{n[t.v]=(n[t.v]||0)+e.edge(t).weight}),n});return T(e.nodes(),t)}function c(e,t){let n=e.x,r=e.y,i=t.x-n,a=t.y-r,o=e.width/2,s=e.height/2;if(!i&&!a)throw Error(`Not possible to find intersection inside of the rectangle`);let c,l;return Math.abs(a)*o>Math.abs(i)*s?(a<0&&(s=-s),c=s*i/a,l=s):(i<0&&(o=-o),c=o,l=o*a/i),{x:n+c,y:r+l}}function l(e){let t=S(g(e)+1).map(()=>[]);return e.nodes().forEach(n=>{let r=e.node(n),i=r.rank;i!==void 0&&(t[i][r.order]=n)}),t}function u(e){let t=e.nodes().map(t=>{let n=e.node(t).rank;return n===void 0?Number.MAX_VALUE:n}),n=h(Math.min,t);e.nodes().forEach(t=>{let r=e.node(t);Object.hasOwn(r,`rank`)&&(r.rank-=n)})}function d(e){let t=e.nodes().map(t=>e.node(t).rank),n=h(Math.min,t),r=[];e.nodes().forEach(t=>{let i=e.node(t).rank-n;r[i]||(r[i]=[]),r[i].push(t)});let i=0,a=e.graph().nodeRankFactor;Array.from(r).forEach((t,n)=>{t===void 0&&n%a!==0?--i:t!==void 0&&i&&t.forEach(t=>e.node(t).rank+=i)})}function f(e,t,n,i){let a={width:0,height:0};return arguments.length>=4&&(a.rank=n,a.order=i),r(e,`border`,a,t)}function p(e,t=m){let n=[];for(let r=0;r<e.length;r+=t){let i=e.slice(r,r+t);n.push(i)}return n}var m=65535;function h(e,t){if(t.length>m){let n=p(t);return e.apply(null,n.map(t=>e.apply(null,t)))}else return e.apply(null,t)}function g(e){let t=e.nodes().map(t=>{let n=e.node(t).rank;return n===void 0?Number.MIN_VALUE:n});return h(Math.max,t)}function _(e,t){let n={lhs:[],rhs:[]};return e.forEach(e=>{t(e)?n.lhs.push(e):n.rhs.push(e)}),n}function v(e,t){let n=Date.now();try{return t()}finally{console.log(e+` time: `+(Date.now()-n)+`ms`)}}function y(e,t){return t()}var b=0;function x(e){var t=++b;return toString(e)+t}function S(e,t,n=1){t??(t=e,e=0);let r=e=>e<t;n<0&&(r=e=>t<e);let i=[];for(let t=e;r(t);t+=n)i.push(t);return i}function C(e,t){let n={};for(let r of t)e[r]!==void 0&&(n[r]=e[r]);return n}function w(e,t){let n=t;return typeof t==`string`&&(n=e=>e[t]),Object.entries(e).reduce((e,[t,r])=>(e[t]=n(r,t),e),{})}function T(e,t){return e.reduce((e,n,r)=>(e[n]=t[r],e),{})}})),$n=t(((e,t)=>{var n=Qn(),r=$().uniqueId;t.exports={run:i,undo:o};function i(e){(e.graph().acyclicer===`greedy`?n(e,t(e)):a(e)).forEach(t=>{let n=e.edge(t);e.removeEdge(t),n.forwardName=t.name,n.reversed=!0,e.setEdge(t.w,t.v,n,r(`rev`))});function t(e){return t=>e.edge(t).weight}}function a(e){let t=[],n={},r={};function i(a){Object.hasOwn(r,a)||(r[a]=!0,n[a]=!0,e.outEdges(a).forEach(e=>{Object.hasOwn(n,e.w)?t.push(e):i(e.w)}),delete n[a])}return e.nodes().forEach(i),t}function o(e){e.edges().forEach(t=>{let n=e.edge(t);if(n.reversed){e.removeEdge(t);let r=n.forwardName;delete n.reversed,delete n.forwardName,e.setEdge(t.w,t.v,n,r)}})}})),er=t(((e,t)=>{var n=$();t.exports={run:r,undo:a};function r(e){e.graph().dummyChains=[],e.edges().forEach(t=>i(e,t))}function i(e,t){let r=t.v,i=e.node(r).rank,a=t.w,o=e.node(a).rank,s=t.name,c=e.edge(t),l=c.labelRank;if(o===i+1)return;e.removeEdge(t);let u,d,f;for(f=0,++i;i<o;++f,++i)c.points=[],d={width:0,height:0,edgeLabel:c,edgeObj:t,rank:i},u=n.addDummyNode(e,`edge`,d,`_d`),i===l&&(d.width=c.width,d.height=c.height,d.dummy=`edge-label`,d.labelpos=c.labelpos),e.setEdge(r,u,{weight:c.weight},s),f===0&&e.graph().dummyChains.push(u),r=u;e.setEdge(r,a,{weight:c.weight},s)}function a(e){e.graph().dummyChains.forEach(t=>{let n=e.node(t),r=n.edgeLabel,i;for(e.setEdge(n.edgeObj,r);n.dummy;)i=e.successors(t)[0],e.removeNode(t),r.points.push({x:n.x,y:n.y}),n.dummy===`edge-label`&&(r.x=n.x,r.y=n.y,r.width=n.width,r.height=n.height),t=i,n=e.node(t)})}})),tr=t(((e,t)=>{var{applyWithChunking:n}=$();t.exports={longestPath:r,slack:i};function r(e){var t={};function r(i){var a=e.node(i);if(Object.hasOwn(t,i))return a.rank;t[i]=!0;let o=e.outEdges(i).map(t=>t==null?1/0:r(t.w)-e.edge(t).minlen);var s=n(Math.min,o);return s===1/0&&(s=0),a.rank=s}e.sources().forEach(r)}function i(e,t){return e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen}})),nr=t(((e,t)=>{var n=Xn().Graph,r=tr().slack;t.exports=i;function i(e){var t=new n({directed:!1}),i=e.nodes()[0],c=e.nodeCount();t.setNode(i,{});for(var l,u;a(t,e)<c;)l=o(t,e),u=t.hasNode(l.v)?r(e,l):-r(e,l),s(t,e,u);return t}function a(e,t){function n(i){t.nodeEdges(i).forEach(a=>{var o=a.v,s=i===o?a.w:o;!e.hasNode(s)&&!r(t,a)&&(e.setNode(s,{}),e.setEdge(i,s,{}),n(s))})}return e.nodes().forEach(n),e.nodeCount()}function o(e,t){return t.edges().reduce((n,i)=>{let a=1/0;return e.hasNode(i.v)!==e.hasNode(i.w)&&(a=r(t,i)),a<n[0]?[a,i]:n},[1/0,null])[1]}function s(e,t,n){e.nodes().forEach(e=>t.node(e).rank+=n)}})),rr=t(((e,t)=>{var n=nr(),r=tr().slack,i=tr().longestPath,a=Xn().alg.preorder,o=Xn().alg.postorder,s=$().simplify;t.exports=c,c.initLowLimValues=f,c.initCutValues=l,c.calcCutValue=d,c.leaveEdge=m,c.enterEdge=h,c.exchangeEdges=g;function c(e){e=s(e),i(e);var t=n(e);f(t),l(t,e);for(var r,a;r=m(t);)a=h(t,e,r),g(t,e,r,a)}function l(e,t){var n=o(e,e.nodes());n=n.slice(0,n.length-1),n.forEach(n=>u(e,t,n))}function u(e,t,n){var r=e.node(n).parent;e.edge(n,r).cutvalue=d(e,t,n)}function d(e,t,n){var r=e.node(n).parent,i=!0,a=t.edge(n,r),o=0;return a||=(i=!1,t.edge(r,n)),o=a.weight,t.nodeEdges(n).forEach(a=>{var s=a.v===n,c=s?a.w:a.v;if(c!==r){var l=s===i,u=t.edge(a).weight;if(o+=l?u:-u,v(e,n,c)){var d=e.edge(n,c).cutvalue;o+=l?-d:d}}}),o}function f(e,t){arguments.length<2&&(t=e.nodes()[0]),p(e,{},1,t)}function p(e,t,n,r,i){var a=n,o=e.node(r);return t[r]=!0,e.neighbors(r).forEach(i=>{Object.hasOwn(t,i)||(n=p(e,t,n,i,r))}),o.low=a,o.lim=n++,i?o.parent=i:delete o.parent,n}function m(e){return e.edges().find(t=>e.edge(t).cutvalue<0)}function h(e,t,n){var i=n.v,a=n.w;t.hasEdge(i,a)||(i=n.w,a=n.v);var o=e.node(i),s=e.node(a),c=o,l=!1;return o.lim>s.lim&&(c=s,l=!0),t.edges().filter(t=>l===y(e,e.node(t.v),c)&&l!==y(e,e.node(t.w),c)).reduce((e,n)=>r(t,n)<r(t,e)?n:e)}function g(e,t,n,r){var i=n.v,a=n.w;e.removeEdge(i,a),e.setEdge(r.v,r.w,{}),f(e),l(e,t),_(e,t)}function _(e,t){var n=a(e,e.nodes().find(e=>!t.node(e).parent));n=n.slice(1),n.forEach(n=>{var r=e.node(n).parent,i=t.edge(n,r),a=!1;i||(i=t.edge(r,n),a=!0),t.node(n).rank=t.node(r).rank+(a?i.minlen:-i.minlen)})}function v(e,t,n){return e.hasEdge(t,n)}function y(e,t,n){return n.low<=t.lim&&t.lim<=n.lim}})),ir=t(((e,t)=>{var n=tr().longestPath,r=nr(),i=rr();t.exports=a;function a(e){switch(e.graph().ranker){case`network-simplex`:c(e);break;case`tight-tree`:s(e);break;case`longest-path`:o(e);break;default:c(e)}}var o=n;function s(e){n(e),r(e)}function c(e){i(e)}})),ar=t(((e,t)=>{t.exports=n;function n(e){let t=i(e);e.graph().dummyChains.forEach(n=>{let i=e.node(n),a=i.edgeObj,o=r(e,t,a.v,a.w),s=o.path,c=o.lca,l=0,u=s[l],d=!0;for(;n!==a.w;){if(i=e.node(n),d){for(;(u=s[l])!==c&&e.node(u).maxRank<i.rank;)l++;u===c&&(d=!1)}if(!d){for(;l<s.length-1&&e.node(u=s[l+1]).minRank<=i.rank;)l++;u=s[l]}e.setParent(n,u),n=e.successors(n)[0]}})}function r(e,t,n,r){let i=[],a=[],o=Math.min(t[n].low,t[r].low),s=Math.max(t[n].lim,t[r].lim),c,l;c=n;do c=e.parent(c),i.push(c);while(c&&(t[c].low>o||s>t[c].lim));for(l=c,c=r;(c=e.parent(c))!==l;)a.push(c);return{path:i.concat(a.reverse()),lca:l}}function i(e){let t={},n=0;function r(i){let a=n;e.children(i).forEach(r),t[i]={low:a,lim:n++}}return e.children().forEach(r),t}})),or=t(((e,t)=>{var n=$();t.exports={run:r,cleanup:s};function r(e){let t=n.addDummyNode(e,`root`,{},`_root`),r=a(e),s=Object.values(r),c=n.applyWithChunking(Math.max,s)-1,l=2*c+1;e.graph().nestingRoot=t,e.edges().forEach(t=>e.edge(t).minlen*=l);let u=o(e)+1;e.children().forEach(n=>i(e,t,l,u,c,r,n)),e.graph().nodeRankFactor=l}function i(e,t,r,a,o,s,c){let l=e.children(c);if(!l.length){c!==t&&e.setEdge(t,c,{weight:0,minlen:r});return}let u=n.addBorderNode(e,`_bt`),d=n.addBorderNode(e,`_bb`),f=e.node(c);e.setParent(u,c),f.borderTop=u,e.setParent(d,c),f.borderBottom=d,l.forEach(n=>{i(e,t,r,a,o,s,n);let l=e.node(n),f=l.borderTop?l.borderTop:n,p=l.borderBottom?l.borderBottom:n,m=l.borderTop?a:2*a,h=f===p?o-s[c]+1:1;e.setEdge(u,f,{weight:m,minlen:h,nestingEdge:!0}),e.setEdge(p,d,{weight:m,minlen:h,nestingEdge:!0})}),e.parent(c)||e.setEdge(t,u,{weight:0,minlen:o+s[c]})}function a(e){var t={};function n(r,i){var a=e.children(r);a&&a.length&&a.forEach(e=>n(e,i+1)),t[r]=i}return e.children().forEach(e=>n(e,1)),t}function o(e){return e.edges().reduce((t,n)=>t+e.edge(n).weight,0)}function s(e){var t=e.graph();e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach(t=>{e.edge(t).nestingEdge&&e.removeEdge(t)})}})),sr=t(((e,t)=>{var n=$();t.exports=r;function r(e){function t(n){let r=e.children(n),a=e.node(n);if(r.length&&r.forEach(t),Object.hasOwn(a,`minRank`)){a.borderLeft=[],a.borderRight=[];for(let t=a.minRank,r=a.maxRank+1;t<r;++t)i(e,`borderLeft`,`_bl`,n,a,t),i(e,`borderRight`,`_br`,n,a,t)}}e.children().forEach(t)}function i(e,t,r,i,a,o){let s={width:0,height:0,rank:o,borderType:t},c=a[t][o-1],l=n.addDummyNode(e,`border`,s,r);a[t][o]=l,e.setParent(l,i),c&&e.setEdge(c,l,{weight:1})}})),cr=t(((e,t)=>{t.exports={adjust:n,undo:r};function n(e){let t=e.graph().rankdir.toLowerCase();(t===`lr`||t===`rl`)&&i(e)}function r(e){let t=e.graph().rankdir.toLowerCase();(t===`bt`||t===`rl`)&&o(e),(t===`lr`||t===`rl`)&&(c(e),i(e))}function i(e){e.nodes().forEach(t=>a(e.node(t))),e.edges().forEach(t=>a(e.edge(t)))}function a(e){let t=e.width;e.width=e.height,e.height=t}function o(e){e.nodes().forEach(t=>s(e.node(t))),e.edges().forEach(t=>{let n=e.edge(t);n.points.forEach(s),Object.hasOwn(n,`y`)&&s(n)})}function s(e){e.y=-e.y}function c(e){e.nodes().forEach(t=>l(e.node(t))),e.edges().forEach(t=>{let n=e.edge(t);n.points.forEach(l),Object.hasOwn(n,`x`)&&l(n)})}function l(e){let t=e.x;e.x=e.y,e.y=t}})),lr=t(((e,t)=>{var n=$();t.exports=r;function r(e){let t={},r=e.nodes().filter(t=>!e.children(t).length),i=r.map(t=>e.node(t).rank),a=n.applyWithChunking(Math.max,i),o=n.range(a+1).map(()=>[]);function s(n){t[n]||(t[n]=!0,o[e.node(n).rank].push(n),e.successors(n).forEach(s))}return r.sort((t,n)=>e.node(t).rank-e.node(n).rank).forEach(s),o}})),ur=t(((e,t)=>{var n=$().zipObject;t.exports=r;function r(e,t){let n=0;for(let r=1;r<t.length;++r)n+=i(e,t[r-1],t[r]);return n}function i(e,t,r){let i=n(r,r.map((e,t)=>t)),a=t.flatMap(t=>e.outEdges(t).map(t=>({pos:i[t.w],weight:e.edge(t).weight})).sort((e,t)=>e.pos-t.pos)),o=1;for(;o<r.length;)o<<=1;let s=2*o-1;--o;let c=Array(s).fill(0),l=0;return a.forEach(e=>{let t=e.pos+o;c[t]+=e.weight;let n=0;for(;t>0;)t%2&&(n+=c[t+1]),t=t-1>>1,c[t]+=e.weight;l+=e.weight*n}),l}})),dr=t(((e,t)=>{t.exports=n;function n(e,t=[]){return t.map(t=>{let n=e.inEdges(t);if(n.length){let r=n.reduce((t,n)=>{let r=e.edge(n),i=e.node(n.v);return{sum:t.sum+r.weight*i.order,weight:t.weight+r.weight}},{sum:0,weight:0});return{v:t,barycenter:r.sum/r.weight,weight:r.weight}}else return{v:t}})}})),fr=t(((e,t)=>{var n=$();t.exports=r;function r(e,t){let n={};return e.forEach((e,t)=>{let r=n[e.v]={indegree:0,in:[],out:[],vs:[e.v],i:t};e.barycenter!==void 0&&(r.barycenter=e.barycenter,r.weight=e.weight)}),t.edges().forEach(e=>{let t=n[e.v],r=n[e.w];t!==void 0&&r!==void 0&&(r.indegree++,t.out.push(n[e.w]))}),i(Object.values(n).filter(e=>!e.indegree))}function i(e){let t=[];function r(e){return t=>{t.merged||(t.barycenter===void 0||e.barycenter===void 0||t.barycenter>=e.barycenter)&&a(e,t)}}function i(t){return n=>{n.in.push(t),--n.indegree===0&&e.push(n)}}for(;e.length;){let n=e.pop();t.push(n),n.in.reverse().forEach(r(n)),n.out.forEach(i(n))}return t.filter(e=>!e.merged).map(e=>n.pick(e,[`vs`,`i`,`barycenter`,`weight`]))}function a(e,t){let n=0,r=0;e.weight&&(n+=e.barycenter*e.weight,r+=e.weight),t.weight&&(n+=t.barycenter*t.weight,r+=t.weight),e.vs=t.vs.concat(e.vs),e.barycenter=n/r,e.weight=r,e.i=Math.min(t.i,e.i),t.merged=!0}})),pr=t(((e,t)=>{var n=$();t.exports=r;function r(e,t){let r=n.partition(e,e=>Object.hasOwn(e,`barycenter`)),o=r.lhs,s=r.rhs.sort((e,t)=>t.i-e.i),c=[],l=0,u=0,d=0;o.sort(a(!!t)),d=i(c,s,d),o.forEach(e=>{d+=e.vs.length,c.push(e.vs),l+=e.barycenter*e.weight,u+=e.weight,d=i(c,s,d)});let f={vs:c.flat(!0)};return u&&(f.barycenter=l/u,f.weight=u),f}function i(e,t,n){let r;for(;t.length&&(r=t[t.length-1]).i<=n;)t.pop(),e.push(r.vs),n++;return n}function a(e){return(t,n)=>t.barycenter<n.barycenter?-1:t.barycenter>n.barycenter?1:e?n.i-t.i:t.i-n.i}})),mr=t(((e,t)=>{var n=dr(),r=fr(),i=pr();t.exports=a;function a(e,t,c,l){let u=e.children(t),d=e.node(t),f=d?d.borderLeft:void 0,p=d?d.borderRight:void 0,m={};f&&(u=u.filter(e=>e!==f&&e!==p));let h=n(e,u);h.forEach(t=>{if(e.children(t.v).length){let n=a(e,t.v,c,l);m[t.v]=n,Object.hasOwn(n,`barycenter`)&&s(t,n)}});let g=r(h,c);o(g,m);let _=i(g,l);if(f&&(_.vs=[f,_.vs,p].flat(!0),e.predecessors(f).length)){let t=e.node(e.predecessors(f)[0]),n=e.node(e.predecessors(p)[0]);Object.hasOwn(_,`barycenter`)||(_.barycenter=0,_.weight=0),_.barycenter=(_.barycenter*_.weight+t.order+n.order)/(_.weight+2),_.weight+=2}return _}function o(e,t){e.forEach(e=>{e.vs=e.vs.flatMap(e=>t[e]?t[e].vs:e)})}function s(e,t){e.barycenter===void 0?(e.barycenter=t.barycenter,e.weight=t.weight):(e.barycenter=(e.barycenter*e.weight+t.barycenter*t.weight)/(e.weight+t.weight),e.weight+=t.weight)}})),hr=t(((e,t)=>{var n=Xn().Graph,r=$();t.exports=i;function i(e,t,r){let i=a(e),o=new n({compound:!0}).setGraph({root:i}).setDefaultNodeLabel(t=>e.node(t));return e.nodes().forEach(n=>{let a=e.node(n),s=e.parent(n);(a.rank===t||a.minRank<=t&&t<=a.maxRank)&&(o.setNode(n),o.setParent(n,s||i),e[r](n).forEach(t=>{let r=t.v===n?t.w:t.v,i=o.edge(r,n),a=i===void 0?0:i.weight;o.setEdge(r,n,{weight:e.edge(t).weight+a})}),Object.hasOwn(a,`minRank`)&&o.setNode(n,{borderLeft:a.borderLeft[t],borderRight:a.borderRight[t]}))}),o}function a(e){for(var t;e.hasNode(t=r.uniqueId(`_root`)););return t}})),gr=t(((e,t)=>{t.exports=n;function n(e,t,n){let r={},i;n.forEach(n=>{let a=e.parent(n),o,s;for(;a;){if(o=e.parent(a),o?(s=r[o],r[o]=a):(s=i,i=a),s&&s!==a){t.setEdge(s,a);return}a=o}})}})),_r=t(((e,t)=>{var n=lr(),r=ur(),i=mr(),a=hr(),o=gr(),s=Xn().Graph,c=$();t.exports=l;function l(e,t){if(t&&typeof t.customOrder==`function`){t.customOrder(e,l);return}let i=c.maxRank(e),a=u(e,c.range(1,i+1),`inEdges`),o=u(e,c.range(i-1,-1,-1),`outEdges`),s=n(e);if(f(e,s),t&&t.disableOptimalOrderHeuristic)return;let p=1/0,m;for(let t=0,n=0;n<4;++t,++n){d(t%2?a:o,t%4>=2),s=c.buildLayerMatrix(e);let i=r(e,s);i<p&&(n=0,m=Object.assign({},s),p=i)}f(e,m)}function u(e,t,n){return t.map(function(t){return a(e,t,n)})}function d(e,t){let n=new s;e.forEach(function(e){let r=e.graph().root,a=i(e,r,n,t);a.vs.forEach((t,n)=>e.node(t).order=n),o(e,n,a.vs)})}function f(e,t){Object.values(t).forEach(t=>t.forEach((t,n)=>e.node(t).order=n))}})),vr=t(((e,t)=>{var n=Xn().Graph,r=$();t.exports={positionX:h,findType1Conflicts:i,findType2Conflicts:a,addConflict:s,hasConflict:c,verticalAlignment:l,horizontalCompaction:u,alignCoordinates:p,findSmallestWidthAlignment:f,balance:m};function i(e,t){let n={};function r(t,r){let i=0,a=0,c=t.length,l=r[r.length-1];return r.forEach((t,u)=>{let d=o(e,t),f=d?e.node(d).order:c;(d||t===l)&&(r.slice(a,u+1).forEach(t=>{e.predecessors(t).forEach(r=>{let a=e.node(r),o=a.order;(o<i||f<o)&&!(a.dummy&&e.node(t).dummy)&&s(n,r,t)})}),a=u+1,i=f)}),r}return t.length&&t.reduce(r),n}function a(e,t){let n={};function i(t,i,a,o,c){let l;r.range(i,a).forEach(r=>{l=t[r],e.node(l).dummy&&e.predecessors(l).forEach(t=>{let r=e.node(t);r.dummy&&(r.order<o||r.order>c)&&s(n,t,l)})})}function a(t,n){let r=-1,a,o=0;return n.forEach((s,c)=>{if(e.node(s).dummy===`border`){let t=e.predecessors(s);t.length&&(a=e.node(t[0]).order,i(n,o,c,r,a),o=c,r=a)}i(n,o,n.length,a,t.length)}),n}return t.length&&t.reduce(a),n}function o(e,t){if(e.node(t).dummy)return e.predecessors(t).find(t=>e.node(t).dummy)}function s(e,t,n){if(t>n){let e=t;t=n,n=e}let r=e[t];r||(e[t]=r={}),r[n]=!0}function c(e,t,n){if(t>n){let e=t;t=n,n=e}return!!e[t]&&Object.hasOwn(e[t],n)}function l(e,t,n,r){let i={},a={},o={};return t.forEach(e=>{e.forEach((e,t)=>{i[e]=e,a[e]=e,o[e]=t})}),t.forEach(e=>{let t=-1;e.forEach(e=>{let s=r(e);if(s.length){s=s.sort((e,t)=>o[e]-o[t]);let r=(s.length-1)/2;for(let l=Math.floor(r),u=Math.ceil(r);l<=u;++l){let r=s[l];a[e]===e&&t<o[r]&&!c(n,e,r)&&(a[r]=e,a[e]=i[e]=i[r],t=o[r])}}})}),{root:i,align:a}}function u(e,t,n,r,i){let a={},o=d(e,t,n,i),s=i?`borderLeft`:`borderRight`;function c(e,t){let n=o.nodes(),r=n.pop(),i={};for(;r;)i[r]?e(r):(i[r]=!0,n.push(r),n=n.concat(t(r))),r=n.pop()}function l(e){a[e]=o.inEdges(e).reduce((e,t)=>Math.max(e,a[t.v]+o.edge(t)),0)}function u(t){let n=o.outEdges(t).reduce((e,t)=>Math.min(e,a[t.w]-o.edge(t)),1/0),r=e.node(t);n!==1/0&&r.borderType!==s&&(a[t]=Math.max(a[t],n))}return c(l,o.predecessors.bind(o)),c(u,o.successors.bind(o)),Object.keys(r).forEach(e=>a[e]=a[n[e]]),a}function d(e,t,r,i){let a=new n,o=e.graph(),s=g(o.nodesep,o.edgesep,i);return t.forEach(t=>{let n;t.forEach(t=>{let i=r[t];if(a.setNode(i),n){var o=r[n],c=a.edge(o,i);a.setEdge(o,i,Math.max(s(e,t,n),c||0))}n=t})}),a}function f(e,t){return Object.values(t).reduce((t,n)=>{let r=-1/0,i=1/0;Object.entries(n).forEach(([t,n])=>{let a=_(e,t)/2;r=Math.max(n+a,r),i=Math.min(n-a,i)});let a=r-i;return a<t[0]&&(t=[a,n]),t},[1/0,null])[1]}function p(e,t){let n=Object.values(t),i=r.applyWithChunking(Math.min,n),a=r.applyWithChunking(Math.max,n);[`u`,`d`].forEach(n=>{[`l`,`r`].forEach(o=>{let s=n+o,c=e[s];if(c===t)return;let l=Object.values(c),u=i-r.applyWithChunking(Math.min,l);o!==`l`&&(u=a-r.applyWithChunking(Math.max,l)),u&&(e[s]=r.mapValues(c,e=>e+u))})})}function m(e,t){return r.mapValues(e.ul,(n,r)=>{if(t)return e[t.toLowerCase()][r];{let t=Object.values(e).map(e=>e[r]).sort((e,t)=>e-t);return(t[1]+t[2])/2}})}function h(e){let t=r.buildLayerMatrix(e),n=Object.assign(i(e,t),a(e,t)),o={},s;return[`u`,`d`].forEach(i=>{s=i===`u`?t:Object.values(t).reverse(),[`l`,`r`].forEach(t=>{t===`r`&&(s=s.map(e=>Object.values(e).reverse()));let a=(i===`u`?e.predecessors:e.successors).bind(e),c=l(e,s,n,a),d=u(e,s,c.root,c.align,t===`r`);t===`r`&&(d=r.mapValues(d,e=>-e)),o[i+t]=d})}),p(o,f(e,o)),m(o,e.graph().align)}function g(e,t,n){return(r,i,a)=>{let o=r.node(i),s=r.node(a),c=0,l;if(c+=o.width/2,Object.hasOwn(o,`labelpos`))switch(o.labelpos.toLowerCase()){case`l`:l=-o.width/2;break;case`r`:l=o.width/2;break}if(l&&(c+=n?l:-l),l=0,c+=(o.dummy?t:e)/2,c+=(s.dummy?t:e)/2,c+=s.width/2,Object.hasOwn(s,`labelpos`))switch(s.labelpos.toLowerCase()){case`l`:l=s.width/2;break;case`r`:l=-s.width/2;break}return l&&(c+=n?l:-l),l=0,c}}function _(e,t){return e.node(t).width}})),yr=t(((e,t)=>{var n=$(),r=vr().positionX;t.exports=i;function i(e){e=n.asNonCompoundGraph(e),a(e),Object.entries(r(e)).forEach(([t,n])=>e.node(t).x=n)}function a(e){let t=n.buildLayerMatrix(e),r=e.graph().ranksep,i=0;t.forEach(t=>{let n=t.reduce((t,n)=>{let r=e.node(n).height;return t>r?t:r},0);t.forEach(t=>e.node(t).y=i+n/2),i+=n+r})}})),br=t(((e,t)=>{var n=$n(),r=er(),i=ir(),a=$().normalizeRanks,o=ar(),s=$().removeEmptyRanks,c=or(),l=sr(),u=cr(),d=_r(),f=yr(),p=$(),m=Xn().Graph;t.exports=h;function h(e,t){let n=t&&t.debugTiming?p.time:p.notime;n(`layout`,()=>{let r=n(`  buildLayoutGraph`,()=>E(e));n(`  runLayout`,()=>g(r,n,t)),n(`  updateInputGraph`,()=>_(e,r))})}function g(e,t,m){t(`    makeSpaceForEdgeLabels`,()=>D(e)),t(`    removeSelfEdges`,()=>I(e)),t(`    acyclic`,()=>n.run(e)),t(`    nestingGraph.run`,()=>c.run(e)),t(`    rank`,()=>i(p.asNonCompoundGraph(e))),t(`    injectEdgeLabelProxies`,()=>O(e)),t(`    removeEmptyRanks`,()=>s(e)),t(`    nestingGraph.cleanup`,()=>c.cleanup(e)),t(`    normalizeRanks`,()=>a(e)),t(`    assignRankMinMax`,()=>k(e)),t(`    removeEdgeLabelProxies`,()=>A(e)),t(`    normalize.run`,()=>r.run(e)),t(`    parentDummyChains`,()=>o(e)),t(`    addBorderSegments`,()=>l(e)),t(`    order`,()=>d(e,m)),t(`    insertSelfEdges`,()=>ee(e)),t(`    adjustCoordinateSystem`,()=>u.adjust(e)),t(`    position`,()=>f(e)),t(`    positionSelfEdges`,()=>L(e)),t(`    removeBorderNodes`,()=>F(e)),t(`    normalize.undo`,()=>r.undo(e)),t(`    fixupEdgeLabelCoords`,()=>N(e)),t(`    undoCoordinateSystem`,()=>u.undo(e)),t(`    translateGraph`,()=>j(e)),t(`    assignNodeIntersects`,()=>M(e)),t(`    reversePoints`,()=>P(e)),t(`    acyclic.undo`,()=>n.undo(e))}function _(e,t){e.nodes().forEach(n=>{let r=e.node(n),i=t.node(n);r&&(r.x=i.x,r.y=i.y,r.rank=i.rank,t.children(n).length&&(r.width=i.width,r.height=i.height))}),e.edges().forEach(n=>{let r=e.edge(n),i=t.edge(n);r.points=i.points,Object.hasOwn(i,`x`)&&(r.x=i.x,r.y=i.y)}),e.graph().width=t.graph().width,e.graph().height=t.graph().height}var v=[`nodesep`,`edgesep`,`ranksep`,`marginx`,`marginy`],y={ranksep:50,edgesep:20,nodesep:50,rankdir:`tb`},b=[`acyclicer`,`ranker`,`rankdir`,`align`],x=[`width`,`height`],S={width:0,height:0},C=[`minlen`,`weight`,`width`,`height`,`labeloffset`],w={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:`r`},T=[`labelpos`];function E(e){let t=new m({multigraph:!0,compound:!0}),n=z(e.graph());return t.setGraph(Object.assign({},y,R(n,v),p.pick(n,b))),e.nodes().forEach(n=>{let r=R(z(e.node(n)),x);Object.keys(S).forEach(e=>{r[e]===void 0&&(r[e]=S[e])}),t.setNode(n,r),t.setParent(n,e.parent(n))}),e.edges().forEach(n=>{let r=z(e.edge(n));t.setEdge(n,Object.assign({},w,R(r,C),p.pick(r,T)))}),t}function D(e){let t=e.graph();t.ranksep/=2,e.edges().forEach(n=>{let r=e.edge(n);r.minlen*=2,r.labelpos.toLowerCase()!==`c`&&(t.rankdir===`TB`||t.rankdir===`BT`?r.width+=r.labeloffset:r.height+=r.labeloffset)})}function O(e){e.edges().forEach(t=>{let n=e.edge(t);if(n.width&&n.height){let n=e.node(t.v),r={rank:(e.node(t.w).rank-n.rank)/2+n.rank,e:t};p.addDummyNode(e,`edge-proxy`,r,`_ep`)}})}function k(e){let t=0;e.nodes().forEach(n=>{let r=e.node(n);r.borderTop&&(r.minRank=e.node(r.borderTop).rank,r.maxRank=e.node(r.borderBottom).rank,t=Math.max(t,r.maxRank))}),e.graph().maxRank=t}function A(e){e.nodes().forEach(t=>{let n=e.node(t);n.dummy===`edge-proxy`&&(e.edge(n.e).labelRank=n.rank,e.removeNode(t))})}function j(e){let t=1/0,n=0,r=1/0,i=0,a=e.graph(),o=a.marginx||0,s=a.marginy||0;function c(e){let a=e.x,o=e.y,s=e.width,c=e.height;t=Math.min(t,a-s/2),n=Math.max(n,a+s/2),r=Math.min(r,o-c/2),i=Math.max(i,o+c/2)}e.nodes().forEach(t=>c(e.node(t))),e.edges().forEach(t=>{let n=e.edge(t);Object.hasOwn(n,`x`)&&c(n)}),t-=o,r-=s,e.nodes().forEach(n=>{let i=e.node(n);i.x-=t,i.y-=r}),e.edges().forEach(n=>{let i=e.edge(n);i.points.forEach(e=>{e.x-=t,e.y-=r}),Object.hasOwn(i,`x`)&&(i.x-=t),Object.hasOwn(i,`y`)&&(i.y-=r)}),a.width=n-t+o,a.height=i-r+s}function M(e){e.edges().forEach(t=>{let n=e.edge(t),r=e.node(t.v),i=e.node(t.w),a,o;n.points?(a=n.points[0],o=n.points[n.points.length-1]):(n.points=[],a=i,o=r),n.points.unshift(p.intersectRect(r,a)),n.points.push(p.intersectRect(i,o))})}function N(e){e.edges().forEach(t=>{let n=e.edge(t);if(Object.hasOwn(n,`x`))switch((n.labelpos===`l`||n.labelpos===`r`)&&(n.width-=n.labeloffset),n.labelpos){case`l`:n.x-=n.width/2+n.labeloffset;break;case`r`:n.x+=n.width/2+n.labeloffset;break}})}function P(e){e.edges().forEach(t=>{let n=e.edge(t);n.reversed&&n.points.reverse()})}function F(e){e.nodes().forEach(t=>{if(e.children(t).length){let n=e.node(t),r=e.node(n.borderTop),i=e.node(n.borderBottom),a=e.node(n.borderLeft[n.borderLeft.length-1]),o=e.node(n.borderRight[n.borderRight.length-1]);n.width=Math.abs(o.x-a.x),n.height=Math.abs(i.y-r.y),n.x=a.x+n.width/2,n.y=r.y+n.height/2}}),e.nodes().forEach(t=>{e.node(t).dummy===`border`&&e.removeNode(t)})}function I(e){e.edges().forEach(t=>{if(t.v===t.w){var n=e.node(t.v);n.selfEdges||=[],n.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdge(t)}})}function ee(e){p.buildLayerMatrix(e).forEach(t=>{var n=0;t.forEach((t,r)=>{var i=e.node(t);i.order=r+n,(i.selfEdges||[]).forEach(t=>{p.addDummyNode(e,`selfedge`,{width:t.label.width,height:t.label.height,rank:i.rank,order:r+ ++n,e:t.e,label:t.label},`_se`)}),delete i.selfEdges})})}function L(e){e.nodes().forEach(t=>{var n=e.node(t);if(n.dummy===`selfedge`){var r=e.node(n.e.v),i=r.x+r.width/2,a=r.y,o=n.x-i,s=r.height/2;e.setEdge(n.e,n.label),e.removeNode(t),n.label.points=[{x:i+2*o/3,y:a-s},{x:i+5*o/6,y:a-s},{x:i+o,y:a},{x:i+5*o/6,y:a+s},{x:i+2*o/3,y:a+s}],n.label.x=n.x,n.label.y=n.y}})}function R(e,t){return p.mapValues(p.pick(e,t),Number)}function z(e){var t={};return e&&Object.entries(e).forEach(([e,n])=>{typeof e==`string`&&(e=e.toLowerCase()),t[e]=n}),t}})),xr=t(((e,t)=>{var n=$(),r=Xn().Graph;t.exports={debugOrdering:i};function i(e){let t=n.buildLayerMatrix(e),i=new r({compound:!0,multigraph:!0}).setGraph({});return e.nodes().forEach(t=>{i.setNode(t,{label:t}),i.setParent(t,`layer`+e.node(t).rank)}),e.edges().forEach(e=>i.setEdge(e.v,e.w,{},e.name)),t.forEach((e,t)=>{let n=`layer`+t;i.setNode(n,{rank:`same`}),e.reduce((e,t)=>(i.setEdge(e,t,{style:`invis`}),t))}),i}})),Sr=t(((e,t)=>{t.exports=`1.1.4`})),Cr=e(t(((e,t)=>{t.exports={graphlib:Xn(),layout:br(),debug:xr(),util:{time:$().time,notime:$().notime},version:Sr()}}))(),1),wr=128,Tr=96,Er=128,Dr=48,Or=128,kr=64;function Ar(e,t){let{findNode:n,findEdge:r,getSelectedNodes:i,edges:a,nodes:o}=Ye(e);function s(e){return e===`selection`?{nodes:i.value,edges:a.value}:{nodes:o.value,edges:a.value}}function c(e,t){let n=e.y-t.y;return n===0?e.x-t.x:n}function l(e,t){let n=a.value.some(t=>t.target===e.id),r=a.value.some(e=>e.target===t.id);return!n&&r?-1:n&&!r?1:c(e.position,t.position)}function u(e,t){return c(d(e),d(t))}function d(e){return{x:e.targetX,y:e.targetY}}function f(e){return e.dimensions&&typeof e.dimensions.width==`number`&&typeof e.dimensions.height==`number`&&e.dimensions.width>0&&e.dimensions.height>0?{width:e.dimensions.width,height:e.dimensions.height}:e.data&&e.data.render?Ze(e.data.render.type===X.Default&&e.data.render.options.configuration===!0,e.data.render.type===X.Default&&e.data.render.options.configurable===!0,e.data.inputs.filter(e=>e.type===`main`).length||1,e.data.outputs.filter(e=>e.type===`main`).length||1,e.data.inputs.filter(e=>e.type!==`main`).length+e.data.outputs.filter(e=>e.type!==`main`).length,t.value):{width:je[0],height:je[1]}}function p({nodes:e,edges:t}){let i=new Cr.default.graphlib.Graph;i.setDefaultEdgeLabel(()=>({}));let a=e.map(e=>n(e.id)).filter(Ge).sort(l),o=new Set(e.map(e=>e.id));return a.forEach(e=>{let{width:t,height:n}=f(e),{x:r,y:a}=e.position;i.setNode(e.id,{width:t,height:n,x:r,y:a})}),t.map(e=>r(e.id)).filter(Ge).filter(e=>o.has(e.source)&&o.has(e.target)).sort(u).forEach(e=>i.setEdge(e.source,e.target)),i}function m({nodeIds:e,parent:t}){let n=new Cr.default.graphlib.Graph;n.setGraph({rankdir:`LR`,edgesep:Tr,nodesep:Tr,ranksep:wr}),n.setDefaultEdgeLabel(()=>({}));let r=new Set(e);return t.nodes().filter(e=>r.has(e)).forEach(e=>{n.setNode(e,t.node(e))}),t.edges().filter(e=>r.has(e.v)&&r.has(e.w)).forEach(e=>n.setEdge(e.v,e.w,t.edge(e))),n}function h({nodes:e}){let t=new Cr.default.graphlib.Graph;return t.setGraph({rankdir:`TB`,align:`UL`,edgesep:Er,nodesep:Er,ranksep:Er}),t.setDefaultEdgeLabel(()=>({})),e.forEach(({id:e,box:{x:n,y:r,width:i,height:a}})=>t.setNode(e,{x:n,y:r,width:i,height:a})),e.forEach((n,r)=>{e[r+1]&&t.setEdge(n.id,e[r+1].id)}),t}function g({parent:e,nodeIds:t}){let n=new Cr.default.graphlib.Graph;n.setGraph({rankdir:`TB`,edgesep:Dr,nodesep:Dr,ranksep:Or}),n.setDefaultEdgeLabel(()=>({}));let r=new Set(t);return e.nodes().filter(e=>r.has(e)).forEach(t=>{n.setNode(t,e.node(t))}),e.edges().filter(e=>r.has(e.v)&&r.has(e.w)).forEach(e=>n.setEdge(e.w,e.v)),n}function _(e){let{minX:t,minY:n,maxX:r,maxY:i}=e.reduce((e,t)=>{let{x:n,y:r,width:i,height:a}=t;return{minX:Math.min(e.minX,n),maxX:Math.max(e.maxX,n+i),minY:Math.min(e.minY,r),maxY:Math.max(e.maxY,r+a)}},{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});return{x:t,y:n,width:r-t,height:i-n}}function v(e){let{width:t,height:n}=f(e);return{x:e.position.x,y:e.position.y,width:t,height:n}}function y(e){return{x:e.x-e.width/2,y:e.y-e.height/2,width:e.width,height:e.height}}function b(e){return _(e.nodes().map(t=>y(e.node(t))))}function x(e){return _(e.map(v))}function S(e,t){let n=t.x+t.width,r=t.y+t.height,i=e.x+e.width,a=e.y+e.height;return t.x>=e.x&&t.y>=e.y&&n<=i&&r<=a}function C(e,t){return e.x+e.width/2-t.width/2}function w(e,t,n=0){let r={x:t.x-n,y:t.y-n,width:t.width+n*2,height:t.height+n*2};return!(r.x+r.width<e.x||r.x>e.x+e.width||r.y+r.height<e.y||r.y>e.y+e.height)}function T(e){return e.render.type===X.Default&&e.render.options.configurable&&!e.render.options.configuration}function E(e){return e.render.type===X.Default&&e.render.options.configuration}function D({graph:e,root:t,nodeById:n}){return e.predecessors(t.id).map(e=>n[e]).filter(e=>E(e.data)).flatMap(t=>[t.id,...D({graph:e,root:t.data,nodeById:n})])}function O(e){let{nodes:t,edges:r}=s(e),i=t.filter(e=>e.data.type!==Mt).map(e=>n(e.id)).filter(Ge),a=x(i),o=p({nodes:i,edges:r}),c=i.reduce((e,t)=>(e[t.id]=t,e),{}),l=Cr.default.graphlib.alg.components(o).map(e=>{let t=m({nodeIds:e,parent:o}),n=t.nodes().map(e=>c[e].data).filter(T).map(e=>{let n=D({graph:t,nodeById:c,root:e}),r=g({parent:t,nodeIds:n.concat(e.id)});n.forEach(e=>t.removeNode(e));let i=t.edges().filter(t=>t.v===e.id||t.w===e.id);Cr.default.layout(r,{disableOptimalOrderHeuristic:!0});let a=b(r);return t.setNode(e.id,{width:a.width,height:a.height}),i.forEach(e=>t.setEdge(e)),{graph:r,boundingBox:a,aiParentNode:e}});return Cr.default.layout(t,{disableOptimalOrderHeuristic:!0}),{graph:t,aiGraphs:n,boundingBox:b(t)}}),u=h({nodes:l.map(({boundingBox:e},t)=>({box:e,id:t.toString()}))});Cr.default.layout(u,{disableOptimalOrderHeuristic:!0});let d=l.flatMap(({graph:e,aiGraphs:t},n)=>{let r=u.node(n.toString()),i=new Set(t.map(({aiParentNode:e})=>e.id)),a={x:0,y:r.y-r.height/2};return e.nodes().flatMap(n=>{let{x:r,y:o,width:s,height:c}=e.node(n),l={id:n,boundingBox:{x:r+a.x-s/2,y:o+a.y-c/2,width:s,height:c}};if(i.has(n)){let e=t.find(({aiParentNode:e})=>e.id===n);if(!e)return[];let r=l.boundingBox,i={x:r.x,y:r.y};return e.graph.nodes().map(t=>{let n=e.graph.node(t);return{id:t,boundingBox:{x:n.x+i.x-n.width/2,y:n.y+i.y-n.height/2,width:n.width,height:n.height}}})}return l})}).reduce((e,t)=>(e[t.id]=t.boundingBox,e),{});l.flatMap(({aiGraphs:e})=>e).forEach(({graph:e})=>{let t=e.nodes(),n=_(t.map(e=>d[e]).filter(Ge)),r=n.height/2-je[0]/2;if(n.y+=r,!Object.entries(d).filter(([t])=>!e.hasNode(t)).some(([,e])=>w(n,e,Tr)))for(let e of t)d[e].y+=r});let f=Object.entries(d).map(([e,t])=>({id:e,boundingBox:t})),y=_(f.map(e=>e.boundingBox)),E={x:y.x-a.x,y:y.y-a.y},O=t.filter(e=>e.data.type===Mt).map(e=>n(e.id)).filter(Ge).map(e=>{let t=v(e),n=i.filter(t=>S(v(e),v(t)));if(n.length===0)return null;let r=_(f.filter(e=>n.some(t=>t.id===e.id)).map(({boundingBox:e})=>e));return{id:e.id,boundingBox:{x:C(r,t),y:r.y+r.height-t.height+kr,height:t.height,width:t.width}}}).filter(Ge);return{boundingBox:y,nodes:f.concat(O).map(({id:e,boundingBox:t})=>({id:e,x:t.x-E.x,y:t.y-E.y}))}}return{layout:O}}function jr(e,t,n){let r=l(),i=ie(i=>{let a=t.viewportRef.value?.getBoundingClientRect();if(!a)return;let o=t.project({x:i.clientX-a.x,y:i.clientY-a.y});r.value=e.value.flatMap(e=>{if(e.data?.disabled)return[];let r=t.nodeLookup.value.get(e.id);if(!r)return[];let i=qe([r]),a=n(i);if(a.x>o.x||o.x>a.x+a.width||a.y>o.y||o.y>a.y+a.height)return[];let s=i.x+i.width/2-o.x,c=i.y+i.height/2-o.y;return[{id:e.id,squareDistance:s**2+c**2}]}).toSorted((e,t)=>e.squareDistance-t.squareDistance)[0]?.id},200,!0,!0);return y(()=>{t.vueFlowRef.value?.addEventListener(`mousemove`,i)}),m(()=>{t.vueFlowRef.value?.removeEventListener(`mousemove`,i)}),{id:r}}function Mr({getIncomers:e,getOutgoers:t}){function n(e){return e.sort((e,t)=>e.position.y-t.position.y)}function r(t){return n(e(t))}function i(e){return n(t(e))}function a(r){let i=e(r).flatMap(e=>t(e.id)),a=t(r).flatMap(t=>e(t.id));return n([...i,...a].filter((e,t,n)=>n.findIndex(t=>t.id===e.id)===t))}function o(e,n=[]){if(n.includes(e))return[];n.push(e);let r=t(e);return[...r,...r.flatMap(e=>o(e.id,n))].filter((e,t,n)=>n.findIndex(t=>t.id===e.id)===t)}function s(t,n=[]){if(n.includes(t))return[];n.push(t);let r=e(t);return[...r,...r.flatMap(e=>s(e.id,n))].filter((e,t,n)=>n.findIndex(t=>t.id===e.id)===t)}return{sortNodesByVerticalPosition:n,getIncomingNodes:r,getOutgoingNodes:i,getSiblingNodes:a,getDownstreamNodes:o,getUpstreamNodes:s}}function Nr(e,t,{dedupe:n=!0,threshold:r=300,disabled:i=!1}){let a=l(null);ne(e,()=>{s(i)||(a.value=Date.now())},{dedupe:n}),ae(e,()=>{s(i)||!a.value||Date.now()-a.value<r&&t()})}var Pr={value:()=>{}};function Fr(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+``)||r in n||/[\s.]/.test(r))throw Error(`illegal type: `+r);n[r]=[]}return new Ir(n)}function Ir(e){this._=e}function Lr(e,t){return e.trim().split(/^|\s+/).map(function(e){var n=``,r=e.indexOf(`.`);if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw Error(`unknown type: `+e);return{type:e,name:n}})}Ir.prototype=Fr.prototype={constructor:Ir,on:function(e,t){var n=this._,r=Lr(e+``,n),i,a=-1,o=r.length;if(arguments.length<2){for(;++a<o;)if((i=(e=r[a]).type)&&(i=Rr(n[i],e.name)))return i;return}if(t!=null&&typeof t!=`function`)throw Error(`invalid callback: `+t);for(;++a<o;)if(i=(e=r[a]).type)n[i]=zr(n[i],e.name,t);else if(t==null)for(i in n)n[i]=zr(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ir(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw Error(`unknown type: `+e);for(a=this._[e],r=0,i=a.length;r<i;++r)a[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw Error(`unknown type: `+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};function Rr(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function zr(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=Pr,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var Br=`http://www.w3.org/1999/xhtml`,Vr={svg:`http://www.w3.org/2000/svg`,xhtml:Br,xlink:`http://www.w3.org/1999/xlink`,xml:`http://www.w3.org/XML/1998/namespace`,xmlns:`http://www.w3.org/2000/xmlns/`};function Hr(e){var t=e+=``,n=t.indexOf(`:`);return n>=0&&(t=e.slice(0,n))!==`xmlns`&&(e=e.slice(n+1)),Vr.hasOwnProperty(t)?{space:Vr[t],local:e}:e}function Ur(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Br&&t.documentElement.namespaceURI===Br?t.createElement(e):t.createElementNS(n,e)}}function Wr(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Gr(e){var t=Hr(e);return(t.local?Wr:Ur)(t)}function Kr(){}function qr(e){return e==null?Kr:function(){return this.querySelector(e)}}function Jr(e){typeof e!=`function`&&(e=qr(e));for(var t=this._groups,n=t.length,r=Array(n),i=0;i<n;++i)for(var a=t[i],o=a.length,s=r[i]=Array(o),c,l,u=0;u<o;++u)(c=a[u])&&(l=e.call(c,c.__data__,u,a))&&(`__data__`in c&&(l.__data__=c.__data__),s[u]=l);return new Ia(r,this._parents)}function Yr(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Xr(){return[]}function Zr(e){return e==null?Xr:function(){return this.querySelectorAll(e)}}function Qr(e){return function(){return Yr(e.apply(this,arguments))}}function $r(e){e=typeof e==`function`?Qr(e):Zr(e);for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var o=t[a],s=o.length,c,l=0;l<s;++l)(c=o[l])&&(r.push(e.call(c,c.__data__,l,o)),i.push(c));return new Ia(r,i)}function ei(e){return function(){return this.matches(e)}}function ti(e){return function(t){return t.matches(e)}}var ni=Array.prototype.find;function ri(e){return function(){return ni.call(this.children,e)}}function ii(){return this.firstElementChild}function ai(e){return this.select(e==null?ii:ri(typeof e==`function`?e:ti(e)))}var oi=Array.prototype.filter;function si(){return Array.from(this.children)}function ci(e){return function(){return oi.call(this.children,e)}}function li(e){return this.selectAll(e==null?si:ci(typeof e==`function`?e:ti(e)))}function ui(e){typeof e!=`function`&&(e=ei(e));for(var t=this._groups,n=t.length,r=Array(n),i=0;i<n;++i)for(var a=t[i],o=a.length,s=r[i]=[],c,l=0;l<o;++l)(c=a[l])&&e.call(c,c.__data__,l,a)&&s.push(c);return new Ia(r,this._parents)}function di(e){return Array(e.length)}function fi(){return new Ia(this._enter||this._groups.map(di),this._parents)}function pi(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}pi.prototype={constructor:pi,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function mi(e){return function(){return e}}function hi(e,t,n,r,i,a){for(var o=0,s,c=t.length,l=a.length;o<l;++o)(s=t[o])?(s.__data__=a[o],r[o]=s):n[o]=new pi(e,a[o]);for(;o<c;++o)(s=t[o])&&(i[o]=s)}function gi(e,t,n,r,i,a,o){var s,c,l=new Map,u=t.length,d=a.length,f=Array(u),p;for(s=0;s<u;++s)(c=t[s])&&(f[s]=p=o.call(c,c.__data__,s,t)+``,l.has(p)?i[s]=c:l.set(p,c));for(s=0;s<d;++s)p=o.call(e,a[s],s,a)+``,(c=l.get(p))?(r[s]=c,c.__data__=a[s],l.delete(p)):n[s]=new pi(e,a[s]);for(s=0;s<u;++s)(c=t[s])&&l.get(f[s])===c&&(i[s]=c)}function _i(e){return e.__data__}function vi(e,t){if(!arguments.length)return Array.from(this,_i);var n=t?gi:hi,r=this._parents,i=this._groups;typeof e!=`function`&&(e=mi(e));for(var a=i.length,o=Array(a),s=Array(a),c=Array(a),l=0;l<a;++l){var u=r[l],d=i[l],f=d.length,p=yi(e.call(u,u&&u.__data__,l,r)),m=p.length,h=s[l]=Array(m),g=o[l]=Array(m);n(u,d,h,g,c[l]=Array(f),p,t);for(var _=0,v=0,y,b;_<m;++_)if(y=h[_]){for(_>=v&&(v=_+1);!(b=g[v])&&++v<m;);y._next=b||null}}return o=new Ia(o,r),o._enter=s,o._exit=c,o}function yi(e){return typeof e==`object`&&`length`in e?e:Array.from(e)}function bi(){return new Ia(this._exit||this._groups.map(di),this._parents)}function xi(e,t,n){var r=this.enter(),i=this,a=this.exit();return typeof e==`function`?(r=e(r),r&&=r.selection()):r=r.append(e+``),t!=null&&(i=t(i),i&&=i.selection()),n==null?a.remove():n(a),r&&i?r.merge(i).order():i}function Si(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,a=r.length,o=Math.min(i,a),s=Array(i),c=0;c<o;++c)for(var l=n[c],u=r[c],d=l.length,f=s[c]=Array(d),p,m=0;m<d;++m)(p=l[m]||u[m])&&(f[m]=p);for(;c<i;++c)s[c]=n[c];return new Ia(s,this._parents)}function Ci(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,a=r[i],o;--i>=0;)(o=r[i])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function wi(e){e||=Ti;function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}for(var n=this._groups,r=n.length,i=Array(r),a=0;a<r;++a){for(var o=n[a],s=o.length,c=i[a]=Array(s),l,u=0;u<s;++u)(l=o[u])&&(c[u]=l);c.sort(t)}return new Ia(i,this._parents).order()}function Ti(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ei(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Di(){return Array.from(this)}function Oi(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null}function ki(){let e=0;for(let t of this)++e;return e}function Ai(){return!this.node()}function ji(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],a=0,o=i.length,s;a<o;++a)(s=i[a])&&e.call(s,s.__data__,a,i);return this}function Mi(e){return function(){this.removeAttribute(e)}}function Ni(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Pi(e,t){return function(){this.setAttribute(e,t)}}function Fi(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Ii(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Li(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Ri(e,t){var n=Hr(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Ni:Mi:typeof t==`function`?n.local?Li:Ii:n.local?Fi:Pi)(n,t))}function zi(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Bi(e){return function(){this.style.removeProperty(e)}}function Vi(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Hi(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Ui(e,t,n){return arguments.length>1?this.each((t==null?Bi:typeof t==`function`?Hi:Vi)(e,t,n??``)):Wi(this.node(),e)}function Wi(e,t){return e.style.getPropertyValue(t)||zi(e).getComputedStyle(e,null).getPropertyValue(t)}function Gi(e){return function(){delete this[e]}}function Ki(e,t){return function(){this[e]=t}}function qi(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Ji(e,t){return arguments.length>1?this.each((t==null?Gi:typeof t==`function`?qi:Ki)(e,t)):this.node()[e]}function Yi(e){return e.trim().split(/^|\s+/)}function Xi(e){return e.classList||new Zi(e)}function Zi(e){this._node=e,this._names=Yi(e.getAttribute(`class`)||``)}Zi.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute(`class`,this._names.join(` `)))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute(`class`,this._names.join(` `)))},contains:function(e){return this._names.indexOf(e)>=0}};function Qi(e,t){for(var n=Xi(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function $i(e,t){for(var n=Xi(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function ea(e){return function(){Qi(this,e)}}function ta(e){return function(){$i(this,e)}}function na(e,t){return function(){(t.apply(this,arguments)?Qi:$i)(this,e)}}function ra(e,t){var n=Yi(e+``);if(arguments.length<2){for(var r=Xi(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t==`function`?na:t?ea:ta)(n,t))}function ia(){this.textContent=``}function aa(e){return function(){this.textContent=e}}function oa(e){return function(){this.textContent=e.apply(this,arguments)??``}}function sa(e){return arguments.length?this.each(e==null?ia:(typeof e==`function`?oa:aa)(e)):this.node().textContent}function ca(){this.innerHTML=``}function la(e){return function(){this.innerHTML=e}}function ua(e){return function(){this.innerHTML=e.apply(this,arguments)??``}}function da(e){return arguments.length?this.each(e==null?ca:(typeof e==`function`?ua:la)(e)):this.node().innerHTML}function fa(){this.nextSibling&&this.parentNode.appendChild(this)}function pa(){return this.each(fa)}function ma(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ha(){return this.each(ma)}function ga(e){var t=typeof e==`function`?e:Gr(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function _a(){return null}function va(e,t){var n=typeof e==`function`?e:Gr(e),r=t==null?_a:typeof t==`function`?t:qr(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function ya(){var e=this.parentNode;e&&e.removeChild(this)}function ba(){return this.each(ya)}function xa(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Sa(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Ca(e){return this.select(e?Sa:xa)}function wa(e){return arguments.length?this.property(`__data__`,e):this.node().__data__}function Ta(e){return function(t){e.call(this,t,this.__data__)}}function Ea(e){return e.trim().split(/^|\s+/).map(function(e){var t=``,n=e.indexOf(`.`);return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function Da(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,a;n<i;++n)a=t[n],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.options):t[++r]=a;++r?t.length=r:delete this.__on}}}function Oa(e,t,n){return function(){var r=this.__on,i,a=Ta(t);if(r){for(var o=0,s=r.length;o<s;++o)if((i=r[o]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),i.value=t;return}}this.addEventListener(e.type,a,n),i={type:e.type,name:e.name,value:t,listener:a,options:n},r?r.push(i):this.__on=[i]}}function ka(e,t,n){var r=Ea(e+``),i,a=r.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var c=0,l=s.length,u;c<l;++c)for(i=0,u=s[c];i<a;++i)if((o=r[i]).type===u.type&&o.name===u.name)return u.value}return}for(s=t?Oa:Da,i=0;i<a;++i)this.each(s(r[i],t,n));return this}function Aa(e,t,n){var r=zi(e),i=r.CustomEvent;typeof i==`function`?i=new i(t,n):(i=r.document.createEvent(`Event`),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function ja(e,t){return function(){return Aa(this,e,t)}}function Ma(e,t){return function(){return Aa(this,e,t.apply(this,arguments))}}function Na(e,t){return this.each((typeof t==`function`?Ma:ja)(e,t))}function*Pa(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length,o;i<a;++i)(o=r[i])&&(yield o)}var Fa=[null];function Ia(e,t){this._groups=e,this._parents=t}function La(){return new Ia([[document.documentElement]],Fa)}function Ra(){return this}Ia.prototype=La.prototype={constructor:Ia,select:Jr,selectAll:$r,selectChild:ai,selectChildren:li,filter:ui,data:vi,enter:fi,exit:bi,join:xi,merge:Si,selection:Ra,order:Ci,sort:wi,call:Ei,nodes:Di,node:Oi,size:ki,empty:Ai,each:ji,attr:Ri,style:Ui,property:Ji,classed:ra,text:sa,html:da,raise:pa,lower:ha,append:ga,insert:va,remove:ba,clone:Ca,datum:wa,on:ka,dispatch:Na,[Symbol.iterator]:Pa};function za(e){return typeof e==`string`?new Ia([[document.querySelector(e)]],[document.documentElement]):new Ia([[e]],Fa)}function Ba(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Va(e,t){if(e=Ba(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}var Ha={capture:!0,passive:!1};function Ua(e){e.preventDefault(),e.stopImmediatePropagation()}function Wa(e){var t=e.document.documentElement,n=za(e).on(`dragstart.drag`,Ua,Ha);`onselectstart`in t?n.on(`selectstart.drag`,Ua,Ha):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect=`none`)}function Ga(e,t){var n=e.document.documentElement,r=za(e).on(`dragstart.drag`,null);t&&(r.on(`click.drag`,Ua,Ha),setTimeout(function(){r.on(`click.drag`,null)},0)),`onselectstart`in n?r.on(`selectstart.drag`,null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Ka(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function qa(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Ja(){}var Ya=.7,Xa=1/Ya,Za=`\\s*([+-]?\\d+)\\s*`,Qa=`\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*`,$a=`\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*`,eo=/^#([0-9a-f]{3,8})$/,to=RegExp(`^rgb\\(${Za},${Za},${Za}\\)$`),no=RegExp(`^rgb\\(${$a},${$a},${$a}\\)$`),ro=RegExp(`^rgba\\(${Za},${Za},${Za},${Qa}\\)$`),io=RegExp(`^rgba\\(${$a},${$a},${$a},${Qa}\\)$`),ao=RegExp(`^hsl\\(${Qa},${$a},${$a}\\)$`),oo=RegExp(`^hsla\\(${Qa},${$a},${$a},${Qa}\\)$`),so={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ka(Ja,po,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:co,formatHex:co,formatHex8:lo,formatHsl:uo,formatRgb:fo,toString:fo});function co(){return this.rgb().formatHex()}function lo(){return this.rgb().formatHex8()}function uo(){return Eo(this).formatHsl()}function fo(){return this.rgb().formatRgb()}function po(e){var t,n;return e=(e+``).trim().toLowerCase(),(t=eo.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?mo(t):n===3?new vo(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?ho(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?ho(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=to.exec(e))?new vo(t[1],t[2],t[3],1):(t=no.exec(e))?new vo(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=ro.exec(e))?ho(t[1],t[2],t[3],t[4]):(t=io.exec(e))?ho(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=ao.exec(e))?To(t[1],t[2]/100,t[3]/100,1):(t=oo.exec(e))?To(t[1],t[2]/100,t[3]/100,t[4]):so.hasOwnProperty(e)?mo(so[e]):e===`transparent`?new vo(NaN,NaN,NaN,0):null}function mo(e){return new vo(e>>16&255,e>>8&255,e&255,1)}function ho(e,t,n,r){return r<=0&&(e=t=n=NaN),new vo(e,t,n,r)}function go(e){return e instanceof Ja||(e=po(e)),e?(e=e.rgb(),new vo(e.r,e.g,e.b,e.opacity)):new vo}function _o(e,t,n,r){return arguments.length===1?go(e):new vo(e,t,n,r??1)}function vo(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}Ka(vo,_o,qa(Ja,{brighter(e){return e=e==null?Xa:Xa**+e,new vo(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Ya:Ya**+e,new vo(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new vo(Co(this.r),Co(this.g),Co(this.b),So(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yo,formatHex:yo,formatHex8:bo,formatRgb:xo,toString:xo}));function yo(){return`#${wo(this.r)}${wo(this.g)}${wo(this.b)}`}function bo(){return`#${wo(this.r)}${wo(this.g)}${wo(this.b)}${wo((isNaN(this.opacity)?1:this.opacity)*255)}`}function xo(){let e=So(this.opacity);return`${e===1?`rgb(`:`rgba(`}${Co(this.r)}, ${Co(this.g)}, ${Co(this.b)}${e===1?`)`:`, ${e})`}`}function So(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Co(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function wo(e){return e=Co(e),(e<16?`0`:``)+e.toString(16)}function To(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Oo(e,t,n,r)}function Eo(e){if(e instanceof Oo)return new Oo(e.h,e.s,e.l,e.opacity);if(e instanceof Ja||(e=po(e)),!e)return new Oo;if(e instanceof Oo)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,c=(a+i)/2;return s?(o=t===a?(n-r)/s+(n<r)*6:n===a?(r-t)/s+2:(t-n)/s+4,s/=c<.5?a+i:2-a-i,o*=60):s=c>0&&c<1?0:o,new Oo(o,s,c,e.opacity)}function Do(e,t,n,r){return arguments.length===1?Eo(e):new Oo(e,t,n,r??1)}function Oo(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Ka(Oo,Do,qa(Ja,{brighter(e){return e=e==null?Xa:Xa**+e,new Oo(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Ya:Ya**+e,new Oo(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new vo(jo(e>=240?e-240:e+120,i,r),jo(e,i,r),jo(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Oo(ko(this.h),Ao(this.s),Ao(this.l),So(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=So(this.opacity);return`${e===1?`hsl(`:`hsla(`}${ko(this.h)}, ${Ao(this.s)*100}%, ${Ao(this.l)*100}%${e===1?`)`:`, ${e})`}`}}));function ko(e){return e=(e||0)%360,e<0?e+360:e}function Ao(e){return Math.max(0,Math.min(1,e||0))}function jo(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var Mo=e=>()=>e;function No(e,t){return function(n){return e+n*t}}function Po(e,t,n){return e**=+n,t=t**+n-e,n=1/n,function(r){return(e+r*t)**+n}}function Fo(e){return(e=+e)==1?Io:function(t,n){return n-t?Po(t,n,e):Mo(isNaN(t)?n:t)}}function Io(e,t){var n=t-e;return n?No(e,n):Mo(isNaN(e)?t:e)}var Lo=function e(t){var n=Fo(t);function r(e,t){var r=n((e=_o(e)).r,(t=_o(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=Io(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+``}}return r.gamma=e,r}(1);function Ro(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var zo=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Bo=new RegExp(zo.source,`g`);function Vo(e){return function(){return e}}function Ho(e){return function(t){return e(t)+``}}function Uo(e,t){var n=zo.lastIndex=Bo.lastIndex=0,r,i,a,o=-1,s=[],c=[];for(e+=``,t+=``;(r=zo.exec(e))&&(i=Bo.exec(t));)(a=i.index)>n&&(a=t.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,c.push({i:o,x:Ro(r,i)})),n=Bo.lastIndex;return n<t.length&&(a=t.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?c[0]?Ho(c[0].x):Vo(t):(t=c.length,function(e){for(var n=0,r;n<t;++n)s[(r=c[n]).i]=r.x(e);return s.join(``)})}var Wo=180/Math.PI,Go={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ko(e,t,n,r,i,a){var o,s,c;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(c=e*n+t*r)&&(n-=e*c,r-=t*c),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,c/=s),e*r<t*n&&(e=-e,t=-t,c=-c,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*Wo,skewX:Math.atan(c)*Wo,scaleX:o,scaleY:s}}var qo;function Jo(e){let t=new(typeof DOMMatrix==`function`?DOMMatrix:WebKitCSSMatrix)(e+``);return t.isIdentity?Go:Ko(t.a,t.b,t.c,t.d,t.e,t.f)}function Yo(e){return e==null||(qo||=document.createElementNS(`http://www.w3.org/2000/svg`,`g`),qo.setAttribute(`transform`,e),!(e=qo.transform.baseVal.consolidate()))?Go:(e=e.matrix,Ko(e.a,e.b,e.c,e.d,e.e,e.f))}function Xo(e,t,n,r){function i(e){return e.length?e.pop()+` `:``}function a(e,r,i,a,o,s){if(e!==i||r!==a){var c=o.push(`translate(`,null,t,null,n);s.push({i:c-4,x:Ro(e,i)},{i:c-2,x:Ro(r,a)})}else (i||a)&&o.push(`translate(`+i+t+a+n)}function o(e,t,n,a){e===t?t&&n.push(i(n)+`rotate(`+t+r):(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+`rotate(`,null,r)-2,x:Ro(e,t)}))}function s(e,t,n,a){e===t?t&&n.push(i(n)+`skewX(`+t+r):a.push({i:n.push(i(n)+`skewX(`,null,r)-2,x:Ro(e,t)})}function c(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+`scale(`,null,`,`,null,`)`);o.push({i:s-4,x:Ro(e,n)},{i:s-2,x:Ro(t,r)})}else (n!==1||r!==1)&&a.push(i(a)+`scale(`+n+`,`+r+`)`)}return function(t,n){var r=[],i=[];return t=e(t),n=e(n),a(t.translateX,t.translateY,n.translateX,n.translateY,r,i),o(t.rotate,n.rotate,r,i),s(t.skewX,n.skewX,r,i),c(t.scaleX,t.scaleY,n.scaleX,n.scaleY,r,i),t=n=null,function(e){for(var t=-1,n=i.length,a;++t<n;)r[(a=i[t]).i]=a.x(e);return r.join(``)}}}var Zo=Xo(Jo,`px, `,`px)`,`deg)`),Qo=Xo(Yo,`, `,`)`,`)`),$o=1e-12;function es(e){return((e=Math.exp(e))+1/e)/2}function ts(e){return((e=Math.exp(e))-1/e)/2}function ns(e){return((e=Math.exp(2*e))-1)/(e+1)}var rs=function e(t,n,r){function i(e,i){var a=e[0],o=e[1],s=e[2],c=i[0],l=i[1],u=i[2],d=c-a,f=l-o,p=d*d+f*f,m,h;if(p<$o)h=Math.log(u/s)/t,m=function(e){return[a+e*d,o+e*f,s*Math.exp(t*e*h)]};else{var g=Math.sqrt(p),_=(u*u-s*s+r*p)/(2*s*n*g),v=(u*u-s*s-r*p)/(2*u*n*g),y=Math.log(Math.sqrt(_*_+1)-_);h=(Math.log(Math.sqrt(v*v+1)-v)-y)/t,m=function(e){var r=e*h,i=es(y),c=s/(n*g)*(i*ns(t*r+y)-ts(y));return[a+c*d,o+c*f,s*i/es(t*r+y)]}}return m.duration=h*1e3*t/Math.SQRT2,m}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4),is=0,as=0,os=0,ss=1e3,cs,ls,us=0,ds=0,fs=0,ps=typeof performance==`object`&&performance.now?performance:Date,ms=typeof window==`object`&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function hs(){return ds||=(ms(gs),ps.now()+fs)}function gs(){ds=0}function _s(){this._call=this._time=this._next=null}_s.prototype=vs.prototype={constructor:_s,restart:function(e,t,n){if(typeof e!=`function`)throw TypeError(`callback is not a function`);n=(n==null?hs():+n)+(t==null?0:+t),!this._next&&ls!==this&&(ls?ls._next=this:cs=this,ls=this),this._call=e,this._time=n,Cs()},stop:function(){this._call&&(this._call=null,this._time=1/0,Cs())}};function vs(e,t,n){var r=new _s;return r.restart(e,t,n),r}function ys(){hs(),++is;for(var e=cs,t;e;)(t=ds-e._time)>=0&&e._call.call(void 0,t),e=e._next;--is}function bs(){ds=(us=ps.now())+fs,is=as=0;try{ys()}finally{is=0,Ss(),ds=0}}function xs(){var e=ps.now(),t=e-us;t>ss&&(fs-=t,us=e)}function Ss(){for(var e,t=cs,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:cs=n);ls=e,Cs(r)}function Cs(e){is||(as&&=clearTimeout(as),e-ds>24?(e<1/0&&(as=setTimeout(bs,e-ps.now()-fs)),os&&=clearInterval(os)):(os||=(us=ps.now(),setInterval(xs,ss)),is=1,ms(bs)))}function ws(e,t,n){var r=new _s;return t=t==null?0:+t,r.restart(n=>{r.stop(),e(n+t)},t,n),r}var Ts=Fr(`start`,`end`,`cancel`,`interrupt`),Es=[],Ds=0,Os=1,ks=2,As=3,js=4,Ms=5,Ns=6;function Ps(e,t,n,r,i,a){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;Rs(e,n,{name:t,index:r,group:i,on:Ts,tween:Es,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Ds})}function Fs(e,t){var n=Ls(e,t);if(n.state>Ds)throw Error(`too late; already scheduled`);return n}function Is(e,t){var n=Ls(e,t);if(n.state>As)throw Error(`too late; already running`);return n}function Ls(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw Error(`transition not found`);return n}function Rs(e,t,n){var r=e.__transition,i;r[t]=n,n.timer=vs(a,0,n.time);function a(e){n.state=Os,n.timer.restart(o,n.delay,n.time),n.delay<=e&&o(e-n.delay)}function o(a){var l,u,d,f;if(n.state!==Os)return c();for(l in r)if(f=r[l],f.name===n.name){if(f.state===As)return ws(o);f.state===js?(f.state=Ns,f.timer.stop(),f.on.call(`interrupt`,e,e.__data__,f.index,f.group),delete r[l]):+l<t&&(f.state=Ns,f.timer.stop(),f.on.call(`cancel`,e,e.__data__,f.index,f.group),delete r[l])}if(ws(function(){n.state===As&&(n.state=js,n.timer.restart(s,n.delay,n.time),s(a))}),n.state=ks,n.on.call(`start`,e,e.__data__,n.index,n.group),n.state===ks){for(n.state=As,i=Array(d=n.tween.length),l=0,u=-1;l<d;++l)(f=n.tween[l].value.call(e,e.__data__,n.index,n.group))&&(i[++u]=f);i.length=u+1}}function s(t){for(var r=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(c),n.state=Ms,1),a=-1,o=i.length;++a<o;)i[a].call(e,r);n.state===Ms&&(n.on.call(`end`,e,e.__data__,n.index,n.group),c())}function c(){for(var i in n.state=Ns,n.timer.stop(),delete r[t],r)return;delete e.__transition}}function zs(e,t){var n=e.__transition,r,i,a=!0,o;if(n){for(o in t=t==null?null:t+``,n){if((r=n[o]).name!==t){a=!1;continue}i=r.state>ks&&r.state<Ms,r.state=Ns,r.timer.stop(),r.on.call(i?`interrupt`:`cancel`,e,e.__data__,r.index,r.group),delete n[o]}a&&delete e.__transition}}function Bs(e){return this.each(function(){zs(this,e)})}function Vs(e,t){var n,r;return function(){var i=Is(this,e),a=i.tween;if(a!==n){r=n=a;for(var o=0,s=r.length;o<s;++o)if(r[o].name===t){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function Hs(e,t,n){var r,i;if(typeof n!=`function`)throw Error();return function(){var a=Is(this,e),o=a.tween;if(o!==r){i=(r=o).slice();for(var s={name:t,value:n},c=0,l=i.length;c<l;++c)if(i[c].name===t){i[c]=s;break}c===l&&i.push(s)}a.tween=i}}function Us(e,t){var n=this._id;if(e+=``,arguments.length<2){for(var r=Ls(this.node(),n).tween,i=0,a=r.length,o;i<a;++i)if((o=r[i]).name===e)return o.value;return null}return this.each((t==null?Vs:Hs)(n,e,t))}function Ws(e,t,n){var r=e._id;return e.each(function(){var e=Is(this,r);(e.value||={})[t]=n.apply(this,arguments)}),function(e){return Ls(e,r).value[t]}}function Gs(e,t){var n;return(typeof t==`number`?Ro:t instanceof po?Lo:(n=po(t))?(t=n,Lo):Uo)(e,t)}function Ks(e){return function(){this.removeAttribute(e)}}function qs(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Js(e,t,n){var r,i=n+``,a;return function(){var o=this.getAttribute(e);return o===i?null:o===r?a:a=t(r=o,n)}}function Ys(e,t,n){var r,i=n+``,a;return function(){var o=this.getAttributeNS(e.space,e.local);return o===i?null:o===r?a:a=t(r=o,n)}}function Xs(e,t,n){var r,i,a;return function(){var o,s=n(this),c;return s==null?void this.removeAttribute(e):(o=this.getAttribute(e),c=s+``,o===c?null:o===r&&c===i?a:(i=c,a=t(r=o,s)))}}function Zs(e,t,n){var r,i,a;return function(){var o,s=n(this),c;return s==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),c=s+``,o===c?null:o===r&&c===i?a:(i=c,a=t(r=o,s)))}}function Qs(e,t){var n=Hr(e),r=n===`transform`?Qo:Gs;return this.attrTween(e,typeof t==`function`?(n.local?Zs:Xs)(n,r,Ws(this,`attr.`+e,t)):t==null?(n.local?qs:Ks)(n):(n.local?Ys:Js)(n,r,t))}function $s(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function ec(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function tc(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&ec(e,i)),n}return i._value=t,i}function nc(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&$s(e,i)),n}return i._value=t,i}function rc(e,t){var n=`attr.`+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!=`function`)throw Error();var r=Hr(e);return this.tween(n,(r.local?tc:nc)(r,t))}function ic(e,t){return function(){Fs(this,e).delay=+t.apply(this,arguments)}}function ac(e,t){return t=+t,function(){Fs(this,e).delay=t}}function oc(e){var t=this._id;return arguments.length?this.each((typeof e==`function`?ic:ac)(t,e)):Ls(this.node(),t).delay}function sc(e,t){return function(){Is(this,e).duration=+t.apply(this,arguments)}}function cc(e,t){return t=+t,function(){Is(this,e).duration=t}}function lc(e){var t=this._id;return arguments.length?this.each((typeof e==`function`?sc:cc)(t,e)):Ls(this.node(),t).duration}function uc(e,t){if(typeof t!=`function`)throw Error();return function(){Is(this,e).ease=t}}function dc(e){var t=this._id;return arguments.length?this.each(uc(t,e)):Ls(this.node(),t).ease}function fc(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!=`function`)throw Error();Is(this,e).ease=n}}function pc(e){if(typeof e!=`function`)throw Error();return this.each(fc(this._id,e))}function mc(e){typeof e!=`function`&&(e=ei(e));for(var t=this._groups,n=t.length,r=Array(n),i=0;i<n;++i)for(var a=t[i],o=a.length,s=r[i]=[],c,l=0;l<o;++l)(c=a[l])&&e.call(c,c.__data__,l,a)&&s.push(c);return new Uc(r,this._parents,this._name,this._id)}function hc(e){if(e._id!==this._id)throw Error();for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),o=Array(r),s=0;s<a;++s)for(var c=t[s],l=n[s],u=c.length,d=o[s]=Array(u),f,p=0;p<u;++p)(f=c[p]||l[p])&&(d[p]=f);for(;s<r;++s)o[s]=t[s];return new Uc(o,this._parents,this._name,this._id)}function gc(e){return(e+``).trim().split(/^|\s+/).every(function(e){var t=e.indexOf(`.`);return t>=0&&(e=e.slice(0,t)),!e||e===`start`})}function _c(e,t,n){var r,i,a=gc(t)?Fs:Is;return function(){var o=a(this,e),s=o.on;s!==r&&(i=(r=s).copy()).on(t,n),o.on=i}}function vc(e,t){var n=this._id;return arguments.length<2?Ls(this.node(),n).on.on(e):this.each(_c(n,e,t))}function yc(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function bc(){return this.on(`end.remove`,yc(this._id))}function xc(e){var t=this._name,n=this._id;typeof e!=`function`&&(e=qr(e));for(var r=this._groups,i=r.length,a=Array(i),o=0;o<i;++o)for(var s=r[o],c=s.length,l=a[o]=Array(c),u,d,f=0;f<c;++f)(u=s[f])&&(d=e.call(u,u.__data__,f,s))&&(`__data__`in u&&(d.__data__=u.__data__),l[f]=d,Ps(l[f],t,n,f,l,Ls(u,n)));return new Uc(a,this._parents,t,n)}function Sc(e){var t=this._name,n=this._id;typeof e!=`function`&&(e=Zr(e));for(var r=this._groups,i=r.length,a=[],o=[],s=0;s<i;++s)for(var c=r[s],l=c.length,u,d=0;d<l;++d)if(u=c[d]){for(var f=e.call(u,u.__data__,d,c),p,m=Ls(u,n),h=0,g=f.length;h<g;++h)(p=f[h])&&Ps(p,t,n,h,f,m);a.push(f),o.push(u)}return new Uc(a,o,t,n)}var Cc=La.prototype.constructor;function wc(){return new Cc(this._groups,this._parents)}function Tc(e,t){var n,r,i;return function(){var a=Wi(this,e),o=(this.style.removeProperty(e),Wi(this,e));return a===o?null:a===n&&o===r?i:i=t(n=a,r=o)}}function Ec(e){return function(){this.style.removeProperty(e)}}function Dc(e,t,n){var r,i=n+``,a;return function(){var o=Wi(this,e);return o===i?null:o===r?a:a=t(r=o,n)}}function Oc(e,t,n){var r,i,a;return function(){var o=Wi(this,e),s=n(this),c=s+``;return s??(c=s=(this.style.removeProperty(e),Wi(this,e))),o===c?null:o===r&&c===i?a:(i=c,a=t(r=o,s))}}function kc(e,t){var n,r,i,a=`style.`+t,o=`end.`+a,s;return function(){var c=Is(this,e),l=c.on,u=c.value[a]==null?s||=Ec(t):void 0;(l!==n||i!==u)&&(r=(n=l).copy()).on(o,i=u),c.on=r}}function Ac(e,t,n){var r=(e+=``)==`transform`?Zo:Gs;return t==null?this.styleTween(e,Tc(e,r)).on(`end.style.`+e,Ec(e)):typeof t==`function`?this.styleTween(e,Oc(e,r,Ws(this,`style.`+e,t))).each(kc(this._id,e)):this.styleTween(e,Dc(e,r,t),n).on(`end.style.`+e,null)}function jc(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function Mc(e,t,n){var r,i;function a(){var a=t.apply(this,arguments);return a!==i&&(r=(i=a)&&jc(e,a,n)),r}return a._value=t,a}function Nc(e,t,n){var r=`style.`+(e+=``);if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!=`function`)throw Error();return this.tween(r,Mc(e,t,n??``))}function Pc(e){return function(){this.textContent=e}}function Fc(e){return function(){this.textContent=e(this)??``}}function Ic(e){return this.tween(`text`,typeof e==`function`?Fc(Ws(this,`text`,e)):Pc(e==null?``:e+``))}function Lc(e){return function(t){this.textContent=e.call(this,t)}}function Rc(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Lc(r)),t}return r._value=e,r}function zc(e){var t=`text`;if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!=`function`)throw Error();return this.tween(t,Rc(e))}function Bc(){for(var e=this._name,t=this._id,n=Wc(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],s=o.length,c,l=0;l<s;++l)if(c=o[l]){var u=Ls(c,t);Ps(c,e,n,l,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Uc(r,this._parents,e,n)}function Vc(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(a,o){var s={value:o},c={value:function(){--i===0&&a()}};n.each(function(){var n=Is(this,r),i=n.on;i!==e&&(t=(e=i).copy(),t._.cancel.push(s),t._.interrupt.push(s),t._.end.push(c)),n.on=t}),i===0&&a()})}var Hc=0;function Uc(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function Wc(){return++Hc}var Gc=La.prototype;Uc.prototype={constructor:Uc,select:xc,selectAll:Sc,selectChild:Gc.selectChild,selectChildren:Gc.selectChildren,filter:mc,merge:hc,selection:wc,transition:Bc,call:Gc.call,nodes:Gc.nodes,node:Gc.node,size:Gc.size,empty:Gc.empty,each:Gc.each,on:vc,attr:Qs,attrTween:rc,style:Ac,styleTween:Nc,text:Ic,textTween:zc,remove:bc,tween:Us,delay:oc,duration:lc,ease:dc,easeVarying:pc,end:Vc,[Symbol.iterator]:Gc[Symbol.iterator]};function Kc(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var qc={time:null,delay:0,duration:250,ease:Kc};function Jc(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw Error(`transition ${t} not found`);return n}function Yc(e){var t,n;e instanceof Uc?(t=e._id,e=e._name):(t=Wc(),(n=qc).time=hs(),e=e==null?null:e+``);for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],s=o.length,c,l=0;l<s;++l)(c=o[l])&&Ps(c,e,t,l,o,n||Jc(c,t));return new Uc(r,this._parents,e,t)}La.prototype.interrupt=Bs,La.prototype.transition=Yc;var Xc=e=>()=>e;function Zc(e,{sourceEvent:t,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function Qc(e,t,n){this.k=e,this.x=t,this.y=n}Qc.prototype={constructor:Qc,scale:function(e){return e===1?this:new Qc(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Qc(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return`translate(`+this.x+`,`+this.y+`) scale(`+this.k+`)`}};var $c=new Qc(1,0,0);Qc.prototype;function el(e){e.stopImmediatePropagation()}function tl(e){e.preventDefault(),e.stopImmediatePropagation()}function nl(e){return(!e.ctrlKey||e.type===`wheel`)&&!e.button}function rl(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute(`viewBox`)?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function il(){return this.__zoom||$c}function al(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function ol(){return navigator.maxTouchPoints||`ontouchstart`in this}function sl(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],a=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function cl(){var e=nl,t=rl,n=sl,r=al,i=ol,a=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],s=250,c=rs,l=Fr(`start`,`zoom`,`end`),u,d,f,p=500,m=150,h=0,g=10;function _(e){e.property(`__zoom`,il).on(`wheel.zoom`,w,{passive:!1}).on(`mousedown.zoom`,T).on(`dblclick.zoom`,E).filter(i).on(`touchstart.zoom`,D).on(`touchmove.zoom`,O).on(`touchend.zoom touchcancel.zoom`,k).style(`-webkit-tap-highlight-color`,`rgba(0,0,0,0)`)}_.transform=function(e,t,n,r){var i=e.selection?e.selection():e;i.property(`__zoom`,il),e===i?i.interrupt().each(function(){S(this,arguments).event(r).start().zoom(null,typeof t==`function`?t.apply(this,arguments):t).end()}):x(e,t,n,r)},_.scaleBy=function(e,t,n,r){_.scaleTo(e,function(){return this.__zoom.k*(typeof t==`function`?t.apply(this,arguments):t)},n,r)},_.scaleTo=function(e,r,i,a){_.transform(e,function(){var e=t.apply(this,arguments),a=this.__zoom,s=i==null?b(e):typeof i==`function`?i.apply(this,arguments):i,c=a.invert(s),l=typeof r==`function`?r.apply(this,arguments):r;return n(y(v(a,l),s,c),e,o)},i,a)},_.translateBy=function(e,r,i,a){_.transform(e,function(){return n(this.__zoom.translate(typeof r==`function`?r.apply(this,arguments):r,typeof i==`function`?i.apply(this,arguments):i),t.apply(this,arguments),o)},null,a)},_.translateTo=function(e,r,i,a,s){_.transform(e,function(){var e=t.apply(this,arguments),s=this.__zoom,c=a==null?b(e):typeof a==`function`?a.apply(this,arguments):a;return n($c.translate(c[0],c[1]).scale(s.k).translate(typeof r==`function`?-r.apply(this,arguments):-r,typeof i==`function`?-i.apply(this,arguments):-i),e,o)},a,s)};function v(e,t){return t=Math.max(a[0],Math.min(a[1],t)),t===e.k?e:new Qc(t,e.x,e.y)}function y(e,t,n){var r=t[0]-n[0]*e.k,i=t[1]-n[1]*e.k;return r===e.x&&i===e.y?e:new Qc(e.k,r,i)}function b(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function x(e,n,r,i){e.on(`start.zoom`,function(){S(this,arguments).event(i).start()}).on(`interrupt.zoom end.zoom`,function(){S(this,arguments).event(i).end()}).tween(`zoom`,function(){var e=this,a=arguments,o=S(e,a).event(i),s=t.apply(e,a),l=r==null?b(s):typeof r==`function`?r.apply(e,a):r,u=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),d=e.__zoom,f=typeof n==`function`?n.apply(e,a):n,p=c(d.invert(l).concat(u/d.k),f.invert(l).concat(u/f.k));return function(e){if(e===1)e=f;else{var t=p(e),n=u/t[2];e=new Qc(n,l[0]-t[0]*n,l[1]-t[1]*n)}o.zoom(null,e)}})}function S(e,t,n){return!n&&e.__zooming||new C(e,t)}function C(e,n){this.that=e,this.args=n,this.active=0,this.sourceEvent=null,this.extent=t.apply(e,n),this.taps=0}C.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit(`start`)),this},zoom:function(e,t){return this.mouse&&e!==`mouse`&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&e!==`touch`&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&e!==`touch`&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit(`zoom`),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit(`end`)),this},emit:function(e){var t=za(this.that).datum();l.call(e,this.that,new Zc(e,{sourceEvent:this.sourceEvent,target:_,type:e,transform:this.that.__zoom,dispatch:l}),t)}};function w(t,...i){if(!e.apply(this,arguments))return;var s=S(this,i).event(t),c=this.__zoom,l=Math.max(a[0],Math.min(a[1],c.k*2**r.apply(this,arguments))),u=Va(t);if(s.wheel)(s.mouse[0][0]!==u[0]||s.mouse[0][1]!==u[1])&&(s.mouse[1]=c.invert(s.mouse[0]=u)),clearTimeout(s.wheel);else if(c.k===l)return;else s.mouse=[u,c.invert(u)],zs(this),s.start();tl(t),s.wheel=setTimeout(d,m),s.zoom(`mouse`,n(y(v(c,l),s.mouse[0],s.mouse[1]),s.extent,o));function d(){s.wheel=null,s.end()}}function T(t,...r){if(f||!e.apply(this,arguments))return;var i=t.currentTarget,a=S(this,r,!0).event(t),s=za(t.view).on(`mousemove.zoom`,d,!0).on(`mouseup.zoom`,p,!0),c=Va(t,i),l=t.clientX,u=t.clientY;Wa(t.view),el(t),a.mouse=[c,this.__zoom.invert(c)],zs(this),a.start();function d(e){if(tl(e),!a.moved){var t=e.clientX-l,r=e.clientY-u;a.moved=t*t+r*r>h}a.event(e).zoom(`mouse`,n(y(a.that.__zoom,a.mouse[0]=Va(e,i),a.mouse[1]),a.extent,o))}function p(e){s.on(`mousemove.zoom mouseup.zoom`,null),Ga(e.view,a.moved),tl(e),a.event(e).end()}}function E(r,...i){if(e.apply(this,arguments)){var a=this.__zoom,c=Va(r.changedTouches?r.changedTouches[0]:r,this),l=a.invert(c),u=a.k*(r.shiftKey?.5:2),d=n(y(v(a,u),c,l),t.apply(this,i),o);tl(r),s>0?za(this).transition().duration(s).call(x,d,c,r):za(this).call(_.transform,d,c,r)}}function D(t,...n){if(e.apply(this,arguments)){var r=t.touches,i=r.length,a=S(this,n,t.changedTouches.length===i).event(t),o,s,c,l;for(el(t),s=0;s<i;++s)c=r[s],l=Va(c,this),l=[l,this.__zoom.invert(l),c.identifier],a.touch0?!a.touch1&&a.touch0[2]!==l[2]&&(a.touch1=l,a.taps=0):(a.touch0=l,o=!0,a.taps=1+!!u);u&&=clearTimeout(u),o&&(a.taps<2&&(d=l[0],u=setTimeout(function(){u=null},p)),zs(this),a.start())}}function O(e,...t){if(this.__zooming){var r=S(this,t).event(e),i=e.changedTouches,a=i.length,s,c,l,u;for(tl(e),s=0;s<a;++s)c=i[s],l=Va(c,this),r.touch0&&r.touch0[2]===c.identifier?r.touch0[0]=l:r.touch1&&r.touch1[2]===c.identifier&&(r.touch1[0]=l);if(c=r.that.__zoom,r.touch1){var d=r.touch0[0],f=r.touch0[1],p=r.touch1[0],m=r.touch1[1],h=(h=p[0]-d[0])*h+(h=p[1]-d[1])*h,g=(g=m[0]-f[0])*g+(g=m[1]-f[1])*g;c=v(c,Math.sqrt(h/g)),l=[(d[0]+p[0])/2,(d[1]+p[1])/2],u=[(f[0]+m[0])/2,(f[1]+m[1])/2]}else if(r.touch0)l=r.touch0[0],u=r.touch0[1];else return;r.zoom(`touch`,n(y(c,l,u),r.extent,o))}}function k(e,...t){if(this.__zooming){var n=S(this,t).event(e),r=e.changedTouches,i=r.length,a,o;for(el(e),f&&clearTimeout(f),f=setTimeout(function(){f=null},p),a=0;a<i;++a)o=r[a],n.touch0&&n.touch0[2]===o.identifier?delete n.touch0:n.touch1&&n.touch1[2]===o.identifier&&delete n.touch1;if(n.touch1&&!n.touch0&&(n.touch0=n.touch1,delete n.touch1),n.touch0)n.touch0[1]=this.__zoom.invert(n.touch0[0]);else if(n.end(),n.taps===2&&(o=Va(o,this),Math.hypot(d[0]-o[0],d[1]-o[1])<g)){var s=za(this).on(`dblclick.zoom`);s&&s.apply(this,arguments)}}}return _.wheelDelta=function(e){return arguments.length?(r=typeof e==`function`?e:Xc(+e),_):r},_.filter=function(t){return arguments.length?(e=typeof t==`function`?t:Xc(!!t),_):e},_.touchable=function(e){return arguments.length?(i=typeof e==`function`?e:Xc(!!e),_):i},_.extent=function(e){return arguments.length?(t=typeof e==`function`?e:Xc([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),_):t},_.scaleExtent=function(e){return arguments.length?(a[0]=+e[0],a[1]=+e[1],_):[a[0],a[1]]},_.translateExtent=function(e){return arguments.length?(o[0][0]=+e[0][0],o[1][0]=+e[1][0],o[0][1]=+e[0][1],o[1][1]=+e[1][1],_):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},_.constrain=function(e){return arguments.length?(n=e,_):n},_.duration=function(e){return arguments.length?(s=+e,_):s},_.interpolate=function(e){return arguments.length?(c=e,_):c},_.on=function(){var e=l.on.apply(l,arguments);return e===l?_:e},_.clickDistance=function(e){return arguments.length?(h=(e=+e)*e,_):Math.sqrt(h)},_.tapDistance=function(e){return arguments.length?(g=+e,_):g},_}var ll=Symbol(`MiniMapSlots`),ul=[`id`,`x`,`y`,`rx`,`ry`,`width`,`height`,`fill`,`stroke`,`stroke-width`,`shape-rendering`],dl=p({name:`MiniMapNode`,compatConfig:{MODE:3},inheritAttrs:!1,props:{id:{},type:{},selected:{type:Boolean},dragging:{type:Boolean},position:{},dimensions:{},borderRadius:{},color:{},shapeRendering:{},strokeColor:{},strokeWidth:{},hidden:{type:Boolean}},emits:[`click`,`dblclick`,`mouseenter`,`mousemove`,`mouseleave`],setup(e,{emit:t}){let n=e,r=te(ll),o=L(),c=_(()=>o.style??{});function l(e){t(`click`,e)}function u(e){t(`dblclick`,e)}function d(e){t(`mouseenter`,e)}function f(e){t(`mousemove`,e)}function p(e){t(`mouseleave`,e)}return(e,t)=>!e.hidden&&e.dimensions.width!==0&&e.dimensions.height!==0?(O(),i(b,{key:0},[s(r)[`node-${n.type}`]?(O(),h(D(s(r)[`node-${n.type}`]),U(v({key:0},{...n,...e.$attrs})),null,16)):(O(),i(`rect`,v({key:1,id:e.id},e.$attrs,{class:[`vue-flow__minimap-node`,{selected:e.selected,dragging:e.dragging}],x:e.position.x,y:e.position.y,rx:e.borderRadius,ry:e.borderRadius,width:e.dimensions.width,height:e.dimensions.height,fill:e.color||c.value.background||c.value.backgroundColor,stroke:e.strokeColor,"stroke-width":e.strokeWidth,"shape-rendering":e.shapeRendering,onClick:l,onDblclick:u,onMouseenter:d,onMousemove:f,onMouseleave:p}),null,16,ul))],64)):a(``,!0)}}),fl=[`width`,`height`,`viewBox`,`aria-labelledby`],pl=[`id`],ml=[`d`,`fill`,`stroke`,`stroke-width`],hl=p({name:`MiniMap`,compatConfig:{MODE:3},props:{nodeColor:{type:[String,Function],default:`#e2e2e2`},nodeStrokeColor:{type:[String,Function],default:`transparent`},nodeClassName:{type:[String,Function]},nodeBorderRadius:{default:5},nodeStrokeWidth:{default:2},maskColor:{default:`rgb(240, 240, 240, 0.6)`},maskStrokeColor:{default:`none`},maskStrokeWidth:{default:1},position:{default:`bottom-right`},pannable:{type:Boolean,default:!1},zoomable:{type:Boolean,default:!1},width:{},height:{},ariaLabel:{default:`Vue Flow mini map`},inversePan:{type:Boolean,default:!1},zoomStep:{default:1},offsetScale:{default:5},maskBorderRadius:{default:0}},emits:[`click`,`nodeClick`,`nodeDblclick`,`nodeMouseenter`,`nodeMousemove`,`nodeMouseleave`],setup(e,{emit:t}){let o=ee(),c=L(),{id:u,edges:d,viewport:f,translateExtent:p,dimensions:m,emits:g,d3Selection:v,d3Zoom:y,getNodesInitialized:x}=Ye(),S=l();F(ll,o);let C=_(()=>e.width??c.style?.width??200),E=_(()=>e.height??c.style?.height??150),D=typeof window>`u`||window.chrome?`crispEdges`:`geometricPrecision`,k=n(()=>typeof e.nodeColor==`string`?()=>e.nodeColor:e.nodeColor),A=n(()=>typeof e.nodeStrokeColor==`string`?()=>e.nodeStrokeColor:e.nodeStrokeColor),M=n(()=>typeof e.nodeClassName==`string`?()=>e.nodeClassName:typeof e.nodeClassName==`function`?e.nodeClassName:()=>``),N=n(()=>qe(x.value.filter(e=>!e.hidden))),P=n(()=>({x:-f.value.x/f.value.zoom,y:-f.value.y/f.value.zoom,width:m.value.width/f.value.zoom,height:m.value.height/f.value.zoom})),I=n(()=>x.value&&x.value.length?Ae(N.value,P.value):P.value),V=n(()=>{let e=I.value.width/C.value,t=I.value.height/E.value;return Math.max(e,t)}),H=n(()=>{let t=V.value*C.value,n=V.value*E.value,r=e.offsetScale*V.value;return{offset:r,x:I.value.x-(t-I.value.width)/2-r,y:I.value.y-(n-I.value.height)/2-r,width:t+r*2,height:n+r*2}}),U=n(()=>!H.value.x||!H.value.y?``:`
    M${H.value.x-H.value.offset},${H.value.y-H.value.offset}
    h${H.value.width+H.value.offset*2}
    v${H.value.height+H.value.offset*2}
    h${-H.value.width-H.value.offset*2}z
    M${P.value.x+e.maskBorderRadius},${P.value.y}
    h${P.value.width-2*e.maskBorderRadius}
    a${e.maskBorderRadius},${e.maskBorderRadius} 0 0 1 ${e.maskBorderRadius},${e.maskBorderRadius}
    v${P.value.height-2*e.maskBorderRadius}
    a${e.maskBorderRadius},${e.maskBorderRadius} 0 0 1 -${e.maskBorderRadius},${e.maskBorderRadius}
    h${-(P.value.width-2*e.maskBorderRadius)}
    a${e.maskBorderRadius},${e.maskBorderRadius} 0 0 1 -${e.maskBorderRadius},-${e.maskBorderRadius}
    v${-(P.value.height-2*e.maskBorderRadius)}
    a${e.maskBorderRadius},${e.maskBorderRadius} 0 0 1 ${e.maskBorderRadius},-${e.maskBorderRadius}z`);z(t=>{if(S.value){let n=za(S.value),r=cl().wheelDelta(t=>Ue(t)*(e.zoomStep/10)).on(`zoom`,e.pannable?t=>{if(t.sourceEvent.type!==`mousemove`||!v.value||!y.value)return;let n=V.value*Math.max(1,f.value.zoom)*(e.inversePan?-1:1),r={x:f.value.x-t.sourceEvent.movementX*n,y:f.value.y-t.sourceEvent.movementY*n},i=[[0,0],[m.value.width,m.value.height]],a=$c.translate(r.x,r.y).scale(f.value.zoom),o=y.value.constrain()(a,i,p.value);y.value.transform(v.value,o)}:()=>{}).on(`zoom.wheel`,e.zoomable?t=>{if(t.sourceEvent.type!==`wheel`||!v.value||!y.value)return;let n=t.sourceEvent.ctrlKey&&Qe()?10:1,r=-t.sourceEvent.deltaY*(t.sourceEvent.deltaMode===1?.05:t.sourceEvent.deltaMode?1:.002)*e.zoomStep,i=f.value.zoom*2**(r*n);y.value.scaleTo(v.value,i)}:()=>{});n.call(r),t(()=>{n.on(`zoom`,null)})}},{flush:`post`});function te(e){let[n,r]=Va(e);t(`click`,{event:e,position:{x:n,y:r}})}function ne(e,n){let r={event:e,node:n,connectedEdges:ge([n],d.value)};g.miniMapNodeClick(r),t(`nodeClick`,r)}function re(e,n){let r={event:e,node:n,connectedEdges:ge([n],d.value)};g.miniMapNodeDoubleClick(r),t(`nodeDblclick`,r)}function ie(e,n){let r={event:e,node:n,connectedEdges:ge([n],d.value)};g.miniMapNodeMouseEnter(r),t(`nodeMouseenter`,r)}function W(e,n){let r={event:e,node:n,connectedEdges:ge([n],d.value)};g.miniMapNodeMouseMove(r),t(`nodeMousemove`,r)}function ae(e,n){let r={event:e,node:n,connectedEdges:ge([n],d.value)};g.miniMapNodeMouseLeave(r),t(`nodeMouseleave`,r)}return(e,t)=>(O(),h(s(we),{position:e.position,class:R([`vue-flow__minimap`,{pannable:e.pannable,zoomable:e.zoomable}])},{default:T(()=>[(O(),i(`svg`,{ref_key:`el`,ref:S,width:C.value,height:E.value,viewBox:[H.value.x,H.value.y,H.value.width,H.value.height].join(` `),role:`img`,"aria-labelledby":`vue-flow__minimap-${s(u)}`,onClick:te},[e.ariaLabel?(O(),i(`title`,{key:0,id:`vue-flow__minimap-${s(u)}`},r(e.ariaLabel),9,pl)):a(``,!0),(O(!0),i(b,null,j(s(x),t=>(O(),h(dl,{id:t.id,key:t.id,f:``,position:t.computedPosition,dimensions:t.dimensions,selected:t.selected,dragging:t.dragging,style:w(t.style),class:R(M.value(t)),color:k.value(t),"border-radius":e.nodeBorderRadius,"stroke-color":A.value(t),"stroke-width":e.nodeStrokeWidth,"shape-rendering":s(D),type:t.type,hidden:t.hidden,onClick:e=>ne(e,t),onDblclick:e=>re(e,t),onMouseenter:e=>ie(e,t),onMousemove:e=>W(e,t),onMouseleave:e=>ae(e,t)},null,8,[`id`,`position`,`dimensions`,`selected`,`dragging`,`style`,`class`,`color`,`border-radius`,`stroke-color`,`stroke-width`,`shape-rendering`,`type`,`hidden`,`onClick`,`onDblclick`,`onMouseenter`,`onMousemove`,`onMouseleave`]))),128)),B(`path`,{class:`vue-flow__minimap-mask`,d:U.value,fill:e.maskColor,stroke:e.maskStrokeColor,"stroke-width":e.maskStrokeWidth,"fill-rule":`evenodd`},null,8,ml)],8,fl))]),_:1},8,[`position`,`class`]))}});function gl(e,t,n){let r=l();x(e,(e,t,n)=>{if(!e)return;let i=new ResizeObserver(e=>{let t=e[0];t&&(r.value=t.contentRect)});r.value={x:e.offsetLeft,y:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight},i.observe(e),n(()=>i.disconnect())},{immediate:!0}),x(r,async(e,r)=>{!e||!r||await n({x:t.value.x+(e.width-r.width)/2,y:t.value.y+(e.height-r.height)/2,zoom:t.value.zoom})})}var _l=[`id`],vl=p({__name:`CanvasArrowHeadMarker`,props:{id:{}},setup(e){return(t,n)=>(O(),i(`svg`,null,[B(`defs`,null,[B(`marker`,{id:e.id,viewBox:`-10 -10 20 20`,refX:`0`,refY:`0`,markerWidth:`12.5`,markerHeight:`12.5`,markerUnits:`strokeWidth`,orient:`auto-start-reverse`},[...n[0]||=[B(`polyline`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,points:`-5,-4 0,0 -5,4 -5,-4`,"stroke-width":`2`,stroke:`context-stroke`,fill:`context-stroke`},null,-1)]],8,_l)])]))}}),yl=130,bl=40,xl=16,Sl=20,Cl=(e,t)=>e-Sl>t;function wl(e,{connectionType:t=Q.Main}={}){let{targetX:n,targetY:r,sourceX:i,sourceY:a,sourcePosition:o,targetPosition:s}=e,c=a===r;if(!Cl(i,n)||t!==Q.Main){let t=Ve(e);return{segments:[t],labelPosition:[t[1],t[2]],isConnectorStraight:c}}let l=(i+n)/2,u=a+yl;return{segments:[ot({sourceX:i,sourceY:a,targetX:l,targetY:u,sourcePosition:o,targetPosition:Ie.Right,borderRadius:xl,offset:bl}),ot({sourceX:l,sourceY:u,targetX:n,targetY:r,sourcePosition:Ie.Left,targetPosition:s,borderRadius:xl,offset:bl})],labelPosition:[l,u],isConnectorStraight:c}}function Tl(){return pn(Ot)}var El=Y(p({__name:`CanvasConnectionLine`,props:{sourceX:{},sourceY:{},sourcePosition:{},targetX:{},targetY:{},targetPosition:{},sourceNode:{},sourceHandle:{},targetNode:{},targetHandle:{},markerStart:{},markerEnd:{},connectionStatus:{}},setup(e){let t=e,r=E(),{connectingHandle:a}=Tl(),o=n(()=>qt(a.value?.handleId).type),c=n(()=>({[r.edge]:!0,[r.visible]:p.value})),u=n(()=>({...o.value===Q.Main?{}:{strokeDasharray:`5,6`},strokeWidth:2,stroke:`var(--color--foreground--shade-2)`})),d=n(()=>wl(t,{connectionType:o.value})),f=n(()=>d.value.segments),p=l(!1);return y(()=>{setTimeout(()=>{p.value=!0},300)}),(t,n)=>(O(!0),i(b,null,j(f.value,t=>(O(),h(s(De),{key:t[0],class:R(c.value),style:w(u.value),path:t[0],"marker-end":e.markerEnd},null,8,[`class`,`style`,`path`,`marker-end`]))),128))}}),[[`__cssModules`,{$style:{edge:`_edge_qsnhv_125`,visible:`_visible_qsnhv_131`}}]]),Dl={},Ol={xmlns:`http://www.w3.org/2000/svg`,viewBox:`0 0 16 16`};function kl(e,t){return O(),i(`svg`,Ol,[...t[0]||=[B(`path`,{fill:`currentColor`,d:`M1.6.13c-.18-.17-.47-.18-.62 0L.56.57.14.98c-.2.15-.18.44 0 .62l3.63 3.6c.1.1.1.27 0 .37-.2.2-.53.52-.93.94-.56.57-.12 1.62.22 2.11.05.07.12.1.2.1.05-.01.1-.04.15-.08l5.23-5.22c.1-.1.1-.26-.02-.34-.5-.34-1.55-.78-2.12-.22-.42.4-.75.73-.94.93-.1.1-.27.1-.37 0L1.6.13ZM9.5 3.9c.07-.09.2-.1.3-.04l6.07 3.44c.15.08.18.29.05.4l-1.21 1.22a.26.26 0 0 1-.26.07l-2.18-.64a.26.26 0 0 0-.32.33l.76 2.02c.04.1.01.2-.06.27L7.7 15.92a.26.26 0 0 1-.41-.05L3.83 9.8a.26.26 0 0 1 .04-.3l5.62-5.6Z`},null,-1)]])}var Al=Y(Dl,[[`render`,kl]]),jl={name:`ControlButton`,compatConfig:{MODE:3}},Ml=(e,t)=>{let n=e.__vccOpts||e;for(let[e,r]of t)n[e]=r;return n},Nl={type:`button`,class:`vue-flow__controls-button`};function Pl(e,t,n,r,a,o){return O(),i(`button`,Nl,[S(e.$slots,`default`)])}var Fl=Ml(jl,[[`render`,Pl]]),Il={xmlns:`http://www.w3.org/2000/svg`,viewBox:`0 0 32 32`},Ll=[B(`path`,{d:`M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z`},null,-1)];function Rl(e,t){return O(),i(`svg`,Il,Ll)}var zl={render:Rl},Bl={xmlns:`http://www.w3.org/2000/svg`,viewBox:`0 0 32 5`},Vl=[B(`path`,{d:`M0 0h32v4.2H0z`},null,-1)];function Hl(e,t){return O(),i(`svg`,Bl,Vl)}var Ul={render:Hl},Wl={xmlns:`http://www.w3.org/2000/svg`,viewBox:`0 0 32 30`},Gl=[B(`path`,{d:`M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z`},null,-1)];function Kl(e,t){return O(),i(`svg`,Wl,Gl)}var ql={render:Kl},Jl={xmlns:`http://www.w3.org/2000/svg`,viewBox:`0 0 25 32`},Yl=[B(`path`,{d:`M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z`},null,-1)];function Xl(e,t){return O(),i(`svg`,Jl,Yl)}var Zl={render:Xl},Ql={xmlns:`http://www.w3.org/2000/svg`,viewBox:`0 0 25 32`},$l=[B(`path`,{d:`M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z`},null,-1)];function eu(e,t){return O(),i(`svg`,Ql,$l)}var tu={render:eu},nu=p({name:`Controls`,compatConfig:{MODE:3},props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>Me.BottomLeft}},emits:[`zoomIn`,`zoomOut`,`fitView`,`interactionChange`],setup(e,{emit:t}){let{nodesDraggable:n,nodesConnectable:r,elementsSelectable:o,setInteractive:c,zoomIn:l,zoomOut:u,fitView:d,viewport:p,minZoom:m,maxZoom:g}=Ye(),v=_(()=>n.value||r.value||o.value),y=_(()=>p.value.zoom<=m.value),x=_(()=>p.value.zoom>=g.value);function C(){l(),t(`zoomIn`)}function w(){u(),t(`zoomOut`)}function E(){d(e.fitViewParams),t(`fitView`)}function k(){c(!v.value),t(`interactionChange`,!v.value)}return(e,t)=>(O(),h(s(we),{class:`vue-flow__controls`,position:e.position},{default:T(()=>[S(e.$slots,`top`),e.showZoom?(O(),i(b,{key:0},[S(e.$slots,`control-zoom-in`,{},()=>[f(Fl,{class:`vue-flow__controls-zoomin`,disabled:x.value,onClick:C},{default:T(()=>[S(e.$slots,`icon-zoom-in`,{},()=>[(O(),h(D(s(zl))))])]),_:3},8,[`disabled`])]),S(e.$slots,`control-zoom-out`,{},()=>[f(Fl,{class:`vue-flow__controls-zoomout`,disabled:y.value,onClick:w},{default:T(()=>[S(e.$slots,`icon-zoom-out`,{},()=>[(O(),h(D(s(Ul))))])]),_:3},8,[`disabled`])])],64)):a(``,!0),e.showFitView?S(e.$slots,`control-fit-view`,{key:1},()=>[f(Fl,{class:`vue-flow__controls-fitview`,onClick:E},{default:T(()=>[S(e.$slots,`icon-fit-view`,{},()=>[(O(),h(D(s(ql))))])]),_:3})]):a(``,!0),e.showInteractive?S(e.$slots,`control-interactive`,{key:2},()=>[e.showInteractive?(O(),h(Fl,{key:0,class:`vue-flow__controls-interactive`,onClick:k},{default:T(()=>[v.value?S(e.$slots,`icon-unlock`,{key:0},()=>[(O(),h(D(s(tu))))]):a(``,!0),v.value?a(``,!0):S(e.$slots,`icon-lock`,{key:1},()=>[(O(),h(D(s(Zl))))])]),_:3})):a(``,!0)]):a(``,!0),S(e.$slots,`default`)]),_:3},8,[`position`]))}}),ru=Y(p({__name:`CanvasControlButtons`,props:{zoom:{default:1},readOnly:{type:Boolean,default:!1}},emits:[`reset-zoom`,`zoom-in`,`zoom-out`,`zoom-to-fit`,`tidy-up`,`toggle-zoom-mode`],setup(e,{emit:t}){let r=e,i=t,o=G(),c=tn(),l=n(()=>c.isActive(r.zoom)),u=n(()=>c.isZoomedViewEnabled),d=n(()=>!u.value&&r.zoom!==1);function p(){i(`reset-zoom`)}function m(){i(`zoom-in`)}function g(){i(`zoom-out`)}function _(){i(`zoom-to-fit`)}function v(){i(`tidy-up`)}return(t,n)=>(O(),h(s(nu),{"show-zoom":!1,"show-fit-view":!1},{default:T(()=>[f(dn,{label:s(o).baseText(`nodeView.zoomToFit`),shortcut:{keys:[`1`]}},{default:T(()=>[f(s(K),{variant:`subtle`,size:`large`,icon:`maximize`,"data-test-id":`zoom-to-fit`,onClick:_})]),_:1},8,[`label`]),f(dn,{label:s(o).baseText(`nodeView.zoomIn`),shortcut:{keys:[`+`]}},{default:T(()=>[f(s(K),{variant:`subtle`,size:`large`,icon:`zoom-in`,"data-test-id":`zoom-in-button`,onClick:m})]),_:1},8,[`label`]),f(dn,{label:s(o).baseText(`nodeView.zoomOut`),shortcut:{keys:[`-`]}},{default:T(()=>[f(s(K),{variant:`subtle`,size:`large`,icon:`zoom-out`,"data-test-id":`zoom-out-button`,onClick:g})]),_:1},8,[`label`]),u.value?(O(),h(dn,{key:0,label:s(o).baseText(l.value?`nodeView.leaveZoomMode`:`nodeView.enterZoomMode`),shortcut:{keys:[`Z`]}},{default:T(()=>[f(s(K),{variant:`subtle`,iconOnly:``,size:`large`,class:R(t.$style.iconButton),icon:l.value?`undo-2`:`crosshair`,onClick:n[0]||=e=>i(`toggle-zoom-mode`)},null,8,[`class`,`icon`])]),_:1},8,[`label`])):a(``,!0),d.value?(O(),h(dn,{key:1,label:s(o).baseText(`nodeView.resetZoom`),shortcut:{keys:[`0`]}},{default:T(()=>[f(s(K),{variant:`subtle`,size:`large`,icon:`undo-2`,"data-test-id":`reset-zoom-button`,onClick:p})]),_:1},8,[`label`])):a(``,!0),e.readOnly?a(``,!0):(O(),h(dn,{key:2,label:s(o).baseText(`nodeView.tidyUp`),shortcut:{shiftKey:!0,altKey:!0,keys:[`T`]}},{default:T(()=>[f(s(ce),{variant:`subtle`,iconOnly:``,size:`large`,"data-test-id":`tidy-up-button`,class:R(t.$style.iconButton),onClick:v},{default:T(()=>[f(Al)]),_:1},8,[`class`])]),_:1},8,[`label`])),l.value?(O(),h(s(q),{key:3,placement:`top`,content:s(o).baseText(`nodeView.expandAllNodes`)},{default:T(()=>[f(s(K),{variant:`subtle`,size:`large`,icon:`maximize-2`,onClick:s(c).expandAllNodes},null,8,[`onClick`])]),_:1},8,[`content`])):a(``,!0),l.value?(O(),h(s(q),{key:4,placement:`top`,content:s(o).baseText(`nodeView.collapseAllNodes`)},{default:T(()=>[f(s(K),{variant:`subtle`,size:`large`,icon:`minimize-2`,onClick:s(c).collapseAllNodes},null,8,[`onClick`])]),_:1},8,[`content`])):a(``,!0)]),_:1}))}}),[[`__cssModules`,{$style:{iconButton:`_iconButton_yqho8_125`}}]]),iu=Y(p({__name:`CanvasEdgeTooltip`,props:{content:{}},setup(e){let t=E();return(n,r)=>(O(),i(`div`,{class:R(s(t).tooltipContainer)},[f(s(q),{content:e.content,placement:`top`,teleported:!1,offset:8,"content-class":s(t).content},{default:T(()=>[S(n.$slots,`default`)]),_:3},8,[`content`,`content-class`])],2))}}),[[`__cssModules`,{$style:{tooltipContainer:`_tooltipContainer_yuv67_125`,content:`_content_yuv67_129`}}]]),au=Y(p({__name:`CanvasEdgeToolbar`,props:{type:{},targetNode:{},sourceNode:{}},emits:[`add`,`delete`],setup(e,{emit:t}){let r=t,o=e,c=E(),l=G(),u=n(()=>({[c.canvasEdgeToolbar]:!0})),d=n(()=>{let e=o.type===Q.Main,t=o.type===Q.AiTool&&(o.targetNode.data.type===`@n8n/n8n-nodes-langchain.agent`||o.targetNode.data.type===`@n8n/n8n-nodes-langchain.agentTool`)&&!Bt(o.sourceNode.data.type);return e||t});function p(){r(`add`)}function m(){r(`delete`)}return(t,n)=>(O(),i(`div`,{class:R(u.value),"data-test-id":`canvas-edge-toolbar`},[d.value?(O(),h(iu,{key:0,content:e.type===s(Q).AiTool?s(l).baseText(`node.add-human-review-step`):s(l).baseText(`node.add`)},{default:T(()=>[f(s(K),{variant:`subtle`,class:`canvas-edge-toolbar-button`,"data-test-id":`add-connection-button`,size:`small`,"icon-size":`medium`,icon:`plus`,onClick:p})]),_:1},8,[`content`])):a(``,!0),f(iu,{content:s(l).baseText(`node.delete`)},{default:T(()=>[f(s(K),{variant:`subtle`,"data-test-id":`delete-connection-button`,class:`canvas-edge-toolbar-button`,size:`small`,"icon-size":`medium`,icon:`trash-2`,onClick:m})]),_:1},8,[`content`])],2))}}),[[`__cssModules`,{$style:{canvasEdgeToolbar:`_canvasEdgeToolbar_1asvk_125`}}]]);function ou(e){function t(e,t,n,r=.2,i=2.2){return e>=1?t:e<=r?n:t+((1-e)/(1-r))**i*(n-t)}function r(r=l(!1)){return n(()=>{let n=e.value.zoom,i=t(n,.84,.6),a=t(n,.42,.66);return r.value&&(i=Math.max(0,i-.3),a=Math.min(1,a+.2)),{light:i.toFixed(3),dark:a.toFixed(3)}})}function i(){return n(()=>{let n=e.value.zoom,r=t(n,.68,.3),i=t(n,.5,.7);return{light:r.toFixed(3),dark:i.toFixed(3)}})}function a(){return n(()=>{let n=e.value.zoom,r=t(n,.1,.7),i=t(n,.2,.7);return{light:r.toFixed(3),dark:i.toFixed(3)}})}return{calculateZoomAdjustedValue:t,calculateEdgeLightness:r,calculateHandleLightness:i,calculateNodeBorderOpacity:a}}var su=[`data-source-node-name`,`data-target-node-name`],cu=[`data-source-node-name`,`data-target-node-name`,`data-edge-status`],lu=600,uu=Y(p({__name:`CanvasEdge`,props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},readOnly:{type:Boolean},hovered:{type:Boolean},bringToFront:{type:Boolean}},emits:[`add`,`delete`,`update:label:hovered`],setup(e,{emit:t}){let a=t,o=e,u=_(o,`data`),d=E(),{viewport:p}=Tl(),{calculateEdgeLightness:m}=ou(p),g=n(()=>He(o.data.source.type)?o.data.source.type:Q.Main),y=l(o.hovered),C=l(null);x(()=>o.hovered,e=>{e?(C.value&&clearTimeout(C.value),y.value=!0):C.value=setTimeout(()=>{y.value=!1},lu)},{immediate:!0});let D=n(()=>y.value&&!o.readOnly),k=n(()=>u.value.source.type===Q.Main),A=n(()=>o.data.status),M=n(()=>({...o.style,...k.value?{}:{strokeDasharray:`5,6`}})),N=n(()=>({[d.edge]:!0,hovered:y.value,"bring-to-front":o.bringToFront})),P=n(()=>({transform:`translate(-50%, -50%) translate(${L.value[0]}px, ${L.value[1]}px)`,...y.value&&o.bringToFront?{zIndex:1}:{}})),F=n(()=>({[d.edgeLabelWrapper]:!0,"vue-flow__edge-label":!0,selected:o.selected,[d.straight]:I.value.isConnectorStraight})),I=n(()=>wl(o,{connectionType:g.value})),ee=n(()=>I.value.segments),L=n(()=>I.value.labelPosition),z=n(()=>({source:o.source,target:o.target,sourceHandle:o.sourceHandleId,targetHandle:o.targetHandleId})),V=n(()=>{if(A.value===`success`)return`var(--color--success)`;if(A.value===`pinned`)return`var(--color--secondary)`}),H=n(()=>A.value===`success`||A.value===`pinned`),te=m(n(()=>H.value?!1:y.value)),ne=n(()=>{let e={"--canvas-edge--color--lightness--light":te.value.light,"--canvas-edge--color--lightness--dark":te.value.dark};return V.value&&(e[`--canvas-edge--color`]=V.value),e});function re(){a(`add`,z.value)}function ie(){a(`delete`,z.value)}function W(){a(`update:label:hovered`,!0)}function ae(){a(`update:label:hovered`,!1)}return(t,n)=>(O(),i(b,null,[B(`g`,v({"data-test-id":`edge`,"data-source-node-name":u.value.source?.node,"data-target-node-name":u.value.target?.node,style:ne.value},t.$attrs),[S(t.$slots,`highlight`,U(c({segments:ee.value}))),(O(!0),i(b,null,j(ee.value,(t,n)=>(O(),h(s(De),{id:`${e.id}-${n}`,key:t[0],class:R(N.value),style:w(M.value),path:t[0],"marker-end":k.value?e.markerEnd:void 0,"interaction-width":40},null,8,[`id`,`class`,`style`,`path`,`marker-end`]))),128))],16,su),f(s(et),null,{default:T(()=>[B(`div`,{"data-test-id":`edge-label`,"data-source-node-name":u.value.source?.node,"data-target-node-name":u.value.target?.node,"data-edge-status":A.value,style:w(P.value),class:R(F.value),onMouseenter:W,onMouseleave:ae},[D.value?(O(),h(au,{key:0,type:g.value,"target-node":e.targetNode,"source-node":e.sourceNode,onAdd:re,onDelete:ie},null,8,[`type`,`target-node`,`source-node`])):(O(),i(`div`,{key:1,class:R(s(d).edgeLabel)},r(e.label),3))],46,cu)]),_:1})],64))}}),[[`__cssModules`,{$style:{edge:`_edge_1yu3o_125`,edgeLabelWrapper:`_edgeLabelWrapper_1yu3o_133`,straight:`_straight_1yu3o_139`,edgeLabel:`_edgeLabel_1yu3o_133`}}]]);function du(){let e=te(Ht),t=n(()=>e?.data.value??{id:``,name:``,subtitle:``,type:``,typeVersion:1,disabled:!1,inputs:[],outputs:[],connections:{[Z.Input]:{},[Z.Output]:{}},issues:{execution:[],validation:[],visible:!1},pinnedData:{count:0,visible:!1},execution:{running:!1},runData:{iterations:0,outputMap:{},visible:!1},render:{type:X.Default,options:{}}}),r=n(()=>e?.id.value??``),i=n(()=>e?.label.value??``),a=n(()=>t.value.subtitle),o=n(()=>t.value.name),s=n(()=>t.value.inputs),c=n(()=>t.value.outputs),l=n(()=>t.value.connections),u=n(()=>t.value.disabled),d=n(()=>e?.readOnly.value),f=n(()=>e?.selected.value),p=n(()=>t.value.pinnedData.count),m=n(()=>t.value.pinnedData.count>0),h=n(()=>[...t.value.issues.execution,...t.value.issues.validation]),g=n(()=>t.value.issues.execution??[]),_=n(()=>t.value.issues.validation??[]),v=n(()=>t.value.issues.visible),y=n(()=>t.value.issues.execution.length>0),b=n(()=>t.value.issues.validation.length>0),x=n(()=>t.value.execution.status),S=n(()=>t.value.execution.waiting),C=n(()=>t.value.execution.waitingForNext),w=n(()=>t.value.execution.running),T=n(()=>t.value.runData.outputMap);return{node:e,id:r,name:o,label:i,subtitle:a,inputs:s,outputs:c,connections:l,isDisabled:u,isReadOnly:d,isSelected:f,pinnedDataCount:p,hasPinnedData:m,runDataIterations:n(()=>t.value.runData.iterations),runDataOutputMap:T,hasRunData:n(()=>t.value.runData.visible),issues:h,executionErrors:g,validationErrors:_,hasIssues:v,hasExecutionErrors:y,hasValidationErrors:b,executionStatus:x,executionWaiting:S,executionWaitingForNext:C,executionRunning:w,render:n(()=>t.value.render),eventBus:n(()=>e?.eventBus.value),isNotInstalledCommunityNode:n(()=>Ct(t.value.type)&&!be().getIsNodeInstalled(t.value.type))}}var fu={key:4},pu={key:6},mu=Y(p({__name:`CanvasNodeStatusIcons`,props:{size:{default:`large`},spinnerScrim:{type:Boolean,default:!1},spinnerLayout:{default:`absolute`}},setup(e){let t=Ee(),o=G(),c=E(),{hasPinnedData:l,executionErrors:u,validationErrors:d,hasExecutionErrors:p,hasValidationErrors:m,executionStatus:h,hasRunData:g,runDataIterations:_,isDisabled:v,render:y,isNotInstalledCommunityNode:b}=du(),x=oe(),S=n(()=>!1),C=n(()=>x.name===It.DEMO),w=n(()=>y.value.type===X.Default?y.value.options.dirtiness:void 0),D=n(()=>[c.status,e.spinnerScrim?c.spinnerScrim:``,e.spinnerLayout===`absolute`?c.absoluteSpinner:``]),k=n(()=>{let e=u.value.reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{});return Object.entries(e).map(([e,t])=>t>1?`${e} (x${t})`:e)});return(n,u)=>s(b)&&!C.value?(O(),i(`div`,{key:0,class:R([...D.value,s(c).issues]),"data-test-id":`node-not-installed`},[f(s(q),{"show-after":500,placement:`bottom`},{content:T(()=>[M(r(s(o).baseText(`node.install-to-use`)),1)]),default:T(()=>[f(s(J),{icon:`hard-drive-download`,size:e.size},null,8,[`size`])]),_:1})],2)):s(v)?(O(),i(`div`,{key:1,class:R([...D.value,s(c).disabled])},[f(s(J),{icon:`power`,size:e.size},null,8,[`size`])],2)):s(p)&&!S.value?(O(),i(`div`,{key:2,class:R([...D.value,s(c).issues]),"data-test-id":`node-issues`},[f(s(q),{"show-after":500,placement:`bottom`},{content:T(()=>[f(dt,{title:`${s(o).baseText(`node.issues`)}:`,items:k.value},null,8,[`title`,`items`])]),default:T(()=>[f(s(J),{icon:`node-execution-error`,size:e.size},null,8,[`size`])]),_:1})],2)):s(m)&&!S.value?(O(),i(`div`,{key:3,class:R([...D.value,s(c).issues]),"data-test-id":`node-issues`},[f(s(q),{"show-after":500,placement:`bottom`},{content:T(()=>[f(dt,{title:`${s(o).baseText(`node.issues`)}:`,items:s(d)},null,8,[`title`,`items`])]),default:T(()=>[f(s(J),{icon:`node-validation-error`,size:e.size},null,8,[`size`])]),_:1})],2)):s(h)===`unknown`?(O(),i(`div`,fu)):s(l)&&!s(t).isProductionExecutionPreview.value?(O(),i(`div`,{key:5,"data-test-id":`canvas-node-status-pinned`,class:R([...D.value,s(c).pinnedData])},[f(s(J),{icon:`node-pin`,size:e.size},null,8,[`size`])],2)):w.value===void 0?s(g)&&s(h)===`success`?(O(),i(`div`,{key:7,"data-test-id":`canvas-node-status-success`,class:R([...D.value,s(c).runData])},[f(s(J),{icon:`node-success`,size:e.size},null,8,[`size`]),s(_)>1?(O(),i(`span`,{key:0,class:R(s(c).count)},r(s(_)),3)):a(``,!0)],2)):a(``,!0):(O(),i(`div`,pu,[f(s(q),{"show-after":500,placement:`bottom`},{content:T(()=>[M(r(s(o).baseText(w.value===s(st).PARAMETERS_UPDATED?`node.dirty`:`node.subjectToChange`)),1)]),default:T(()=>[B(`div`,{"data-test-id":`canvas-node-status-warning`,class:R([...D.value,s(c).warning])},[f(s(J),{icon:`node-dirty`,size:e.size},null,8,[`size`]),s(_)>1?(O(),i(`span`,{key:0,class:R(s(c).count)},r(s(_)),3)):a(``,!0)],2)]),_:1})]))}}),[[`__cssModules`,{$style:{status:`_status_v9j1u_125`,runData:`_runData_v9j1u_132`,waiting:`_waiting_v9j1u_136`,pinnedData:`_pinnedData_v9j1u_140`,running:`_running_v9j1u_144`,absoluteSpinner:`_absoluteSpinner_v9j1u_147`,spinnerScrim:`_spinnerScrim_v9j1u_160`,issues:`_issues_v9j1u_166`,count:`_count_v9j1u_171`,warning:`_warning_v9j1u_175`,disabled:`_disabled_v9j1u_179`}}]]),hu=[`title`],gu=[`onClick`],_u=[`title`],vu=Y(p({__name:`CanvasNodeStickyColorSelector`,props:{visible:{type:Boolean},visibleModifiers:{}},emits:g([`update`],[`update:visible`]),setup(e,{emit:t}){let r=t,a=G(),{render:o,eventBus:c}=du(),d=n(()=>o.value.options),p=l(null),m=n(()=>Array.from({length:7}).map((e,t)=>t+1)),h=k(e,`visible`),g=l(null);function _(){h.value=!1}function v(){h.value=!0}function x(e){r(`update`,e),_()}function S(){g.value?.click()}function C(e){let t=e.target;r(`update`,t.value.toUpperCase()),_()}function E(){p.value&&=(clearTimeout(p.value),null)}function D(){p.value=setTimeout(()=>{_()},1e3)}return y(()=>{c.value?.on(`update:sticky:color`,v)}),u(()=>{c.value?.off(`update:sticky:color`,v)}),(e,t)=>(O(),i(`div`,null,[f(s(ue),{open:h.value,"onUpdate:open":t[0]||=e=>h.value=e,side:`top`,width:`240px`,"content-class":e.$style.popover,"enable-scrolling":!1,onBeforeEnter:E,onAfterLeave:D},{trigger:T(()=>[B(`div`,{class:R(e.$style.option),"data-test-id":`change-sticky-color`,title:s(a).baseText(`node.changeColor`)},[f(s(J),{size:`small`,icon:`palette`})],10,hu)]),content:T(()=>[B(`div`,{class:R(e.$style.content)},[(O(!0),i(b,null,j(m.value,t=>(O(),i(`div`,{key:t,"data-test-id":`color`,class:R([e.$style.color,e.$style[`sticky-color-${t}`],d.value.color===t?e.$style.selected:``]),onClick:e=>x(t)},null,10,gu))),128)),B(`div`,{"data-test-id":`custom-color`,class:R([e.$style.color,e.$style.customColorButton,typeof d.value.color==`string`?e.$style.selected:``]),style:w(typeof d.value.color==`string`?{backgroundColor:d.value.color}:{}),title:s(a).baseText(`node.customColor`),onClick:A(S,[`stop`])},[f(s(J),{icon:`plus`,size:`xsmall`,class:R(e.$style.plusIcon)},null,8,[`class`])],14,_u)],2)]),_:1},8,[`open`,`content-class`]),B(`input`,{ref_key:`colorInputRef`,ref:g,type:`color`,class:R(e.$style.hiddenColorInput),"data-test-id":`native-color-input`,onChange:C},null,34)]))}}),[[`__cssModules`,{$style:{popover:`_popover_18eco_125`,content:`_content_18eco_131`,color:`_color_18eco_138`,selected:`_selected_18eco_150`,"sticky-color-1":`_sticky-color-1_18eco_153`,"sticky-color-2":`_sticky-color-2_18eco_156`,"sticky-color-3":`_sticky-color-3_18eco_159`,"sticky-color-4":`_sticky-color-4_18eco_162`,"sticky-color-5":`_sticky-color-5_18eco_165`,"sticky-color-6":`_sticky-color-6_18eco_168`,"sticky-color-7":`_sticky-color-7_18eco_171`,option:`_option_18eco_175`,customColorButton:`_customColorButton_18eco_187`,plusIcon:`_plusIcon_18eco_195`,hiddenColorInput:`_hiddenColorInput_18eco_204`}}]]),yu=Y(p({__name:`CanvasNodeToolbar`,props:{readOnly:{type:Boolean},showStatusIcons:{type:Boolean},itemsClass:{}},emits:[`delete`,`toggle`,`run`,`update`,`open:contextmenu`,`focus`,`add:ai`],setup(e,{emit:t}){let r=t,o=e,c=E(),u=G(),{isExecuting:d,isExperimentalNdvActive:p}=Tl(),{isDisabled:m,render:g,name:_}=du(),v=it(),y=be(),b=tn(),x=_e(),S=n(()=>_.value?v.getNodeByName(_.value):null),C=n(()=>!!S.value&&y.isToolNode(S.value.type)),w=n(()=>m.value?u.baseText(`node.enable`):u.baseText(`node.disable`)),D=l(!1),k=l(!1),j=n(()=>({[c.canvasNodeToolbar]:!0,[c.readOnly]:o.readOnly,[c.forceVisible]:k.value||D.value,[c.isExperimentalNdvActive]:p.value})),M=n(()=>!o.readOnly&&g.value.type===X.Default&&`configuration`in g.value.options&&(!g.value.options.configuration||C.value)),N=n(()=>!o.readOnly&&g.value.type===X.Default),P=n(()=>!o.readOnly),F=n(()=>b.isZoomedViewEnabled),I=n(()=>!o.readOnly&&x.isFeatureEnabled),ee=n(()=>!o.readOnly&&g.value.type===X.StickyNote);function L(){r(`run`)}function z(){r(`toggle`)}function V(){r(`delete`)}function H(e){r(`update`,{color:e})}function U(e){r(`open:contextmenu`,e)}function te(){k.value=!0}function ne(){k.value=!1}function re(){S.value&&r(`focus`,S.value.id)}function ie(){S.value&&r(`add:ai`,S.value.id)}return(t,n)=>(O(),i(`div`,{"data-test-id":`canvas-node-toolbar`,class:R(j.value),onMouseenter:te,onMouseleave:ne,onMousedown:n[1]||=A(()=>{},[`stop`]),onClick:n[2]||=A(()=>{},[`stop`])},[B(`div`,{class:R([s(c).canvasNodeToolbarItems,e.itemsClass])},[M.value?(O(),h(s(q),{key:0,placement:`top`,disabled:!s(m),content:s(u).baseText(`ndv.execute.deactivated`)},{default:T(()=>[f(s(K),{variant:`ghost`,"data-test-id":`execute-node-button`,size:`small`,icon:`node-play`,disabled:s(d)||s(m),title:s(u).baseText(`node.testStep`),onClick:A(L,[`stop`])},null,8,[`disabled`,`title`])]),_:1},8,[`disabled`,`content`])):a(``,!0),N.value?(O(),h(s(K),{key:1,variant:`ghost`,"data-test-id":`disable-node-button`,size:`small`,icon:`node-power`,title:w.value,onClick:A(z,[`stop`])},null,8,[`title`])):a(``,!0),P.value?(O(),h(s(K),{key:2,variant:`ghost`,"data-test-id":`delete-node-button`,size:`small`,icon:`node-trash`,title:s(u).baseText(`node.delete`),onClick:A(V,[`stop`])},null,8,[`title`])):a(``,!0),F.value?(O(),h(s(K),{key:3,variant:`ghost`,size:`small`,icon:`crosshair`,onClick:A(re,[`stop`])})):a(``,!0),ee.value?(O(),h(vu,{key:4,visible:D.value,"onUpdate:visible":n[0]||=e=>D.value=e,onUpdate:H},null,8,[`visible`])):a(``,!0),I.value?(O(),h(s(q),{key:5,placement:`top`,content:s(u).baseText(`node.addToAi`)},{default:T(()=>[f(s(K),{"data-test-id":`add-to-ai-button`,variant:`ghost`,size:`small`,text:``,icon:`sparkles`,onClick:A(ie,[`stop`])})]),_:1},8,[`content`])):a(``,!0),f(s(K),{variant:`ghost`,"data-test-id":`overflow-node-button`,size:`small`,icon:`node-ellipsis`,onClick:A(U,[`stop`])})],2),e.showStatusIcons?(O(),h(mu,{key:0,class:R(s(c).statusIcons),"spinner-layout":`static`},null,8,[`class`])):a(``,!0)],34))}}),[[`__cssModules`,{$style:{canvasNodeToolbar:`_canvasNodeToolbar_bw5fp_125`,isExperimentalNdvActive:`_isExperimentalNdvActive_bw5fp_133`,canvasNodeToolbarItems:`_canvasNodeToolbarItems_bw5fp_142`,forceVisible:`_forceVisible_bw5fp_154`,statusIcons:`_statusIcons_bw5fp_158`}}]]);function bu({inputs:e,outputs:t,connections:r}){let i=n(()=>s(e).filter(e=>e.type===Q.Main)),a=n(()=>s(e).filter(e=>e.type!==Q.Main)),o=n(()=>a.value.filter(e=>e.required)),c=n(()=>s(r)[Z.Input][Q.Main]??[]),l=n(()=>s(t).filter(e=>e.type===Q.Main)),u=n(()=>s(t).filter(e=>e.type!==Q.Main)),d=n(()=>s(r)[Z.Output][Q.Main]??[]);function f(e){let{type:t,mode:n}=qt(e.sourceHandle),{type:r,mode:i}=qt(e.targetHandle);return n!==i&&t===r}return{mainInputs:i,nonMainInputs:a,requiredNonMainInputs:o,mainInputConnections:c,mainOutputs:l,nonMainOutputs:u,mainOutputConnections:d,isValidConnection:f}}var xu=`small`,Su=Y(p({__name:`CanvasNodeSettingsIcons`,setup(e){let{name:t}=du(),o=G(),c=it(),l=rt(),{isEnabled:u}=rn(),d=n(()=>c.workflowObject.getNode(t.value)),p=n(()=>{let e=d.value?.credentials;return e?Object.values(e).some(e=>e?.id?l.getCredentialById(e.id)?.isResolvable===!0:!1):!1}),m=n(()=>{let e=d.value?.parameters?.contextEstablishmentHooks;if(typeof e!=`object`||!e||!(`hooks`in e))return!1;let t=e.hooks;return Array.isArray(t)&&t.length>0}),g=n(()=>p.value||m.value);return(e,t)=>(O(),i(`div`,{class:R(e.$style.settingsIcons)},[d.value?.alwaysOutputData?(O(),h(s(q),{key:0},{content:T(()=>[B(`div`,{class:R(e.$style.tooltipHeader)},[f(s(J),{icon:`always-output-data`,size:xu}),B(`strong`,{class:R(e.$style.tooltipTitle)},r(s(o).baseText(`nodeSettings.alwaysOutputData.displayName`)),3)],2),B(`div`,null,r(s(o).baseText(`node.settings.alwaysOutputData`)),1)]),default:T(()=>[B(`div`,{"data-test-id":`canvas-node-status-always-output-data`,class:R(e.$style.icon)},[f(s(J),{icon:`always-output-data`,size:xu})],2)]),_:1})):a(``,!0),d.value?.executeOnce?(O(),h(s(q),{key:1},{content:T(()=>[B(`div`,{class:R(e.$style.tooltipHeader)},[f(s(J),{icon:`execute-once`,size:xu}),B(`strong`,{class:R(e.$style.tooltipTitle)},r(s(o).baseText(`nodeSettings.executeOnce.displayName`)),3)],2),B(`div`,null,r(s(o).baseText(`node.settings.executeOnce`)),1)]),default:T(()=>[B(`div`,{"data-test-id":`canvas-node-status-execute-once`,class:R(e.$style.icon)},[f(s(J),{icon:`execute-once`,size:xu})],2)]),_:1})):a(``,!0),d.value?.retryOnFail?(O(),h(s(q),{key:2},{content:T(()=>[B(`div`,{class:R(e.$style.tooltipHeader)},[f(s(J),{icon:`retry-on-fail`,size:xu}),B(`strong`,{class:R(e.$style.tooltipTitle)},r(s(o).baseText(`nodeSettings.retryOnFail.displayName`)),3)],2),B(`div`,null,r(s(o).baseText(`node.settings.retriesOnFailure`)),1)]),default:T(()=>[B(`div`,{"data-test-id":`canvas-node-status-retry-on-fail`,class:R(e.$style.icon)},[f(s(J),{icon:`retry-on-fail`,size:xu})],2)]),_:1})):a(``,!0),d.value?.onError===`continueRegularOutput`||d.value?.onError===`continueErrorOutput`?(O(),h(s(q),{key:3},{content:T(()=>[B(`div`,{class:R(e.$style.tooltipHeader)},[f(s(J),{icon:`continue-on-error`,size:xu}),B(`strong`,{class:R(e.$style.tooltipTitle)},r(s(o).baseText(`node.settings.continuesOnError.title`)),3)],2),B(`div`,null,r(s(o).baseText(`node.settings.continuesOnError`)),1)]),default:T(()=>[B(`div`,{"data-test-id":`canvas-node-status-continue-on-error`,class:R(e.$style.icon)},[f(s(J),{icon:`continue-on-error`,size:xu})],2)]),_:1})):a(``,!0),s(u)&&g.value?(O(),h(s(q),{key:4},{content:T(()=>[B(`div`,{class:R(e.$style.tooltipHeader)},[f(s(J),{icon:`key-round`,size:xu}),B(`strong`,{class:R(e.$style.tooltipTitle)},r(s(o).baseText(`nodeSettings.dynamicCredentials.displayName`)),3)],2),B(`div`,null,r(s(o).baseText(m.value?`node.settings.contextEstablishmentHooks`:`node.settings.dynamicCredentials`)),1)]),default:T(()=>[B(`div`,{"data-test-id":`canvas-node-status-dynamic-credentials`,class:R(e.$style.icon)},[f(s(J),{icon:`key-round`,size:xu})],2)]),_:1})):a(``,!0)],2))}}),[[`__cssModules`,{$style:{settingsIcons:`_settingsIcons_xulzx_125`,tooltipHeader:`_tooltipHeader_xulzx_134`,tooltipTitle:`_tooltipTitle_xulzx_139`,icon:`_icon_xulzx_145`}}]]),Cu=p({__name:`ExperimentalCanvasNodeSettings`,props:{nodeId:{},isReadOnly:{type:Boolean},subTitle:{},isEmbeddedInCanvas:{type:Boolean}},emits:[`dblclickHeader`],setup(e,{emit:t}){let r=t,i=it(),a=tt(),{renameNode:o}=nn(),c=Ee(),l=ye(),u=n(()=>i.getNodeById(e.nodeId)),d=n(()=>c.getForeignCredentialsIfSharingEnabled(u.value?.credentials)),f=n(()=>a.isActionActive.workflowRunning),p=n(()=>i.executionWaitingForWebhook),m=n(()=>f.value||p.value);function g(e){e.name===`name`&&e.oldValue&&o(e.oldValue,e.value)}function _(e){e.ctrlKey||e.currentTarget instanceof HTMLElement&&e.currentTarget.scrollHeight<=e.currentTarget.offsetHeight||Math.abs(e.deltaX)>=Math.abs(e.deltaY)||e.stopImmediatePropagation()}return(t,n)=>(O(),h(un,{dragging:!1,"active-node":u.value,"push-ref":s(l).pushRef,"foreign-credentials":d.value,"read-only":e.isReadOnly,"block-u-i":m.value,executable:!e.isReadOnly,"is-embedded-in-canvas":e.isEmbeddedInCanvas,"sub-title":e.subTitle,"extra-tabs-class-name":`nodrag`,"extra-parameter-wrapper-class-name":`nodrag`,"is-ndv-v2":``,"hide-execute":``,"hide-docs":!1,"hide-sub-connections":``,onValueChanged:g,onCaptureWheelBody:_,onDblclickHeader:n[0]||=e=>r(`dblclickHeader`,e)},{actions:T(()=>[S(t.$slots,`actions`)]),_:3},8,[`active-node`,`push-ref`,`foreign-credentials`,`read-only`,`block-u-i`,`executable`,`is-embedded-in-canvas`,`sub-title`]))}});function wu(e,t,n,r){if(e.disabled)return`(${r.baseText(`node.disabled`)})`;let i=t.displayName??``;if(!n)return i;let a=e.parameters.operation,o=a&&t.properties.find(e=>e.name===`operation`)?.options?.find(e=>`value`in e&&e.value===a)?.name;return o?`${i}: ${o}`:i}var Tu=Y(p({__name:`ExperimentalEmbeddedNdvActions`,props:{isExpanded:{type:Boolean}},emits:[`openNdv`,`toggleExpand`],setup(e,{emit:t}){let n=t;return(t,r)=>(O(),i(`div`,{class:R(t.$style.actions)},[f(s(K),{variant:`ghost`,icon:`expand`,size:`xsmall`,"icon-size":`small`,"aria-label":`Open...`,onClick:r[0]||=A(e=>n(`openNdv`),[`stop`])}),f(s(K),{variant:`ghost`,icon:e.isExpanded?`chevron-down`:`chevron-up`,size:`xsmall`,"icon-size":`medium`,"aria-label":`Toggle expand`,onClick:r[1]||=A(e=>n(`toggleExpand`),[`stop`])},null,8,[`icon`])],2))}}),[[`__cssModules`,{$style:{actions:`_actions_1x1ab_125`}}]]);function Eu(e){let t=ke(),r=it(),i=n(()=>r.workflowObject);return n(()=>{if(!e.value)return;let n=r.workflowExecutionData,a=e.value.name;function o(){let e=(n?.data?.resultData.runData[a]??[])[0]?.source[0];if(e)return{name:e.previousNode,branchIndex:e.previousNodeOutput??0,runIndex:e.previousNodeRun??0};let t=i.value.getParentNodesByDepth(a,1);if(t.length>0)return{name:t[0].name,branchIndex:t[0].indicies[0]??0,runIndex:0}}return{localResolve:!0,envVars:t.variablesAsObject,workflow:i.value,execution:n,nodeName:a,additionalKeys:{},inputNode:o(),connections:r.connectionsBySourceNode}})}var Du=Y(p({__name:`ExperimentalEmbeddedNodeDetails`,props:{nodeId:{},isReadOnly:{type:Boolean}},setup(e){let t=G(),a=ye(),o=tn(),c=n(()=>!o.collapsedNodes[e.nodeId]),u=be(),d=it();on({view_shown:`zoomed_view`});let p=n(()=>d.getNodeById(e.nodeId)??null),m=n(()=>p.value?u.getNodeType(p.value.type,p.value.typeVersion):null),g=Ye(),{isPaneMoving:_}=Tl(),v=n(()=>g.isNodeIntersecting({id:e.nodeId},{x:-g.viewport.value.x/g.viewport.value.zoom,y:-g.viewport.value.y/g.viewport.value.zoom,width:g.dimensions.value.width/g.viewport.value.zoom,height:g.dimensions.value.height/g.viewport.value.zoom})),y=l(v.value),x=n(()=>p.value&&m.value?wu(p.value,m.value,!c.value,t):void 0),S=n(()=>g.dimensions.value.height*.8),C=Eu(p);function E(){o.setNodeExpanded(e.nodeId)}function D(){p.value&&a.setActiveNodeName(p.value.name,`canvas_zoomed_view`)}return F(Vt,C),re(v,e=>{y.value=y.value||e}),(t,n)=>(O(),i(`div`,{class:R([t.$style.component,c.value?t.$style.expanded:t.$style.collapsed,p.value?.disabled?t.$style.disabled:``]),style:w({"--input--max-height--focus":`${S.value/s(o).maxCanvasZoom}px`,pointerEvents:s(_)?`none`:`auto`})},[!p.value||!y.value?(O(),i(b,{key:0},[],64)):c.value?(O(),h(Cu,{key:1,tabindex:`-1`,"node-id":e.nodeId,class:R(t.$style.settingsView),"is-read-only":e.isReadOnly,"sub-title":x.value,"input-node-name":s(C)?.inputNode?.name,"is-embedded-in-canvas":``,onDblclickHeader:D},{actions:T(()=>[f(Tu,{"is-expanded":c.value,onOpenNdv:D,onToggleExpand:E},null,8,[`is-expanded`])]),_:1},8,[`node-id`,`class`,`is-read-only`,`sub-title`,`input-node-name`])):(O(),i(`div`,{key:2,role:`button`,class:R(t.$style.collapsedContent),onClick:E},[f(an,{"node-type":m.value,size:18},null,8,[`node-type`]),B(`div`,{class:R(t.$style.collapsedNodeName)},[f(s(de),{bold:``},{default:T(()=>[M(r(p.value.name),1)]),_:1}),f(s(de),{bold:``,size:`small`,color:`text-light`},{default:T(()=>[M(r(x.value),1)]),_:1})],2),f(Tu,{"is-expanded":c.value,onOpenNdv:D,onToggleExpand:E},null,8,[`is-expanded`])],2))],6))}}),[[`__cssModules`,{$style:{component:`_component_8xduy_125`,expanded:`_expanded_8xduy_138`,collapsed:`_collapsed_8xduy_148`,collapsedContent:`_collapsedContent_8xduy_160`,settingsView:`_settingsView_8xduy_161`,disabled:`_disabled_8xduy_183`,collapsedNodeName:`_collapsedNodeName_8xduy_193`}}]]),Ou=Y(p({__name:`CanvasNodeTooltip`,props:{visible:{type:Boolean}},setup(e){let{render:t}=du(),i=n(()=>t.value.options);return(t,n)=>(O(),h(s(q),{placement:`top`,"show-after":500,visible:e.visible,teleported:!1,"content-class":t.$style.content,"avoid-collisions":!1},{content:T(()=>[M(r(i.value.tooltip),1)]),default:T(()=>[B(`div`,{class:R(t.$style.tooltipTrigger)},null,2)]),_:1},8,[`visible`,`content-class`]))}}),[[`__cssModules`,{$style:{tooltipTrigger:`_tooltipTrigger_r3vzo_125`,content:`_content_r3vzo_133`}}]]),ku=Y(p({__name:`CanvasNodeDisabledStrikeThrough`,setup(e){let t=E(),{hasRunData:r,render:a}=du(),o=n(()=>({[t.disabledStrikeThrough]:!0,[t.success]:r.value,[t.warning]:a.value.type===X.Default&&a.value.options.dirtiness!==void 0}));return(e,t)=>(O(),i(`div`,{class:R(o.value)},null,2))}}),[[`__cssModules`,{$style:{disabledStrikeThrough:`_disabledStrikeThrough_l3m1g_125`,success:`_success_l3m1g_134`,warning:`_warning_l3m1g_138`}}]]),Au=[`data-test-id`],ju=Y(p({__name:`CanvasNodeDefault`,emits:[`open:contextmenu`,`activate`],setup(e,{emit:t}){let o=E(),c=G(),u=t,{initialized:d,viewport:p,isExperimentalNdvActive:m}=Tl(),{calculateNodeBorderOpacity:g}=ou(p),_=oe(),{id:v,label:y,subtitle:b,inputs:S,outputs:C,connections:T,isDisabled:D,isReadOnly:k,isSelected:j,hasPinnedData:M,executionStatus:N,executionWaiting:P,executionWaitingForNext:F,executionRunning:I,hasRunData:ee,hasExecutionErrors:L,render:z,isNotInstalledCommunityNode:V}=du(),{mainOutputs:H,mainOutputConnections:U,mainInputs:te,mainInputConnections:ne,nonMainInputs:re}=bu({inputs:S,outputs:C,connections:T}),ie=Ee(),W=n(()=>z.value.options),ae=n(()=>_.name===It.DEMO),se=n(()=>({[o.node]:!0,[o.selected]:j.value,[o.disabled]:D.value||V.value&&!ae.value,[o.success]:ee.value&&N.value===`success`,[o.error]:L.value,[o.pinned]:M.value,[o.waiting]:P.value||N.value===`waiting`,[o.running]:I.value||F.value,[o.configurable]:W.value.configurable,[o.configuration]:W.value.configuration,[o.trigger]:W.value.trigger,[o.warning]:W.value.dirtiness!==void 0,waiting:P.value||N.value===`waiting`,running:I.value||F.value})),ce=n(()=>W.value.configuration?30:40),K=n(()=>Ze(W.value.configuration??!1,W.value.configurable??!1,te.value.length,H.value.length,re.value.length,m.value)),q=g(),le=n(()=>({"--canvas-node--width":`${K.value.width}px`,"--canvas-node--height":`${K.value.height}px`,"--node--icon--size":`${ce.value}px`,"--canvas-node--border--opacity-light":q.value.light,"--canvas-node--border--opacity-dark":q.value.dark})),J=n(()=>{let e=`default`;return W.value.configurable?e=`configurable`:W.value.configuration?e=`configuration`:W.value.trigger&&(e=`trigger`),`canvas-${e}-node`}),ue=n(()=>{let e=te.value.length===1&&ne.value.length<=1,t=H.value.length===1&&U.value.length<=1;return D.value&&e&&t}),de=n(()=>W.value.icon),fe=l(!1);x(d,()=>{d.value&&(fe.value=!0)}),x(p,()=>{fe.value=!1,setTimeout(()=>{fe.value=!0},0)});function pe(e){u(`open:contextmenu`,e)}function me(e){u(`activate`,v.value,e)}return(e,t)=>s(m)?(O(),h(Du,{key:0,"node-id":s(v),class:R(se.value),style:w(le.value),"is-read-only":s(k),"is-configurable":W.value.configurable??!1},null,8,[`node-id`,`class`,`style`,`is-read-only`,`is-configurable`])):(O(),i(`div`,{key:1,class:R(se.value),style:w(le.value),"data-test-id":J.value,onContextmenu:pe,onDblclick:A(me,[`stop`])},[W.value.tooltip?(O(),h(Ou,{key:0,visible:fe.value},null,8,[`visible`])):a(``,!0),f(an,{"icon-source":de.value,size:ce.value,shrink:!1,disabled:s(D),class:R(s(o).icon)},null,8,[`icon-source`,`size`,`disabled`,`class`]),!W.value.configuration&&!s(D)&&!(s(M)&&!s(ie).isProductionExecutionPreview.value)?(O(),h(Su,{key:1})):a(``,!0),ue.value?(O(),h(ku,{key:2})):a(``,!0),B(`div`,{class:R(s(o).description)},[s(y)?(O(),i(`div`,{key:0,class:R(s(o).label)},r(s(y)),3)):a(``,!0),s(D)?(O(),i(`div`,{key:1,class:R(s(o).disabledLabel)},` (`+r(s(c).baseText(`node.disabled`))+`) `,3)):a(``,!0),s(b)&&!s(V)?(O(),i(`div`,{key:2,class:R(s(o).subtitle)},r(s(b)),3)):a(``,!0)],2),s(D)?a(``,!0):(O(),h(mu,{key:3,class:R(s(o).statusIcons)},null,8,[`class`]))],46,Au))}}),[[`__cssModules`,{$style:{node:`_node_139nt_125`,trigger:`_trigger_139nt_148`,running:`_running_139nt_151`,waiting:`_waiting_139nt_151`,configuration:`_configuration_139nt_154`,statusIcons:`_statusIcons_139nt_160`,configurable:`_configurable_139nt_163`,icon:`_icon_139nt_163`,description:`_description_139nt_166`,label:`_label_139nt_179`,subtitle:`_subtitle_139nt_182`,selected:`_selected_139nt_195`,success:`_success_139nt_199`,warning:`_warning_139nt_206`,error:`_error_139nt_210`,pinned:`_pinned_139nt_213`,disabled:`_disabled_139nt_220`,"border-rotate":`_border-rotate_139nt_1`,disabledLabel:`_disabledLabel_139nt_283`}}]]),Mu=`http://www.w3.org/1999/xhtml`,Nu={svg:`http://www.w3.org/2000/svg`,xhtml:Mu,xlink:`http://www.w3.org/1999/xlink`,xml:`http://www.w3.org/XML/1998/namespace`,xmlns:`http://www.w3.org/2000/xmlns/`};function Pu(e){var t=e+=``,n=t.indexOf(`:`);return n>=0&&(t=e.slice(0,n))!==`xmlns`&&(e=e.slice(n+1)),Nu.hasOwnProperty(t)?{space:Nu[t],local:e}:e}function Fu(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Mu&&t.documentElement.namespaceURI===Mu?t.createElement(e):t.createElementNS(n,e)}}function Iu(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Lu(e){var t=Pu(e);return(t.local?Iu:Fu)(t)}function Ru(){}function zu(e){return e==null?Ru:function(){return this.querySelector(e)}}function Bu(e){typeof e!=`function`&&(e=zu(e));for(var t=this._groups,n=t.length,r=Array(n),i=0;i<n;++i)for(var a=t[i],o=a.length,s=r[i]=Array(o),c,l,u=0;u<o;++u)(c=a[u])&&(l=e.call(c,c.__data__,u,a))&&(`__data__`in c&&(l.__data__=c.__data__),s[u]=l);return new kf(r,this._parents)}function Vu(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Hu(){return[]}function Uu(e){return e==null?Hu:function(){return this.querySelectorAll(e)}}function Wu(e){return function(){return Vu(e.apply(this,arguments))}}function Gu(e){e=typeof e==`function`?Wu(e):Uu(e);for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var o=t[a],s=o.length,c,l=0;l<s;++l)(c=o[l])&&(r.push(e.call(c,c.__data__,l,o)),i.push(c));return new kf(r,i)}function Ku(e){return function(){return this.matches(e)}}function qu(e){return function(t){return t.matches(e)}}var Ju=Array.prototype.find;function Yu(e){return function(){return Ju.call(this.children,e)}}function Xu(){return this.firstElementChild}function Zu(e){return this.select(e==null?Xu:Yu(typeof e==`function`?e:qu(e)))}var Qu=Array.prototype.filter;function $u(){return Array.from(this.children)}function ed(e){return function(){return Qu.call(this.children,e)}}function td(e){return this.selectAll(e==null?$u:ed(typeof e==`function`?e:qu(e)))}function nd(e){typeof e!=`function`&&(e=Ku(e));for(var t=this._groups,n=t.length,r=Array(n),i=0;i<n;++i)for(var a=t[i],o=a.length,s=r[i]=[],c,l=0;l<o;++l)(c=a[l])&&e.call(c,c.__data__,l,a)&&s.push(c);return new kf(r,this._parents)}function rd(e){return Array(e.length)}function id(){return new kf(this._enter||this._groups.map(rd),this._parents)}function ad(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}ad.prototype={constructor:ad,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function od(e){return function(){return e}}function sd(e,t,n,r,i,a){for(var o=0,s,c=t.length,l=a.length;o<l;++o)(s=t[o])?(s.__data__=a[o],r[o]=s):n[o]=new ad(e,a[o]);for(;o<c;++o)(s=t[o])&&(i[o]=s)}function cd(e,t,n,r,i,a,o){var s,c,l=new Map,u=t.length,d=a.length,f=Array(u),p;for(s=0;s<u;++s)(c=t[s])&&(f[s]=p=o.call(c,c.__data__,s,t)+``,l.has(p)?i[s]=c:l.set(p,c));for(s=0;s<d;++s)p=o.call(e,a[s],s,a)+``,(c=l.get(p))?(r[s]=c,c.__data__=a[s],l.delete(p)):n[s]=new ad(e,a[s]);for(s=0;s<u;++s)(c=t[s])&&l.get(f[s])===c&&(i[s]=c)}function ld(e){return e.__data__}function ud(e,t){if(!arguments.length)return Array.from(this,ld);var n=t?cd:sd,r=this._parents,i=this._groups;typeof e!=`function`&&(e=od(e));for(var a=i.length,o=Array(a),s=Array(a),c=Array(a),l=0;l<a;++l){var u=r[l],d=i[l],f=d.length,p=dd(e.call(u,u&&u.__data__,l,r)),m=p.length,h=s[l]=Array(m),g=o[l]=Array(m);n(u,d,h,g,c[l]=Array(f),p,t);for(var _=0,v=0,y,b;_<m;++_)if(y=h[_]){for(_>=v&&(v=_+1);!(b=g[v])&&++v<m;);y._next=b||null}}return o=new kf(o,r),o._enter=s,o._exit=c,o}function dd(e){return typeof e==`object`&&`length`in e?e:Array.from(e)}function fd(){return new kf(this._exit||this._groups.map(rd),this._parents)}function pd(e,t,n){var r=this.enter(),i=this,a=this.exit();return typeof e==`function`?(r=e(r),r&&=r.selection()):r=r.append(e+``),t!=null&&(i=t(i),i&&=i.selection()),n==null?a.remove():n(a),r&&i?r.merge(i).order():i}function md(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,a=r.length,o=Math.min(i,a),s=Array(i),c=0;c<o;++c)for(var l=n[c],u=r[c],d=l.length,f=s[c]=Array(d),p,m=0;m<d;++m)(p=l[m]||u[m])&&(f[m]=p);for(;c<i;++c)s[c]=n[c];return new kf(s,this._parents)}function hd(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,a=r[i],o;--i>=0;)(o=r[i])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function gd(e){e||=_d;function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}for(var n=this._groups,r=n.length,i=Array(r),a=0;a<r;++a){for(var o=n[a],s=o.length,c=i[a]=Array(s),l,u=0;u<s;++u)(l=o[u])&&(c[u]=l);c.sort(t)}return new kf(i,this._parents).order()}function _d(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function vd(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function yd(){return Array.from(this)}function bd(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null}function xd(){let e=0;for(let t of this)++e;return e}function Sd(){return!this.node()}function Cd(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],a=0,o=i.length,s;a<o;++a)(s=i[a])&&e.call(s,s.__data__,a,i);return this}function wd(e){return function(){this.removeAttribute(e)}}function Td(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ed(e,t){return function(){this.setAttribute(e,t)}}function Dd(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Od(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function kd(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Ad(e,t){var n=Pu(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Td:wd:typeof t==`function`?n.local?kd:Od:n.local?Dd:Ed)(n,t))}function jd(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Md(e){return function(){this.style.removeProperty(e)}}function Nd(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Pd(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Fd(e,t,n){return arguments.length>1?this.each((t==null?Md:typeof t==`function`?Pd:Nd)(e,t,n??``)):Id(this.node(),e)}function Id(e,t){return e.style.getPropertyValue(t)||jd(e).getComputedStyle(e,null).getPropertyValue(t)}function Ld(e){return function(){delete this[e]}}function Rd(e,t){return function(){this[e]=t}}function zd(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Bd(e,t){return arguments.length>1?this.each((t==null?Ld:typeof t==`function`?zd:Rd)(e,t)):this.node()[e]}function Vd(e){return e.trim().split(/^|\s+/)}function Hd(e){return e.classList||new Ud(e)}function Ud(e){this._node=e,this._names=Vd(e.getAttribute(`class`)||``)}Ud.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute(`class`,this._names.join(` `)))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute(`class`,this._names.join(` `)))},contains:function(e){return this._names.indexOf(e)>=0}};function Wd(e,t){for(var n=Hd(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function Gd(e,t){for(var n=Hd(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function Kd(e){return function(){Wd(this,e)}}function qd(e){return function(){Gd(this,e)}}function Jd(e,t){return function(){(t.apply(this,arguments)?Wd:Gd)(this,e)}}function Yd(e,t){var n=Vd(e+``);if(arguments.length<2){for(var r=Hd(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t==`function`?Jd:t?Kd:qd)(n,t))}function Xd(){this.textContent=``}function Zd(e){return function(){this.textContent=e}}function Qd(e){return function(){this.textContent=e.apply(this,arguments)??``}}function $d(e){return arguments.length?this.each(e==null?Xd:(typeof e==`function`?Qd:Zd)(e)):this.node().textContent}function ef(){this.innerHTML=``}function tf(e){return function(){this.innerHTML=e}}function nf(e){return function(){this.innerHTML=e.apply(this,arguments)??``}}function rf(e){return arguments.length?this.each(e==null?ef:(typeof e==`function`?nf:tf)(e)):this.node().innerHTML}function af(){this.nextSibling&&this.parentNode.appendChild(this)}function of(){return this.each(af)}function sf(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function cf(){return this.each(sf)}function lf(e){var t=typeof e==`function`?e:Lu(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function uf(){return null}function df(e,t){var n=typeof e==`function`?e:Lu(e),r=t==null?uf:typeof t==`function`?t:zu(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function ff(){var e=this.parentNode;e&&e.removeChild(this)}function pf(){return this.each(ff)}function mf(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function hf(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function gf(e){return this.select(e?hf:mf)}function _f(e){return arguments.length?this.property(`__data__`,e):this.node().__data__}function vf(e){return function(t){e.call(this,t,this.__data__)}}function yf(e){return e.trim().split(/^|\s+/).map(function(e){var t=``,n=e.indexOf(`.`);return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function bf(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,a;n<i;++n)a=t[n],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.options):t[++r]=a;++r?t.length=r:delete this.__on}}}function xf(e,t,n){return function(){var r=this.__on,i,a=vf(t);if(r){for(var o=0,s=r.length;o<s;++o)if((i=r[o]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),i.value=t;return}}this.addEventListener(e.type,a,n),i={type:e.type,name:e.name,value:t,listener:a,options:n},r?r.push(i):this.__on=[i]}}function Sf(e,t,n){var r=yf(e+``),i,a=r.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var c=0,l=s.length,u;c<l;++c)for(i=0,u=s[c];i<a;++i)if((o=r[i]).type===u.type&&o.name===u.name)return u.value}return}for(s=t?xf:bf,i=0;i<a;++i)this.each(s(r[i],t,n));return this}function Cf(e,t,n){var r=jd(e),i=r.CustomEvent;typeof i==`function`?i=new i(t,n):(i=r.document.createEvent(`Event`),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function wf(e,t){return function(){return Cf(this,e,t)}}function Tf(e,t){return function(){return Cf(this,e,t.apply(this,arguments))}}function Ef(e,t){return this.each((typeof t==`function`?Tf:wf)(e,t))}function*Df(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length,o;i<a;++i)(o=r[i])&&(yield o)}var Of=[null];function kf(e,t){this._groups=e,this._parents=t}function Af(){return this}kf.prototype={constructor:kf,select:Bu,selectAll:Gu,selectChild:Zu,selectChildren:td,filter:nd,data:ud,enter:id,exit:fd,join:pd,merge:md,selection:Af,order:hd,sort:gd,call:vd,nodes:yd,node:bd,size:xd,empty:Sd,each:Cd,attr:Ad,style:Fd,property:Bd,classed:Yd,text:$d,html:rf,raise:of,lower:cf,append:lf,insert:df,remove:pf,clone:gf,datum:_f,on:Sf,dispatch:Ef,[Symbol.iterator]:Df};function jf(e){return typeof e==`string`?new kf([[document.querySelector(e)]],[document.documentElement]):new kf([[e]],Of)}function Mf(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Nf(e,t){if(e=Mf(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}var Pf={value:()=>{}};function Ff(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+``)||r in n||/[\s.]/.test(r))throw Error(`illegal type: `+r);n[r]=[]}return new If(n)}function If(e){this._=e}function Lf(e,t){return e.trim().split(/^|\s+/).map(function(e){var n=``,r=e.indexOf(`.`);if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw Error(`unknown type: `+e);return{type:e,name:n}})}If.prototype=Ff.prototype={constructor:If,on:function(e,t){var n=this._,r=Lf(e+``,n),i,a=-1,o=r.length;if(arguments.length<2){for(;++a<o;)if((i=(e=r[a]).type)&&(i=Rf(n[i],e.name)))return i;return}if(t!=null&&typeof t!=`function`)throw Error(`invalid callback: `+t);for(;++a<o;)if(i=(e=r[a]).type)n[i]=zf(n[i],e.name,t);else if(t==null)for(i in n)n[i]=zf(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new If(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw Error(`unknown type: `+e);for(a=this._[e],r=0,i=a.length;r<i;++r)a[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw Error(`unknown type: `+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};function Rf(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function zf(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=Pf,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var Bf={passive:!1},Vf={capture:!0,passive:!1};function Hf(e){e.stopImmediatePropagation()}function Uf(e){e.preventDefault(),e.stopImmediatePropagation()}function Wf(e){var t=e.document.documentElement,n=jf(e).on(`dragstart.drag`,Uf,Vf);`onselectstart`in t?n.on(`selectstart.drag`,Uf,Vf):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect=`none`)}function Gf(e,t){var n=e.document.documentElement,r=jf(e).on(`dragstart.drag`,null);t&&(r.on(`click.drag`,Uf,Vf),setTimeout(function(){r.on(`click.drag`,null)},0)),`onselectstart`in n?r.on(`selectstart.drag`,null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var Kf=e=>()=>e;function qf(e,{sourceEvent:t,subject:n,target:r,identifier:i,active:a,x:o,y:s,dx:c,dy:l,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:u}})}qf.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Jf(e){return!e.ctrlKey&&!e.button}function Yf(){return this.parentNode}function Xf(e,t){return t??{x:e.x,y:e.y}}function Zf(){return navigator.maxTouchPoints||`ontouchstart`in this}function Qf(){var e=Jf,t=Yf,n=Xf,r=Zf,i={},a=Ff(`start`,`drag`,`end`),o=0,s,c,l,u,d=0;function f(e){e.on(`mousedown.drag`,p).filter(r).on(`touchstart.drag`,g).on(`touchmove.drag`,_,Bf).on(`touchend.drag touchcancel.drag`,v).style(`touch-action`,`none`).style(`-webkit-tap-highlight-color`,`rgba(0,0,0,0)`)}function p(n,r){if(!(u||!e.call(this,n,r))){var i=y(this,t.call(this,n,r),n,r,`mouse`);i&&(jf(n.view).on(`mousemove.drag`,m,Vf).on(`mouseup.drag`,h,Vf),Wf(n.view),Hf(n),l=!1,s=n.clientX,c=n.clientY,i(`start`,n))}}function m(e){if(Uf(e),!l){var t=e.clientX-s,n=e.clientY-c;l=t*t+n*n>d}i.mouse(`drag`,e)}function h(e){jf(e.view).on(`mousemove.drag mouseup.drag`,null),Gf(e.view,l),Uf(e),i.mouse(`end`,e)}function g(n,r){if(e.call(this,n,r)){var i=n.changedTouches,a=t.call(this,n,r),o=i.length,s,c;for(s=0;s<o;++s)(c=y(this,a,n,r,i[s].identifier,i[s]))&&(Hf(n),c(`start`,n,i[s]))}}function _(e){var t=e.changedTouches,n=t.length,r,a;for(r=0;r<n;++r)(a=i[t[r].identifier])&&(Uf(e),a(`drag`,e,t[r]))}function v(e){var t=e.changedTouches,n=t.length,r,a;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),r=0;r<n;++r)(a=i[t[r].identifier])&&(Hf(e),a(`end`,e,t[r]))}function y(e,t,r,s,c,l){var u=a.copy(),d=Nf(l||r,t),p,m,h;if((h=n.call(e,new qf(`beforestart`,{sourceEvent:r,target:f,identifier:c,active:o,x:d[0],y:d[1],dx:0,dy:0,dispatch:u}),s))!=null)return p=h.x-d[0]||0,m=h.y-d[1]||0,function n(r,a,l){var g=d,_;switch(r){case`start`:i[c]=n,_=o++;break;case`end`:delete i[c],--o;case`drag`:d=Nf(l||a,t),_=o;break}u.call(r,e,new qf(r,{sourceEvent:a,subject:h,target:f,identifier:c,active:_,x:d[0]+p,y:d[1]+m,dx:d[0]-g[0],dy:d[1]-g[1],dispatch:u}),s)}}return f.filter=function(t){return arguments.length?(e=typeof t==`function`?t:Kf(!!t),f):e},f.container=function(e){return arguments.length?(t=typeof e==`function`?e:Kf(e),f):t},f.subject=function(e){return arguments.length?(n=typeof e==`function`?e:Kf(e),f):n},f.touchable=function(e){return arguments.length?(r=typeof e==`function`?e:Kf(!!e),f):r},f.on=function(){var e=a.on.apply(a,arguments);return e===a?f:e},f.clickDistance=function(e){return arguments.length?(d=(e=+e)*e,f):Math.sqrt(d)},f}var $f=(e=>(e.Line=`line`,e.Handle=`handle`,e))($f||{});function ep({width:e,prevWidth:t,height:n,prevHeight:r,invertX:i,invertY:a}){let o=e-t,s=n-r,c=[o>0?1:o<0?-1:0,s>0?1:s<0?-1:0];return o&&i&&(c[0]*=-1),s&&a&&(c[1]*=-1),c}var tp={[$f.Line]:`right`,[$f.Handle]:`bottom-right`},np={[$f.Line]:`borderColor`,[$f.Handle]:`backgroundColor`},rp=p({name:`ResizeControl`,compatConfig:{MODE:3},props:{nodeId:{},color:{},minWidth:{default:10},minHeight:{default:10},maxWidth:{default:Number.MAX_VALUE},maxHeight:{default:Number.MAX_VALUE},position:{},variant:{default:`handle`},shouldResize:{},keepAspectRatio:{type:[Boolean,Number],default:!1},autoScale:{type:Boolean,default:!0},handleClassName:{},handleStyle:{},lineClassName:{},lineStyle:{},isVisible:{type:Boolean}},emits:[`resizeStart`,`resize`,`resizeEnd`],setup(e,{emit:t}){let r=e,a={width:0,height:0,x:0,y:0},o={...a,pointerX:0,pointerY:0,aspectRatio:1},{findNode:c,emits:u,viewport:d,noDragClassName:f}=Ye(),p=nt(),m=l(),h=o,g=a,v=_(()=>r.position??tp[r.variant]),y=n(()=>v.value.split(`-`)),b=_(()=>r.color?{[np[r.variant]]:r.color}:{});return z(e=>{if(!m.value||!r.nodeId)return;let n=jf(m.value),i=v.value.includes(`right`)||v.value.includes(`left`),a=v.value.includes(`bottom`)||v.value.includes(`top`),o=v.value.includes(`left`),s=v.value.includes(`top`),l=Qf().on(`start`,e=>{let n=c(r.nodeId),{xSnapped:i,ySnapped:a}=p(e);g={width:n?.dimensions.width??0,height:n?.dimensions.height??0,x:n?.position.x??0,y:n?.position.y??0},h={...g,pointerX:i,pointerY:a,aspectRatio:g.width/g.height},t(`resizeStart`,{event:e,params:g})}).on(`drag`,e=>{let{xSnapped:n,ySnapped:l}=p(e),d=c(r.nodeId);if(d){let c=[],{pointerX:f,pointerY:p,width:m,height:_,x:v,y,aspectRatio:b}=h,{x,y:S,width:C,height:w}=g,T=Math.floor(i?n-f:0),E=Math.floor(a?l-p:0),D=Re(m+(o?-T:T),r.minWidth,r.maxWidth),O=Re(_+(s?-E:E),r.minHeight,r.maxHeight);if(r.keepAspectRatio){let e=D/O,t=b;typeof r.keepAspectRatio==`number`&&e!==r.keepAspectRatio&&(t=r.keepAspectRatio);let n=i&&a,o=i&&!a;D=e<=t&&n||a&&!i?O*t:D,O=e>t&&n||o?D/t:O,D>=r.maxWidth?(D=r.maxWidth,O=r.maxWidth/t):D<=r.minWidth&&(D=r.minWidth,O=r.minWidth/t),O>=r.maxHeight?(O=r.maxHeight,D=r.maxHeight*t):O<=r.minHeight&&(O=r.minHeight,D=r.minHeight*t)}let k=D!==C,A=O!==w;if(o||s){let e=o?v-(D-m):v,t=s?y-(O-_):y,n=e!==x&&k,r=t!==S&&A;if(n||r){let i={id:d.id,type:`position`,from:d.position,position:{x:n?e:x,y:r?t:S}};c.push(i),g.x=i.position.x,g.y=i.position.y}}if(r.nodeId&&(k||A)){let e={id:r.nodeId,type:`dimensions`,updateStyle:!0,resizing:!0,dimensions:{width:D,height:O}};c.push(e),g.width=D,g.height=O}if(c.length===0)return;let j=ep({width:g.width,prevWidth:C,height:g.height,prevHeight:w,invertX:o,invertY:s}),M={...g,direction:j};if(r.shouldResize?.call(r,e,M)===!1)return;t(`resize`,{event:e,params:M}),u.nodesChange(c)}}).on(`end`,e=>{if(r.nodeId){let n={id:r.nodeId,type:`dimensions`,resizing:!1};t(`resizeEnd`,{event:e,params:g}),u.nodesChange([n])}});n.call(l),e(()=>{n.on(`.drag`,null)})}),(e,t)=>(O(),i(`div`,{ref_key:`resizeControlRef`,ref:m,class:R([`vue-flow__resize-control`,[...y.value,e.variant,s(f)]]),style:w({...b.value,scale:e.variant===s($f).Handle?`${Math.max(1/s(d).zoom,1)}`:void 0})},[S(e.$slots,`default`)],6))}}),ip=p({name:`NodeResizer`,compatConfig:{MODE:3},inheritAttrs:!1,props:{nodeId:{},color:{},handleClassName:{},handleStyle:{},lineClassName:{},lineStyle:{},isVisible:{type:Boolean,default:!0},minWidth:{},minHeight:{},maxWidth:{},maxHeight:{},shouldResize:{},keepAspectRatio:{type:[Boolean,Number]},autoScale:{type:Boolean,default:!0}},emits:[`resizeStart`,`resize`,`resizeEnd`],setup(e,{emit:t}){let r=e,{findNode:o,emits:c}=Ye(),l=[`top-left`,`top-right`,`bottom-left`,`bottom-right`],u=[`top`,`right`,`bottom`,`left`],d=te(Te,null),p=_(()=>typeof r.nodeId==`string`?r.nodeId:d),m=n(()=>o(p.value));return x([()=>r.minWidth,()=>r.minHeight,()=>r.maxWidth,()=>r.maxHeight,()=>!!m.value?.dimensions.width&&!!m.value.dimensions.height],([e,t,n,r,i])=>{let a=m.value;if(a&&i){let i={id:a.id,type:`dimensions`,updateStyle:!0,dimensions:{width:a.dimensions.width,height:a.dimensions.height}};e&&a.dimensions.width<e&&(i.dimensions.width=e),t&&a.dimensions.height<t&&(i.dimensions.height=t),n&&a.dimensions.width>n&&(i.dimensions.width=n),r&&a.dimensions.height>r&&(i.dimensions.height=r),(i.dimensions.width!==a.dimensions.width||i.dimensions.height!==a.dimensions.height)&&c.nodesChange([i])}},{flush:`post`,immediate:!0}),(e,n)=>e.isVisible?(O(),i(b,{key:0},[(O(),i(b,null,j(u,r=>f(rp,{key:r,class:R(e.lineClassName),style:w(e.lineStyle),"node-id":p.value,position:r,variant:s($f).Line,color:e.color,"min-width":e.minWidth,"min-height":e.minHeight,"max-width":e.maxWidth,"max-height":e.maxHeight,"should-resize":e.shouldResize,"keep-aspect-ratio":e.keepAspectRatio,"auto-scale":e.autoScale,onResizeStart:n[0]||=e=>t(`resizeStart`,e),onResize:n[1]||=e=>t(`resize`,e),onResizeEnd:n[2]||=e=>t(`resizeEnd`,e)},null,8,[`class`,`style`,`node-id`,`position`,`variant`,`color`,`min-width`,`min-height`,`max-width`,`max-height`,`should-resize`,`keep-aspect-ratio`,`auto-scale`])),64)),(O(),i(b,null,j(l,r=>f(rp,{key:r,class:R(e.handleClassName),style:w(e.handleStyle),"node-id":p.value,position:r,color:e.color,"min-width":e.minWidth,"min-height":e.minHeight,"max-width":e.maxWidth,"max-height":e.maxHeight,"should-resize":e.shouldResize,"keep-aspect-ratio":e.keepAspectRatio,"auto-scale":e.autoScale,onResizeStart:n[3]||=e=>t(`resizeStart`,e),onResize:n[4]||=e=>t(`resize`,e),onResizeEnd:n[5]||=e=>t(`resizeEnd`,e)},null,8,[`class`,`style`,`node-id`,`position`,`color`,`min-width`,`min-height`,`max-width`,`max-height`,`should-resize`,`keep-aspect-ratio`,`auto-scale`])),64))],64)):a(``,!0)}}),ap=Y(p({inheritAttrs:!1,__name:`CanvasNodeStickyNote`,emits:[`update`,`move`,`activate`,`deactivate`,`open:contextmenu`],setup(e,{emit:t}){let r=t,a=E(),{id:o,isSelected:c,isReadOnly:d,render:p,eventBus:m}=du(),h=n(()=>p.value.options),g=n(()=>({[a.sticky]:!0,[a.selected]:c.value,"sticky--active":x.value}));function _(e){r(`move`,{x:e.params.x,y:e.params.y}),r(`update`,{...e.params.width?{width:e.params.width}:{},...e.params.height?{height:e.params.height}:{}})}let x=l(!1);function S(e){r(`update`,{content:e})}function C(e){x.value!==e&&(x.value=e,r(e?`activate`:`deactivate`,o.value))}function w(){C(!0)}function T(e){r(`open:contextmenu`,e)}return y(()=>{m.value?.on(`update:node:activated`,w)}),u(()=>{m.value?.off(`update:node:activated`,w)}),(e,t)=>(O(),i(b,null,[f(s(ip),{"min-height":80,"min-width":150,height:h.value.height,width:h.value.width,"is-visible":!s(d),onResize:_},null,8,[`height`,`width`,`is-visible`]),f(s(le),v(e.$attrs,{id:s(o),class:g.value,"data-test-id":`sticky`,height:h.value.height,width:h.value.width,"model-value":h.value.content,"background-color":h.value.color,"edit-mode":x.value,"read-only":s(d),onEdit:C,onDblclick:A(w,[`stop`]),"onUpdate:modelValue":S,onContextmenu:T}),null,16,[`id`,`class`,`height`,`width`,`model-value`,`background-color`,`edit-mode`,`read-only`])],64))}}),[[`__cssModules`,{$style:{sticky:`_sticky_1k3w0_125`,selected:`_selected_1k3w0_132`}}]]),op=Y(p({__name:`CanvasNodeAddNodes`,setup(e){let t=$t(),o=G(),c=lt(),d=ut(),p=he(),m=l(!1),g=n(()=>at()&&c.isTemplatesEnabled);y(()=>{Je.on(`runWorkflowButton:mouseenter`,_),Je.on(`runWorkflowButton:mouseleave`,v)}),u(()=>{Je.off(`runWorkflowButton:mouseenter`,_),Je.off(`runWorkflowButton:mouseleave`,v)});function _(){m.value=!0}function v(){m.value=!1}function b(){t.openNodeCreatorForTriggerNodes(St.TRIGGER_PLACEHOLDER_BUTTON)}async function x(){if(Ke($e.emptyWorkflowLink),d.hasCustomTemplatesHost){await p.push({name:It.TEMPLATES});return}window.open(d.websiteTemplateRepositoryURL,`_blank`)}return(e,n)=>(O(),i(`div`,{ref:`container`,class:R(e.$style.addNodes),"data-test-id":`canvas-add-button`},[f(s(q),{placement:`top`,visible:m.value,disabled:s(t).showScrim,"show-after":700},{content:T(()=>[M(r(s(o).baseText(`nodeView.canvasAddButton.addATriggerNodeBeforeExecuting`)),1)]),default:T(()=>[B(`button`,{class:R(e.$style.button),"data-test-id":`canvas-plus-button`,onClick:A(b,[`stop`])},[f(s(J),{icon:`plus`,color:`foreground-xdark`,size:40})],2)]),_:1},8,[`visible`,`disabled`]),B(`p`,{class:R(e.$style.label)},[M(r(s(o).baseText(`nodeView.canvasAddButton.addFirstStep`))+` `,1),g.value?(O(),h(s(pe),{key:0,underline:!0,size:`small`,"data-test-id":`canvas-template-link`,onClick:x},{default:T(()=>[M(r(s(o).baseText(`nodeView.templateLink`)),1)]),_:1})):a(``,!0)],2)],2))}}),[[`__cssModules`,{$style:{addNodes:`_addNodes_1ik7n_125`,button:`_button_1ik7n_133`,label:`_label_1ik7n_147`}}]]),sp=Y(p({__name:`CanvasNodeChoicePrompt`,setup(e){let t=$t(),o=Wt(),c=G(),l=lt(),u=ut(),d=he(),p=Ut(),m=n(()=>o.isOpen&&o.isBuilderModeActive),g=n(()=>at()&&l.isTemplatesEnabled),_=()=>{t.isCreateNodeActive?t.isCreateNodeActive=!1:t.openNodeCreatorForTriggerNodes(St.TRIGGER_PLACEHOLDER_BUTTON)};async function v(){p.trackUserOpenedAssistant({source:`build_with_ai`,task:`placeholder`,has_existing_session:!p.isSessionEnded}),await o.toggle({mode:`builder`})}async function y(){if(Ke($e.emptyWorkflowLink),u.hasCustomTemplatesHost){await d.push({name:It.TEMPLATES});return}window.open(u.websiteTemplateRepositoryURL,`_blank`)}return(e,n)=>(O(),i(`div`,{class:R(e.$style.choicePrompt),"data-test-id":`canvas-choice-prompt`,onClick:n[0]||=A(()=>{},[`stop`]),onMousedown:n[1]||=A(()=>{},[`stop`])},[B(`div`,{class:R(e.$style.option)},[B(`div`,{class:R([e.$style.selectedButtonHighlight,{[e.$style.highlighted]:s(t).isCreateNodeActive}])},[B(`button`,{class:R(e.$style.button),"data-test-id":`canvas-add-first-step-button`,onMousedown:A(_,[`stop`,`prevent`])},[f(s(J),{icon:`plus`,color:`foreground-xdark`,size:40})],34)],2),B(`p`,{class:R(e.$style.label)},[M(r(s(c).baseText(`nodeView.canvasAddButton.addFirstStep`))+` `,1),g.value?(O(),h(s(pe),{key:0,underline:!0,size:`small`,"data-test-id":`canvas-template-link`,onClick:y},{default:T(()=>[M(r(s(c).baseText(`nodeView.templateLink`)),1)]),_:1})):a(``,!0)],2)],2),B(`div`,{class:R(e.$style.orDivider)},[B(`span`,{class:R(e.$style.orText)},r(s(c).baseText(`generic.or`)),3)],2),B(`div`,{class:R(e.$style.option)},[B(`div`,{class:R([e.$style.selectedButtonHighlight,{[e.$style.highlighted]:m.value}])},[B(`button`,{class:R([e.$style.button]),"data-test-id":`canvas-build-with-ai-button`,onMousedown:A(v,[`stop`,`prevent`])},[f(s(J),{icon:`wand-sparkles`,color:`foreground-xdark`,size:40})],34)],2),B(`p`,{class:R(e.$style.label)},r(s(c).baseText(`aiAssistant.builder.canvasPrompt.buildWithAI`)),3)],2)],34))}}),[[`__cssModules`,{$style:{choicePrompt:`_choicePrompt_5k7m7_125`,option:`_option_5k7m7_133`,button:`_button_5k7m7_140`,selectedButtonHighlight:`_selectedButtonHighlight_5k7m7_150`,highlighted:`_highlighted_5k7m7_153`,label:`_label_5k7m7_157`,orDivider:`_orDivider_5k7m7_169`,orText:`_orText_5k7m7_177`}}]]),cp=p({__name:`CanvasNodeRenderer`,setup(e){let t=te(Ht),n=()=>{let e=t?.data.value.render.type??X.Default,n;switch(e){case X.StickyNote:n=ap;break;case X.AddNodes:n=op;break;case X.ChoicePrompt:n=sp;break;default:n=ju}return d(n,{"data-canvas-node-render-type":e})};return(e,t)=>(O(),h(n))}});function lp(){let e=te(zt);return{label:n(()=>e?.label.value??``),isConnected:n(()=>e?.isConnected.value??!1),isConnecting:n(()=>e?.isConnecting.value??!1),isReadOnly:n(()=>e?.isReadOnly.value),isRequired:n(()=>e?.isRequired.value),maxConnections:n(()=>e?.maxConnections.value),type:n(()=>e?.type.value??Q.Main),mode:n(()=>e?.mode.value??Z.Input),index:n(()=>e?.index.value??0),runData:n(()=>e?.runData.value)}}var up=Y(p({__name:`CanvasHandleDot`,props:{handleClasses:{default:void 0}},setup(e){let t=e,r=n(()=>t.handleClasses===`source`);return(t,n)=>(O(),i(`div`,{class:R([t.$style.wrapper,{[t.$style.output]:r.value}])},[B(`div`,{class:R([t.$style.dot,e.handleClasses])},null,2)],2))}}),[[`__cssModules`,{$style:{wrapper:`_wrapper_1jh0f_125`,output:`_output_1jh0f_131`,dot:`_dot_1jh0f_135`}}]]),dp=`target`,fp=Y(p({__name:`CanvasHandleMainInput`,setup(e){let t=E(),{label:a,isRequired:o}=lp(),{viewport:c}=Tl(),{calculateHandleLightness:l}=ou(c),u=n(()=>({"canvas-node-handle-main-input":!0,[t.handle]:!0,[t.required]:o.value})),d=l(),p=n(()=>({"--handle--border--lightness--light":d.value.light,"--handle--border--lightness--dark":d.value.dark}));return(e,n)=>(O(),i(`div`,{class:R(u.value)},[B(`div`,{class:R([s(t).label])},r(s(a)),3),f(up,{"handle-classes":dp,style:w(p.value)},null,8,[`style`])],2))}}),[[`__cssModules`,{$style:{handle:`_handle_1rqcc_125`,label:`_label_1rqcc_132`,required:`_required_1rqcc_147`}}]]),pp=[`viewBox`],mp=[`x1`,`y1`,`x2`,`y2`],hp=[`transform`],gp=Y(p({__name:`CanvasHandlePlus`,props:{position:{default:`right`},handleClasses:{default:void 0},plusSize:{default:24},lineSize:{default:46},type:{default:`default`}},emits:[`click:plus`],setup(e,{emit:t}){let r=e,{viewport:a}=Tl(),{calculateEdgeLightness:o}=ou(a),s=o(),c=t,l=E(),u=n(()=>[`canvas-handle-plus`,l.container,l[r.position],r.handleClasses]),d=n(()=>{switch(r.position){case`bottom`:case`top`:return{width:r.plusSize,height:r.lineSize+r.plusSize};default:return{width:r.lineSize+r.plusSize,height:r.plusSize}}}),f=n(()=>({width:`${d.value.width}px`,height:`${d.value.height}px`,"--canvas-handle-plus-line--color--lightness--light":s.value.light,"--canvas-handle-plus-line--color--lightness--dark":s.value.dark})),p=n(()=>{switch(r.position){case`top`:return[[d.value.width/2,d.value.height-r.lineSize+1],[d.value.width/2,d.value.height]];case`bottom`:return[[d.value.width/2,0],[d.value.width/2,r.lineSize+1]];case`left`:return[[d.value.width-r.lineSize-1,d.value.height/2],[d.value.width,d.value.height/2]];default:return[[0,d.value.height/2],[r.lineSize+1,d.value.height/2]]}}),m=n(()=>{switch(r.position){case`bottom`:return[0,d.value.height-r.plusSize];case`top`:return[0,0];case`left`:return[0,0];default:return[d.value.width-r.plusSize,0]}});function h(e){c(`click:plus`,e)}return(t,n)=>(O(),i(`div`,{class:R(u.value),"data-test-id":`canvas-handle-plus-wrapper`},[(O(),i(`svg`,{class:R([t.$style.wrapper,t.$style[e.position],t.$style[e.type]]),style:w(f.value),viewBox:`0 0 ${d.value.width} ${d.value.height}`},[B(`line`,{class:R([e.handleClasses,t.$style.line]),x1:p.value[0][0],y1:p.value[0][1],x2:p.value[1][0],y2:p.value[1][1],"stroke-width":`2`},null,10,mp),B(`g`,{"data-test-id":`canvas-handle-plus`,class:R([t.$style.plus,e.handleClasses,`clickable`]),transform:`translate(${m.value[0]}, ${m.value[1]})`,onClick:A(h,[`stop`])},[B(`rect`,{class:R([e.handleClasses,`clickable`]),x:`2`,y:`2`,width:`20`,height:`20`,stroke:`light-dark(var(--color--neutral-200), var(--color--neutral-850))`,"stroke-width":`2`,rx:`4`,fill:`light-dark(var(--color--neutral-200), var(--color--neutral-850))`},null,2),n[0]||=B(`path`,{stroke:`currentColor`,"stroke-width":`1.5`,"stroke-linecap":`round`,"stroke-linejoin":`round`,d:`M8 12h8m-4-4v8`,class:`source clickable`},null,-1)],10,hp)],14,pp))],2))}}),[[`__cssModules`,{$style:{container:`_container_276y9_125`,bottom:`_bottom_276y9_128`,wrapper:`_wrapper_276y9_140`,right:`_right_276y9_145`,line:`_line_276y9_151`,success:`_success_276y9_154`,plus:`_plus_276y9_157`}}]]),_p=`source`,vp=Y(p({__name:`CanvasHandleMainOutput`,emits:[`add`],setup(e,{emit:t}){let o=t,c=E(),u=G(),{render:d}=du(),{label:p,isConnected:m,isConnecting:g,isReadOnly:_,isRequired:v,runData:y}=lp(),{viewport:b}=Tl(),{calculateHandleLightness:x}=ou(b),S=n(()=>({"canvas-node-handle-main-output":!0,[c.handle]:!0,[c.connected]:m.value,[c.required]:v.value})),C=l(!1),D=n(()=>d.value.options),k=n(()=>y.value?.total??0),A=n(()=>!m.value&&y.value&&y.value.total>0?u.baseText(`ndv.output.items`,{adjustToNumber:y.value.total,interpolate:{count:String(y.value.total)}}):``),j=n(()=>!g.value||C.value),M=n(()=>k.value>0?`success`:`default`),N=n(()=>({small:46,medium:66,large:80})[(k.value>0?`large`:D.value.outputs?.labelSize)??`small`]),F=n(()=>({[c.label]:!0,[c.outputLabel]:!0})),ee=n(()=>({[c.label]:!0,[c.runDataLabel]:!0})),L=x(),z=n(()=>({"--handle--border--lightness--light":L.value.light,"--handle--border--lightness--dark":L.value.dark}));function B(){C.value=!0}function H(){C.value=!1}function U(){o(`add`)}return(e,t)=>(O(),i(`div`,{class:R(S.value)},[s(p)?(O(),i(`div`,{key:0,class:R(F.value)},r(s(p)),3)):a(``,!0),s(y)?(O(),i(`div`,{key:1,class:R(ee.value)},r(A.value),3)):a(``,!0),f(up,{"handle-classes":_p,style:w(z.value)},null,8,[`style`]),f(P,{name:`canvas-node-handle-main-output`},{default:T(()=>[!s(m)&&!s(_)?V((O(),h(gp,{key:0,"data-plus-type":M.value,"line-size":N.value,"handle-classes":_p,type:M.value,onMouseenter:B,onMouseleave:H,"onClick:plus":U},null,8,[`data-plus-type`,`line-size`,`type`])),[[I,j.value]]):a(``,!0)]),_:1})],2))}}),[[`__cssModules`,{$style:{handle:`_handle_4le4q_125`,connected:`_connected_4le4q_131`,label:`_label_4le4q_131`,required:`_required_4le4q_145`,outputLabel:`_outputLabel_4le4q_150`,runDataLabel:`_runDataLabel_4le4q_160`}}]]),yp=Y(p({__name:`CanvasHandleDiamond`,props:{handleClasses:{default:void 0}},setup(e){return(t,n)=>(O(),i(`div`,{class:R(t.$style.wrapper)},[B(`div`,{class:R([t.$style.diamond,e.handleClasses])},null,2)],2))}}),[[`__cssModules`,{$style:{wrapper:`_wrapper_149eq_125`,diamond:`_diamond_149eq_131`}}]]),bp=`target`,xp=Y(p({__name:`CanvasHandleNonMainInput`,emits:[`add`],setup(e,{emit:t}){let o=t,c=E(),{label:u,isConnected:d,isConnecting:p,isRequired:m,maxConnections:g}=lp(),{viewport:_}=Tl(),{calculateHandleLightness:v}=ou(_),y=n(()=>({"canvas-node-handle-non-main-input":!0,[c.handle]:!0,[c.required]:m.value})),b=n(()=>!d.value||!g.value||g.value>1),x=l(!1),S=n(()=>!p.value||x.value||!g.value||g.value>1),C=v(),D=n(()=>({"--handle--border--lightness--light":C.value.light,"--handle--border--lightness--dark":C.value.dark}));function k(){x.value=!0}function A(){x.value=!1}function j(){o(`add`)}return(e,t)=>(O(),i(`div`,{class:R(y.value)},[B(`div`,{class:R([s(c).label])},r(s(u)),3),f(yp,{"handle-classes":bp,style:w(D.value)},null,8,[`style`]),f(P,{name:`canvas-node-handle-non-main-input`},{default:T(()=>[b.value?V((O(),h(gp,{key:0,"handle-classes":bp,type:`secondary`,position:`bottom`,onMouseenter:k,onMouseleave:A,"onClick:plus":j},null,512)),[[I,S.value]]):a(``,!0)]),_:1})],2))}}),[[`__cssModules`,{$style:{handle:`_handle_1i9b3_125`,label:`_label_1i9b3_132`,required:`_required_1i9b3_146`}}]]),Sp=`source`,Cp=Y(p({__name:`CanvasHandleNonMainOutput`,setup(e){let t=E(),{label:a,isRequired:o}=lp(),{viewport:c}=Tl(),{calculateHandleLightness:l}=ou(c),u=n(()=>({"canvas-node-handle-non-main-output":!0,[t.handle]:!0,[t.required]:o.value})),d=l(),p=n(()=>({"--handle--border--lightness--light":d.value.light,"--handle--border--lightness--dark":d.value.dark}));return(e,n)=>(O(),i(`div`,{class:R(u.value)},[B(`div`,{class:R(s(t).label)},r(s(a)),3),f(yp,{"handle-classes":Sp,style:w(p.value)},null,8,[`style`])],2))}}),[[`__cssModules`,{$style:{handle:`_handle_1utsl_125`,label:`_label_1utsl_132`,required:`_required_1utsl_145`}}]]),wp=Y(p({inheritAttrs:!1,__name:`CanvasHandleRenderer`,props:{handleId:{},connectionsCount:{},isConnecting:{type:Boolean},position:{},offset:{},node:{},type:{},index:{},required:{type:Boolean},maxConnections:{},label:{},mode:{},isReadOnly:{type:Boolean},isValidConnection:{type:Function}},emits:[`add`],setup(e,{emit:t}){let r=e,i=t,a=E(),o=n(()=>r.mode===Z.Input?`target`:`source`),c=n(()=>[a.handle,a[r.type],a[r.mode]]),l=n(()=>r.maxConnections&&r.connectionsCount>=r.maxConnections),u=n(()=>l.value?!1:r.mode===Z.Output||r.type!==Q.Main),p=n(()=>l.value?!1:r.mode===Z.Input||r.type!==Q.Main),m=n(()=>r.connectionsCount>0),{runDataOutputMap:g}=du(),y=n(()=>r.mode===Z.Output?g.value?.[r.type]?.[r.index]:void 0),b=n(()=>[a.renderType,a[r.position]]),x=()=>{let e;return e=r.mode===Z.Output?r.type===Q.Main?vp:Cp:r.type===Q.Main?fp:xp,e?d(e):null};function S(){i(`add`,r.handleId)}let C=_(r,`label`),D=_(r,`isConnecting`),k=_(r,`isReadOnly`),A=_(r,`mode`),j=_(r,`type`),M=_(r,`index`),N=_(r,`required`),P=_(r,`maxConnections`);return F(zt,{label:C,mode:A,type:j,index:M,runData:y,isRequired:N,isConnected:m,isConnecting:D,isReadOnly:k,maxConnections:P}),(t,n)=>(O(),h(s(Be),v(t.$attrs,{id:e.handleId,class:c.value,type:o.value,position:e.position,style:e.offset,"connectable-start":u.value,"connectable-end":p.value,"is-valid-connection":e.isValidConnection}),{default:T(()=>[f(x,{class:R(b.value),"is-connected":m.value,"max-connections":P.value,style:w(e.offset),label:C.value,onAdd:S},null,8,[`class`,`is-connected`,`max-connections`,`style`,`label`])]),_:1},16,[`id`,`class`,`type`,`position`,`style`,`connectable-start`,`connectable-end`,`is-valid-connection`]))}}),[[`__cssModules`,{$style:{handle:`_handle_pg5br_125`,inputs:`_inputs_pg5br_140`,main:`_main_pg5br_140`,renderType:`_renderType_pg5br_144`,top:`_top_pg5br_144`,right:`_right_pg5br_148`,left:`_left_pg5br_152`,bottom:`_bottom_pg5br_156`}}]]),Tp=Y(p({__name:`CanvasNodeTrigger`,props:{name:{},type:{},hovered:{type:Boolean},disabled:{type:Boolean},readOnly:{type:Boolean},class:{},isExperimentalNdvActive:{type:Boolean}},setup(e){let t=E(),r=n(()=>({[e.class??``]:!0,[t.container]:!0,[t.interactive]:!e.disabled&&!e.readOnly,[t.hovered]:!!e.hovered,[t.isExperimentalNdvActive]:e.isExperimentalNdvActive})),o=he(),c=G(),l=it(),u=en(),{runEntireWorkflow:d}=cn({router:o}),{startChat:p}=nn(),m=n(()=>u.isOpen),g=n(()=>l.isWorkflowRunning),_=n(()=>`execute-workflow-button-${e.name}`);async function v(){l.setSelectedTriggerNodeName(e.name),await d(`node`,e.name)}return(t,n)=>(O(),i(`div`,{class:R(r.value),onClick:n[2]||=A(()=>{},[`stop`,`prevent`]),onMousedown:n[3]||=A(()=>{},[`stop`,`prevent`])},[B(`div`,null,[B(`div`,{class:R(t.$style.bolt)},[f(s(J),{icon:`bolt-filled`,size:`large`})],2),e.readOnly?a(``,!0):(O(),i(b,{key:0},[e.type===s(`@n8n/n8n-nodes-langchain.chatTrigger`)?(O(),i(b,{key:0},[m.value?(O(),h(s(ce),{key:0,variant:`subtle`,icon:`message-circle`,size:`large`,disabled:g.value,"data-test-id":_.value,label:s(c).baseText(`chat.hide`),onClickCapture:n[0]||=e=>s(u).toggleOpen(!1)},null,8,[`disabled`,`data-test-id`,`label`])):(O(),h(dn,{key:1,label:s(c).baseText(`chat.open`),shortcut:{keys:[`c`]}},{default:T(()=>[f(s(ce),{variant:`solid`,icon:`message-circle`,size:`large`,disabled:g.value,"data-test-id":_.value,label:s(c).baseText(`chat.open`),onClickCapture:n[1]||=e=>s(p)(`node`)},null,8,[`disabled`,`data-test-id`,`label`])]),_:1},8,[`label`]))],64)):(O(),h(s(ce),{key:1,variant:`solid`,icon:`flask-conical`,size:`large`,disabled:g.value,"data-test-id":_.value,label:s(c).baseText(`nodeView.runButtonText.executeWorkflow`),onClickCapture:v},null,8,[`disabled`,`data-test-id`,`label`]))],64))])],34))}}),[[`__cssModules`,{$style:{container:`_container_zea8x_125`,interactive:`_interactive_zea8x_149`,hovered:`_hovered_zea8x_149`,isExperimentalNdvActive:`_isExperimentalNdvActive_zea8x_154`,bolt:`_bolt_zea8x_158`}}]]),Ep=e(vt(),1),Dp=[`data-test-id`,`data-node-name`,`data-node-type`],Op=Y(p({__name:`CanvasNode`,props:{id:{},type:{},selected:{type:Boolean},connectable:{type:[Boolean,Number,String,Function]},position:{},dimensions:{},label:{},isValidTargetPos:{type:Function},isValidSourcePos:{type:Function},parent:{},parentNodeId:{},dragging:{type:Boolean},resizing:{type:Boolean},zIndex:{},targetPosition:{},sourcePosition:{},dragHandle:{},data:{},events:{},readOnly:{type:Boolean},eventBus:{},hovered:{type:Boolean},nearbyHovered:{type:Boolean}},emits:[`add`,`delete`,`run`,`select`,`toggle`,`activate`,`deactivate`,`open:contextmenu`,`update`,`update:inputs`,`update:outputs`,`move`,`focus`,`add:ai`],setup(e,{emit:t}){let r=ee(),o=t,c=E(),d=e,p=An(),{connectingHandle:m,isExperimentalNdvActive:g}=Tl(),C=l([]),w=n(()=>d.data.inputs),T=n(()=>d.data.outputs),D=n(()=>d.data.connections),{mainInputs:k,nonMainInputs:A,requiredNonMainInputs:M,mainOutputs:N,nonMainOutputs:P,isValidConnection:I}=bu({inputs:w,outputs:T,connections:D}),L=n(()=>d.data.disabled),z=n(()=>({[c.canvasNode]:!0,[c.showToolbar]:Ce.value,hovered:d.hovered,selected:d.selected,waiting:d.data.execution.waiting||d.data.execution.status===`waiting`,running:d.data.execution.running||d.data.execution.waitingForNext,...Object.fromEntries([...C.value].map(e=>[e,!0]))})),B=n(()=>d.data.render.type),V=n(()=>[X.StickyNote,X.AddNodes,X.ChoicePrompt].includes(B.value)?void 0:`canvas-node`),H=l(fe());function U(e){e.ids.includes(d.id)&&H.value&&H.value.emit(e.action,e.payload)}let te=n(()=>Xt(A.value,M.value.length)),ne=n(()=>[...k.value.map(W),...te.value.map(ae)].filter(e=>!!e)),re=n(()=>[...N.value.map(G),...P.value.map(oe)].filter(e=>!!e)),ie=({mode:e,position:t,offsetAxis:n})=>(r,i,a)=>{if(!r)return;let o=Jt({mode:e,type:r.type,index:r.index}),s=e===Z.Input?`target`:`source`,c=D.value[e][r.type]?.[r.index]?.length??0,l=m.value?.nodeId===d.id&&m.value?.handleType===s&&m.value?.handleId===o,u=t===Ie.Bottom?`${40+3*i*16}px`:g.value&&a.length===1?`${(1+i)*(16*1.5)}px`:`${100/(a.length+1)*(i+1)}%`;return{...r,handleId:o,connectionsCount:c,isConnecting:l,position:t,offset:{[n]:u}}},W=ie({mode:Z.Input,position:Ie.Left,offsetAxis:`top`}),ae=ie({mode:Z.Input,position:Ie.Bottom,offsetAxis:`left`}),G=ie({mode:Z.Output,position:Ie.Right,offsetAxis:`top`}),oe=ie({mode:Z.Output,position:Ie.Top,offsetAxis:`left`});function se(e){o(`add`,d.id,e)}function ce(){o(`delete`,d.id)}function K(){o(`run`,d.id)}function q(){o(`toggle`,d.id)}function le(e,t){o(`activate`,e,t)}function J(){o(`deactivate`,d.id)}function ue(e){o(`open:contextmenu`,d.id,e,`node-button`)}function de(e){o(`open:contextmenu`,d.id,e,`node-right-click`)}function pe(e){o(`update`,d.id,e)}function me(e){o(`move`,d.id,e)}function he(e){o(`focus`,e)}function Y(e){o(`add:ai`,e)}function ge({className:e,add:t=!0}){C.value=t?[...new Set([...C.value,e])]:C.value.filter(t=>t!==e)}let _e=_(d,`id`),ve=_(d,`data`),ye=_(d,`label`),be=_(d,`selected`),xe=_(d,`readOnly`);F(Ht,{id:_e,data:ve,label:ye,selected:be,readOnly:xe,eventBus:H});let Se=n(()=>![X.AddNodes,X.ChoicePrompt].includes(B.value)),Ce=n(()=>{let e=p.target.value;return p.isOpen&&e?.source===`node-button`&&e.nodeId===_e.value});return x(()=>d.selected,e=>{o(`select`,d.id,e)}),x(w,(e,t)=>{(0,Ep.default)(e,t)||o(`update:inputs`,d.id)}),x(T,(e,t)=>{(0,Ep.default)(e,t)||o(`update:outputs`,d.id)}),y(()=>{d.eventBus?.on(`nodes:action`,U),H.value?.on(`update:node:class`,ge)}),u(()=>{d.eventBus?.off(`nodes:action`,U),H.value?.off(`update:node:class`,ge)}),(t,n)=>(O(),i(`div`,{class:R(z.value),"data-test-id":V.value,"data-node-name":ve.value.name,"data-node-type":ve.value.type},[(O(!0),i(b,null,j(re.value,e=>(O(),h(wp,v({key:`${e.handleId}(${e.index+1}/${re.value.length})`,ref_for:!0},e,{mode:s(Z).Output,"is-read-only":xe.value,"is-valid-connection":s(I),"data-node-name":ve.value.name,"data-test-id":`canvas-node-output-handle`,"data-index":e.index,"data-connection-type":e.type,onAdd:se}),null,16,[`mode`,`is-read-only`,`is-valid-connection`,`data-node-name`,`data-index`,`data-connection-type`]))),128)),(O(!0),i(b,null,j(ne.value,e=>(O(),h(wp,v({key:`${e.handleId}(${e.index+1}/${ne.value.length})`,ref_for:!0},e,{mode:s(Z).Input,"is-read-only":xe.value,"is-valid-connection":s(I),"data-test-id":`canvas-node-input-handle`,"data-index":e.index,"data-connection-type":e.type,"data-node-name":ve.value.name,onAdd:se}),null,16,[`mode`,`is-read-only`,`is-valid-connection`,`data-index`,`data-connection-type`,`data-node-name`]))),128)),r.toolbar?S(t.$slots,`toolbar`,{key:0,inputs:s(k),outputs:s(N),data:ve.value}):Se.value?(O(),h(yu,{key:1,"data-test-id":`canvas-node-toolbar`,"read-only":xe.value,class:R(t.$style.canvasNodeToolbar),"show-status-icons":s(g),"items-class":t.$style.canvasNodeToolbarItems,onDelete:ce,onToggle:q,onRun:K,onUpdate:pe,"onOpen:contextmenu":ue,onFocus:he,"onAdd:ai":Y},null,8,[`read-only`,`class`,`show-status-icons`,`items-class`])):a(``,!0),f(cp,{onActivate:le,onDeactivate:J,onMove:me,onUpdate:pe,"onOpen:contextmenu":de,onDelete:ce}),d.data.render.type===s(X).Default&&d.data.render.options.trigger?(O(),h(Tp,{key:2,name:ve.value.name,type:ve.value.type,hovered:e.nearbyHovered,disabled:L.value,"read-only":xe.value,class:R(t.$style.trigger),"is-experimental-ndv-active":s(g)},null,8,[`name`,`type`,`hovered`,`disabled`,`read-only`,`class`,`is-experimental-ndv-active`])):a(``,!0)],10,Dp))}}),[[`__cssModules`,{$style:{canvasNode:`_canvasNode_35bs3_125`,canvasNodeToolbarItems:`_canvasNodeToolbarItems_35bs3_125`,trigger:`_trigger_35bs3_129`,showToolbar:`_showToolbar_35bs3_129`,canvasNodeToolbar:`_canvasNodeToolbar_35bs3_125`}}]]),kp=` `,Ap=1,jp=1e3,Mp=Y(p({__name:`Canvas`,props:{id:{default:`canvas`},nodes:{default:()=>[]},connections:{default:()=>[]},controlsPosition:{default:Me.BottomLeft},eventBus:{default:()=>fe()},readOnly:{type:Boolean,default:!1},executing:{type:Boolean,default:!1},keyBindings:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},suppressInteraction:{type:Boolean,default:!1},hideControls:{type:Boolean,default:!1}},emits:`update:modelValue.update:node:position.update:nodes:position.update:node:activated.update:node:deactivated.update:node:enabled.update:node:selected.update:node:name.update:node:parameters.update:node:inputs.update:node:outputs.update:logs-open.update:logs:input-open.update:logs:output-open.update:has-range-selection.click:node.click:node:add.run:node.copy:production:url.copy:test:url.delete:node.replace:node.create:node.create:sticky.delete:nodes.update:nodes:enabled.copy:nodes.duplicate:nodes.update:nodes:pin.cut:nodes.delete:connection.create:connection:start.create:connection.create:connection:end.create:connection:cancelled.click:connection:add.click:pane.run:workflow.create:workflow.drag-and-drop.tidy-up.toggle:focus-panel.viewport:change.selection:end.open:sub-workflow.start-chat.extract-workflow`.split(`.`),setup(e,{expose:t,emit:r}){let i=E(),u=r,d=e,{isMobileDevice:p,controlKeyCode:g}=me(),b=tn(),C=_e(),w=Wt(),D=Xe(),k=n(()=>b.isActive(J.value.zoom)),A=Ye(d.id),{getSelectedNodes:j,addSelectedNodes:M,removeSelectedNodes:ee,viewportRef:L,fitView:z,fitBounds:B,zoomIn:te,zoomOut:re,zoomTo:W,setInteractive:G,elementsSelectable:oe,project:se,nodes:ce,onPaneReady:K,onNodesInitialized:q,findNode:le,viewport:J,dimensions:ue,nodesSelectionActive:de,userSelectionRect:fe,setViewport:pe,setCenter:he,onEdgeMouseLeave:Y,onEdgeMouseEnter:ge,onEdgeMouseMove:ye,onNodeMouseEnter:be,onNodeMouseLeave:xe}=A,{getIncomingNodes:Se,getOutgoingNodes:we,getSiblingNodes:Te,getDownstreamNodes:Ee,getUpstreamNodes:De}=Mr(A),{layout:ke}=Ar(d.id,k),Ae=l(!1),je=n(()=>({[i.canvas]:!0,[i.ready]:!d.loading&&Ae.value,[i.isExperimentalNdvActive]:k.value})),Ne=l(p?!0:[` `,g]),Fe=l(p?!0:[1]),Ie=l(p?`Shift`:!0),Le=l(!1);function Re(){Ie.value=null,Fe.value=[0,1],Le.value=!0}function Be(){Ie.value=!0,Fe.value=[1],Le.value=!1}ne(Ne.value,Re,{dedupe:!0}),ae(Ne.value,Be),Nr(kp,()=>{et.value&&u(`update:node:name`,et.value.id)},{disabled:_(d,`readOnly`)});let Ve=n(()=>!d.keyBindings);function He(e){let t=Se(e)[0];t&&pt({ids:[t.id]})}function Ue(e){let t=we(e)[0];t&&pt({ids:[t.id]})}function We(e){let t=Te(e),n=t[t.findIndex(t=>t.id===e)+1]??t[0];n&&pt({ids:[n.id]})}function Ke(e){let t=Te(e),n=t[t.findIndex(t=>t.id===e)-1]??t[t.length-1];n&&pt({ids:[n.id]})}function Je(e){pt({ids:[...Ee(e).map(e=>e.id),e]})}function Ze(e){pt({ids:[...De(e).map(e=>e.id),e]})}function Z(){b.toggleZoomMode({canvasViewport:J.value,canvasDimensions:ue.value,selectedNodes:j.value,setViewport:pe,fitView:z,zoomTo:W,setCenter:he})}fn(n(()=>{let e={ctrl_shift_o:Rt(e=>u(`open:sub-workflow`,e)),ctrl_c:{disabled:()=>ze(L.value),run:Lt(e=>u(`copy:nodes`,e))},enter:Rt(e=>lt(e)),ctrl_a:()=>M(ce.value),"shift_+|+|=|shift_Equal|Equal":async()=>await Kt(),"shift+_|-|_|shift_Minus|Minus":async()=>await qt(),0:async()=>await Jt(),1:async()=>await Ut(),ArrowUp:Rt(Ke),ArrowDown:Rt(We),ArrowLeft:Rt(He),ArrowRight:Rt(Ue),shift_ArrowLeft:Rt(Ze),shift_ArrowRight:Rt(Je),l:()=>u(`update:logs-open`),i:()=>u(`update:logs:input-open`),o:()=>u(`update:logs:output-open`),z:Z};return d.readOnly?e:{...e,ctrl_x:Lt(e=>u(`cut:nodes`,e)),"delete|backspace":Lt(e=>u(`delete:nodes`,e)),ctrl_d:Lt(e=>u(`duplicate:nodes`,e)),d:Lt(e=>u(`update:nodes:enabled`,e)),p:Lt(e=>u(`update:nodes:pin`,e,`keyboard-shortcut`)),f2:Rt(e=>u(`update:node:name`,e)),tab:()=>u(`create:node`,`tab`),shift_s:()=>u(`create:sticky`),shift_f:()=>u(`toggle:focus-panel`),ctrl_alt_n:()=>u(`create:workflow`),ctrl_enter:()=>u(`run:workflow`),ctrl_s:()=>{},shift_alt_t:async()=>await on({source:`keyboard-shortcut`}),alt_x:Lt(e=>u(`extract-workflow`,e)),c:()=>u(`start-chat`),r:Rt(e=>u(`replace:node`,e)),shift_alt_u:Rt(e=>u(`copy:test:url`,e)),alt_u:Rt(e=>u(`copy:production:url`,e)),alt_i:Lt(e=>xt(e))}}),{disabled:Ve});let Qe=n(()=>j.value.length>0),$e=n(()=>j.value.map(e=>e.id)),et=l(),tt=jr(n(()=>d.nodes.filter(e=>e.data?.render.type===X.Default&&e.data.render.options.trigger)),A,e=>({x:e.x-e.width*2,y:e.y-e.height,width:e.width*4,height:e.height*3}));x(j,e=>{(!et.value||!e.find(e=>e.id===et.value?.id))&&(et.value=e[e.length-1])}),x($e,e=>{w.isOpen&&C.isFeatureEnabled&&C.setUnconfirmedFromCanvasSelection(e)}),x(()=>w.isOpen,e=>{e&&$e.value.length>0&&C.isFeatureEnabled&&C.setUnconfirmedFromCanvasSelection($e.value)});function nt(e,t){u(`click:node:add`,e,t)}function rt(e){u(`update:nodes:position`,e)}function it(e,t){u(`update:node:position`,e,t)}function at(e){rt(e.nodes.map(({id:e,position:t})=>({id:e,position:t})))}function ot({event:e,node:t}){w.isOpen&&C.isFeatureEnabled&&(C.confirmNodes([t.id],`canvas_selection`),D.focusRequested++),u(`click:node`,t.id,Bt(e)),!(e.ctrlKey||e.metaKey||j.value.length<2)&&pt({ids:[t.id]})}function st(e){rt(e.nodes.map(({id:e,position:t})=>({id:e,position:t})))}function ct(e){j.value.length===1&&(de.value=!1),u(`selection:end`,Bt(e))}function lt(e,t){d.eventBus.emit(`nodes:action`,{ids:[e],action:`update:node:activated`}),u(`update:node:activated`,e,t)}function ut(e){u(`update:node:deactivated`,e)}function dt(){ee(j.value)}function ft(){u(`update:node:selected`,et.value?.id)}function pt({ids:e,panIntoView:t}){if(dt(),M(e.map(le).filter(Ge)),t){let t=e.map(le).filter(Ge);if(t.length===0)return;pe(ve(J.value,ue.value,t,100),{duration:200,interpolate:`linear`})}}function mt(e){u(`update:node:enabled`,e)}function ht(e){u(`delete:node`,e)}function gt(e,t){u(`update:node:parameters`,e,t)}function _t(e){u(`update:node:inputs`,e),o(()=>A.updateNodeInternals([e]))}function vt(e){u(`update:node:outputs`,e),o(()=>A.updateNodeInternals([e]))}function yt(e){let t=A.nodeLookup.value.get(e);t&&(M([t]),b.focusNode(t,{canvasViewport:J.value,canvasDimensions:ue.value,setCenter:he}))}function bt(e){C.confirmNodes([e],`context_menu`),w.open({mode:`builder`})}function xt(e){C.isFeatureEnabled&&(C.confirmNodes(e,`context_menu`),w.open({mode:`builder`}))}let St=l(!1),Ct=l(),wt=l();function Tt(e){u(`create:connection:start`,e),Ct.value=e,St.value=!1}function Et(e){u(`create:connection`,e),wt.value=e,St.value=!0}function Dt(e){wt.value?u(`create:connection:end`,wt.value,e):Ct.value&&u(`create:connection:cancelled`,Ct.value,Bt(e),e),wt.value=void 0,Ct.value=void 0}function kt(e){u(`delete:connection`,e)}function At(e){u(`click:connection:add`,e)}let jt=l(`custom-arrow-head`),Mt=l({}),Nt=l({});ge(({edge:e})=>{Nt.value={[e.id]:!0},Mt.value={[e.id]:!0}}),ye(ie(({edge:e,event:t})=>{e.data.source.type===Q.AiTool&&(!e.data.maxConnections||e.data.maxConnections>1)&&(Bt(t).y-e.targetY<64?Nt.value={[e.id]:!1}:Nt.value={[e.id]:!0})},100)),Y(({edge:e})=>{Nt.value={[e.id]:!1},Mt.value={[e.id]:!1}});function Pt(e,t){Nt.value={[e]:!0},Mt.value[e]=t}let Ft=l({});be(({node:e})=>{Ft.value={[e.id]:!0}}),xe(({node:e})=>{Ft.value={[e.id]:!1}});function It(e){u(`run:node`,e)}function Lt(e){return()=>{Qe.value&&e($e.value)}}function Rt(e){return()=>{et.value&&e(et.value.id)}}let zt=l(!1);gl(L,J,pe);function Bt(e){let t=L.value?.getBoundingClientRect()??{left:0,top:0},[n,r]=e?Ce(e):[0,0];return se({x:n-t.left,y:r-t.top})}function Vt(e){u(`click:pane`,Bt(e))}async function Ht(e){await B(qe(e),{padding:2})}async function Ut(){await z({maxZoom:Ap,padding:.2})}async function Gt(e){await W(e)}async function Kt(){await te()}async function qt(){await re()}async function Jt(){await Gt(Ap)}function Yt({event:e}){(Le.value||e instanceof WheelEvent)&&(zt.value=!0)}function Xt(){zt.value=!1}function Zt(){u(`viewport:change`,J.value,ue.value)}let Qt=n(()=>d.nodes.reduce((e,t)=>(e[t.id]=t.data,e),{})),$t=An();function en(e,t){$t.open(e,{source:`canvas`,nodeIds:$e.value,...t})}function nn({event:e}){en(e)}function rn(e,t,n){n===`node-button`?$t.open(t,{source:n,nodeId:e}):$e.value.length>1&&$e.value.includes(e)?en(t,{nodeId:e}):(pt({ids:[e]}),$t.open(t,{source:n,nodeId:e}))}async function an(e,t){switch(e){case`add_node`:return u(`create:node`,`context_menu`);case`add_sticky`:return u(`create:sticky`);case`copy`:return u(`copy:nodes`,t);case`delete`:return u(`delete:nodes`,t);case`select_all`:return M(ce.value);case`deselect_all`:return dt();case`duplicate`:return u(`duplicate:nodes`,t);case`toggle_pin`:return u(`update:nodes:pin`,t,`context-menu`);case`execute`:return u(`run:node`,t[0]);case`copy_production_url`:return u(`copy:production:url`,t[0]);case`copy_test_url`:return u(`copy:test:url`,t[0]);case`toggle_activation`:return u(`update:nodes:enabled`,t);case`open`:return lt(t[0]);case`rename`:return u(`update:node:name`,t[0]);case`replace`:return u(`replace:node`,t[0]);case`change_color`:return d.eventBus.emit(`nodes:action`,{ids:t,action:`update:sticky:color`});case`tidy_up`:return await on({source:`context-menu`});case`extract_sub_workflow`:return u(`extract-workflow`,t);case`open_sub_workflow`:return u(`open:sub-workflow`,t[0]);case`focus_ai_on_selected`:C.confirmNodes(t,`context_menu`),w.open({mode:`builder`});return}}async function on(e){e.nodeIdsFilter&&e.nodeIdsFilter.length>0&&(dt(),M(e.nodeIdsFilter.map(le).filter(Ge)));let t=j.value.length>1,n=t?`selection`:`all`;u(`tidy-up`,{result:ke(n),target:n,source:e.source},{trackEvents:e.trackEvents,trackHistory:e.trackHistory,trackBulk:e.trackBulk}),await o(),t?await Ht(j.value):await Ut()}function sn(e){e.preventDefault()}function cn(e){u(`drag-and-drop`,Bt(e),e)}let ln=l(null),un=l(!1);function dn(e){return`minimap-node-${e.data?.render.type.replace(/\./g,`-`)??`default`}`}x(zt,e=>{e?pn():mn()});function pn(){ln.value&&=(clearTimeout(ln.value),null),un.value=!0}function mn(){ln.value=setTimeout(()=>{un.value=!1},jp)}function hn(){pn()}function gn(){mn()}function _n(){Be()}let vn=l(!1);return y(()=>{d.eventBus.on(`fitView`,Ut),d.eventBus.on(`nodes:select`,pt),d.eventBus.on(`nodes:selectAll`,()=>M(ce.value)),d.eventBus.on(`tidyUp`,on),window.addEventListener(`blur`,_n)}),m(()=>{d.eventBus.off(`fitView`,Ut),d.eventBus.off(`nodes:select`,pt),d.eventBus.off(`tidyUp`,on),window.removeEventListener(`blur`,_n)}),K(async()=>{await Ut(),Ae.value=!0}),q(()=>{vn.value=!0}),x([()=>d.readOnly,()=>d.suppressInteraction],([e,t])=>{G(!e&&!t),oe.value=!t},{immediate:!0}),x([de,fe],([e,t])=>u(`update:has-range-selection`,e||(t?.width??0)>0||(t?.height??0)>0)),x([A.nodes,()=>b.nodeNameToBeFocused],([e,t])=>{let n=t&&e.find(e=>e.data.name===t);n&&setTimeout(()=>{b.focusNode(n,{canvasViewport:J.value,canvasDimensions:ue.value,setCenter:he})})}),F(Ot,{connectingHandle:Ct,isExecuting:_(d,`executing`),initialized:vn,viewport:J,isExperimentalNdvActive:k,isPaneMoving:zt}),t({executeContextMenuAction:an}),(t,n)=>(O(),h(s(Oe),{id:e.id,nodes:e.nodes,edges:e.connections,class:R(je.value),"apply-changes":!1,"connection-line-options":{markerEnd:s(Pe).ArrowClosed},"connection-radius":60,"pan-on-drag":Fe.value,"pan-on-scroll":``,"snap-to-grid":``,"snap-grid":[s(16),s(16)],"min-zoom":0,"max-zoom":s(b).isZoomedViewEnabled?s(b).maxCanvasZoom:4,"selection-key-code":Ie.value,"zoom-activation-key-code":Ne.value,"pan-activation-key-code":Ne.value,"disable-keyboard-a11y":!0,"delete-key-code":null,"data-test-id":`canvas`,onConnectStart:Tt,onConnect:Et,onConnectEnd:Dt,onPaneClick:Vt,onPaneContextMenu:en,onMove:Yt,onMoveEnd:Xt,onNodeDragStop:at,onNodeClick:ot,onSelectionDragStop:st,onSelectionEnd:ct,onSelectionContextMenu:nn,onDragover:sn,onDrop:cn,onViewportChange:Zt},{"node-canvas-node":T(n=>[S(t.$slots,`node`,U(c({nodeProps:n})),()=>[f(Op,v(n,{data:Qt.value[n.id],"read-only":e.readOnly,"event-bus":e.eventBus,hovered:Ft.value[n.id],"nearby-hovered":n.id===s(tt).id.value,onDelete:ht,onRun:It,onSelect:ft,onToggle:mt,onActivate:lt,onDeactivate:ut,"onOpen:contextmenu":rn,onUpdate:gt,"onUpdate:inputs":_t,"onUpdate:outputs":vt,onMove:it,onAdd:nt,onFocus:yt,"onAdd:ai":bt}),N({_:2},[t.$slots.nodeToolbar?{name:`toolbar`,fn:T(e=>[S(t.$slots,`nodeToolbar`,U(c(e)),void 0,!0)]),key:`0`}:void 0]),1040,[`data`,`read-only`,`event-bus`,`hovered`,`nearby-hovered`])],!0)]),"edge-canvas-edge":T(n=>[S(t.$slots,`edge`,U(c({edgeProps:n,arrowHeadMarkerId:jt.value})),()=>[f(uu,v(n,{"marker-end":`url(#${jt.value})`,"read-only":e.readOnly,hovered:Mt.value[n.id],"bring-to-front":Nt.value[n.id],onAdd:At,onDelete:kt,"onUpdate:label:hovered":e=>Pt(n.id,e)}),null,16,[`marker-end`,`read-only`,`hovered`,`bring-to-front`,`onUpdate:label:hovered`])],!0)]),"connection-line":T(e=>[f(El,U(c(e)),null,16)]),default:T(()=>[f(vl,{id:jt.value},null,8,[`id`]),S(t.$slots,`canvas-background`,U(c({viewport:s(J)})),()=>[f(En,{viewport:s(J),striped:e.readOnly},null,8,[`viewport`,`striped`])],!0),f(P,{name:`minimap`},{default:T(()=>[V(f(s(hl),{"data-test-id":`canvas-minimap`,"aria-label":`n8n Minimap`,height:120,width:200,position:s(Me).BottomLeft,pannable:``,zoomable:``,"node-class-name":dn,"node-border-radius":16,onMouseenter:hn,onMouseleave:gn},null,8,[`position`]),[[I,un.value]])]),_:1}),e.hideControls?a(``,!0):(O(),h(ru,{key:0,"data-test-id":`canvas-controls`,class:R(s(i).canvasControls),position:e.controlsPosition,"show-interactive":!1,zoom:s(J).zoom,"read-only":e.readOnly,"is-experimental-ndv-active":k.value,onZoomToFit:Ut,onZoomIn:Kt,onZoomOut:qt,onResetZoom:Jt,onTidyUp:n[0]||=e=>on({source:`canvas-button`}),onToggleZoomMode:Z},null,8,[`class`,`position`,`zoom`,`read-only`,`is-experimental-ndv-active`])),(O(),h(H,null,{default:T(()=>[f(jn,{onAction:an})]),_:1}))]),_:3},8,[`id`,`nodes`,`edges`,`class`,`connection-line-options`,`pan-on-drag`,`snap-grid`,`max-zoom`,`selection-key-code`,`zoom-activation-key-code`,`pan-activation-key-code`]))}}),[[`__cssModules`,{$style:{canvas:`_canvas_wikel_125`,ready:`_ready_wikel_131`,isExperimentalNdvActive:`_isExperimentalNdvActive_wikel_134`}}],[`__scopeId`,`data-v-b4ad6171`]]);function Np({nodes:e,connections:t,workflowObject:r}){let i=G(),a=it(),o=Fe(),s=be(),c=Ee(),{dirtinessByName:u}=sn();function d(e){return{type:X.StickyNote,options:{width:e.parameters.width,height:e.parameters.height,color:e.parameters.color,content:e.parameters.content}}}function f(){return{type:X.AddNodes,options:{}}}function p(){return{type:X.ChoicePrompt,options:{}}}function m(e){let t=g.value[e.id],n=Kt(L.value[e.id]??t??e.type,e);return{type:X.Default,options:{trigger:_.value[e.id],configuration:s.isConfigNode(r.value,e,e.type),configurable:s.isConfigurableNode(r.value,e,e.type,e.typeVersion),inputs:{labelSize:S.value[e.id]},outputs:{labelSize:C.value[e.id]},tooltip:E.value[e.id],dirtiness:u.value[e.name],icon:n}}}let h=n(()=>e.value.reduce((e,t)=>{switch(t.type){case`${X.StickyNote}`:e[t.id]=d(t);break;case`${X.AddNodes}`:e[t.id]=f();break;case`${X.ChoicePrompt}`:e[t.id]=p();break;default:e[t.id]=m(t)}return e},{})??{}),g=n(()=>e.value.reduce((e,t)=>(e[t.id]=s.getNodeType(t.type,t.typeVersion)??s.communityNodeType(t.type)?.nodeDescription??null,e),{})),_=n(()=>e.value.reduce((e,t)=>(e[t.id]=s.isTriggerNode(t.type),e),{})),v=n(()=>e.value.reduce((e,t)=>{try{let n=g.value[t.id];if(!n)return e;let i=c.getNodeSubtitle(t,n,r.value)??``;if(i.includes(`__CUSTOM_API_CALL__`))return e;e[t.id]=i}catch{}return e},{})),y=n(()=>e.value.reduce((e,t)=>{let n=g.value[t.id],i=r.value.getNode(t.name);return e[t.id]=i&&n?Zt(Lt(r.value,i,n),n.inputNames??[]):[],e},{}));function b(e=``){return e.length<=2?0:e.length<=6?1:2}function x(e){let t=[`small`,`medium`,`large`],n=e.reduce((e,t)=>(t.type===Q.Main&&e.push(b(t.label??``)),e),[0]);return t[Math.max(...n)]}let S=n(()=>e.value.reduce((e,t)=>(e[t.id]=x(y.value[t.id]),e),{})),C=n(()=>e.value.reduce((e,t)=>(e[t.id]=x(w.value[t.id]),e),{})),w=n(()=>e.value.reduce((e,t)=>{let n=g.value[t.id],i=r.value.getNode(t.name);return e[t.id]=i&&n?Zt(At(r.value,i,n),n.outputNames??[]):[],e},{})),T=n(()=>e.value.reduce((e,t)=>(e[t.id]=a.pinDataByNodeName(t.name),e),{})),E=n(()=>{if(!a.isWorkflowRunning)return{};let t=e.value.filter(e=>_.value[e.id]&&!e.disabled).length,n=a.getWorkflowExecution?.triggerNode;return n===void 0&&t!==1?{}:e.value.reduce((e,t)=>{let r=g.value[t.id];if(r&&_.value[t.id]){if(t.disabled||n!==void 0&&n!==t.name||![`new`,`unknown`,`waiting`].includes(k.value[t.id])||T.value[t.id])return e;if(typeof r.eventTriggerDescription==`string`){let n=i.shortNodeType(r.name),{eventTriggerDescription:a}=r;e[t.id]=i.nodeText(r.name).eventTriggerDescription(n,a??``)}else e[t.id]=i.baseText(`node.waitingForYouToCreateAnEventIn`,{interpolate:{nodeType:r?Ne(r):``}})}return e},{})}),D=n(()=>e.value.reduce((e,t)=>(e[t.id]=o.executingNode.isNodeExecuting(t.name),e),{})),O=n(()=>e.value.reduce((e,t)=>(e[t.id]=t.name===o.executingNode.lastAddedExecutingNode&&o.executingNode.executingNode.length===0&&a.isWorkflowRunning,e),{})),k=n(()=>e.value.reduce((e,t)=>{let n=a.getWorkflowRunData?.[t.name]??[],r=n.at(-1)?.executionStatus;return n.length>1&&r===`canceled`&&(r=n.at(-2)?.executionStatus),e[t.id]=r??`new`,e},{})),A=n(()=>e.value.reduce((e,t)=>(e[t.id]=a.getWorkflowResultDataByNodeName(t.name),e),{})),j=n(()=>new Map(e.value.map(e=>[e.name,e]))),M=l({});W(()=>a.workflowExecutionResultDataLastUpdate,()=>{M.value=Object.keys(A.value).reduce((e,t)=>{e[t]={};let n={iterations:0,total:0};for(let r of A.value[t]??[]){let i=r.data??{};for(let a of Object.keys(i)){let o=i[a]??{};e[t][a]=e[t][a]??{};for(let i of Object.keys(o)){let s=o[parseInt(i,10)]??[];e[t][a][i]=e[t][a][i]??{...n,...a===Q.Main?{}:{byTarget:{}}};let c=s.length;if(a!==Q.Main&&s.length>0){let e=s[0];e?.json&&typeof e.json==`object`&&`response`in e.json&&Array.isArray(e.json.response)&&(c=e.json.response.length)}if(r.executionStatus!==`canceled`&&(e[t][a][i].iterations+=1),e[t][a][i].total+=c,a!==Q.Main){let n=r.source?.[0]?.previousNode;if(n){let o=j.value.get(n);if(o){let n=o.id,s=e[t][a][i];s.byTarget&&(s.byTarget[n]||(s.byTarget[n]={total:0,iterations:0}),r.executionStatus!==`canceled`&&(s.byTarget[n].iterations+=1),s.byTarget[n].total+=c)}}}}}}return e},{})},{throttle:500,immediate:!0});let N=n(()=>e.value.reduce((e,t)=>{let n=[],r=a.getWorkflowRunData?.[t.name];return r&&r.forEach(e=>{if(e?.error){let{message:t,description:r}=e.error,i=`${t}${r?` (${r})`:``}`;n.push(Le(i))}}),e[t.id]=n,e},{})),P=n(()=>e.value.reduce((e,t)=>{let n=[];return t?.issues!==void 0&&n.push(...c.nodeIssuesToString(t.issues,t)),e[t.id]=n,e},{})),F=n(()=>e.value.reduce((e,t)=>{let n=N.value[t.id]?.length>0,r=P.value[t.id]?.length>0;if([`crashed`,`error`].includes(k.value[t.id]))e[t.id]=!0;else if(T.value[t.id])e[t.id]=!1;else if(r)e[t.id]=!0;else if(n)e[t.id]=!0;else{let n=a.getWorkflowRunData?.[t.name]??[];e[t.id]=!!n.at(-1)?.error}return e},{})),I=n(()=>e.value.reduce((e,t)=>{let n=e=>`waitTill`in e,r=a.getWorkflowExecution,o=r?.data?.resultData?.lastNodeExecuted;if(r&&o&&n(r)&&t.name===r.data?.resultData?.lastNodeExecuted&&r?.waitTill&&!r?.finished){if(t&&t.type===`n8n-nodes-base.wait`&&[`webhook`,`form`].includes(t.parameters.resume))return e[t.id]=t.parameters.resume===`webhook`?i.baseText(`node.theNodeIsWaitingWebhookCall`):i.baseText(`node.theNodeIsWaitingFormCall`),e;if(t?.parameters.operation===`sendAndWait`)return e[t.id]=i.baseText(`node.theNodeIsWaitingUserInput`),e;if(t?.type===`n8n-nodes-base.form`)return e[t.id]=i.baseText(`node.theNodeIsWaitingFormCall`),e;let n=new Date(r.waitTill);if(n.getTime()===ht.getTime())return e[t.id]=i.baseText(`node.theNodeIsWaitingIndefinitelyForAnIncomingWebhookCall`),e;e[t.id]=i.baseText(`node.nodeIsWaitingTill`,{interpolate:{date:n.toLocaleDateString(),time:n.toLocaleTimeString()}})}return e},{})),ee=n(()=>{let t=-100,n=e.value.reduce((e,n)=>{if(n.type===`n8n-nodes-base.stickyNote`){let r=n.position[0],i=n.position[1],a=n.parameters.width,o=n.parameters.height;e.push({id:n.id,x:r,y:i,width:a,height:o,area:a*o,zIndex:t})}return e},[]).sort((e,t)=>t.area-e.area);n.forEach((e,n)=>{e.zIndex=t+n});for(let e=0;e<n.length;e++){let t=n[e];for(let r=e+1;r<n.length;r++){let e=n[r];Qt(t,e)&&(t.area<e.area&&t.zIndex<=e.zIndex?t.zIndex=e.zIndex+1:e.area<t.area&&e.zIndex<=t.zIndex&&(e.zIndex=t.zIndex+1))}}return n.reduce((e,t)=>(e[t.id]={style:{zIndex:t.zIndex}},e),{})}),L=n(()=>e.value.reduce((e,t)=>{if([`n8n-nodes-base.simulate`,`n8n-nodes-base.simulateTrigger`].includes(t.type)){let n=t.parameters?.icon,i=r.value.expression.getSimpleParameterValue(t,n,`internal`,{});i&&typeof i==`string`&&(e[t.id]=s.getNodeType(i))}return e},{}));function R(e){return e?e.filter(e=>e.executionStatus!==`canceled`):null}let z=n(()=>{let n=t.value,r=Ft(n);return[...e.value.map(e=>{let t=n[e.name]??{},i=r[e.name]??{},a={id:e.id,name:e.name,subtitle:v.value[e.id]??``,type:e.type,typeVersion:e.typeVersion,disabled:e.disabled,inputs:y.value[e.id]??[],outputs:w.value[e.id]??[],connections:{[Z.Input]:i,[Z.Output]:t},issues:{execution:N.value[e.id],validation:P.value[e.id],visible:F.value[e.id]},pinnedData:{count:T.value[e.id]?.length??0,visible:!!T.value[e.id]},execution:{status:k.value[e.id],waiting:I.value[e.id],waitingForNext:O.value[e.id],running:D.value[e.id]},runData:{outputMap:M.value[e.id],iterations:R(A.value[e.id])?.length??0,visible:!!A.value[e.id]},render:h.value[e.id]??{type:`default`,options:{}}};return{id:e.id,label:e.name,type:`canvas-node`,position:{x:e.position[0],y:e.position[1]},data:a,...ee.value[e.id],draggable:e.draggable}})]}),B=n(()=>Yt(t.value??[],e.value??[]).map(e=>{let t=H(e),n=U(e),r=V(e);return{...e,data:r,type:t,label:n,markerEnd:Pe.ArrowClosed}}));function V(e){let{type:t,index:n}=qt(e.sourceHandle),r=M.value[e.source]?.[t]?.[n]?.total??0,i=A.value[e.source]??[],a=i[i.length-1];a?.executionStatus===`canceled`&&i.length>1&&(a=i[i.length-2]);let o;if(D.value[e.source]&&r===0)o=`running`;else if(T.value[e.source]&&A.value[e.source])o=`pinned`;else if(F.value[e.source])o=`error`;else if(r>0&&a?.executionStatus!==`canceled`){let n=t===Q.Main,r=A.value[e.target];(n||r)&&(o=`success`)}let s=[...y.value[e.source],...y.value[e.target]].filter(e=>e.type===t).reduce((e,t)=>t.maxConnections===void 0?e:Math.min(e??1/0,t.maxConnections),void 0);return{...e.data,...s?{maxConnections:s}:{},status:o}}function H(e){return`canvas-edge`}function U(e){let t=j.value.get(e.data?.source.node??``);if(!t)return``;if(T.value[t.id]){let e=T.value[t.id]?.length??0;return e>0?i.baseText(`ndv.output.items`,{adjustToNumber:e,interpolate:{count:String(e)}}):``}else if(A.value[t.id]){let{type:n,index:r}=qt(e.sourceHandle),a=M.value[t.id]?.[n]?.[r],o=n===Q.Main,s=A.value[e.target];if(!o&&a?.byTarget){let t=e.target,n=a.byTarget[t];return n&&n.total>0&&s?i.baseText(n.iterations>1?`ndv.output.itemsTotal`:`ndv.output.items`,{adjustToNumber:n.total,interpolate:{count:String(n.total)}}):``}let c=a?.total??0,l=(a?.iterations??1)>1;return c>0&&(o||s)?i.baseText(l?`ndv.output.itemsTotal`:`ndv.output.items`,{adjustToNumber:c,interpolate:{count:String(c)}}):``}return``}return{additionalNodePropertiesById:ee,nodeExecutionRunDataOutputMapById:M,nodeExecutionWaitingForNextById:O,nodeHasIssuesById:F,connections:B,nodes:z}}export{Cu as a,En as c,Eu as i,Mp as n,uu as o,Op as r,Dn as s,Np as t};
//# sourceMappingURL=useCanvasMapping-DLJo3gwW.js.map