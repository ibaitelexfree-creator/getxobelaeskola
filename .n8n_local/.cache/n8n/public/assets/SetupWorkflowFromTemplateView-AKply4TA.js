(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`05a682db-d201-4425-a131-47ec5a8a6052`,e._sentryDebugIdIdentifier=`sentry-dbid-05a682db-d201-4425-a131-47ec5a8a6052`)})()}catch{}import{C as e,Cn as t,D as n,Gt as r,It as i,M as a,P as o,T as s,Z as c,_ as l,_t as u,bt as d,et as f,it as p,j as m,vn as h,w as g}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as _}from"./_MapCache-DjbOQyB7.js";import{Ci as v,Et as y,Hi as b,Oi as x,gi as S,wi as C,zi as w}from"./src-CppJvwzX.js";import{t as T}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{C as E,Lt as D,pa as O,rt as k,s as A,xn as j,xr as M}from"./users.store-pCkD7Zo0.js";import{rs as N}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import{j as P,r as F}from"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import"./nodeIcon--7uU1Imq.js";import"./NodeIcon-Dv1e4Lvu.js";import"./nodeTransforms-CG9uauaw.js";import"./templateTransforms-u0_D8fwP.js";import{n as I,r as L,t as R}from"./SetupTemplateFormStep-M1Yhoabp.js";import"./CredentialPicker-u0Fuk2eM.js";import{t as z}from"./templateActions-mFhFI7hF.js";import{t as B}from"./TemplatesView-C8R65plk.js";const V=P(`setupTemplate`,()=>{let t=i(``),n=i(!0),r=i(!1),a=j(),o=E(),s=k(),c=F(),l=A(),u=e(()=>t.value?a.getFullTemplateById(t.value):null),{appCredentials:d,credentialOverrides:f,credentialUsages:p,credentialsByKey:m,nodesRequiringCredentialsSorted:h,numFilledCredentials:g,selectedCredentialIdByKey:_,setSelectedCredentialId:v,unsetSelectedCredential:y}=L(e(()=>u.value?.workflow.nodes??[])),b=e=>{t.value=e},x=new Set([`httpBasicAuth`,`httpCustomAuth`,`httpDigestAuth`,`httpHeaderAuth`,`oAuth1Api`,`oAuth2Api`,`httpQueryAuth`]),S=()=>{for(let e of p.value){if(x.has(e.credentialType))continue;let t=s.getCredentialsByType(e.credentialType);t.length===1&&(_.value[e.key]=t[0].id)}},C=async()=>{u.value||!t.value||(await a.fetchTemplateById(t.value),S())};return{credentialsByKey:m,isLoading:n,isSaving:r,appCredentials:d,nodesRequiringCredentialsSorted:h,template:u,credentialUsages:p,selectedCredentialIdByKey:_,credentialOverrides:f,numFilledCredentials:g,createWorkflow:async e=>{let{router:n}=e,i=D();if(u.value)try{r.value=!0;let e=await z({template:u.value,credentialOverrides:f.value,rootStore:c,workflowsStore:l,nodeTypeProvider:o});i.track(`User closed cred setup`,{completed:!0,creds_filled:g.value,creds_needed:p.value.length,workflow_id:e.id}),i.track(`User inserted workflow template`,{source:`workflow`,template_id:O(t.value),wf_template_repo_session_id:a.currentSessionId}),i.track(`User saved new workflow from template`,{template_id:O(t.value),workflow_id:e.id,wf_template_repo_session_id:a.currentSessionId}),await n.replace({name:N.WORKFLOW,params:{name:e.id}})}finally{r.value=!1}},skipSetup:async({router:e})=>{let n=M(),r=D();await n.run(`templatesWorkflowView.openWorkflow`,{source:`workflow`,template_id:t.value,wf_template_repo_session_id:a.currentSessionId}),r.track(`User closed cred setup`,{completed:!1,creds_filled:0,creds_needed:p.value.length,workflow_id:null}),await e.replace({name:N.TEMPLATE_IMPORT,params:{id:t.value}})},init:async()=>{n.value=!0;try{_.value={},await Promise.all([s.fetchAllCredentials(),s.fetchCredentialTypes(!1),o.loadNodeTypesIfNotLoaded(),C()]),S()}finally{n.value=!1}},loadTemplateIfNeeded:C,setInitialCredentialSelection:S,setTemplateId:b,setSelectedCredentialId:v,unsetSelectedCredential:y}});var H={key:1},U=T(o({__name:`SetupWorkflowFromTemplateView`,setup(i){let o=V(),T=_(),E=v(),D=C(),O=e(()=>Array.isArray(E.params.id)?E.params.id[0]:E.params.id),k=e(()=>o.template?.name??`unknown`),A=e(()=>!o.isLoading),j=e(()=>D.resolve({name:N.TEMPLATE_IMPORT,params:{id:O.value}}).fullPath);u(O,async e=>{o.setTemplateId(e),await o.loadTemplateIfNeeded()});let M=async e=>{e.preventDefault(),await o.skipSetup({router:D})},P=async()=>o.template&&o.credentialUsages.length===0?(await o.skipSetup({router:D}),!0):!1;return o.setTemplateId(O.value),c(async()=>{await o.init(),await P()}),(e,i)=>(f(),s(B,{"go-back-enabled":!0},{header:d(()=>[A.value?(f(),s(r(w),{key:0,tag:`h1`,size:`2xlarge`},{default:d(()=>[m(t(r(T).baseText(`templateSetup.title`,{interpolate:{name:k.value}})),1)]),_:1})):(f(),s(r(y),{key:1,variant:`h1`}))]),content:d(()=>[g(`div`,{class:h(e.$style.grid)},[g(`div`,{class:h(e.$style.notice),"data-test-id":`info-callout`},[A.value?(f(),s(I,{key:0,"app-credentials":r(o).appCredentials},null,8,[`app-credentials`])):(f(),s(r(y),{key:1,variant:`p`}))],2),g(`div`,null,[A.value?(f(),n(`ol`,{key:0,class:h(e.$style.appCredentialsContainer)},[(f(!0),n(l,null,p(r(o).credentialUsages,(t,n)=>(f(),s(R,{key:t.key,class:h(e.$style.appCredential),order:n+1,credentials:t,"selected-credential-id":r(o).selectedCredentialIdByKey[t.key],onCredentialSelected:i[0]||=e=>r(o).setSelectedCredentialId(e.credentialUsageKey,e.credentialId),onCredentialDeselected:i[1]||=e=>r(o).unsetSelectedCredential(e.credentialUsageKey)},null,8,[`class`,`order`,`credentials`,`selected-credential-id`]))),128))],2)):(f(),n(`div`,{key:1,class:h(e.$style.appCredentialsContainer)},[a(r(y),{class:h(e.$style.appCredential),variant:`p`,rows:3},null,8,[`class`]),a(r(y),{class:h(e.$style.appCredential),variant:`p`,rows:3},null,8,[`class`])],2))]),g(`div`,{class:h(e.$style.actions)},[a(r(S),{href:j.value,"new-window":!1,onClick:i[2]||=e=>M(e)},{default:d(()=>[m(t(r(T).baseText(`templateSetup.skip`)),1)]),_:1},8,[`href`]),A.value?(f(),s(r(x),{key:0,content:r(T).baseText(`templateSetup.continue.button.fillRemaining`),disabled:r(o).numFilledCredentials>0},{default:d(()=>[a(r(b),{size:`large`,label:r(T).baseText(`templateSetup.continue.button`),disabled:r(o).isSaving||r(o).numFilledCredentials===0,"data-test-id":`continue-button`,onClick:i[3]||=e=>r(o).createWorkflow({router:r(D)})},null,8,[`label`,`disabled`])]),_:1},8,[`content`,`disabled`])):(f(),n(`div`,H,[a(r(y),{variant:`button`})]))],2)],2)]),_:1}))}}),[[`__cssModules`,{$style:{grid:`_grid_u018b_125`,notice:`_notice_u018b_133`,appCredentialsContainer:`_appCredentialsContainer_u018b_137`,appCredential:`_appCredential_u018b_137`,actions:`_actions_u018b_148`}}]]);export{U as default};
//# sourceMappingURL=SetupWorkflowFromTemplateView-AKply4TA.js.map