(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`d3b0a59d-442b-4918-8645-d7d15623c343`,e._sentryDebugIdIdentifier=`sentry-dbid-d3b0a59d-442b-4918-8645-d7d15623c343`)})()}catch{}import{C as e,Gt as t}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as n}from"./_MapCache-DjbOQyB7.js";import{C as r,Lt as i,ct as a,da as o,fa as s,s as c,xr as l,yr as u}from"./users.store-pCkD7Zo0.js";import{Ca as d,Ga as f,Ka as p,Xn as m,da as h,gc as g,hc as _,mc as v,so as y}from"./constants-D1jZwsUK.js";import{r as b}from"./_baseOrderBy-El3qbNHQ.js";function x(n={}){let i=r(),a=e(()=>{if(n.nodeType)return t(n.nodeType);let e=t(n.node);return e?i.getNodeType(e.type,e.typeVersion):null});return{nodeType:a,isSubNodeType:e(()=>d(a.value)),isMultipleOutputsNodeType:e(()=>{let e=a.value?.outputs;return typeof e==`string`?!1:(e??[]).length>1})}}function S(d,_={}){let S=b(),C=c(),w=u(),T=n(),E=i(),D=l(),{getInputDataWithPinned:O}=a(),k=e(()=>C.workflowObject),{isSubNodeType:A,isMultipleOutputsNodeType:j}=x({node:d}),M=e(()=>{let e=t(d);return e?C.pinDataByNodeName(e.name):void 0}),N=e(()=>!!t(d)&&M.value!==void 0),P=e(()=>{let e=t(d);return!!e&&!A.value&&!j.value&&!m.includes(e.type)});function F(e=!1,n){let i=t(d);if(i===null||m.includes(i.type))return!1;let a=r().getNodeType(i.type,i.typeVersion),o=O(i);if(!a||e&&o.length===0)return!1;let s=h(k.value,i,a).map(e=>typeof e==`string`?{type:e}:e),c=s.filter(e=>e.type===y.Main&&e.category!==`error`),l=!0;if(n!==void 0){let e=s[n];if(s[n]===void 0)return!1;l=e.type===y.Main&&e.category!==`error`}return c.length===1&&l}function I(e){try{return JSON.parse(e),!0}catch(t){let n=T.baseText(`runData.editOutputInvalid`),r=new RegExp(/JSON\.parse:|of the JSON data/,`g`),i=t.message.replace(r,``).trim(),a=/at position (\d+)/,o=t.message.match(a);if(t.message=i.charAt(0).toUpperCase()+i.slice(1),t.message=t.message.replace(`Unexpected token ' in JSON`,T.baseText(`runData.editOutputInvalid.singleQuote`)),o){let n=parseInt(o[1],10),r=(e.slice(0,n).match(/\n/g)||[]).length;t.message=t.message.replace(a,T.baseText(`runData.editOutputInvalid.atPosition`,{interpolate:{position:`${n}`}})),t.message=`${T.baseText(`runData.editOutputInvalid.onLine`,{interpolate:{line:`${r+1}`}})} ${t.message}`}return w.showError(t,n),!1}}function L(){return window.maxPinnedDataSize??12582912}function R(e){let n=t(d);if(!n)return!1;typeof e==`object`&&(e=JSON.stringify(e));let{pinData:r,...i}=k.value,a=p(i,{replaceCircularRefs:!0}),c={...r,[n.name]:e},l=C.getPinDataSize(c);if(l>L())return w.showError(Error(T.baseText(`ndv.pinData.error.tooLarge.description`,{interpolate:{size:s(l),limit:s(L())}})),T.baseText(`ndv.pinData.error.tooLarge.title`)),!1;let u=o(a)+l,f=g-v;return u>f?(w.showError(Error(T.baseText(`ndv.pinData.error.tooLargeWorkflow.description`,{interpolate:{size:s(u),limit:s(f)}})),T.baseText(`ndv.pinData.error.tooLargeWorkflow.title`)),!1):!0}function z({source:e}){let n=t(d),r=t(_.displayMode),i=t(_.runIndex),a={pinning_source:e,node_type:n?.type,push_ref:S.pushRef,data_size:o(M.value),view:r,run_index:i,workflow_id:C.workflowId,node_id:n?.id};D.run(`runData.onDataPinningSuccess`,a),E.track(`Ndv data pinning success`,a)}function B({errorType:e,source:n}){let r=t(d),i=t(_.displayMode),a=t(_.runIndex);E.track(`Ndv data pinning failure`,{pinning_source:n,node_type:r?.type,push_ref:S.pushRef,data_size:o(M.value),view:i,run_index:a,error_type:e})}function V(e,n){let r=t(d);if(r){if(typeof e==`string`){if(!I(e))throw B({errorType:`invalid-json`,source:n}),Error(`Invalid JSON`);e=f(e)}if(!R(e))throw B({errorType:`data-too-large`,source:n}),Error(`Data too large`);C.pinData({node:r,data:e}),z({source:n})}}function H({source:e}){let n=t(d),r=t(_.runIndex);E.track(`User unpinned ndv data`,{node_type:n?.type,push_ref:S.pushRef,run_index:r,source:e,data_size:o(M.value)})}function U(e){let n=t(d);n&&(H({source:e}),C.unpinData({node:n}))}return{data:M,hasData:N,isValidNodeType:P,canPinNode:F,setData:V,onSetDataSuccess:z,onSetDataError:B,unsetData:U,onUnsetData:H,isValidJSON:I,isValidSize:R}}export{x as n,S as t};
//# sourceMappingURL=usePinnedData-C6FFXoty.js.map