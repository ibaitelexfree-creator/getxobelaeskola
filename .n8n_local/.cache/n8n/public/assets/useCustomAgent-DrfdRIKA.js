(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`2abc7dfb-aa08-4812-b836-e1ad13c6a9d9`,e._sentryDebugIdIdentifier=`sentry-dbid-2abc7dfb-aa08-4812-b836-e1ad13c6a9d9`)})()}catch{}import{C as e,Cn as t,D as n,E as r,Gt as i,It as a,M as o,P as s,T as c,Ut as l,Z as u,_ as d,_t as f,bn as p,bt as m,et as h,h as g,it as _,j as v,mt as ee,vn as y,w as b}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as x}from"./_MapCache-DjbOQyB7.js";import{Hi as S,Ii as C,Mi as w,Oi as T,Ui as E,Vi as D,n as O}from"./src-CppJvwzX.js";import{t as k}from"./_plugin-vue_export-helper-B_J4Khre.js";import{C as te,Gt as A,Lt as j,r as ne,rt as M,ws as N}from"./users.store-pCkD7Zo0.js";import{li as P,oi as F,qo as I}from"./constants-D1jZwsUK.js";import{t as L}from"./NodeIcon-Dv1e4Lvu.js";import{n as R}from"./dist-BiTDpeeI.js";import{_ as z,d as B,f as V,g as H,i as U,m as W,p as re,r as ie,v as G,y as K}from"./constants-BeYoedeu.js";import{_ as q,c as ae,d as J,m as Y,r as X,s as oe,t as Z,x as Q,y as se}from"./chat.store-a0NAXg9S.js";import{t as ce}from"./ChatAgentAvatar-B0HR6UWG.js";var le=s({__name:`ChatProviderAvatar`,props:{provider:{},icon:{}},setup(t){let n=e(()=>X(t.provider===`n8n`?{provider:`n8n`,workflowId:``}:t.provider===`custom-agent`?{provider:`custom-agent`,agentId:``}:{provider:t.provider,model:``},{icon:t.icon}));return(e,t)=>(h(),c(ce,{agent:n.value,size:`sm`},null,8,[`agent`]))}});function ue(e,t){return t?(e.data?.fullName??e.label??``).toLowerCase().includes(t):!0}function de(e){let t=e.id;return!!(t.endsWith(`::configure`)||t.endsWith(`::add-model`)||t.endsWith(`::error`)||t.endsWith(`::loading`)||e.disabled||!e.data?.provider)}function fe(e,t,n=!1){if(de(e))return null;if(!t||n)return e;let r=ue(e,t),i=e.children??[],a=i.flatMap(e=>{let n=fe(e,t,r);return n?[n]:[]});return r||a.length>0?i.length>0&&a.length===0?null:{...e,children:a}:null}function $(e,t){return{id:se(e.model),icon:e.icon??t??void 0,label:C(e.name,45),disabled:!1,data:{provider:e.model.provider,description:e.description??void 0,fullName:e.name}}}function pe(e,{isLoading:t,i18n:n,includeCustomAgents:r}){if(!r)return null;let i=t?[]:e.map(e=>$(e,q));return{id:`custom-agent`,label:n.baseText(`chatHub.agent.personalAgents`),icon:q,data:{provider:`custom-agent`},children:[...t?[{id:`custom-agent::loading`,label:n.baseText(`generic.loadingEllipsis`),disabled:!0}]:i,{id:H,icon:{type:`icon`,value:`plus`},label:n.baseText(`chatHub.agent.newAgent`),disabled:!1,divided:t||i.length>0}]}}function me(e,t){let n=new Map;for(let t of e){let e=t.groupName??``,r=n.get(e)??[];n.set(e,[...r,t])}return n.size<2?e.map(e=>$(e,Q)):[...n].map(([e,n])=>{let r=e===``?t.baseText(`chatHub.models.selector.personalProject`):e;return{id:`n8n-project-${e}`,label:r,icon:n[0]?.groupIcon??Q,data:{provider:`n8n`},children:n.map(e=>$(e,Q))}})}function he(e,{includeCustomAgents:t,i18n:n,isLoading:r}){if(!t)return null;let i=n.baseText(`chatHub.workflowAgents.empty.noAgents`),a=n.baseText(`generic.loadingEllipsis`);return{id:`n8n`,label:n.baseText(`chatHub.agent.workflowAgents`),icon:Q,data:{provider:`n8n`},children:r?[{id:`n8n::loading`,label:a,disabled:!0}]:e.length===0?[{id:`n8n::no-agents`,label:i,disabled:!0}]:me(e,n)}}function ge(e,{models:t,error:n},{settings:r,i18n:i,isLoading:a}){let o=r[e];if(o?.enabled===!1)return null;let s={id:`${e}::configure`,icon:{type:`icon`,value:`settings`},label:i.baseText(`chatHub.agent.configureCredentials`),disabled:!1};if(a)return{id:e,label:K[e],data:{provider:e},children:[s,{id:`${e}::loading`,label:i.baseText(`generic.loadingEllipsis`),disabled:!0,divided:!0}]};let c=(o?.allowedModels??[]).flatMap(t=>t.isManual?[X({provider:e,model:t.model},{name:t.displayName})]:[]),l=[...t,...c].toSorted((e,t)=>(t.metadata.priority??0)-(e.metadata.priority??0)),u=l.length>0?l.flatMap((e,t)=>{if(o&&!J(o,e.model))return[];let n=$(e);return[t===0?{...n,divided:!0}:n]}).filter((e,t,n)=>n.findIndex(t=>t.id===e.id)===t):n?[{id:`${e}::error`,divided:!0,disabled:!0,label:n}]:[],d=[s,...u,...u.length>0&&o?.allowedModels.length===0?[{id:`${e}::add-model`,icon:{type:`icon`,value:`plus`},label:i.baseText(`chatHub.agent.addModel`),disabled:!1,divided:!0}]:[]];return{id:e,data:{provider:e},label:K[e],children:d}}function _e(e,t){let n=e.children??[],r=[...t,e.label];return n.length===0?[{...e,divided:!1,data:e.data?{...e.data,parts:r}:void 0}]:n.flatMap(e=>_e(e,r))}function ve(e,t,n){return t?e.reduce((e,r)=>{let i=fe(r,t);if(!i)return e;let a=_e(i,[]),o=Math.max(0,10-e.length),s=i.data?.provider,c=s?K[s]:``;if(e.push(...a.slice(0,o)),a.length>o){let t=o>0?n.baseText(`chatHub.models.selector.moreModels`,{interpolate:{providerName:c}}):i.label,r=a.slice(o).map(e=>({...e,label:C(e.data?.fullName??``,45),data:e.data?{...e.data,parts:void 0}:void 0}));e.push({...i,divided:!1,label:t,children:r})}return e},[]):e}function ye(e,t){let n=[],r=pe(e[`custom-agent`].models,t),i=he(e.n8n.models,t);r&&n.push(r),i&&n.push(i);let a=P.options.toSorted((e,t)=>(B.includes(e)?1:-1)-(B.includes(t)?1:-1)),o=!1;for(let r of a){let i=ge(r,e[r],t);i&&(n.push(o?i:{...i,divided:!0}),o=!0)}return n}var be=k(s({__name:`ModelSelector`,props:{selectedAgent:{},includeCustomAgents:{type:Boolean,default:!0},credentials:{},text:{type:Boolean},warnMissingCredentials:{type:Boolean,default:!1},agents:{},isLoading:{type:Boolean}},emits:[`change`,`createCustomAgent`,`selectCredential`],setup(s,{expose:l,emit:u}){let f=u;function p(e,t){f(`selectCredential`,e,t)}function g(e,t){f(`change`,{provider:e,model:t})}let C=x(),w=ee(`dropdownRef`),k=ne(),te=N(),P=M(),L=A(),z=j(),B=a(``),V=e(()=>s.selectedAgent?P.getCredentialById(s.credentials?.[s.selectedAgent.model.provider]??``)?.name:void 0),H=e(()=>Y(s.selectedAgent?.model)),W=e(()=>s.warnMissingCredentials&&H.value&&s.selectedAgent?.model.provider&&!s.credentials?.[s.selectedAgent?.model.provider]),re=e(()=>ye(s.agents,{includeCustomAgents:s.includeCustomAgents,isLoading:s.isLoading,i18n:C,settings:te.moduleSettings?.[`chat-hub`]?.providers??{}})),G=e(()=>ve(re.value,B.value,C)),K=e(()=>s.selectedAgent?.name??C.baseText(`chatHub.models.selector.defaultLabel`)),q=e(()=>I(L.personalProject?.scopes).credential.create);function J(e){let t=F[e];if(P.getCredentialsByType(t).length===0&&q.value){k.openNewCredential(t);return}k.openModalWithData({name:ie,data:{provider:e,initialValue:s.credentials?.[e]??null,onSelect:p}})}function X(e){k.openModalWithData({name:U,data:{provider:e,initialValue:null,onSelect:g}})}function Z(e){if(e===`agent::new`){f(`createCustomAgent`);return}let[,t]=e.split(`::`),n=ae(e);if(n){if(t===`configure`&&Y(n)){J(n.provider);return}if(t===`add-model`&&Y(n)){X(n.provider);return}z.track(`User selected model or agent`,{...oe(n),is_custom:n.provider===`custom-agent`}),f(`change`,n)}}function Q(e){B.value=e.toLowerCase()}return l({open:()=>w.value?.open(),openCredentialSelector:e=>J(e)}),(e,a)=>(h(),c(i(O),{ref_key:`dropdownRef`,ref:w,items:G.value,teleported:``,placement:`bottom-start`,"extra-popper-class":[e.$style.component,B.value?e.$style.searching:``].join(` `),searchable:``,emptyText:B.value?i(C).baseText(`chatHub.models.selector.noMatch`):void 0,onSearch:Q,onSelect:Z},{trigger:m(()=>[o(i(S),{variant:`ghost`,class:y(e.$style.dropdownButton),text:s.text,"data-test-id":`chat-model-selector`},{default:m(()=>[o(ce,{agent:s.selectedAgent,size:V.value||!H.value?`md`:`sm`,class:y(e.$style.icon)},null,8,[`agent`,`size`,`class`]),b(`div`,{class:y(e.$style.selected)},[b(`div`,null,t(i(R)(K.value,i(30))),1),V.value?(h(),c(i(D),{key:0,size:`xsmall`,color:`text-light`},{default:m(()=>[v(t(i(R)(V.value,i(30))),1)]),_:1})):W.value?(h(),c(i(D),{key:1,size:`xsmall`,color:`danger`},{default:m(()=>[o(i(E),{icon:`node-validation-error`,size:`xsmall`,class:y(e.$style.credentialsMissingIcon)},null,8,[`class`]),v(` `+t(i(C).baseText(`chatHub.agent.credentialsMissing`)),1)]),_:1})):r(``,!0)],2),o(i(E),{icon:`chevron-down`,size:`medium`})]),_:1},8,[`class`,`text`])]),"item-leading":m(({item:t})=>[t.data?.provider?(h(),c(le,{key:0,provider:t.data?.provider,icon:t.icon,class:y(e.$style.menuIcon)},null,8,[`provider`,`icon`,`class`])):r(``,!0)]),"item-label":m(({item:a,ui:s})=>[a.data?.parts?(h(),n(`div`,{key:0,class:y([e.$style.flattenedLabel,s.class])},[(h(!0),n(d,null,_(a.data.parts,(s,l)=>(h(),n(d,{key:l},[l>0?(h(),c(i(D),{key:0,color:`text-light`,class:y(e.$style.separator)},{default:m(()=>[o(i(E),{icon:`chevron-right`,size:`small`})]),_:1},8,[`class`])):r(``,!0),o(i(D),{size:`medium`,color:l===a.data.parts.length-1?`text-dark`:`text-base`},{default:m(()=>[v(t(s),1)]),_:2},1032,[`color`])],64))),128))],2)):(h(),c(i(D),{key:1,class:y(s.class),size:`medium`,color:`text-dark`},{default:m(()=>[v(t(a.label),1)]),_:2},1032,[`class`]))]),"item-trailing":m(({item:t,ui:n})=>[t.data?.description?(h(),c(i(T),{key:0,content:i(R)(t.data.description,200,0),class:y(n.class),"popper-class":e.$style.tooltip},{default:m(()=>[o(i(E),{icon:`info`,size:`medium`,color:`text-light`,class:y(e.$style.infoIcon)},null,8,[`class`])]),_:1},8,[`content`,`class`,`popper-class`])):r(``,!0)]),_:1},8,[`items`,`extra-popper-class`,`emptyText`]))}}),[[`__cssModules`,{$style:{component:`_component_1abe6_125`,dropdownButton:`_dropdownButton_1abe6_130`,credentialsMissingIcon:`_credentialsMissingIcon_1abe6_139`,selected:`_selected_1abe6_144`,icon:`_icon_1abe6_151`,infoIcon:`_infoIcon_1abe6_156`,menuIcon:`_menuIcon_1abe6_157`,avatarIcon:`_avatarIcon_1abe6_165`,tooltip:`_tooltip_1abe6_169`,flattenedLabel:`_flattenedLabel_1abe6_174`,separator:`_separator_1abe6_183`}}]]),xe=k(s({__name:`ToolsSelector`,props:{disabled:{type:Boolean},checkedToolIds:{},customAgentId:{},disabledTooltip:{}},emits:[`toggle`],setup(s,{emit:l}){let f=s,b=l,C=te(),D=ne(),k=Z(),A=x(),j=ee(`dropdownMenu`),M=a(``),N=e(()=>new Set(f.checkedToolIds)),P=e(()=>f.checkedToolIds.length),F=e(()=>{let e=P.value>3?2:3;return k.configuredTools.filter(e=>N.value.has(e.definition.id)).slice(0,e).map(e=>C.getNodeType(e.definition.type,e.definition.typeVersion)).filter(Boolean)}),I=e(()=>P.value>3?P.value-2:0),R=e(()=>{if(P.value===1){let e=f.checkedToolIds[0],t=k.configuredTools.find(t=>t.definition.id===e);if(t)return t.definition.name}return P.value>1?A.baseText(`chatHub.tools.selector.label.count`,{adjustToNumber:P.value}):A.baseText(`chatHub.tools.selector.label.default`)});function B(){j.value?.close(),D.openModalWithData({name:z,data:{tools:k.configuredTools.filter(e=>N.value.has(e.definition.id)).map(e=>e.definition),onConfirm:()=>{},customAgentId:f.customAgentId}})}function V(e){j.value?.close();let t=e.data?.tool;if(!t)return;let n=k.configuredTools.filter(e=>e.definition.id!==t.id).map(e=>e.definition.name);D.openModalWithData({name:G,data:{node:{...t},existingToolNames:n,onConfirm:async e=>{await k.updateConfiguredTool(t.id,e)}}})}let H=e(()=>{let e=M.value.toLowerCase();return k.configuredTools.filter(t=>{if(!e)return!0;let n=t.definition,r=C.getNodeType(n.type,n.typeVersion),i=n.name.toLowerCase().includes(e),a=r?.displayName.toLowerCase().includes(e);return i||a}).map(e=>({id:`tool::${e.definition.id}`,label:e.definition.name,checked:N.value.has(e.definition.id),data:{nodeType:C.getNodeType(e.definition.type,e.definition.typeVersion),tool:e.definition}}))});function U(e){let[t,n]=e.split(`::`);t===`tool`&&b(`toggle`,n)}function W(e){M.value=e}return u(async()=>{await C.loadNodeTypesIfNotLoaded()}),(e,a)=>(h(),n(`div`,{class:y(e.$style.container)},[i(k).configuredTools.length===0?(h(),c(i(T),{key:0,content:s.disabledTooltip,disabled:!s.disabledTooltip||!s.disabled,placement:`bottom`},{default:m(()=>[o(i(S),{variant:`subtle`,"native-type":`button`,class:y(e.$style.toolsButton),disabled:s.disabled,icon:`plus`,"data-test-id":`chat-tools-button`,onClick:B},{default:m(()=>[v(t(R.value),1)]),_:1},8,[`class`,`disabled`])]),_:1},8,[`content`,`disabled`])):(h(),c(i(T),{key:1,content:s.disabledTooltip,disabled:!s.disabledTooltip||!s.disabled,placement:`bottom`},{default:m(()=>[o(i(O),{ref:`dropdownMenu`,items:H.value,placement:`top-start`,"extra-popper-class":`tools-selector-dropdown`,searchable:``,"search-placeholder":i(A).baseText(`chatHub.toolsManager.searchPlaceholder`),"empty-text":i(A).baseText(`chatHub.toolsManager.noResults`),onSelect:U,onSearch:W},{trigger:m(()=>[o(i(S),{variant:`subtle`,"native-type":`button`,disabled:s.disabled,icon:P.value===0?`plus`:void 0,"data-test-id":`chat-tools-button`},{default:m(()=>[P.value>0?(h(),n(`span`,{key:0,class:y(e.$style.iconStack)},[(h(!0),n(d,null,_(F.value,(t,n)=>(h(),c(L,{key:`${t?.name}-${n}`,style:p({zIndex:n+1}),"node-type":t,class:y([e.$style.icon,{[e.$style.iconOverlap]:n!==0}]),circle:!0,size:12},null,8,[`style`,`node-type`,`class`]))),128)),I.value>0?(h(),n(`span`,{key:0,class:y([e.$style.icon,e.$style.iconOverlap,e.$style.countBadge])},` +`+t(I.value),3)):r(``,!0)],2)):r(``,!0),v(` `+t(R.value),1)]),_:1},8,[`disabled`,`icon`])]),"search-prefix":m(()=>[o(i(E),{icon:`search`})]),"search-suffix":m(()=>[o(i(w),{icon:`settings`,variant:`ghost`,size:`medium`,text:``,class:y(e.$style.settingsButton),onClick:g(B,[`stop`])},null,8,[`class`])]),"item-leading":m(({item:e})=>[e.data?.nodeType?(h(),c(L,{key:0,"node-type":e.data.nodeType,size:16},null,8,[`node-type`])):r(``,!0)]),"item-trailing":m(({item:t})=>[o(i(w),{icon:`settings`,variant:`ghost`,size:`medium`,text:``,class:y(e.$style.itemSettingsButton),onClick:g(e=>V(t),[`stop`])},null,8,[`class`,`onClick`]),t.checked?r(``,!0):(h(),n(`span`,{key:0,class:y(e.$style.checkPlaceholder)},null,2))]),_:1},8,[`items`,`search-placeholder`,`empty-text`])]),_:1},8,[`content`,`disabled`]))],2))}}),[[`__cssModules`,{$style:{container:`_container_i8oeh_125`,toolsButton:`_toolsButton_i8oeh_130`,transparentBg:`_transparentBg_i8oeh_135`,iconStack:`_iconStack_i8oeh_139`,icon:`_icon_i8oeh_139`,iconOverlap:`_iconOverlap_i8oeh_154`,countBadge:`_countBadge_i8oeh_158`,settingsButton:`_settingsButton_i8oeh_171`,itemSettingsButton:`_itemSettingsButton_i8oeh_179`,checkPlaceholder:`_checkPlaceholder_i8oeh_183`}}]]);function Se(t){let n=Z(),r=a(!1),i=e(()=>l(t)),o=e(()=>{if(i.value)return n.customAgents[i.value]});return f(i,async e=>{if(e)try{r.value=!0,await n.fetchCustomAgent(e)}finally{r.value=!1}},{immediate:!0}),{isLoading:r,customAgent:o}}export{xe as n,be as r,Se as t};
//# sourceMappingURL=useCustomAgent-DrfdRIKA.js.map