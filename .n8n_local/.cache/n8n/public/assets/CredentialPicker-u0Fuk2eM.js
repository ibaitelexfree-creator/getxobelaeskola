(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`56d69038-0b45-4930-962b-6ea03eba301b`,e._sentryDebugIdIdentifier=`sentry-dbid-56d69038-0b45-4930-962b-6ea03eba301b`)})()}catch{}import{C as e,Cn as t,D as n,E as r,G as i,Gt as a,It as o,M as s,P as c,T as l,_ as u,_t as d,bt as f,et as p,it as m,j as h,vn as g,w as _}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as v}from"./_MapCache-DjbOQyB7.js";import{Hi as y,Mi as b,Oi as x,Ui as S,Vi as C,ft as w,pt as T}from"./src-CppJvwzX.js";import{t as E}from"./_plugin-vue_export-helper-B_J4Khre.js";import{Gt as D,Tr as O,Ua as k,n as A,nt as j,r as M,rt as N,yr as P}from"./users.store-pCkD7Zo0.js";import{Ss as F,qo as I}from"./constants-D1jZwsUK.js";import{v as L}from"./_baseOrderBy-El3qbNHQ.js";var R=[`disabled`],z=E(c({__name:`CredentialsDropdown`,props:{credentialOptions:{},selectedCredentialId:{},permissions:{}},emits:[`credentialSelected`,`newCredential`],setup(r,{emit:c}){let d=r,y=c,b=v(),E=o(null),D=o(``);function O(e,t){return t.toLocaleLowerCase().includes(e.toLocaleLowerCase())}let k=e(()=>D.value?d.credentialOptions.filter(e=>O(D.value,e.name)||e.homeProject?.name&&O(D.value,e.homeProject.name)):d.credentialOptions),A=(e=``)=>{D.value=e},j=e=>{y(`credentialSelected`,e)},M=async()=>{E.value?.blur(),await i(),y(`newCredential`)};return(e,r)=>(p(),l(a(w),{ref_key:`selectRefs`,ref:E,size:`small`,filterable:``,"filter-method":A,"model-value":d.selectedCredentialId,"popper-class":e.$style.selectPopper,"onUpdate:modelValue":j},{empty:f(()=>[...r[1]||=[]]),footer:f(()=>[s(a(x),{disabled:d.permissions.create,content:a(b).baseText(`nodeCredentials.createNew.permissionDenied`),placement:`top`},{default:f(()=>[_(`button`,{type:`button`,"data-test-id":`node-credentials-select-item-new`,class:g([e.$style.newCredential]),disabled:!d.permissions.create,onClick:r[0]||=e=>M()},[s(a(S),{size:`xsmall`,icon:`plus`}),h(` `+t(a(b).baseText(`nodeCredentials.createNew`)),1)],10,R)]),_:1},8,[`disabled`,`content`])]),default:f(()=>[(p(!0),n(u,null,m(k.value,n=>(p(),l(a(T),{key:n.id,"data-test-id":`node-credentials-select-item-${n.id}`,label:n.name,value:n.id},{default:f(()=>[_(`div`,{class:g([e.$style.credentialOption,`mt-2xs mb-2xs`])},[s(a(C),{bold:``},{default:f(()=>[h(t(n.name),1)]),_:2},1024),n.homeProject?(p(),l(a(C),{key:0,size:`small`},{default:f(()=>[h(t(`${n.typeDisplayName} - ${n.homeProject?.name}`),1)]),_:2},1024)):(p(),l(a(C),{key:1,size:`small`},{default:f(()=>[h(t(n.typeDisplayName),1)]),_:2},1024))],2)]),_:2},1032,[`data-test-id`,`label`,`value`]))),128))]),_:1},8,[`model-value`,`popper-class`]))}}),[[`__cssModules`,{$style:{selectPopper:`_selectPopper_178ar_125`,newCredential:`_newCredential_178ar_128`,credentialOption:`_credentialOption_178ar_137`}}]]),B=E(c({__name:`CredentialPicker`,props:{appName:{},credentialType:{},selectedCredentialId:{},personalOnly:{type:Boolean},showDelete:{type:Boolean},hideCreateNew:{type:Boolean},createButtonVariant:{}},emits:[`credentialSelected`,`credentialDeselected`,`credentialModalOpened`,`credentialDeleted`],setup(t,{emit:i}){let c=t,u=i,m=M(),h=N(),_=D(),S=v(),C=P(),w=O(),T=o(!1),E=o(null),k=e(()=>{let e=h.getCredentialsByType(c.credentialType);return c.personalOnly?e.filter(e=>e.homeProject?.type===`personal`||e.isGlobal):e}),F=e(()=>k.value.map(e=>({id:e.id,name:e.name,typeDisplayName:h.getCredentialTypeByName(e.type)?.displayName,homeProject:e.homeProject})));async function R(){if(c.selectedCredentialId)try{let e=await h.getCredentialData({id:c.selectedCredentialId});if(!e)throw Error(S.baseText(`credentialEdit.credentialEdit.couldNotFindCredentialWithId`)+`:`+c.selectedCredentialId);E.value=e}catch(e){C.showError(e,S.baseText(`credentialEdit.credentialEdit.showError.loadCredential.title`));return}}let B=e(()=>{let{currentProject:e,personalProject:t}=_;return e??t}),V=e(()=>I(E.value?.scopes??B.value?.scopes).credential),H=e=>{u(`credentialSelected`,e)},U=()=>{m.openNewCredential(c.credentialType,!0),T.value=!0,u(`credentialModalOpened`,void 0)},W=()=>{L(c.selectedCredentialId),m.openExistingCredential(c.selectedCredentialId),T.value=!0,u(`credentialModalOpened`,c.selectedCredentialId)},G=async()=>{L(c.selectedCredentialId);let e=c.selectedCredentialId;if(await w.confirm(S.baseText(`credentialEdit.credentialEdit.confirmMessage.deleteCredential.message`,{interpolate:{savedCredentialName:E.value?.name??c.selectedCredentialId}}),S.baseText(`credentialEdit.credentialEdit.confirmMessage.deleteCredential.headline`),{confirmButtonText:S.baseText(`credentialEdit.credentialEdit.confirmMessage.deleteCredential.confirmButtonText`)})===`confirm`)try{await h.deleteCredential({id:e}),E.value=null,u(`credentialDeleted`,e)}catch(e){C.showError(e,S.baseText(`credentialEdit.credentialEdit.showError.deleteCredential.title`))}};return j({store:h,onCredentialCreated:e=>{T.value&&u(`credentialSelected`,e.id)},onCredentialDeleted:e=>{if(!T.value||e!==c.selectedCredentialId)return;let t=F.value.map(e=>e.id).filter(t=>t!==e);t.length>0?u(`credentialSelected`,t[0]):u(`credentialDeselected`)}}),A({store:m,onModalClosed(e){e===`editCredential`&&T.value&&(T.value=!1)}}),d(()=>c.selectedCredentialId,()=>{R()},{immediate:!0}),(e,t)=>(p(),n(`div`,null,[F.value.length>0||c.hideCreateNew?(p(),n(`div`,{key:0,class:g(e.$style.dropdown)},[s(z,{"credential-type":c.credentialType,"credential-options":F.value,"selected-credential-id":c.selectedCredentialId,"data-test-id":`credential-dropdown`,permissions:V.value,onCredentialSelected:H,onNewCredential:U},null,8,[`credential-type`,`credential-options`,`selected-credential-id`,`permissions`]),c.selectedCredentialId?(p(),l(a(x),{key:0,disabled:V.value.update,content:a(S).baseText(`nodeCredentials.updateCredential.permissionDenied`),placement:`top`},{default:f(()=>[s(a(b),{variant:`subtle`,icon:`pen`,class:g({[e.$style.edit]:!0}),title:a(S).baseText(`nodeCredentials.updateCredential`),"data-test-id":`credential-edit-button`,disabled:!V.value.update,onClick:t[0]||=e=>W()},null,8,[`class`,`title`,`disabled`])]),_:1},8,[`disabled`,`content`])):r(``,!0),c.showDelete&&c.selectedCredentialId?(p(),l(a(x),{key:1,disabled:V.value.update,content:a(S).baseText(`nodeCredentials.deleteCredential.permissionDenied`),placement:`top`},{default:f(()=>[c.showDelete&&c.selectedCredentialId?(p(),l(a(b),{key:0,"native-type":`button`,title:a(S).baseText(`nodeCredentials.deleteCredential`),icon:`trash-2`,"icon-size":`large`,variant:`outline`,disabled:!V.value.delete,onClick:t[1]||=e=>G()},null,8,[`title`,`disabled`])):r(``,!0)]),_:1},8,[`disabled`,`content`])):r(``,!0)],2)):c.hideCreateNew?r(``,!0):(p(),l(a(y),{key:1,label:`Create new ${c.appName} credential`,class:g(e.$style.createButton),"data-test-id":`create-credential`,variant:c.createButtonVariant||`solid`,disabled:!V.value.create,onClick:U},null,8,[`label`,`class`,`variant`,`disabled`]))]))}}),[[`__cssModules`,{$style:{dropdown:`_dropdown_1yxv4_125`,edit:`_edit_1yxv4_130`,createButton:`_createButton_1yxv4_138`}}]]);export{B as t};
//# sourceMappingURL=CredentialPicker-u0Fuk2eM.js.map