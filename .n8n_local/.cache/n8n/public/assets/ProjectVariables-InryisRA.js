(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`2d6bb69d-46ee-40e1-9bf8-fb202d959c14`,e._sentryDebugIdIdentifier=`sentry-dbid-2d6bb69d-46ee-40e1-9bf8-fb202d959c14`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{C as t,Cn as n,D as r,E as i,Gt as a,It as o,M as s,P as c,T as l,W as u,Z as ee,_ as d,bt as f,et as p,it as te,j as m,k as ne,mt as re,st as ie,vn as h,w as g,xt as ae,yn as oe}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{x as se,yt as _}from"./_MapCache-DjbOQyB7.js";import{At as v,Ci as ce,Hi as y,Oi as b,Pi as x,Ui as S,Vi as C,ft as le,gi as ue,ot as w,pt as de,st as T,wi as E}from"./src-CppJvwzX.js";import{t as D}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{Ft as fe,Ga as O,Gt as pe,Lt as me,Tr as he,fn as ge,oi as _e,r as ve,t as ye,wr as be,ws as k,yr as A}from"./users.store-pCkD7Zo0.js";import{Ss as j,Yc as M,qo as N}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import"./versions.store-1_eor2Ku.js";import{t as xe}from"./usePageRedirectionHelper-BoF8hzbN.js";import{t as P}from"./useClipboard-Duc7LjuO.js";import"./folders.store-CS_gIPIm.js";import"./ProjectIcon-D-HRIqn6.js";import"./EnterpriseEdition.ee-BF3fOBuQ.js";import"./orderBy-KAUxkCYD.js";import"./ProjectSharing-DgwjJKfK.js";import{t as Se}from"./insights.store-CIIvho7C.js";import"./insights.constants-DHL43iRt.js";import"./insights.utils-B2NpOI0Q.js";import{r as Ce}from"./readyToRun.store-DM7AW4os.js";import{t as we}from"./ResourcesListLayout-Dgyw19qu.js";import"./ResourceFiltersDropdown-tUuDPU--.js";import{t as Te}from"./ProjectHeader-KFxxuu0P.js";import{t as Ee}from"./InsightsSummary-8qyRMqyz.js";import{t as F}from"./pickBy-D_42q52J.js";var De=e(F(),1),Oe=D(c({__name:`VariablesUsageBadge`,props:{name:{}},setup(e){let r=_(),i=P(),{showMessage:o}=A(),s=e,c=t(()=>`$vars.${s.name}`),u=()=>{i.copy(c.value),o({title:r.baseText(`variables.row.usage.copiedToClipboard`),type:`success`})};return(e,t)=>(p(),l(a(b),{placement:`top`},{content:f(()=>[m(n(a(r).baseText(`variables.row.usage.copyToClipboard`)),1)]),default:f(()=>[g(`span`,{class:`usageSyntax`,onClick:u},n(c.value),1)]),_:1}))}}),[[`__scopeId`,`data-v-b4930937`]]),ke={class:`mb-s`},Ae={key:0,class:`mb-s`},je={"data-test-id":`variables-row`},Me={key:0},Ne={key:0},Pe={class:`scope-badge`,style:{display:`flex`,"align-items":`center`,gap:`4px`}},Fe={key:1,align:`right`},Ie={class:`action-buttons`},I={key:0,class:`mt-xs`},L=D(c({__name:`ProjectVariables`,setup(e){let c=k(),D=fe(),j=ye(),P=ve(),F=me(),L=_(),Le=he(),Re=be(),R=ce(),ze=E(),z=Se(),Be=Ce(),B=pe(),Ve=re(`layoutRef`),{showError:He,showMessage:Ue}=A(),V=R.params.projectId,H=t(()=>N(j.currentUser?.globalScopes).variable),U=t(()=>N(B.currentProject?.scopes).projectVariable),{isLoading:We,execute:Ge}=se(D.fetchAllVariables,[],{immediate:!0}),W=t(()=>c.isEnterpriseFeatureEnabled[M.Variables]),Ke=()=>{P.openModalWithData({name:O,data:{mode:`new`}}),F.track(`User clicked add variable button`)},qe=e=>{P.openModalWithData({name:O,data:{mode:`edit`,variable:e}})},Je=t(()=>D.variables.filter(e=>!V||e.project?.id===V).map(e=>({resourceType:`variable`,id:e.id,name:e.key,key:e.key,value:e.value,project:e.project}))),G=t(()=>D.variables.filter(e=>!e.project)),K=t(()=>W.value&&(H.value.create??U.value.create)),Ye=t(()=>{let e=[{id:0,path:`name`,label:L.baseText(`variables.table.key`),classes:[`variables-key-column`]},{id:1,path:`value`,label:L.baseText(`variables.table.value`),classes:[`variables-value-column`]},{id:2,path:`usage`,label:L.baseText(`variables.table.usage`),classes:[`variables-usage-column`]}];return V||e.push({id:3,path:`project`,label:L.baseText(`variables.table.scope`),classes:[`variables-scope-column`]}),W.value?e.concat({id:4,path:`actions`,label:``,classes:[`variables-actions-column`]}):e}),Xe=async e=>{try{if(await Le.confirm(L.baseText(`variables.modals.deleteConfirm.message`,{interpolate:{name:e.key}}),L.baseText(`variables.modals.deleteConfirm.title`),{confirmButtonText:L.baseText(`variables.modals.deleteConfirm.confirmButton`),cancelButtonText:L.baseText(`variables.modals.deleteConfirm.cancelButton`)})!==`confirm`)return;await D.deleteVariable({id:e.id,value:e.value,key:e.key}),Ue({title:L.baseText(`variables.delete.successful.message`,{interpolate:{variableName:e.key}}),type:`success`})}catch(e){He(e,L.baseText(`variables.errors.delete`))}},q=e=>{ze.replace({query:(0,De.default)(e)})},J=o({...R.query,incomplete:R.query.incomplete?.toString()===`true`,projectId:R.query.projectId?.toString()||``}),Ze=e=>{q({...J.value,search:e})},Qe=(e,t,n)=>{if(!_e(e))return!1;let r=t;return r.incomplete&&(n&&=!e.value),r.projectId&&(r.projectId===`global`?n&&=!e.project:n&&=e.project?.id===r.projectId),n},Y=(e,t,n)=>n===`asc`?Q(e).trim().localeCompare(Q(t).trim()):Q(t).trim().localeCompare(Q(e).trim()),$e={nameAsc:(e,t)=>Y(e,t,`asc`),nameDesc:(e,t)=>Y(e,t,`desc`)},X=t(()=>{let e=[{value:`global`,label:L.baseText(`variables.modal.scope.global`),icon:{type:`icon`,value:`database`}}];return e.push(...B.availableProjects.filter(e=>e.type!==`personal`).map(e=>{let t=e.icon??{type:`icon`,value:`layer-group`};return{value:e.id,label:e.name??e.id,icon:t}})),e}),Z=t(()=>X.value.find(e=>e.value===J.value.projectId)?.icon??{type:`icon`,value:`database`});function et(){xe().goToUpgrade(`variables`,`upgrade-variables`)}function Q(e){return e.key}Re.$onAction(({name:e,after:t})=>{e===`pullWorkfolder`&&t&&t(()=>{Ge()})});let $=t(()=>({heading:L.baseText(P.contextBasedTranslationKeys.variables.unavailable.title),description:L.baseText(P.contextBasedTranslationKeys.variables.unavailable.description),buttonText:L.baseText(P.contextBasedTranslationKeys.variables.unavailable.button),buttonType:`secondary`,"onClick:button":et,"data-test-id":`unavailable-resources-list`}));return ee(()=>{ge().set(L.baseText(`variables.heading`))}),(e,t)=>{let o=ie(`n8n-truncate`);return p(),l(we,{ref_key:`layoutRef`,ref:Ve,filters:J.value,"onUpdate:filters":[t[1]||=e=>J.value=e,q],"resource-key":`variables`,disabled:!W.value,resources:Je.value,"additional-filters-handler":Qe,shareable:!1,"display-name":Q,"sort-fns":$e,"sort-options":[`nameAsc`,`nameDesc`],type:`datatable`,"type-props":{columns:Ye.value},loading:a(We),"onUpdate:search":Ze,"onClick:add":Ke},ne({header:f(()=>[s(Te,{"main-button":`variable`},{default:f(()=>[a(Be).isOverviewSubPage&&a(z).isSummaryEnabled?(p(),l(Ee,{key:0,loading:a(z).weeklySummary.isLoading,summary:a(z).weeklySummary.state,"time-range":`week`},null,8,[`loading`,`summary`])):i(``,!0)]),_:1})]),filters:f(({setKeyValue:o})=>[g(`div`,ke,[s(a(w),{label:a(L).baseText(`credentials.filters.status`),bold:!1,size:`small`,color:`text-base`,class:`mb-3xs`},null,8,[`label`]),s(a(T),{label:`Value missing`,"data-test-id":`variable-filter-incomplete`,"model-value":J.value.incomplete,"onUpdate:modelValue":e=>o(`incomplete`,e)},null,8,[`model-value`,`onUpdate:modelValue`])]),a(V)?i(``,!0):(p(),r(`div`,Ae,[s(a(w),{label:a(L).baseText(`forms.resourceFiltersDropdown.owner`),bold:!1,size:`small`,color:`text-base`,class:`mb-3xs`},null,8,[`label`]),s(a(le),{modelValue:J.value.projectId,"onUpdate:modelValue":[t[0]||=e=>J.value.projectId=e,e=>o(`projectId`,e)],size:`large`,filterable:``,"data-test-id":`variable-modal-scope-select`},{prefix:f(()=>[Z.value?.type===`emoji`?(p(),l(a(C),{key:0,class:h(e.$style.menuItemEmoji)},{default:f(()=>[m(n(Z.value?.value),1)]),_:1},8,[`class`])):Z.value?.value?(p(),l(a(S),{key:1,icon:Z.value.value},null,8,[`icon`])):i(``,!0)]),default:f(()=>[(p(!0),r(d,null,te(X.value,t=>(p(),l(a(de),{key:t.value||`global`,value:t.value,label:t.label,class:h({[e.$style.globalOption]:t.value===`global`})},{default:f(()=>[g(`div`,{class:h(e.$style.optionContent)},[t.icon&&t.icon?.type===`emoji`?(p(),l(a(C),{key:0,class:h(e.$style.menuItemEmoji)},{default:f(()=>[m(n(t.icon.value),1)]),_:2},1032,[`class`])):t.icon?.value?(p(),l(a(S),{key:1,icon:t.icon.value},null,8,[`icon`])):i(``,!0),g(`span`,null,n(t.label),1)],2)]),_:2},1032,[`value`,`label`,`class`]))),128))]),_:1},8,[`modelValue`,`onUpdate:modelValue`])]))]),default:f(({data:e})=>[g(`tr`,je,[g(`td`,null,n(e.key),1),g(`td`,null,[e.value?ae((p(),r(`span`,Me,null,512)),[[o,e.value,`20`]]):(p(),l(a(v),{key:1,theme:`warning`},{default:f(()=>[...t[2]||=[m(` Value missing `,-1)]]),_:1}))]),g(`td`,null,[e.key?(p(),l(Oe,{key:0,name:e.key},null,8,[`name`])):i(``,!0)]),a(V)?i(``,!0):(p(),r(`td`,Ne,[s(a(v),null,{default:f(()=>[g(`div`,Pe,[e.project?(p(),l(a(S),{key:0,icon:`layers`})):i(``,!0),m(` `+n(e.project?.name??a(L).baseText(`variables.table.scope.global`)),1)])]),_:2},1024)])),W.value?(p(),r(`td`,Fe,[g(`div`,Ie,[s(a(b),{disabled:H.value.update??U.value.update,placement:`top`},{content:f(()=>[m(n(a(L).baseText(`variables.row.button.edit.onlyRoleCanEdit`)),1)]),default:f(()=>[s(a(y),{variant:`subtle`,size:`small`,"data-test-id":`variable-row-edit-button`,class:`mr-xs`,disabled:!(H.value.update??U.value.update),onClick:t=>qe(e)},{default:f(()=>[m(n(a(L).baseText(`variables.row.button.edit`)),1)]),_:1},8,[`disabled`,`onClick`])]),_:2},1032,[`disabled`]),s(a(b),{disabled:H.value.delete??U.value.delete,placement:`top`},{content:f(()=>[m(n(a(L).baseText(`variables.row.button.delete.onlyRoleCanDelete`)),1)]),default:f(()=>[s(a(y),{variant:`subtle`,size:`small`,"data-test-id":`variable-row-delete-button`,disabled:!(H.value.delete??U.value.delete),onClick:t=>Xe(e)},{default:f(()=>[m(n(a(L).baseText(`variables.row.button.delete`)),1)]),_:1},8,[`disabled`,`onClick`])]),_:2},1032,[`disabled`])])])):i(``,!0)])]),postdata:f(()=>[a(V)&&G.value.length?(p(),r(`div`,I,[a(V)?(p(),l(a(C),{key:0,size:`small`},{default:f(()=>[s(a(ue),{href:`/home/variables`,theme:`text`,size:`small`},{default:f(()=>[m(n(G.value.length)+` global variables `,1)]),_:1}),t[3]||=m(` available in this project `,-1)]),_:1})):i(``,!0)])):i(``,!0)]),_:2},[W.value?void 0:{name:`preamble`,fn:f(()=>[s(a(x),u({class:`mb-m`},$.value),null,16)]),key:`0`},!W.value||W.value&&!K.value?{name:`empty`,fn:f(()=>[W.value?K.value?i(``,!0):(p(),l(a(x),{key:1,"data-test-id":`cannot-create-variables`,heading:a(L).baseText(`variables.empty.notAllowedToCreate.heading`,{interpolate:{name:a(j).currentUser?.firstName??``}}),description:a(L).baseText(`variables.empty.notAllowedToCreate.description`)},null,8,[`heading`,`description`])):(p(),l(a(x),oe(u({key:0},$.value)),null,16))]),key:`1`}:void 0]),1032,[`filters`,`disabled`,`resources`,`type-props`,`loading`])}}}),[[`__cssModules`,{$style:{optionContent:`_optionContent_16ed1_125`,menuItemEmoji:`_menuItemEmoji_16ed1_131`,globalOption:`_globalOption_16ed1_136`}}],[`__scopeId`,`data-v-b28a8f81`]]);export{L as default};
//# sourceMappingURL=ProjectVariables-InryisRA.js.map