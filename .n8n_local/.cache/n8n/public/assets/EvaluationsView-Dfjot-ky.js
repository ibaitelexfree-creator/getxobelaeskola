(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`9ba2c16c-ca91-4abc-af51-a190c9e2a215`,e._sentryDebugIdIdentifier=`sentry-dbid-9ba2c16c-ca91-4abc-af51-a190c9e2a215`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{C as t,Cn as n,D as r,Gt as i,It as a,M as o,P as s,T as c,U as l,_ as u,_t as d,bt as f,et as p,ft as m,it as h,j as g,k as _,vn as v,vt as y,w as b}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{C as x,bt as S,yt as C}from"./_MapCache-DjbOQyB7.js";import{Hi as w,Oi as T,Ui as E,Vi as D,ft as O,pt as k,wi as A,zi as j}from"./src-CppJvwzX.js";import{t as M}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import"./table-BUhHdyzF.js";import{T as N,yr as P}from"./users.store-pCkD7Zo0.js";import{rs as F}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import"./_baseOrderBy-El3qbNHQ.js";import{t as I}from"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import{t as L}from"./dateFormatter-C82w-7IH.js";import{t as R}from"./orderBy-KAUxkCYD.js";import{t as z}from"./AnimatedSpinner-BEM3aFx0.js";import{r as B}from"./dist-hhZkOity.js";import{n as V,r as H,t as U}from"./evaluation.constants-CwiQgQMV.js";var W=e(I(),1);function G(){let e={primary:x(`--color--primary`,document.body).value,textBase:x(`--color--text`,document.body).value,backgroundXLight:x(`--color--background--light-3`,document.body).value,foregroundLight:x(`--color--foreground--tint-1`,document.body).value,foregroundBase:x(`--color--foreground`,document.body).value,foregroundDark:x(`--color--foreground--shade-1`,document.body).value};function t(t,n){return{datasets:[{data:t,parsing:{xAxisKey:`id`,yAxisKey:`metrics.${n}`},borderColor:e.primary,backgroundColor:e.backgroundXLight,borderWidth:1,pointRadius:2,pointHoverRadius:4,pointBackgroundColor:e.backgroundXLight,pointHoverBackgroundColor:e.backgroundXLight}]}}function n({metric:t,data:n}){return{responsive:!0,maintainAspectRatio:!1,animation:!1,devicePixelRatio:2,interaction:{mode:`index`,intersect:!1},scales:{y:{border:{display:!1},grid:{color:e.foregroundBase},ticks:{padding:8,color:e.textBase}},x:{border:{display:!1},grid:{display:!1},ticks:{color:e.textBase,callback(e,t){return`#${n[t].index}`}}}},plugins:{tooltip:{backgroundColor:e.backgroundXLight,titleColor:e.textBase,titleFont:{weight:`600`},bodyColor:e.textBase,bodySpacing:4,padding:12,borderColor:e.foregroundBase,borderWidth:1,displayColors:!0,callbacks:{title:e=>(0,W.default)(e[0].raw.runAt,`yyyy-mm-dd HH:MM`),label:e=>`${t}: ${e.parsed.y.toFixed(2)}`,labelColor(){return{borderColor:`rgba(29, 21, 21, 0)`,backgroundColor:e.primary,borderWidth:0,borderRadius:5}}}},legend:{display:!1}}}}return{generateChartData:t,generateChartOptions:n}}var K=M(s({__name:`MetricsChart`,props:{selectedMetric:{},runs:{}},emits:[`update:selectedMetric`],setup(e,{emit:n}){let a=n,s=e,l=G(),d=t(()=>s.runs.reduce((e,t)=>{let n=Object.keys(t.metrics??{});return[...new Set([...e,...n])]},[])),m=t(()=>s.runs.filter(e=>e.metrics?.[s.selectedMetric]!==void 0)),g=t(()=>l.generateChartData(m.value,s.selectedMetric)),_=t(()=>l.generateChartOptions({metric:s.selectedMetric,data:m.value}));return y(()=>{s.runs.length>0&&!s.selectedMetric&&a(`update:selectedMetric`,d.value[0])}),(t,n)=>(p(),r(`div`,{class:v(t.$style.metricsChartContainer)},[b(`div`,{class:v(t.$style.chartHeader)},[o(i(O),{"model-value":e.selectedMetric,class:v(t.$style.metricSelect),placeholder:`Select metric`,size:`small`,"onUpdate:modelValue":n[0]||=e=>a(`update:selectedMetric`,e)},{default:f(()=>[(p(!0),r(u,null,h(d.value,e=>(p(),c(i(k),{key:e,label:e,value:e},null,8,[`label`,`value`]))),128))]),_:1},8,[`model-value`,`class`])],2),b(`div`,{class:v(t.$style.chartWrapper)},[(p(),c(i(B),{key:e.selectedMetric,data:g.value,options:_.value,class:v(t.$style.metricsChart)},null,8,[`data`,`options`,`class`]))],2)],2))}}),[[`__cssModules`,{$style:{metricsChartContainer:`_metricsChartContainer_1i2e2_125`,chartHeader:`_chartHeader_1i2e2_130`,chartTitle:`_chartTitle_1i2e2_133`,metricSelect:`_metricSelect_1i2e2_138`,chartWrapper:`_chartWrapper_1i2e2_141`}}]]),q={style:{display:`inline-flex`,gap:`12px`,"text-transform":`capitalize`,"align-items":`center`}},J=M(s({__name:`TestRunsTable`,props:{runs:{},columns:{}},emits:[`rowClick`],setup(e,{emit:a}){let s=a,l=e,d=C(),m=t(()=>l.columns.map(e=>e.prop===`id`?{...e,width:100}:e.prop===`runAt`?{...e,width:150}:e)),h=t(()=>l.runs.map(({status:e,finalResult:t,errorDetails:n,...r})=>(e===`completed`&&t&&[`error`,`warning`].includes(t)&&(e=`warning`),{...r,status:e,finalResult:t,errorDetails:n})));return(t,a)=>(p(),r(`div`,{class:v(t.$style.container)},[o(i(j),{size:`large`,bold:!0,class:v(t.$style.runsTableHeading),color:`text-base`},{default:f(()=>[g(n(i(d).baseText(`evaluation.listRuns.pastRuns.total`,{adjustToNumber:e.runs.length}))+` (`+n(e.runs.length)+`) `,1)]),_:1},8,[`class`]),o(H,{data:h.value,columns:m.value,"default-sort":{prop:`runAt`,order:`descending`},onRowClick:a[0]||=e=>e.status===`error`?void 0:s(`rowClick`,e)},{id:f(({row:e})=>[g(`#`+n(e.index),1)]),status:f(({row:e})=>[b(`div`,q,[e.status===`running`?(p(),c(i(D),{key:0,color:`secondary`},{default:f(()=>[o(z)]),_:1})):(p(),c(i(E),{key:1,icon:i(V)[e.status].icon,color:i(V)[e.status].color},null,8,[`icon`,`color`])),e.status===`warning`?(p(),c(i(D),{key:2,color:`warning`,class:v([t.$style.alertText,t.$style.warningText])},{default:f(()=>[g(n(i(d).baseText(`evaluation.runDetail.error.partialCasesFailed`)),1)]),_:1},8,[`class`])):e.status===`error`?(p(),c(i(T),{key:3,placement:`top`,"show-after":300},{content:f(()=>[o(i(S),{keypath:`${i(U)(e.errorCode)}`,scope:`global`},_({_:2},[i(d).exists(`${i(U)(e.errorCode)}.description`)?{name:`description`,fn:f(()=>[g(n(i(d).baseText(`${i(U)(e.errorCode)}.description`)&&`. `)+` `+n(i(d).baseText(`${i(U)(e.errorCode)}.description`)),1)]),key:`0`}:void 0]),1032,[`keypath`])]),default:f(()=>[o(i(D),{class:v([t.$style.alertText,t.$style.errorText])},{default:f(()=>[o(i(S),{keypath:`${i(U)(e.errorCode)}`,scope:`global`},_({_:2},[i(d).exists(`${i(U)(e.errorCode)}.description`)?{name:`description`,fn:f(()=>[b(`p`,{class:v(t.$style.grayText)},n(i(d).baseText(`${i(U)(e.errorCode)}.description`)),3)]),key:`0`}:void 0]),1032,[`keypath`])]),_:2},1032,[`class`])]),_:2},1024)):(p(),r(u,{key:4},[g(n(e.status),1)],64))])]),_:1},8,[`data`,`columns`])],2))}}),[[`__cssModules`,{$style:{container:`_container_1ulnw_125`,grayText:`_grayText_1ulnw_131`,alertText:`_alertText_1ulnw_135`,warningText:`_warningText_1ulnw_153`,errorText:`_errorText_1ulnw_157`}}]]),Y=M(s({__name:`RunsSection`,props:l({runs:{},workflowId:{}},{selectedMetric:{required:!0},selectedMetricModifiers:{}}),emits:[`update:selectedMetric`],setup(e){let n=e,i=C(),a=A(),s=m(e,`selectedMetric`),c=t(()=>[...n.runs.reduce((e,t)=>(Object.keys(t.metrics??{}).forEach(t=>e.add(t)),e),new Set)]),l=t(()=>c.value.map(e=>({prop:`metrics.${e}`,label:e,sortable:!0,showHeaderTooltip:!0,sortMethod:(t,n)=>(t.metrics?.[e]??0)-(n.metrics?.[e]??0),formatter:t=>t.metrics?.[e]===void 0?``:(t.metrics?.[e]).toFixed(2)}))),u=t(()=>[{prop:`id`,label:i.baseText(`evaluation.listRuns.runNumber`),showOverflowTooltip:!0},{prop:`runAt`,label:`Run at`,sortable:!0,showOverflowTooltip:!0,formatter:e=>{let{date:t,time:n}=L(e.runAt);return[t,n].join(`, `)},sortMethod:(e,t)=>new Date(e.runAt??e.createdAt).getTime()-new Date(t.runAt??t.createdAt).getTime()},{prop:`status`,label:i.baseText(`evaluation.listRuns.status`),sortable:!0},...l.value]),d=e=>{a.push({name:F.EVALUATION_RUNS_DETAIL,params:{runId:e.id}})};return(t,n)=>(p(),r(`div`,{class:v(t.$style.runs)},[o(K,{"selected-metric":s.value,"onUpdate:selectedMetric":n[0]||=e=>s.value=e,runs:e.runs},null,8,[`selected-metric`,`runs`]),o(J,{class:v(t.$style.runsTable),runs:e.runs,columns:u.value,selectable:!0,"data-test-id":`past-runs-table`,onRowClick:d},null,8,[`class`,`runs`,`columns`])],2))}}),[[`__cssModules`,{$style:{runs:`_runs_ni2ti_125`}}]]),X=e(R(),1),Z=M(s({__name:`EvaluationsView`,props:{name:{}},setup(e){let n=e,s=C(),l=P(),u=N(),f=a(``),m=a(!1),h=t(()=>y.value.find(e=>e.status===`running`));async function g(){try{await u.startTestRun(n.name)}catch(e){l.showError(e,s.baseText(`evaluation.listRuns.error.cantStartTestRun`))}try{await u.fetchTestRuns(n.name)}catch(e){l.showError(e,s.baseText(`evaluation.listRuns.error.cantFetchTestRuns`))}}async function _(){if(h.value)try{m.value=!0,await u.cancelTestRun(h.value.workflowId,h.value.id)}catch(e){l.showError(e,s.baseText(`evaluation.listRuns.error.cantStopTestRun`)),m.value=!1}}let y=t(()=>(0,X.default)(Object.values(u.testRunsById??{}).filter(({workflowId:e})=>e===n.name),e=>new Date(e.runAt),[`asc`]).map((e,t)=>({...e,index:t+1})));return d(h,e=>{e||(m.value=!1)}),(e,t)=>(p(),r(`div`,{class:v(e.$style.evaluationsView)},[b(`div`,{class:v(e.$style.header)},[h.value?(p(),c(i(w),{key:0,variant:`subtle`,disabled:m.value,class:v(e.$style.runOrStopTestButton),size:`small`,"data-test-id":`stop-test-button`,label:i(s).baseText(`evaluation.stopTest`),onClick:_},null,8,[`disabled`,`class`,`label`])):(p(),c(i(w),{key:1,variant:`solid`,class:v(e.$style.runOrStopTestButton),size:`small`,"data-test-id":`run-test-button`,label:i(s).baseText(`evaluation.runTest`),onClick:g},null,8,[`class`,`label`]))],2),b(`div`,{class:v(e.$style.wrapper)},[b(`div`,{class:v(e.$style.content)},[o(Y,{"selected-metric":f.value,"onUpdate:selectedMetric":t[0]||=e=>f.value=e,class:v(e.$style.runs),runs:y.value,"workflow-id":n.name},null,8,[`selected-metric`,`class`,`runs`,`workflow-id`])],2)],2)],2))}}),[[`__cssModules`,{$style:{evaluationsView:`_evaluationsView_gyn02_125`,content:`_content_gyn02_129`,header:`_header_gyn02_136`,wrapper:`_wrapper_gyn02_150`,runOrStopTestButton:`_runOrStopTestButton_gyn02_155`,runs:`_runs_gyn02_159`}}]]);export{Z as default};
//# sourceMappingURL=EvaluationsView-Dfjot-ky.js.map