!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"n8n@2.9.4"}}catch(e){}}(),System.register(["./vue.runtime.esm-bundler-legacy-BquwEXRp.js","./_MapCache-legacy-BR_CVmoL.js","./src-legacy-kcwUfEuS.js","./users.store-legacy-B-bVJKl3.js","./constants-legacy-DVkAm8xO.js","./_baseOrderBy-legacy-BnyL5wLN.js","./pushConnection.store-legacy-C36NF7Lj.js"],(function(e,l){var n,a,t,u,r,o,i,d,s,v,c,f,w,y,I,g,p,b,E,h,k,C;function B({route:e}){const l=s(),u=i(),r=t(),o=a(null),d=n((()=>e.name===y.DEMO)),v=[];function c(e){if(!d.value&&!window.preventNodeViewBeforeUnload)return v.forEach((e=>e())),l.stateIsDirty?(e.returnValue=!0,!0):void u.startLoading(r.baseText("nodeView.redirecting"))}return{onBeforeUnload:c,addBeforeUnloadEventBindings:function(){window.addEventListener("beforeunload",c)},removeBeforeUnloadEventBindings:function(){o.value&&clearTimeout(o.value),window.removeEventListener("beforeunload",c)},addBeforeUnloadHandler:function(e){v.push(e)}}}return e("n",B),{setters:[function(e){n=e.C,a=e.It},function(e){t=e.yt},function(e){u=e.Ci},function(e){r=e.Ca,o=e.Rr,i=e.Sr,d=e.Wc,s=e.r,v=e.s,c=e.t,f=e.un},function(e){w=e.al,y=e.rs},function(e){I=e.j,g=e.r},function(e){p=e.t}],execute:function(){try{l="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},(t=(new l.Error).stack)&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[t]="69d803e2-3c68-4f05-9699-ad60f224ca70",l._sentryDebugIdIdentifier="sentry-dbid-69d803e2-3c68-4f05-9699-ad60f224ca70")}catch(l){}var l,t;b=5*w.MINUTE,E=30*w.SECOND,h=20*w.SECOND,k=5*w.SECOND,C=20*w.SECOND,e("t",I(d.COLLABORATION,(()=>{const e=p(),l=v(),t=o(),i=c(),d=s(),y=g(),I=f(),{addBeforeUnloadEventBindings:D,removeBeforeUnloadEventBindings:A,addBeforeUnloadHandler:U}=B({route:u()}),m=a(null),O=a([]),T=a(null),R=a(Date.now()),S=a(null),N=a(null),W=a(null),j=a(null),L=a(null),_=a(null);let H=null;const q=n((()=>T.value===i.currentUserId)),x=n((()=>T.value?O.value.find((e=>e.user.id===T.value)):null)),M=n((()=>null!==T.value)),V=n((()=>M.value&&!q.value));async function z(){try{const{workflowId:e}=l;return l.isWorkflowSaved[e]?(await r(y.restApiContext,e)).userId:null}catch{return null}}function Q(){_.value&&e.send({type:"workflowOpened",workflowId:_.value})}function Y(){_.value&&(e.send({type:"workflowClosed",workflowId:_.value}),O.value=O.value.filter((({user:e})=>e.id!==i.currentUserId)))}const F=()=>{null!==N.value&&(clearInterval(N.value),N.value=null)},G=()=>{F(),N.value=window.setInterval(Q,b)},J=()=>{null!==W.value&&(clearInterval(W.value),W.value=null)},K=()=>{q.value&&_.value?e.send({type:"writeAccessHeartbeat",workflowId:_.value}):J()},P=()=>{J(),W.value=window.setInterval(K,E)},X=()=>{null!==j.value&&(clearInterval(j.value),j.value=null)},Z=async()=>{V.value?!(await z())&&T.value&&(T.value=null,X()):X()},$=()=>{X(),j.value=window.setInterval(Z,h)};function ee(){R.value=Date.now()}function le(){if(T.value=null,J(),!_.value)return!0;try{return e.send({type:"writeAccessReleaseRequested",workflowId:_.value}),!0}catch{return!1}}function ne(){q.value&&(I.streaming||Date.now()-R.value>=C&&le())}function ae(){null!==S.value&&(clearInterval(S.value),S.value=null)}return U((()=>{Y(),d.stateIsDirty&&(m.value=setTimeout((()=>Q),5*w.SECOND))})),{collaborators:O,currentWriter:x,isCurrentUserWriter:q,isAnyoneWriting:M,shouldBeReadOnly:V,requestWriteAccess:function(){if(q.value)return!0;if(!_.value)return!1;try{e.send({type:"writeAccessRequested",workflowId:_.value})}catch{return!1}return!0},releaseWriteAccess:le,recordActivity:ee,initialize:async function(){if(L.value)return;_.value=l.workflowId;const n=await z();n&&(T.value=n,q.value?P():$()),L.value=e.addEventListener((e=>"collaboratorsChanged"===e.type&&e.data.workflowId===_.value?(O.value=e.data.collaborators,void(T.value&&(O.value.some((e=>e.user.id===T.value))||(T.value=null)))):"writeAccessAcquired"===e.type&&e.data.workflowId===_.value?(T.value=e.data.userId,void(q.value?(ee(),P(),X()):$())):"writeAccessReleased"===e.type&&e.data.workflowId===_.value?(T.value=null,J(),void X()):void("workflowUpdated"!==e.type||e.data.workflowId!==_.value||async function(){if(!q.value&&_.value)try{const e=await t.fetchWorkflow(_.value);H&&H(e)}catch(e){return console.error("[Collaboration] Error in handleWorkflowUpdate:",e),!1}}()))),D(),Q(),G(),ae(),S.value=window.setInterval(ne,k)},terminate:function(){"function"==typeof L.value&&(L.value(),L.value=null),Y(),F(),J(),X(),ae(),q.value&&le(),e.clearQueue(),A(),m.value&&clearTimeout(m.value),_.value=null,T.value=null,O.value=[]},startHeartbeat:G,stopHeartbeat:F,setRefreshCanvasCallback:function(e){H=e}}})))}}}));
//# sourceMappingURL=collaboration.store-legacy-COoId2Xe.js.map