!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"n8n@2.9.4"}}catch(e){}}(),System.register(["./chunk-legacy-BCpDjeTS.js","./vue.runtime.esm-bundler-legacy-BquwEXRp.js","./_MapCache-legacy-BR_CVmoL.js","./src-legacy-kcwUfEuS.js","./_plugin-vue_export-helper-legacy-DtDV0xrP.js","./users.store-legacy-B-bVJKl3.js","./constants-legacy-DVkAm8xO.js","./_baseOrderBy-legacy-BnyL5wLN.js","./executions.store-legacy-OEeCPZk_.js","./usePinnedData-legacy-B5CI71uf.js","./canvas.utils-legacy-BQnUeqx3.js","./nodeCreator.store-legacy-i0crt2uh.js","./core-legacy-DyDkRzkb.js","./xml-legacy-uUeQFEQf.js","./VueMarkdown-legacy-g5FRWzuT.js","./folders.store-legacy-BDfX2wrH.js"],(function(e,t){var o,n,r,a,s,i,d,c,u,l,p,f,y,g,m,w,h,N,k,v,b,I,x,T,B,H,C,E,_,O,S,D,U,A,W,P,j,M,V,R,L,F,z,$,q,G,J,Z,K,Y,Q,X,ee,te,oe,ne,re,ae,se,ie,de,ce,ue,le,pe,fe,ye,ge,me,we,he,Ne,ke,ve,be,Ie,xe,Te,Be,He,Ce,Ee,_e,Oe,Se,De,Ue,Ae,We,Pe,je,Me,Ve,Re,Le,Fe,ze,$e,qe,Ge,Je,Ze,Ke,Ye,Qe,Xe,et,tt,ot,nt,rt,at,st,it,dt,ct,ut,lt,pt,ft,yt,gt,mt,wt,ht,Nt,kt,vt,bt,It,xt,Tt,Bt,Ht,Ct;function Et(){return{uniqueNodeName:function(e,t=[]){const{canvasNames:o}=me();if(!o.has(e)&&!t.includes(e))return e;const n=A().allNodeTypes.reduce(((e,t)=>{if("string"!=typeof t.defaults.name)throw new Error("Expected node name default to be a string");return/\d$/.test(t.defaults.name)&&e.push(t.defaults.name),e}),[]).find((t=>e.startsWith(t)));if(n){let r="",a=1;const s=e.split(n).pop(),i=s?.[s.length-1];for(i&&Number.isInteger(Number(i))&&(a=parseInt(i,10),e=e.slice(0,-1)),r=e;o.has(r)||t.includes(r);)r=e+a++;return r}if(/^\d+-?\d*$/.test(e)){let n="",r=1;const a=e.match(/(?<base>\d+)-?(?<suffix>\d*)/);if(!a?.groups)throw new Error("Failed to find match for unique name");for(""!==a?.groups?.suffix&&(r=parseInt(a.groups.suffix,10)),n=a.groups.base;o.has(n)||t.includes(n);)n=a.groups.base+"-"+r++;return n}let r="",a=1;const s=e.match(/(?<base>.*\D+)(?<suffix>\d*)/);if(!s?.groups)throw new Error("Failed to find match for unique name");for(""!==s?.groups?.suffix&&(a=parseInt(s.groups.suffix,10)),r=s.groups.base;o.has(r)||t.includes(r);)r=s.groups.base+a++;return r}}}function _t(){const e=pt(),t=j(),o=me();return{fetchAndSetParentFolder:async n=>{if(!n)return;let r=e.getCachedFolder(n);return!r&&t.currentProjectId&&(await e.getFolderPath(t.currentProjectId,n),r=e.getCachedFolder(n)),r&&o.setParentFolder({...r,parentFolderId:r.parentFolder??null}),r??null}}}return e({f:function(e,t,o,n){const r=new URL(e).origin,a=r.startsWith("https")?"wss":"ws";return`${r.replace(/^https?/,a)}/chat?sessionId=${o}&executionId=${t}${n?"&isPublic=true":""}`},m:function(e){return"component"===e.type&&e.key===ht.WITH_BUTTONS&&"boolean"==typeof e.arguments?.blockUserInput&&e.arguments?.blockUserInput},n:_t,p:function(e){const t=Be();let o={id:t,sender:"bot",text:e};try{const n=JSON.parse(e);n.type===Nt&&(o={id:t,sender:"bot",type:"component",key:ht.WITH_BUTTONS,arguments:{text:n.text,buttons:n.buttons,blockUserInput:n.blockUserInput}})}catch{}return o},t:function(){const e=Ke(),t=me(),o=Q(),n=ge(),a=ae(),s=ye(),i=U(),c=A(),l=Z(),p=Ne(),f=z(),y=rt(),g=Ye(),m=j(),w=It(),h=Tt(),N=ve(),k=se(),v=H(),b=Te(),I=Y(),x=R(),T=L(),E=be(),_=B(),{uniqueNodeName:S}=Et(),{fetchAndSetParentFolder:P}=_t(),re=O(),Be=C(),He=u([0,0]),Ee=!!localStorage.getItem("NodeView.preventOpeningNDV"),_e=r((()=>t.workflow)),Oe=r((()=>t.workflowObject)),We=r((()=>t.workflowTriggerNodes));function Ve(e,{trackHistory:t=!1,trackBulk:o=!0}={}){t&&o&&a.startRecordingUndo(),e.forEach((({id:e,position:o})=>{Le(e,o,{trackHistory:t})})),t&&o&&a.stopRecordingUndo()}function Le(e,n,{trackHistory:r=!1}={}){const s=t.getNodeById(e);if(!s)return;const i=[...s.position],d=[n.x,n.y];o.setNodePositionById(e,d),r&&a.pushCommandToUndo(new we(s.name,i,d,Date.now()))}function $e(e,n,r,{trackHistory:s=!1,trackBulk:i=!0}={}){const d=t.getNodeById(e);d&&(s&&i&&a.startRecordingUndo(),o.setNodeParameters({name:d.name,value:r}),s&&a.pushCommandToUndo(new G(e,n,r,Date.now())),s&&i&&a.stopRecordingUndo())}async function Ze(e,o,{trackHistory:n=!1,trackBulk:r=!0,showErrorToast:s=!0}={}){if(e===o)return!1;n&&r&&a.startRecordingUndo(),o=S(o);const d=t.cloneWorkflowObject();try{d.renameNode(e,o)}catch(c){return s&&b.showMessage({type:"error",title:c.message,message:c.description}),!1}return n&&a.pushCommandToUndo(new ke(e,o,Date.now())),t.renameNodeSelectedAndExecution({old:e,new:o}),t.setNodes(Object.values(d.nodes)),t.setConnections(d.connectionsBySourceNode),i.activeNodeName===e&&i.setActiveNodeName(o,"other"),n&&r&&a.stopRecordingUndo(),o}function at(e,{trackHistory:o=!1}={}){const n=t.getNodeById(e);if(!n)return;const r=t.outgoingConnectionsByNodeName(n.name),s=t.incomingConnectionsByNodeName(n.name);for(const[i,d]of Object.entries(s))for(const e of d.at(0)??[]){const n=t.getNodeByName(e.node)?.id;if(n)for(const s of r[i]?.at(0)??[]){const r=t.getNodeByName(s.node)?.id;r&&(o&&a.pushCommandToUndo(new fe([{node:e.node,type:i,index:e.index},{node:s.node,type:i,index:s.index}],Date.now())),Nt({source:n,sourceHandle:ot({mode:ue.Output,type:i,index:e.index}),target:r,targetHandle:ot({mode:ue.Input,type:i,index:s.index})}))}}}function st(e,{trackHistory:o=!1,trackBulk:n=!0}={}){const r=t.getNodeById(e);r&&(o&&n&&a.startRecordingUndo(),s.lastInteractedWithNodeId===e&&(s.lastInteractedWithNodeId=void 0),at(e,{trackHistory:o}),vt(e,{trackHistory:o,trackBulk:!1}),t.removeNodeExecutionDataById(e),t.removeNodeById(e),o&&(a.pushCommandToUndo(new ee(r,Date.now())),n&&a.stopRecordingUndo()),function(e){const o=t.getNodeById(e);o&&("n8n-nodes-base.stickyNote"===o.type?T.track("User deleted workflow note",{workflow_id:t.workflowId}):(E.run("node.deleteNode",{node:o}),T.track("User deleted node",{node_type:o.type,workflow_id:t.workflowId})))}(e))}function it(e,{trackHistory:t=!0,trackBulk:o=!0}={}){t&&o&&a.startRecordingUndo(),e.forEach((e=>st(e,{trackHistory:t,trackBulk:!1}))),t&&o&&a.stopRecordingUndo()}function dt(e,o,{trackHistory:n=!1,trackBulk:r=!0,replaceInputs:s=!0,replaceOutputs:i=!0}={}){const d=t.getNodeById(e),c=t.getNodeById(o);if(!d||!c)return;const u=t.workflowObject,l=s?(0,Ct.default)(u.getParentNodes(d.name,"ALL",1)):[],p=i?(0,Ct.default)(u.getChildNodes(d.name,"ALL",1)):[],f=[...u.getConnectionsBetweenNodes(l,[d.name]),...u.getConnectionsBetweenNodes([d.name],p)];n&&r&&a.startRecordingUndo();for(const a of f){const e=t.getNodeByName(a[0].node),o=t.getNodeByName(a[1].node);if(!e||!o)continue;bt(Xe(e,o,a),{trackHistory:n,trackBulk:!1});const r={...a[0],node:a[0].node===d.name?c.name:a[0].node},s={...a[1],node:a[1].node===d.name?c.name:a[1].node},i=e.name===d.name?c:e,u=o.name===d.name?c:o;if(!Dt(i,u,r,s))continue;const l=Xe(i,u,[r,s]);Nt(l,{trackHistory:n}),Ot(l.target),St(l.source)}n&&r&&a.stopRecordingUndo()}function ct(e,t){i.setActiveNodeName(e,t)}function ut(e,t){return c.getNodeType(e,t)??c.communityNodeType(e)?.nodeDescription??{properties:[],displayName:e,name:e,group:[],description:"",version:t??1,defaults:{},inputs:[],outputs:[]}}async function lt(e,{viewport:o,...n}={}){let r,i=n.position;const d=[],u=e.map((e=>{const t=e.typeVersion??function(e){let t=e.defaultVersion;return void 0===t&&(t=Array.isArray(e.version)?e.version.slice(-1)[0]:e.version),t}(ut(e.type));return{...e,typeVersion:t}}));await async function(e){const t=c.allNodeTypes,o=[];t.forEach((t=>{const n=Array.isArray(t.version)?t.version:[t.version];e.find((e=>e.type===t.name&&n.includes(e.typeVersion)))&&!t.hasOwnProperty("properties")&&o.push({name:t.name,version:Array.isArray(t.version)?t.version.slice(-1)[0]:t.version})})),o.length>0&&await c.getNodesInformation(o)}(u),n.trackHistory&&n.trackBulk&&a.startRecordingUndo();for(const[t,a]of u.entries()){const{isAutoAdd:e,openDetail:s,actionName:c,positionOffset:u,...p}=a,f=p.position??i,y=f&&u?[f[0]+u[0],f[1]+u[1]]:f,g=ut(p.type,p.typeVersion);try{const a=pt({...p,position:y},g,{...n,...0===t?{viewport:o}:{},openNDV:s,isAutoAdd:e,actionName:c});r=a,d.push(a)}catch(l){b.showError(l,v.baseText("error")),console.error(l);continue}i=[r.position[0]+2*K[0]+16,r.position[1]]}return r&&function(e){const o=Oe.value.getParentNodesByDepth(e.name,1);o.length>1&&o.slice(1).forEach(((e,o)=>{const n=t.getNodeByName(e.name);n&&Le(n.id,{x:n.position[0],y:n.position[1]+100*(o+1)})}))}(r),n.trackHistory&&n.trackBulk&&a.stopRecordingUndo(),n.keepPristine||s.markStateDirty(),d}function pt(o,n,r={}){!function(e){if(void 0!==e.maxNodes&&I.getNodeTypeCount(e.name)>=e.maxNodes)throw new Error(v.baseText("nodeView.showMessage.showMaxNodeTypeError.message",{adjustToNumber:e.maxNodes,interpolate:{nodeTypeDataDisplayName:e.displayName}}))}(n);const u=function(t,o,n={}){const r=t.id??x.assignNodeId(t),a=t.name??x.getDefaultNodeName(t)??o.defaults.name,s=t.type??o.name,i=t.typeVersion,d=n.forcePosition&&t.position?t.position:yt(t,o,{viewport:n.viewport}),u=t.disabled??!1,l=t.parameters??{},p={...t,id:r,name:a,type:s,typeVersion:i,position:d,disabled:u,parameters:l};return function(t){t.name=S(v.localizeNodeName(e.defaultLocale,t.name,t.type))}(p),c.getIsNodeInstalled(p.type)&&(ft(p,o),gt(p,o)),p}(o,n,{viewport:r.viewport});if(!u)throw new Error(v.baseText("nodeViewV2.showError.failedToCreateNode"));return t.addNode(u),r.trackHistory&&a.pushCommandToUndo(new le(u,Date.now())),r.isAutoAdd||function(e,o={}){const n=s.lastInteractedWithNode;if(!n)return;const r=Ge(e.type),a=n.id,i=s.lastInteractedWithNodeConnection,d=s.lastInteractedWithNodeHandle;if(r&&i){const{type:t}=et(d),o=e.id,n=ot({mode:ue.Input,type:t,index:0});return Nt({target:i.target,targetHandle:i.targetHandle,source:o,sourceHandle:n}),bt(i),void Nt({source:i.source,sourceHandle:i.sourceHandle,target:o,targetHandle:n})}const c={trackHistory:o.trackHistory,trackBulk:!1};if(d){const{type:t,mode:o}=et(d),n=e.id,r=ot({mode:ue.Input,type:t,index:0});o===ue.Input?Nt({source:n,sourceHandle:r,target:a,targetHandle:d},c):Nt({source:a,sourceHandle:d,target:n,targetHandle:r},c)}else Nt({source:a,sourceHandle:ot({mode:ue.Output,type:ze.Main,index:0}),target:e.id,targetHandle:ot({mode:ue.Input,type:ze.Main,index:0})},c);i&&(bt(i,c),t.getNodeById(i.target)&&Nt({source:e.id,sourceHandle:ot({mode:ue.Input,type:ze.Main,index:0}),target:i.target,targetHandle:i.targetHandle},c))}(u,r),d((()=>{r.keepPristine||s.markStateDirty(),t.setNodePristine(u.name,!0),x.matchCredentials(u),x.updateNodeParameterIssues(u),x.updateNodeCredentialIssues(u),x.updateNodeInputIssues(u);const e=u.type===je,o=e||!r.openNDV||Ee?void 0:h.isNdvInFocusPanelEnabled&&k.focusPanelActive&&void 0===k.resolvedParameter?"focus_panel":h.isZoomedViewEnabled?"zoomed_view":"ndv";r.telemetry&&function(e,o,n){e.type===je?T.track("User inserted workflow note",{workflow_id:t.workflowId}):function(e,o,n){const r=e.parameters,a="string"==typeof r?.resource?r.resource:void 0,i="string"==typeof r?.operation?r.operation:void 0;y.onNodeAddedToCanvas({node_id:e.id,node_type:e.type,node_version:e.typeVersion,is_auto_add:o.isAutoAdd,workflow_id:t.workflowId,drag_and_drop:o.dragAndDrop,input_node_type:s.lastInteractedWithNode?s.lastInteractedWithNode.type:void 0,resource:a,operation:i,action:o.actionName,next_view_shown:n})}(e,o,n)}(u,r,o),e||(E.run("nodeView.addNodeButton",{nodeTypeName:u.type}),"focus_panel"===o||("zoomed_view"===o?h.setNodeNameToBeFocused(u.name):"ndv"===o&&i.setActiveNodeName(u.name,"added_new_node")))})),u}function ft(e,t){e.parameters=Pe(t?.properties??[],e.parameters,!0,!1,e,t)??{}}function yt(e,o,n={}){const r=s.lastInteractedWithNode,a=s.lastInteractedWithNodeConnection,i=s.lastInteractedWithNodeHandle,{type:d,index:u}=et(i??a?.sourceHandle??""),l=d===ze.Main?K:he,p=[l[0]/2,l[1]/2];let f=e.position;if(f)return V(t.allNodes,f,{offset:p,size:l,viewport:n.viewport,normalize:!1});if(r){const i=c.getNodeType(r.type,r.typeVersion),g=Oe.value.getNode(r.name),m=s.lastCancelledConnectionPosition;if(m){const e=d===ze.Main?0:-l[0]/2,t=d===ze.Main?-l[1]/2:0;f=[m[0]+e,m[1]+t],s.lastCancelledConnectionPosition=void 0}else if(i&&g){if(Ge(e.type)&&a&&d===ze.AiTool){const e=t.getNodeById(a.target);if(e){const o=e.position[1],a=r.position[1],s=(a-o)/2,i=o+s;if(f=[r.position[0]-J[0]/2,i],Math.abs(i-a)<F){const e=F/2;Le(r.id,{x:r.position[0],y:r.position[1]+(s>0?e:-e)},{trackHistory:!0})}return V(t.allNodes,f,{offset:p,size:l,viewport:n.viewport})}}const s=qe(Oe.value,g,i),c=Me(s),m=(c||[]).filter((e=>e!==ze.Main)),w=Ae(Oe.value,g,i),h=Me(w).filter((e=>e===ze.Main));let N=0;if(a){let e=!1;"string"==typeof o.inputs?e=!0:Array.isArray(o.inputs)&&(e=Me(o.inputs).filter((e=>e!==ze.Main)).length>0);const n=e?J:K,a=F+(e?J[0]-K[0]:0);!function(e,o,{trackHistory:n=!1,nodeSize:r=K}){const a=t.nodesByName[e];if(!a)return;const s=[a.position[0]+F,a.position[1]];if(function(e,t,o){const n=16,r={x:e[0],y:e[1],width:t[0]+n,height:t[1]};for(const a of o)if("n8n-nodes-base.stickyNote"!==a.type&&D(r,mt(a)))return!1;return!0}(s,r,Object.values(t.nodesByName).filter((t=>t.name!==e&&"n8n-nodes-base.stickyNote"!==t.type))))return;const{nodesToMove:i,stickiesToStretch:d,stickiesToMoveAndStretch:c,stickyAssociatedNodes:u}=wt(s,e,r);for(const t of i)Le(t.id,{x:t.position[0]+o,y:t.position[1]},{trackHistory:n});for(const l of c){const e=t.getNodeById(l.id);e&&ht(e,s,r,u.get(l.id)??[],{trackHistory:n})}for(const t of d)ht(t,s,r,u.get(t.id)??[],{trackHistory:n})}(r.name,a,{trackHistory:!0,nodeSize:n})}h.length>1&&(N=ie(h.length,K[1],16)[u]);let k=[];try{k=Ae(Oe.value,e,o)}catch(y){}const v=Me(k),b={[ze.AiLanguageModel]:2*l[0],[ze.AiMemory]:l[0]}[d]??0;if(v.length>0&&v.every((e=>e!==ze.Main))){const e=m.findIndex((e=>k[0]===e)),t=Math.max(m.length+1,1);f=[r.position[0]+J[0]/t*(e+1)-l[0]/2-b,r.position[1]+F]}else{let e=F;c.find((e=>e!==ze.Main))&&(e+=140),f=[r.position[0]+e,r.position[1]+N],a&&(f=[f[0],r.position[1]])}}}return f||(f=c.isTriggerNode(e.type)&&0===We.value.length?[0,0]:He.value),V(t.allNodes,f,{offset:p,size:l,viewport:n.viewport})}function gt(e,t){t.webhooks?.length&&!e.webhookId&&x.assignWebhookId(e),["n8n-nodes-base.webhook","n8n-nodes-base.formTrigger","@n8n/n8n-nodes-langchain.mcpTrigger"].includes(e.type)&&""===e.parameters.path&&(e.parameters.path=e.webhookId)}function mt(e){return"n8n-nodes-base.stickyNote"===e.type?{x:e.position[0],y:e.position[1],width:e.parameters.width||K[0],height:e.parameters.height||K[1]}:{x:e.position[0],y:e.position[1],width:K[0],height:K[1]}}function wt(e,o,n=K){const r=Object.values(t.nodesByName),a=e[0],s=e[1],i=2*K[1],d=e=>e.position[0]+K[0]>a||e.position[0]>=a,c=(e,t,o,n,r)=>((e,t,o)=>e.position[0]>=t.position[0]&&e.position[0]+K[0]<=t.position[0]+o.width&&e.position[1]>=t.position[1]&&e.position[1]+K[1]<=t.position[1]+o.height)(e,t,o)||((e,t,o)=>Math.abs(e.x-t.x)<=o.x&&Math.abs(e.y-t.y)<=o.y)((e=>({x:e.position[0]+K[0]/2,y:e.position[1]+K[1]/2}))(e),n,r),u=(e,t,o,n,r)=>r.filter((r=>c(r,e,t,o,n))),l=r.filter((e=>"n8n-nodes-base.stickyNote"!==e.type&&e.name!==o&&(e=>Math.abs(e.position[1]-s)<=i)(e)&&d(e))),p=new Set(l.map((e=>e.name)));for(const x of l)I.getConnectedNodes("downstream",Oe.value,x.name).filter((e=>{const o=t.getNodeByName(e);return!!o&&d(o)})).forEach((e=>p.add(e)));const f=r.filter((e=>"n8n-nodes-base.stickyNote"!==e.type&&p.has(e.name))),y=[],g=[],m=[],w=new Map,h=r.filter((e=>e.type===je)),N=Math.min(s,...f.map((e=>e.position[1]))),k=Math.max(s+n[1],...f.map((e=>e.position[1]+K[1]))),v=t.nodesByName[o],b={x:n[0]/2,y:n[1]/2};for(const t of h){const e=mt(t),o=t.position[0],r=o+e.width,s=t.position[1],i=!(s+e.height<=N||s>=k),d=a>=o&&a<=r,l={x:t.position[0]+e.width/2,y:t.position[1]+e.height/2};if(v&&c(v,t,e,l,b)&&d){const o=u(t,e,l,b,f);w.set(t.id,o),y.push(t);continue}const p=u(t,e,l,b,f);p.length>0&&w.set(t.id,p);const h=p.length>0;i&&(h?a+n[0]>o+2*F/3?m.push(t):g.push(t):d?y.push(t):o>=a&&g.push(t))}return{nodesToMove:[...f,...g,...m],stickiesToStretch:y,stickiesToMoveAndStretch:m,stickyAssociatedNodes:w}}function ht(e,o,n,r,{trackHistory:a=!1}){const s=mt(e),i=e.position[0],d=i+s.width;let c=o[0]-20,u=o[0]+n[0]+20;for(const y of r){const e=t.getNodeById(y.id);if(!e)continue;const o=e.position[0]-20,n=e.position[0]+K[0]+20;c=Math.min(c,o),u=Math.max(u,n)}const l=Math.min(i,c),p=Math.max(d,u)-l,f={...e.parameters,width:p};$e(e.id,e.parameters,f,{trackHistory:a,trackBulk:!1}),l!==i&&Le(e.id,{x:l,y:e.position[1]},{trackHistory:a})}function Nt(e,{trackHistory:o=!1,keepPristine:n=!1}={}){const r=t.getNodeById(e.source),i=t.getNodeById(e.target);if(!r||!i)return;o&&a.pushCommandToUndo(new fe(tt(r,i,e),Date.now()));const c=tt(r,i,e);Dt(r,i,c[0],c[1])&&(t.addConnection({connection:c}),d((()=>{x.updateNodeInputIssues(r),x.updateNodeInputIssues(i)})),n||s.markStateDirty())}function vt(e,{trackHistory:o=!1,trackBulk:n=!0}={}){const r=t.getNodeById(e);if(!r)return;o&&n&&a.startRecordingUndo();const s=(0,Ht.default)(t.workflow.connections);for(const a of Object.keys(s)){const e=t.getNodeByName(a);if(e)for(const n of Object.keys(s[a]))for(const i of Object.keys(s[a][n])){const d=s[a][n][parseInt(i,10)]??[];for(const a of Object.keys(d)){const s=d[parseInt(a,10)];if(!s)continue;const c=t.getNodeByName(s.node);!c||c.id!==r.id&&e.name!==r.name||bt({source:e.id,sourceHandle:ot({mode:ue.Output,type:n,index:parseInt(i,10)}),target:c.id,targetHandle:ot({mode:ue.Input,type:s.type,index:s.index})},{trackHistory:o,trackBulk:!1})}}}delete t.workflow.connections[r.name],o&&n&&a.stopRecordingUndo()}function bt(e,{trackHistory:o=!1,trackBulk:n=!0}={}){const r=t.getNodeById(e.source),s=t.getNodeById(e.target);if(!r||!s)return;const i=tt(r,s,e);o&&n&&a.startRecordingUndo(),t.removeConnection({connection:i}),d((()=>{x.updateNodeInputIssues(r),x.updateNodeInputIssues(s)})),o&&(a.pushCommandToUndo(new xe(i,Date.now())),n&&a.stopRecordingUndo())}function xt(e,o){const n=t.getNodeById(e),r=o===ue.Input;n&&c.getNodeType(n.type,n.typeVersion)&&nt(t.workflow.connections,t.workflow.nodes).forEach((o=>{if(r?o.target===e:o.source===e){const e=r?o.source:o.target,a=t.getNodeById(e);if(!a||!o.data)return;const[s,i]=r?[a,n]:[n,a];Dt(s,i,o.data.source,o.data.target)||d((()=>bt(o)))}}))}function Ot(e){return xt(e,ue.Input)}function St(e){return xt(e,ue.Output)}function Dt(e,t,o,n){const r=[je],a=e=>Se(e.type)&&!A().getIsNodeInstalled(e.type),s=a(e),i=a(t),d=e=>c.getNodeType(e.type,e.typeVersion)??c.communityNodeType(e.type)?.nodeDescription,u=(e,t)=>e.filter((e=>("string"==typeof e?e:e.type)===t)),l=e=>{if(e&&"object"==typeof e&&"filter"in e)return e.filter};if(o.type!==n.type)return!1;if(r.includes(e.type)||r.includes(t.type))return!1;const p=d(e),f=Oe.value.getNode(e.name);if(!f)return!1;let y=[];p&&(y=Ae(Oe.value,f,p)||[]);const g=u(y,o.type),m=g.length>0,w=o.index<g.length,h=l(w?g[o.index]:void 0);if(!(m&&w||s))return!1;const N=d(t),k=Oe.value.getNode(t.name);if(!k)return!1;let I=[];N&&(I=qe(Oe.value,k,N)||[]);const x=u(I,n.type),T=x.length>0,B=n.index<x.length;function H(e,t){const o=!!e?.nodes?.length&&!e.nodes.includes(t),n=!!e?.excludedNodes?.length&&e.excludedNodes.includes(t);return o||n}const C=H(l(B?x[n.index]:void 0),e.type),E=H(h,t.type);return C||E?(b.showToast({title:v.baseText("nodeView.showError.nodeNodeCompatible.title"),message:v.baseText("nodeView.showError.nodeNodeCompatible.message",{interpolate:{sourceNodeName:e.name,targetNodeName:t.name}}),type:"error",duration:5e3}),!1):!!(T&&B||i)}async function Ut(e,{trackBulk:t=!0,trackHistory:o=!1,keepPristine:n=!1}={}){await d(),t&&o&&a.startRecordingUndo();for(const r of e)Nt(r,{trackHistory:o,keepPristine:n});t&&o&&a.stopRecordingUndo(),n||s.markStateDirty()}function At(){if(y.setNodeCreatorState({createNodeActive:!1}),y.setShowScrim(!1),t.executionWaitingForWebhook)try{t.removeTestWebhook(t.workflowId)}catch(e){}t.resetWorkflow(),o.resetState(),t.currentWorkflowExecutions=[],o.setActiveExecutionId(void 0),t.lastSuccessfulExecution=null,s.resetLastInteractedWith(),s.markStateClean(),g.activeExecution=null,x.credentialsUpdated.value=!1}async function Wt(e){const{workflowDocumentStore:n}=await I.initState(e,M());return e.nodes.forEach((e=>{const t=ut(e.type,e.typeVersion),o=c.getIsNodeInstalled(e.type);x.matchCredentials(e),o&&(ft(e,t),gt(e,t))})),t.setNodes(e.nodes),t.setConnections(e.connections),o.setWorkflowProperty("createdAt",e.createdAt),o.setWorkflowProperty("updatedAt",e.updatedAt),{workflowDocumentStore:n}}async function Pt(r,i,{importTags:d=!0,trackBulk:u=!0,trackHistory:l=!0,viewport:y,regenerateIds:g=!0,trackEvents:m=!0,setStateDirty:w=!0}={}){if(s.resetLastInteractedWith(),!r.hasOwnProperty("nodes")||!r.hasOwnProperty("connections"))return{};try{const h={};if(r.nodes){const e=new Set(r.nodes.map((e=>e.name)));r.nodes.forEach((t=>{if(!t.name){const o=S(c.getNodeType(t.type)?.displayName??t.type,Array.from(e));t.name=o,e.add(o)}if(t.webhookId&&Je.includes(t.type)&&t.webhookId&&(x.assignWebhookId(t),t.parameters.path?t.parameters.path=t.webhookId:t.parameters.options?.path&&(t.parameters.options.path=t.webhookId)),t.id){const e=t.id;if(g){const o=x.assignNodeId(t);h[o]=e}}else x.assignNodeId(t)}))}!function(e){if(e?.nodes)for(const t of e.nodes)if(t.credentials)for(const[e,o]of Object.entries(t.credentials))"string"!=typeof o&&null!==o.id&&(n.getCredentialById(o.id)||delete t.credentials[e])}(r);try{if(m){const o=JSON.stringify(Re(r,I.getNodeTypes(),{nodeIdMap:h,sourceInstanceId:r.meta&&r.meta.instanceId!==e.instanceId?r.meta.instanceId:"",isCloudDeployment:p.isCloudDeployment}).nodeGraph);"paste"===i?T.track("User pasted nodes",{workflow_id:t.workflowId,node_graph_string:o}):"duplicate"===i?T.track("User duplicated nodes",{workflow_id:t.workflowId,node_graph_string:o}):T.track("User imported workflow",{source:i,workflow_id:t.workflowId,node_graph_string:o})}}catch{}return I.updateNodePositions(r,V(_e.value.nodes,He.value,{...r.nodes&&r.nodes.length>1?{size:q(r.nodes)}:{},viewport:y})),await async function(o,{trackBulk:n=!0,trackHistory:r=!1,viewport:i=W,setStateDirty:d=!0}={}){const u={},l=new Set((o.nodes??[]).map((e=>e.name)));if(!o.nodes)throw new Error(v.baseText("nodeView.noNodesGivenToAdd"));const p=I.getNodeTypesMaxCount();let f,y;const g=[];await x.loadNodesProperties(o.nodes.map((e=>({name:e.type,version:e.typeVersion})))),o.nodes.forEach((t=>{if(void 0!==p[t.type]){if(p[t.type].exist>=p[t.type].max)return void(u[t.name]=p[t.type].nodeNames[0]);p[t.type].exist+=1}f=t.name;const o=v.localizeNodeName(e.defaultLocale,t.name,t.type);l.delete(f),y=S(o,Array.from(l)),l.add(y),u[f]=y,g.push(t)}));const m={},w=o.connections??{},h=g.map((e=>e.name));let N,k,T,B,H;for(N of Object.keys(w)){if(!h.includes(N))continue;const e={};for(k of Object.keys(w[N]))for(e[k]=[],T=0;T<w[N][k].length;T++){const t=[],o=w[N][k][T];if(o)for(B=0;B<o.length;B++)H=o[B],h.includes(H.node)&&t.push(H);e[k].push(t)}m[N]=e}const C=t.createWorkflowObject(g,m,!0);for(const e of Object.keys(C.nodes)){const t=C.nodes[e];c.getIsNodeInstalled(t.type)||(t.parameters=g.find((t=>t.name===e))?.parameters??t.parameters)}for(f in u){const e=u[f];e&&f!==e&&C.renameNode(f,e)}if(o.pinData){let e=!0;for(const t of Object.keys(o.pinData)){if(!e){b.showError(new Error(v.baseText("ndv.pinData.error.tooLarge.description")),v.baseText("ndv.pinData.error.tooLarge.title"));continue}const n=C.nodes[u[t]??t];if(n)try{Qe(n).setData(o.pinData[t],"add-nodes"),e=!0}catch(E){e=!1,console.error(E)}}}return n&&r&&a.startRecordingUndo(),await lt(Object.values(C.nodes),{trackBulk:!1,trackHistory:r,viewport:i,keepPristine:!0}),await Ut(nt(C.connectionsBySourceNode,Object.values(C.nodes)),{trackBulk:!1,trackHistory:r,keepPristine:!0}),n&&r&&a.stopRecordingUndo(),d?s.markStateDirty():s.markStateClean(),{nodes:Object.values(C.nodes),connections:C.connectionsBySourceNode}}(r,{trackBulk:u,trackHistory:l,viewport:y,setStateDirty:w}),d&&p.areTagsEnabled&&Array.isArray(r.tags)&&await async function(e){const o=await f.fetchAll(),n=new Set(o.map((e=>e.name))),r=e.tags,a=r.filter((e=>!n.has(e.name))),s=[];for(const t of a){const e=f.create(t.name).then((e=>(o.push(e),e)));s.push(e)}await Promise.all(s);const i=r.reduce(((e,t)=>{const n=o.find((e=>e.name===t.name));return n&&e.push(n.id),e}),[]);de(ce(t.workflowId)).addTags(i)}(r),r.name&&o.setWorkflowName({newName:r.name,setStateDirty:w}),r}catch(h){return console.error(h),b.showError(h,v.baseText("nodeView.showError.importWorkflowData.title")),{}}}function jt(e){const o={nodes:[],connections:{},pinData:{}},r=new Set;for(const n of e){const e=I.getNodeDataToSave(n),a=t.pinDataByNodeName(n.name);a&&(o.pinData[n.name]=a),e.credentials&&p.isEnterpriseFeatureEnabled[De.Sharing]&&(e.credentials=Mt(e.credentials,t.usedCredentials)),o.nodes.push(e),r.add(n.name)}return o.connections=function(e,o){const n={};for(const r of e){const e=t.outgoingConnectionsByNodeName(r.name);if(!Object.keys(e).length)continue;const a=Vt(e,o);Object.keys(a).length&&(n[r.name]=a)}return n}(o.nodes,r),I.removeForeignCredentialsFromWorkflow(o,n.allCredentials),o}function Mt(e,t){return Object.fromEntries(Object.entries(e).filter((([,e])=>e.id&&(!t[e.id]||t[e.id]?.currentUserHasAccess))))}function Vt(e,t){const o={};for(const[n,r]of Object.entries(e)){const e=r.map((e=>(e??[]).filter((e=>t.has(e.node)))));e.length&&(o[n]=e)}return o}async function Rt(o){const n=Ce(jt(t.getNodesByIds(o)));n.meta={...n.meta,...t.workflow.meta,instanceId:e.instanceId},await _.copy(JSON.stringify(n,null,2)),T.track("User copied nodes",{node_types:n.nodes.map((e=>e.type)),workflow_id:t.workflowId})}async function Lt({id:e,name:n,workflow:r}){const a=r.nodes?.map(t.convertTemplateNodeToNodeUi);r.connections&&t.setConnections(r.connections),await lt(a??[],{keepPristine:!0}),await o.getNewWorkflowDataAndMakeShareable(n,m.currentProjectId),o.addToWorkflowMetadata({templateId:`${e}`})}function Ft(e,o,{trackHistory:n=!0,trackBulk:r=!0}={}){const i=t.getNodeById(e),d=t.getNodeById(o);if(!i||!d)return;n&&r&&a.startRecordingUndo();const[c,u]=i.position;Le(o,{x:c,y:u},{trackHistory:n}),dt(e,o,{trackBulk:!1,trackHistory:n}),st(e,{trackHistory:n,trackBulk:!1}),s.markStateDirty(),n&&r&&a.stopRecordingUndo()}function zt(){setTimeout((()=>Bt.emit("fitView")))}return{lastClickPosition:He,editableWorkflow:_e,editableWorkflowObject:Oe,triggerNodes:We,requireNodeTypeDescription:ut,addNodes:lt,addNode:pt,resolveNodePosition:yt,revertAddNode:async function(e){const o=t.getNodeByName(e);o&&st(o.id)},updateNodesPosition:Ve,updateNodePosition:Le,tidyUp:function({result:e,source:t,target:o},{trackEvents:n=!0,trackHistory:r=!0,trackBulk:a=!0}={}){Ve(e.nodes.map((({id:e,x:t,y:o})=>({id:e,position:{x:t,y:o}}))),{trackBulk:a,trackHistory:r}),n&&function({result:e,source:t,target:o}){T.track("User tidied up canvas",{source:t,target:o,nodes_count:e.nodes.length})}({result:e,source:t,target:o})},revertUpdateNodePosition:function(e,o){const n=t.getNodeByName(e);n&&Le(n.id,o)},setNodeActive:function(e,o){const n=t.getNodeById(e);n&&(t.setNodePristine(n.name,!1),ct(n.name,o))},setNodeActiveByName:ct,clearNodeActive:function(){i.unsetActiveNodeName()},setNodeSelected:function(e){if(!e)return s.lastInteractedWithNodeId=void 0,void(s.lastSelectedNode="");const o=t.getNodeById(e);o&&(s.lastInteractedWithNodeId=e,s.lastSelectedNode=o.name)},toggleNodesDisabled:function(e,{trackHistory:o=!0,trackBulk:n=!0}={}){o&&n&&a.startRecordingUndo();const r=t.getNodesByIds(e);x.disableNodes(r,{trackHistory:o,trackBulk:!1}),o&&n&&a.stopRecordingUndo()},revertToggleNodeDisabled:function(e){const o=t.getNodeByName(e);o&&x.disableNodes([o])},toggleNodesPinned:function(e,o,{trackHistory:n=!0,trackBulk:r=!0}={}){n&&r&&a.startRecordingUndo();const s=t.getNodesByIds(e).filter((e=>Qe(e).canPinNode(!0))),i=s.some((e=>!t.pinDataByNodeName(e.name)));for(const t of s){const e=Qe(t);if(i){const n=oe().getInputDataWithPinned(t);0!==n.length&&e.setData(n,o)}else e.unsetData(o)}n&&r&&a.stopRecordingUndo()},setNodeParameters:function(e,n){const r=t.getNodeById(e);r&&o.setNodeParameters({name:r.name,value:n},!0)},renameNode:Ze,revertRenameNode:async function(e,t){await Ze(e,t)},replaceNodeParameters:$e,revertReplaceNodeParameters:async function(e,t,o){$e(e,o,t)},deleteNode:st,deleteNodes:it,copyNodes:Rt,cutNodes:async function(e){await Rt(e),it(e)},duplicateNodes:async function(e,o={}){return(await Pt(Ce(jt(t.getNodesByIds(e))),"duplicate",{viewport:o.viewport,importTags:!1})).nodes?.map((e=>e.id)).filter(te)??[]},getNodesToSave:jt,getNodesToShift:wt,revertDeleteNode:function(e){t.addNode(e),s.markStateDirty()},addConnections:Ut,createConnection:Nt,revertCreateConnection:function(e){const o=e[0].node,n=t.getNodeByName(o),r=e[1].node,a=t.getNodeByName(r);n&&a&&bt(Xe(n,a,e))},deleteConnection:bt,revertDeleteConnection:function(e){t.addConnection({connection:e})},deleteConnectionsByNodeId:vt,revalidateNodeInputConnections:Ot,revalidateNodeOutputConnections:St,isConnectionAllowed:Dt,filterConnectionsByNodes:Vt,connectAdjacentNodes:at,importWorkflowData:Pt,fetchWorkflowDataFromUrl:async function(e){let o;const n=m.currentProjectId??m.personalProject?.id;if(!n)throw new Error("No project selected");l.startLoading();try{o=await t.getWorkflowFromUrl(e,n)}catch(r){return void b.showError(r,v.baseText("nodeView.showError.getWorkflowDataFromUrl.title"))}finally{l.stopLoading()}return o},resetWorkspace:At,initializeWorkspace:Wt,resolveNodeWebhook:gt,openExecution:async function(e,n){let r;try{r=await t.getExecution(e)}catch(a){return void b.showError(a,v.baseText("nodeView.showError.openExecution.title"))}if(void 0===r)throw new Error(`Execution with id "${e}" could not be found!`);if("error"===r.status&&r.data?.resultData.error){const{title:e,message:t}=Ie({error:r.data.resultData.error,lastNodeExecuted:r.data.resultData.lastNodeExecuted});b.showMessage({title:e,message:t,type:"error",duration:0})}if(await Wt(r.workflowData),o.setWorkflowExecutionData(r),["manual","evaluation"].includes(r.mode)||o.setWorkflowPinData({}),n){const e=t.getNodeById(n);e?i.setActiveNodeName(e.name,"other"):b.showError(new Error(`Node with id "${n}" could not be found!`),v.baseText("nodeView.showError.openExecution.node"))}return s.markStateClean(),r},startChat:function(e){if(!t.allNodes.some(ne))return;const o=t.workflowObject;w.toggleOpen(!0);const n={workflow_id:o.id,button_type:e};E.run("nodeView.onOpenChat",n),T.track("User clicked chat open button",n),setTimeout((()=>{kt.emit("focusInput")}),0)},importTemplate:Lt,replaceNodeConnections:dt,tryToOpenSubworkflowInNewTab:function(o){const n=t.getNodeById(o);if(!n)return!1;const r=Ue(n);return!!r&&(window.open(`${e.baseUrl}workflow/${r}`,"_blank"),!0)},initializeUnknownNodes:e=>{e.forEach((e=>{const n=ut($(e.type),e.typeVersion);x.matchCredentials(e),ft(e,n),gt(e,n);const r=t.workflow.nodes.findIndex((t=>t.name===e.name));o.updateNodeAtIndex(r,{...e,type:$(e.type)})}))},replaceNode:Ft,addNodesAndConnections:async function(e,t,{trackBulk:o=!0,trackHistory:n=!0,...r}){n&&o&&a.startRecordingUndo();const i=await lt(e,{...r,trackHistory:n,trackBulk:!1,telemetry:!0}),d=_e.value.nodes.length-e.length;if(await Ut(t.map((({from:e,to:t})=>{const o=_e.value.nodes[d+e.nodeIndex],n=_e.value.nodes[d+t.nodeIndex],r=e.type??t.type??ze.Main;return{source:o.id,sourceHandle:ot({mode:ue.Output,type:X(r)?r:ze.Main,index:e.outputIndex??0}),target:n.id,targetHandle:ot({mode:ue.Input,type:X(r)?r:ze.Main,index:t.inputIndex??0}),data:{source:{index:e.outputIndex??0,type:r},target:{index:t.inputIndex??0,type:r}}}})),{trackHistory:n,trackBulk:!1}),s.resetLastInteractedWith(),i.length>0&&r.replaceNodeId){const e=i[i.length-1].id;Ft(r.replaceNodeId,e,{trackHistory:n,trackBulk:!1})}return n&&o&&a.stopRecordingUndo(),{addedNodes:i}},fitView:zt,openWorkflowTemplate:async function(e){let n;At(),l.startLoading(),l.setLoadingText(v.baseText("nodeView.loadingTemplate")),t.currentWorkflowExecutions=[],g.activeExecution=null;try{if(E.run("template.requested",{templateId:e}),n=await N.getFixedWorkflowTemplate(e),!n)throw new Error(v.baseText("nodeView.workflowTemplateWithIdCouldNotBeFound",{interpolate:{templateId:e}}))}catch(r){return b.showError(r,v.baseText("nodeView.couldntImportWorkflow")),void(await re.replace({name:Fe.NEW_WORKFLOW}))}!function(e){T.track("User inserted workflow template",{source:"workflow",template_id:pe(e),wf_template_repo_session_id:N.previousSessionId})}(e),s.isBlankRedirect=!0,await re.replace({name:Fe.NEW_WORKFLOW,query:{templateId:e}}),await Lt({id:e,name:n.name,workflow:n.workflow}),"string"==typeof Be.params.name&&o.setWorkflowId(Be.params.name),l.stopLoading(),E.run("template.open",{templateId:e,templateName:n.name,workflow:n.workflow}),zt()},openWorkflowTemplateFromJSON:async function(e){if(!e.nodes||!e.connections)return b.showError(new Error(v.baseText("nodeView.couldntLoadWorkflow.invalidWorkflowObject")),v.baseText("nodeView.couldntImportWorkflow")),void(await re.replace({name:Fe.NEW_WORKFLOW}));At(),l.startLoading(),l.setLoadingText(v.baseText("nodeView.loadingTemplate")),t.currentWorkflowExecutions=[],g.activeExecution=null,s.isBlankRedirect=!0;const o=e.meta.templateId,n=Be.query.parentFolderId;await m.refreshCurrentProject(),await P(n),await re.replace({name:Fe.NEW_WORKFLOW,query:{templateId:o,parentFolderId:n,projectId:m.currentProjectId}}),await Lt({id:o,name:e.name,workflow:e}),l.stopLoading(),zt()}}}}),{setters:[function(e){o=e.o,n=e.t},function(e){r=e.C,a=e.Cn,s=e.D,i=e.E,d=e.G,c=e.Gt,u=e.It,l=e.M,p=e.P,f=e.T,y=e.W,g=e._,m=e.at,w=e.bt,h=e.ct,N=e.et,k=e.it,v=e.j,b=e.vn,I=e.w,x=e.zt},function(e){T=e.M,B=e.S,H=e.yt},function(e){C=e.Ci,E=e._t,_=e.ki,O=e.wi},function(e){S=e.t},function(e){D=e.An,U=e.Bt,A=e.C,e.Dn,W=e.En,P=e.Fr,j=e.Gt,M=e.Ht,V=e.In,R=e.It,L=e.Lt,F=e.On,z=e.Ot,$=e.R,q=e.Rn,G=e.Si,J=e.Sn,Z=e.Sr,K=e.Tn,Y=e.Tt,Q=e.Vt,X=e.ai,ee=e.bi,te=e.ca,oe=e.ct,ne=e.d,re=e.di,ae=e.fi,se=e.gn,ie=e.jn,de=e.jt,ce=e.kt,ue=e.li,le=e.mi,pe=e.pa,fe=e.pi,ye=e.r,ge=e.rt,me=e.s,we=e.vi,he=e.wn,Ne=e.ws,ke=e.xi,ve=e.xn,be=e.xr,Ie=e.y,xe=e.yi,Te=e.yr,Be=e.zr},function(e){He=e.Ac,e.Cr,Ce=e.Ha,Ee=e.Hi,_e=e.Ni,e.Nn,Oe=e.Rc,Se=e.Ua,De=e.Yc,Ue=e._a,Ae=e.da,We=e.ec,Pe=e.fa,e.gn,je=e.hr,Me=e.la,Ve=e.nc,Re=e.oa,Le=e.rc,Fe=e.rs,ze=e.so,$e=e.tc,qe=e.ua,Ge=e.xa,Je=e.xr},function(e){Ze=e.j,Ke=e.r},function(e){Ye=e.t},function(e){Qe=e.t},function(e){Xe=e.a,et=e.c,tt=e.i,ot=e.n,nt=e.o},function(e){rt=e.t},function(e){at=e.t},function(e){st=e.a,it=e.i,dt=e.n,ct=e.r,ut=e.t},function(e){lt=e.t},function(e){pt=e.t}],execute:function(){(ft=document.createElement("style")).textContent=".chat-button-wrapper-disabled{cursor:not-allowed}.chat-button{text-align:center;vertical-align:middle;user-select:none;padding:var(--chat--button--padding);font-size:var(--chat--button--font-size);line-height:var(--chat--button--line-height);border-radius:var(--chat--button--border-radius);transition:color var(--chat--transition-duration)ease-in-out,background-color var(--chat--transition-duration)ease-in-out,border-color var(--chat--transition-duration)ease-in-out,box-shadow var(--chat--transition-duration)ease-in-out;cursor:pointer;text-decoration:none;display:inline-flex}.chat-button:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,123,255,.25)}.chat-button-primary{color:var(--chat--button--color--primary);background-color:var(--chat--button--background--primary);border:var(--chat--button--border--primary)}.chat-button-primary:hover{color:var(--chat--button--color--primary--hover);background-color:var(--chat--button--background--primary--hover);border:var(--chat--button--border--primary--hover)}.chat-button-primary-disabled{pointer-events:none;color:var(--chat--button--color--primary--disabled);background-color:var(--chat--button--background--primary--disabled);border:var(--chat--button--border--primary--disabled)}.chat-button-secondary{color:var(--chat--button--color--secondary);background-color:var(--chat--button--background--secondary);border:var(--chat--button--border--secondary)}.chat-button-secondary:hover{color:var(--chat--button--color--secondary--hover);background-color:var(--chat--button--background--secondary--hover);border:var(--chat--button--border--secondary--hover)}.chat-button-secondary-disabled{pointer-events:none;color:var(--chat--button--color--secondary--disabled);background-color:var(--chat--button--background--secondary--disabled);border:var(--chat--button--border--secondary--disabled)}.chat-message-markdown{box-sizing:border-box;font-size:inherit;display:block}.chat-message-markdown>:first-child{margin-top:0}.chat-message-markdown>:last-child{margin-bottom:0}.chat-message-markdown pre{font-family:inherit;font-size:inherit;white-space:pre-wrap;box-sizing:border-box;padding:var(--chat--spacing);background:var(--chat--message--pre--background);border-radius:var(--chat--border-radius);margin:0}._buttons_1hb9q_125{gap:var(--chat--spacing);margin-top:var(--chat--spacing);display:flex}\n/*$vite$:1*/",document.head.appendChild(ft);try{t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},(d=(new t.Error).stack)&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[d]="e4f65ed2-1441-46be-996e-30f0a90fdbcf",t._sentryDebugIdIdentifier="sentry-dbid-e4f65ed2-1441-46be-996e-30f0a90fdbcf")}catch(t){}var t,d;yt=p({inheritAttrs:!1,__name:"Button",props:{type:{default:"primary"},element:{default:"button"},disabled:{type:Boolean,default:!1}},setup(e){const t=e,o=r((()=>`chat-button-${t.type}${t.disabled?"-disabled":""}`));return(n,r)=>(N(),s("span",{class:b({"chat-button-wrapper-disabled":t.disabled})},[(N(),f(h(e.element),y({class:["chat-button",o.value]},n.$attrs),{default:w((()=>[m(n.$slots,"default")])),_:3},16,["class"]))],2))}}),gt=yt,mt=o(_()),e("y",wt=p({__name:"MarkdownRenderer",props:{text:{}},setup(e){at.registerLanguage("javascript",it),at.registerLanguage("typescript",dt),at.registerLanguage("python",ct),at.registerLanguage("xml",ut),at.registerLanguage("bash",st);const t=e=>{e.use(mt.default,{attrs:{target:"_blank",rel:"noopener"}})},o={highlight(e,t){if(t&&at.getLanguage(t))try{return at.highlight(e,{language:t}).value}catch{}return""}};return(n,r)=>(N(),f(c(lt),{class:"chat-message-markdown",source:e.text,options:o,plugins:[t]},null,8,["source","plugins"]))}})),e("v",S(p({__name:"MessageWithButtons",props:{text:{},buttons:{}},setup(e){const t=u(null);return(o,n)=>(N(),s("div",null,[l(wt,{text:e.text},null,8,["text"]),I("div",{class:b(o.$style.buttons)},[(N(!0),s(g,null,k(e.buttons,((e,o)=>(N(),s(g,{key:e.text},[null===t.value||o===t.value?(N(),f(gt,{key:0,element:"button",type:e.type,disabled:o===t.value,onClick:n=>(async(e,o)=>{null===t.value&&(await fetch(e)).ok&&(t.value=o)})(e.link,o)},{default:w((()=>[v(a(e.text),1)])),_:2},1032,["type","disabled","onClick"])):i("",!0)],64)))),128))],2)]))}}),[["__cssModules",{$style:{buttons:"_buttons_1hb9q_125"}}]])),e("_",ht={WITH_BUTTONS:"with-buttons"}),ht.WITH_BUTTONS,e("g","Chat"),e("h","ChatOptions"),Nt="with-buttons",e("d",kt=function(){const e=new Map;function t(t,o){const n=e.get(t);n&&n.splice(n.indexOf(o)>>>0,1)}return{on:function(o,n){let r=e.get(o);return r?r.push(n):r=[n],e.set(o,r),()=>t(o,n)},off:t,emit:function(t,o){const n=e.get(t);n&&n.slice().forEach((async e=>{await e(o)}))}}}()),e("s","N8N_CANVAS_CHAT_HEIGHT"),e("c","N8N_CANVAS_CHAT_WIDTH"),e("o","N8N_LOGS_OVERVIEW_PANEL_WIDTH"),e("l",vt={CLOSED:"closed",ATTACHED:"attached",FLOATING:"floating"}),e("u",bt={INPUT:"input",OUTPUT:"output",BOTH:"both"}),e("a",It=Ze("logs",(()=>{const e=T(Ve,!1),t=u(!1),o=r((()=>e.value?t.value?vt.FLOATING:vt.ATTACHED:vt.CLOSED)),n=u(0),a=T(We,bt.OUTPUT,{writeDefaults:!1}),s=T($e,bt.BOTH,{writeDefaults:!1}),i=T(Le,!0,{writeDefaults:!1}),d=u(!1),c=L(),l=u(f()),p=u([]);function f(){return Be().replace(/-/g,"")}return{state:o,isOpen:r((()=>o.value!==vt.CLOSED)),detailsState:r((()=>d.value?s.value:a.value)),height:r((()=>n.value)),isLogSelectionSyncedWithCanvas:r((()=>i.value)),chatSessionId:r((()=>l.value)),chatSessionMessages:r((()=>p.value)),addChatMessage:function(e){p.value.push(e)},setHeight:function(e){n.value=e},toggleOpen:function(t){e.value=t??!e.value},setPreferPoppedOut:function(e){t.value=e},setSubNodeSelected:function(e){d.value=e},toggleInputOpen:function(e){const t=[bt.INPUT,bt.BOTH],o=d.value?s:a,n=t.includes(o.value);e!==n&&(o.value=n?bt.OUTPUT:bt.BOTH,c.track("User toggled log view sub pane",{pane:"input",newState:n?"hidden":"visible",isSubNode:d.value}))},toggleOutputOpen:function(e){const t=[bt.OUTPUT,bt.BOTH],o=d.value?s:a,n=t.includes(o.value);e!==n&&(o.value=n?bt.INPUT:bt.BOTH,c.track("User toggled log view sub pane",{pane:"output",newState:n?"hidden":"visible",isSubNode:d.value}))},toggleLogSelectionSync:function(e){i.value=e??!i.value},resetChatSessionId:function(){l.value=f()},resetMessages:function(){p.value=[]}}}))),xt=n(((e,t)=>{var o=Ee();t.exports=function(e){return e&&e.length?o(e):[]}})),e("i",Tt=Ze("experimentalNdv",(()=>{const e=me(),t=P(),o=r((()=>t.getVariant(He.name)===He.variant)),n=r((()=>t.getVariant(Oe.name)===Oe.variant)),a=r((()=>o.value?2:4)),s=u(),i=x({}),d=u(),c=u(!1);function l(e){return o.value&&Math.abs(e-a.value)<1e-6}function p(e,{canvasDimensions:t,canvasViewport:o,setCenter:n}){i.value={...i.value,[e.id]:!1};const r=e.dimensions.width*(l(o.zoom)?1:1.5);d.value===e.data.name&&(d.value=void 0),n(e.position.x+r/2,e.position.y+(.5*t.height-80)/a.value,{duration:200,zoom:a.value,interpolate:"linear"})}return{isZoomedViewEnabled:o,isNdvInFocusPanelEnabled:n,maxCanvasZoom:a,previousZoom:r((()=>s.value)),collapsedNodes:r((()=>i.value)),nodeNameToBeFocused:r((()=>d.value)),isMapperOpen:r((()=>c.value)),isActive:l,setNodeExpanded:function(e,t){i.value={...i.value,[e]:void 0===t?!i.value[e]:!t}},expandAllNodes:function(){i.value={}},collapseAllNodes:function(){i.value=e.allNodes.reduce(((e,t)=>(e[t.id]=!0,e)),{})},toggleZoomMode:function(e){if(l(e.canvasViewport.zoom))return void 0===s.value?void e.fitView({duration:200,interpolate:"linear"}):void e.setViewport(s.value,{duration:200,interpolate:"linear"});s.value=e.canvasViewport;const t=e.selectedNodes.filter((e=>e.data.render.type===re.Default)).toSorted(((e,t)=>e.position.y===t.position.y?e.position.x-t.position.x:e.position.y-t.position.y))[0];t?p(t,e):e.zoomTo(a.value,{duration:200,interpolate:"linear"})},focusNode:p,setNodeNameToBeFocused:function(e){d.value=e},setMapperOpen:function(e){c.value=e}}}))),e("r",Bt=E()),Ht=o(_e(),1),Ct=o(xt(),1)}}}));
//# sourceMappingURL=useCanvasOperations-legacy-CEMGNuuE.js.map