(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`52dad430-ec7a-4959-bafc-eb6dadeb660e`,e._sentryDebugIdIdentifier=`sentry-dbid-52dad430-ec7a-4959-bafc-eb6dadeb660e`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{C as t,Cn as n,Ct as r,D as i,E as a,G as o,Gt as s,I as c,It as l,L as u,Lt as d,M as f,Mt as p,P as m,T as h,Ut as g,W as _,_ as v,_t as y,at as b,bn as x,bt as S,ct as C,et as w,h as T,it as E,j as D,l as O,lt as k,ot as A,pt as j,rt as M,st as N,tt as P,vn as F,w as I,xt as L,yn as R}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{bt as z,h as ee,yt as B}from"./_MapCache-DjbOQyB7.js";import{Bi as V,Hi as H,Oi as U,Ui as W,Vi as te,gi as G,wi as ne}from"./src-CppJvwzX.js";import{t as K}from"./_plugin-vue_export-helper-B_J4Khre.js";import{Bt as q,C as re,It as ie,Lt as ae,Oi as oe,Or as se,Pt as ce,Tr as le,Vt as ue,at as de,ct as fe,ga as pe,lt as me,oa as he,r as ge,s as J,ws as _e,xr as ve,yr as ye}from"./users.store-pCkD7Zo0.js";import{Bo as be,C as xe,Cr as Se,Gt as Ce,P as we,Ri as Te,Ss as Ee,Yc as De,as as Oe,fo as Y,gn as ke,hs as Ae,jn as je,mo as Me,oo as Ne,po as X,so as Z,vi as Pe}from"./constants-D1jZwsUK.js";import{r as Fe}from"./_baseOrderBy-El3qbNHQ.js";import{i as Ie,o as Le,r as Re,t as ze}from"./NDVEmptyState-Cd-QhxaI.js";import{t as Be}from"./usePinnedData-C6FFXoty.js";import{t as Ve}from"./Draggable-YWqutRc8.js";import{t as He}from"./NodeIcon-Dv1e4Lvu.js";import{t as Ue}from"./TextWithHighlights-FXXrxJMD.js";import{t as We}from"./useCalloutHelpers-BqZQxC7j.js";import{n as Ge,t as Ke}from"./useTelemetryContext-Dq1_6uNp.js";import{i as qe,t as Je}from"./useRunWorkflow-DzzlHC01.js";import{o as Ye}from"./nodeTransforms-CG9uauaw.js";var Xe={class:`schema-header-wrapper`},Ze={class:`schema-header`,"data-test-id":`run-data-schema-header`},Qe={class:`title`},$e={key:0,class:`info`},et={key:2,class:`extra-info`,"data-test-id":`run-data-schema-node-item-count`},tt={key:3,class:`extra-info`},nt=K(m({__name:`VirtualSchemaHeader`,props:{title:{},collapsable:{type:Boolean},collapsed:{type:Boolean},itemCount:{},info:{},nodeType:{},preview:{type:Boolean},lastSuccessfulPreview:{type:Boolean}},emits:[`click:toggle`,`execute`],setup(e,{emit:r}){let o=e,c=B(),l=t(()=>!!o.nodeType?.group.includes(`trigger`)),u=r;return(t,r)=>(w(),i(`div`,Xe,[I(`div`,Ze,[I(`div`,{class:`toggle`,onClickCapture:r[0]||=T(e=>u(`click:toggle`),[`stop`])},[f(s(W),{size:`medium`,icon:`chevron-down`,class:F({"collapse-icon":!0,collapsed:e.collapsed})},null,8,[`class`])],32),e.nodeType?(w(),h(He,{key:0,class:F([`icon`,{"icon-trigger":l.value}]),"node-type":e.nodeType,size:12},null,8,[`class`,`node-type`])):a(``,!0),I(`div`,Qe,[D(n(e.title)+` `,1),e.info?(w(),i(`span`,$e,n(e.info),1)):a(``,!0)]),l.value?(w(),h(s(W),{key:1,class:`trigger-icon`,icon:`bolt-filled`,size:`xsmall`})):a(``,!0),e.itemCount&&!e.lastSuccessfulPreview?(w(),i(`div`,et,n(s(c).baseText(`ndv.output.items`,{interpolate:{count:e.itemCount}})),1)):e.preview?(w(),i(`div`,tt,n(s(c).baseText(`dataMapping.schemaView.previewNode`)),1)):a(``,!0)]),e.preview&&!e.collapsed?(w(),i(`div`,{key:0,class:`notice`,"data-test-id":`schema-preview-warning`,onClick:r[3]||=T(()=>{},[`stop`])},[e.lastSuccessfulPreview?(w(),h(s(z),{key:0,keypath:`dataMapping.schemaView.previewLastExecution`,scope:`global`},{execute:S(()=>[f(s(G),{onClick:r[1]||=()=>u(`execute`,e.title),size:`small`,bold:``},{default:S(()=>[D(n(s(c).baseText(`dataMapping.schemaView.previewLastExecution.executePreviousNodes`)),1)]),_:1})]),_:1})):(w(),h(s(z),{key:1,keypath:`dataMapping.schemaView.preview`,scope:`global`},{execute:S(()=>[f(s(G),{onClick:r[2]||=()=>u(`execute`,e.title),size:`small`,bold:``},{default:S(()=>[D(n(s(c).baseText(`dataMapping.schemaView.preview.executeNode`)),1)]),_:1})]),link:S(()=>[f(s(G),{to:s(xe),size:`small`,bold:``},{default:S(()=>[D(n(s(c).baseText(`generic.learnMore`)),1)]),_:1},8,[`to`])]),_:1}))])):a(``,!0)]))}}),[[`__scopeId`,`data-v-81c3a2d5`]]),rt=se(),it={class:`toggle-container`},at=[`data-name`,`data-path`,`data-depth`,`data-nest-level`,`data-value`,`data-node-type`,`data-target`,`data-node-name`,`data-run-index`],ot={key:2,class:`binary-controls`},st=K(m({__name:`VirtualSchemaItem`,props:{title:{},path:{},level:{},depth:{},expression:{},value:{},id:{},icon:{},collapsable:{type:Boolean},nodeName:{},nodeType:{},highlight:{type:Boolean},draggable:{type:Boolean},collapsed:{type:Boolean},search:{},preview:{type:Boolean},locked:{type:Boolean},lockedTooltip:{},runIndex:{},binaryData:{}},emits:[`click`],setup(e,{emit:t}){O(e=>({bae8c388:e.level}));let n=e,r=B();async function o(){if(n.binaryData)try{let{id:e,fileName:t,mimeType:r,fileExtension:i}=n.binaryData,a=J().getBinaryUrl(e,`download`,t??``,r),o=t??`file`;!o.includes(`.`)&&i&&(o=[o,i].join(`.`));let s=await fetch(a);if(!s.ok)throw Error(`Error downloading file`);(0,rt.saveAs)(await s.blob(),o)}catch{ye().showMessage({title:r.baseText(`runData.downloadBinaryData.error.title`),message:r.baseText(`runData.downloadBinaryData.error.message`),type:`error`})}}function c(){ge().openModalWithData({name:Oe,data:{binaryData:n.binaryData}})}let l=t;return(t,r)=>{let u=N(`n8n-html`);return w(),i(`div`,{class:F([`schema-item`,{draggable:e.draggable}]),"data-test-id":`run-data-schema-item`},[I(`div`,it,[e.collapsable?(w(),i(`div`,{key:0,class:`toggle`,onClick:r[0]||=e=>l(`click`)},[f(s(W),{icon:`chevron-down`,class:F({"collapse-icon":!0,collapsed:e.collapsed})},null,8,[`class`])])):a(``,!0)]),e.title?(w(),i(`div`,{key:0,"data-name":e.title,"data-path":e.path,"data-depth":e.depth,"data-nest-level":e.level,"data-value":e.expression,"data-node-type":e.nodeType,"data-target":!e.locked&&`mappable`,"data-node-name":e.nodeName,"data-run-index":e.runIndex,class:F([`pill`,{"pill--highlight":e.highlight,"pill--preview":e.preview,"pill--locked":e.locked}]),"data-test-id":`run-data-schema-node-name`},[f(s(W),{class:`type-icon`,icon:e.icon,size:`small`},null,8,[`icon`]),f(Ue,{class:`title`,content:e.title,search:n.search},null,8,[`content`,`search`])],10,at)):a(``,!0),e.locked?(w(),h(s(U),{key:1,disabled:!e.lockedTooltip,"content-class":t.$style.tooltip},{content:S(()=>[L(I(`span`,null,null,512),[[u,e.lockedTooltip]])]),default:S(()=>[f(s(W),{class:`locked-icon`,icon:`lock`,size:`small`})]),_:1},8,[`disabled`,`content-class`])):a(``,!0),f(Ue,{"data-test-id":`run-data-schema-item-value`,class:`text`,content:e.value,search:n.search},null,8,[`content`,`search`]),n.binaryData&&!e.preview?(w(),i(`div`,ot,[I(`div`,{class:F([`pill binary-control-pill`,{"pill--highlight":e.highlight,"pill--preview":e.preview,"pill--locked":e.locked}]),onClick:o},[f(s(W),{class:`type-icon`,icon:`download`,size:`small`})],2),I(`div`,{class:F([`pill binary-control-pill`,{"pill--highlight":e.highlight,"pill--preview":e.preview,"pill--locked":e.locked}]),onClick:c},[f(s(W),{class:`type-icon`,icon:`eye`,size:`small`})],2)])):a(``,!0)],2)}}}),[[`__cssModules`,{$style:{tooltip:`_tooltip_1e5yq_2`}}],[`__scopeId`,`data-v-5ae9241a`]]);function ct(){var e=window.navigator.userAgent,t=e.indexOf(`MSIE `);if(t>0)return parseInt(e.substring(t+5,e.indexOf(`.`,t)),10);if(e.indexOf(`Trident/`)>0){var n=e.indexOf(`rv:`);return parseInt(e.substring(n+3,e.indexOf(`.`,n)),10)}var r=e.indexOf(`Edge/`);return r>0?parseInt(e.substring(r+5,e.indexOf(`.`,r)),10):-1}var Q;function lt(){lt.init||(lt.init=!0,Q=ct()!==-1)}var $={name:`ResizeObserver`,props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},emits:[`notify`],mounted(){lt(),o(()=>{this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitOnMount&&this.emitSize()});let e=document.createElement(`object`);this._resizeObject=e,e.setAttribute(`aria-hidden`,`true`),e.setAttribute(`tabindex`,-1),e.onload=this.addResizeHandlers,e.type=`text/html`,Q&&this.$el.appendChild(e),e.data=`about:blank`,Q||this.$el.appendChild(e)},beforeUnmount(){this.removeResizeHandlers()},methods:{compareAndNotify(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize(){this.$emit(`notify`,{width:this._w,height:this._h})},addResizeHandlers(){this._resizeObject.contentDocument.defaultView.addEventListener(`resize`,this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers(){this._resizeObject&&this._resizeObject.onload&&(!Q&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener(`resize`,this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}},ut=r(`data-v-b329ee4c`);M(`data-v-b329ee4c`);var dt={class:`resize-observer`,tabindex:`-1`};P(),$.render=ut((e,t,n,r,i,a)=>(w(),h(`div`,dt))),$.__scopeId=`data-v-b329ee4c`,$.__file=`src/components/ResizeObserver.vue`;function ft(e){"@babel/helpers - typeof";return ft=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},ft(e)}function pt(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ht(e,t,n){return t&&mt(e.prototype,t),n&&mt(e,n),e}function gt(e){return _t(e)||vt(e)||yt(e)||xt()}function _t(e){if(Array.isArray(e))return bt(e)}function vt(e){if(typeof Symbol<`u`&&Symbol.iterator in Object(e))return Array.from(e)}function yt(e,t){if(e){if(typeof e==`string`)return bt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`)return Array.from(e);if(n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bt(e,t)}}function bt(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function xt(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function St(e){return typeof e==`function`?{callback:e}:e}function Ct(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,i,a,o=function(o){if(a=[...arguments].slice(1),!(r&&o===i)){var s=n.leading;typeof s==`function`&&(s=s(o,i)),(!r||o!==i)&&s&&e.apply(void 0,[o].concat(gt(a))),i=o,clearTimeout(r),r=setTimeout(function(){e.apply(void 0,[o].concat(gt(a))),r=0},t)}};return o._clear=function(){clearTimeout(r),r=null},o}function wt(e,t){if(e===t)return!0;if(ft(e)===`object`){for(var n in e)if(!wt(e[n],t[n]))return!1;return!0}return!1}var Tt=function(){function e(t,n,r){pt(this,e),this.el=t,this.observer=null,this.frozen=!1,this.createObserver(n,r)}return ht(e,[{key:`createObserver`,value:function(e,t){var n=this;if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=St(e),this.callback=function(e,t){n.options.callback(e,t),e&&n.options.once&&(n.frozen=!0,n.destroyObserver())},this.callback&&this.options.throttle){var r=(this.options.throttleOptions||{}).leading;this.callback=Ct(this.callback,this.options.throttle,{leading:function(e){return r===`both`||r===`visible`&&e||r===`hidden`&&!e}})}this.oldResult=void 0,this.observer=new IntersectionObserver(function(e){var t=e[0];if(e.length>1){var r=e.find(function(e){return e.isIntersecting});r&&(t=r)}if(n.callback){var i=t.isIntersecting&&t.intersectionRatio>=n.threshold;if(i===n.oldResult)return;n.oldResult=i,n.callback(i,t)}},this.options.intersection),o(function(){n.observer&&n.observer.observe(n.el)})}}},{key:`destroyObserver`,value:function(){this.observer&&=(this.observer.disconnect(),null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:`threshold`,get:function(){return this.options.intersection&&typeof this.options.intersection.threshold==`number`?this.options.intersection.threshold:0}}]),e}();function Et(e,t,n){var r=t.value;r&&(typeof IntersectionObserver>`u`?console.warn(`[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill`):e._vue_visibilityState=new Tt(e,r,n))}function Dt(e,t,n){var r=t.value,i=t.oldValue;if(!wt(r,i)){var a=e._vue_visibilityState;if(!r){Ot(e);return}a?a.createObserver(r,n):Et(e,{value:r},n)}}function Ot(e){var t=e._vue_visibilityState;t&&(t.destroyObserver(),delete e._vue_visibilityState)}var kt={beforeMount:Et,updated:Dt,unmounted:Ot};function At(e){return{all:e||=new Map,on:function(t,n){var r=e.get(t);r&&r.push(n)||e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&r.splice(r.indexOf(n)>>>0,1)},emit:function(t,n){(e.get(t)||[]).slice().map(function(e){e(n)}),(e.get(`*`)||[]).slice().map(function(e){e(t,n)})}}}var jt={itemsLimit:1e3},Mt=/(auto|scroll)/;function Nt(e,t){return e.parentNode===null?t:Nt(e.parentNode,t.concat([e]))}var Pt=function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},Ft=function(e){return Pt(e,`overflow`)+Pt(e,`overflow-y`)+Pt(e,`overflow-x`)},It=function(e){return Mt.test(Ft(e))};function Lt(e){if(e instanceof HTMLElement||e instanceof SVGElement){for(var t=Nt(e.parentNode,[]),n=0;n<t.length;n+=1)if(It(t[n]))return t[n];return document.scrollingElement||document.documentElement}}function Rt(e){"@babel/helpers - typeof";return Rt=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},Rt(e)}var zt={items:{type:Array,required:!0},keyField:{type:String,default:`id`},direction:{type:String,default:`vertical`,validator:function(e){return[`vertical`,`horizontal`].includes(e)}},listTag:{type:String,default:`div`},itemTag:{type:String,default:`div`}};function Bt(){return this.items.length&&Rt(this.items[0])!==`object`}var Vt=!1;if(typeof window<`u`){Vt=!1;try{var Ht=Object.defineProperty({},`passive`,{get:function(){Vt=!0}});window.addEventListener(`test`,null,Ht)}catch{}}var Ut=0,Wt={name:`RecycleScroller`,components:{ResizeObserver:$},directives:{ObserveVisibility:kt},props:{...zt,itemSize:{type:Number,default:null},gridItems:{type:Number,default:void 0},itemSecondarySize:{type:Number,default:void 0},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:`size`},typeField:{type:String,default:`type`},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1},updateInterval:{type:Number,default:0},skipHover:{type:Boolean,default:!1},listTag:{type:String,default:`div`},itemTag:{type:String,default:`div`},listClass:{type:[String,Object,Array],default:``},itemClass:{type:[String,Object,Array],default:``}},emits:[`resize`,`visible`,`hidden`,`update`,`scroll-start`,`scroll-end`],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){let e={"-1":{accumulator:0}},t=this.items,n=this.sizeField,r=this.minItemSize,i=1e4,a=0,o;for(let s=0,c=t.length;s<c;s++)o=t[s][n]||r,o<i&&(i=o),a+=o,e[s]={accumulator:a,size:o};return this.$_computedMinItemSize=i,e}return[]},simpleArray:Bt,itemIndexByKey(){let{keyField:e,items:t}=this,n={};for(let r=0,i=t.length;r<i;r++)n[t[r][e]]=r;return n}},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0},gridItems(){this.updateVisibleItems(!0)},itemSecondarySize(){this.updateVisibleItems(!0)}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1)),this.gridItems&&!this.itemSize&&console.error(`[vue-recycle-scroller] You must provide an itemSize when using gridItems`)},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},activated(){let e=this.$_lastUpdateScrollPosition;typeof e==`number`&&this.$nextTick(()=>{this.scrollToPosition(e)})},beforeUnmount(){this.removeListeners()},methods:{addView(e,t,n,r,i){let a=d({item:n,position:0,nr:p({id:Ut++,index:t,used:!0,key:r,type:i})});return e.push(a),a},unuseView(e,t=!1){let n=this.$_unusedViews,r=e.nr.type,i=n.get(r);i||(i=[],n.set(r,i)),i.push(e),t||(e.nr.used=!1,e.position=-9999)},handleResize(){this.$emit(`resize`),this.ready&&this.updateVisibleItems(!1)},handleScroll(e){if(!this.$_scrollDirty){if(this.$_scrollDirty=!0,this.$_updateTimeout)return;let e=()=>requestAnimationFrame(()=>{this.$_scrollDirty=!1;let{continuous:e}=this.updateVisibleItems(!1,!0);e||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,this.updateInterval+100))});e(),this.updateInterval&&(this.$_updateTimeout=setTimeout(()=>{this.$_updateTimeout=0,this.$_scrollDirty&&e()},this.updateInterval))}},handleVisibilityChange(e,t){this.ready&&(e||t.boundingClientRect.width!==0||t.boundingClientRect.height!==0?(this.$emit(`visible`),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit(`hidden`))},updateVisibleItems(e,t=!1){let n=this.itemSize,r=this.gridItems||1,i=this.itemSecondarySize||n,a=this.$_computedMinItemSize,o=this.typeField,s=this.simpleArray?null:this.keyField,c=this.items,l=c.length,u=this.sizes,d=this.$_views,f=this.$_unusedViews,p=this.pool,m=this.itemIndexByKey,h,g,_,v,y;if(!l)h=g=v=y=_=0;else if(this.$_prerender)h=v=0,g=y=Math.min(this.prerender,c.length),_=null;else{let e=this.getScroll();if(t){let t=e.start-this.$_lastUpdateScrollPosition;if(t<0&&(t=-t),n===null&&t<a||t<n)return{continuous:!0}}this.$_lastUpdateScrollPosition=e.start;let i=this.buffer;e.start-=i,e.end+=i;let o=0;if(this.$refs.before&&(o=this.$refs.before.scrollHeight,e.start-=o),this.$refs.after){let t=this.$refs.after.scrollHeight;e.end+=t}if(n===null){let t,n=0,r=l-1,i=~~(l/2),a;do a=i,t=u[i].accumulator,t<e.start?n=i:i<l-1&&u[i+1].accumulator>e.start&&(r=i),i=~~((n+r)/2);while(i!==a);for(i<0&&(i=0),h=i,_=u[l-1].accumulator,g=i;g<l&&u[g].accumulator<e.end;g++);for(g===-1?g=c.length-1:(g++,g>l&&(g=l)),v=h;v<l&&o+u[v].accumulator<e.start;v++);for(y=v;y<l&&o+u[y].accumulator<e.end;y++);}else{h=~~(e.start/n*r);let t=h%r;h-=t,g=Math.ceil(e.end/n*r),v=Math.max(0,Math.floor((e.start-o)/n*r)),y=Math.floor((e.end-o)/n*r),h<0&&(h=0),g>l&&(g=l),v<0&&(v=0),y>l&&(y=l),_=Math.ceil(l/r)*n}}g-h>jt.itemsLimit&&this.itemsLimitError(),this.totalSize=_;let b,x=h<=this.$_endIndex&&g>=this.$_startIndex;if(x)for(let t=0,n=p.length;t<n;t++)b=p[t],b.nr.used&&(e&&(b.nr.index=m[b.item[s]]),(b.nr.index==null||b.nr.index<h||b.nr.index>=g)&&this.unuseView(b));let S=x?null:new Map,C,w,T;for(let e=h;e<g;e++){C=c[e];let t=s?C[s]:C;if(t==null)throw Error(`Key is ${t} on item (keyField is '${s}')`);if(b=d.get(t),!n&&!u[e].size){b&&this.unuseView(b);continue}w=C[o];let a=f.get(w),l=!1;if(!b)x?b=a&&a.length?a.pop():this.addView(p,e,C,t,w):(T=S.get(w)||0,(!a||T>=a.length)&&(b=this.addView(p,e,C,t,w),this.unuseView(b,!0),a=f.get(w)),b=a[T],S.set(w,T+1)),d.delete(b.nr.key),b.nr.used=!0,b.nr.index=e,b.nr.key=t,b.nr.type=w,d.set(t,b),l=!0;else if(!b.nr.used&&(b.nr.used=!0,l=!0,a)){let e=a.indexOf(b);e!==-1&&a.splice(e,1)}b.item=C,l&&(e===c.length-1&&this.$emit(`scroll-end`),e===0&&this.$emit(`scroll-start`)),n===null?(b.position=u[e-1].accumulator,b.offset=0):(b.position=Math.floor(e/r)*n,b.offset=e%r*i)}return this.$_startIndex=h,this.$_endIndex=g,this.emitUpdate&&this.$emit(`update`,h,g,v,y),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,this.updateInterval+300),{continuous:x}},getListenerTarget(){let e=Lt(this.$el);return window.document&&(e===window.document.documentElement||e===window.document.body)&&(e=window),e},getScroll(){let{$el:e,direction:t}=this,n=t===`vertical`,r;if(this.pageMode){let t=e.getBoundingClientRect(),i=n?t.height:t.width,a=-(n?t.top:t.left),o=n?window.innerHeight:window.innerWidth;a<0&&(o+=a,a=0),a+o>i&&(o=i-a),r={start:a,end:a+o}}else r=n?{start:e.scrollTop,end:e.scrollTop+e.clientHeight}:{start:e.scrollLeft,end:e.scrollLeft+e.clientWidth};return r},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener(`scroll`,this.handleScroll,Vt?{passive:!0}:!1),this.listenerTarget.addEventListener(`resize`,this.handleResize)},removeListeners(){this.listenerTarget&&=(this.listenerTarget.removeEventListener(`scroll`,this.handleScroll),this.listenerTarget.removeEventListener(`resize`,this.handleResize),null)},scrollToItem(e){let t,n=this.gridItems||1;t=this.itemSize===null?e>0?this.sizes[e-1].accumulator:0:Math.floor(e/n)*this.itemSize,this.scrollToPosition(t)},scrollToPosition(e){let t=this.direction===`vertical`?{scroll:`scrollTop`,start:`top`}:{scroll:`scrollLeft`,start:`left`},n,r,i;if(this.pageMode){let a=Lt(this.$el),o=a.tagName===`HTML`?0:a[t.scroll],s=a.getBoundingClientRect(),c=this.$el.getBoundingClientRect()[t.start]-s[t.start];n=a,r=t.scroll,i=e+o+c}else n=this.$el,r=t.scroll,i=e;n[r]=i},itemsLimitError(){throw setTimeout(()=>{console.log(`It seems the scroller element isn't scrolling, so it tries to render all the items at once.`,`Scroller:`,this.$el),console.log(`Make sure the scroller has a fixed height (or width) and 'overflow-y' (or 'overflow-x') set to 'auto' so it can scroll correctly and only render the items visible in the scroll viewport.`)}),Error(`Rendered items limit reached`)},sortViews(){this.pool.sort((e,t)=>e.nr.index-t.nr.index)}}},Gt={key:0,ref:`before`,class:`vue-recycle-scroller__slot`},Kt={key:1,ref:`after`,class:`vue-recycle-scroller__slot`};function qt(e,t,n,r,o,s){let c=A(`ResizeObserver`),l=N(`observe-visibility`);return L((w(),i(`div`,{class:F([`vue-recycle-scroller`,{ready:o.ready,"page-mode":n.pageMode,[`direction-${e.direction}`]:!0}]),onScrollPassive:t[0]||=(...e)=>s.handleScroll&&s.handleScroll(...e)},[e.$slots.before?(w(),i(`div`,Gt,[b(e.$slots,`before`)],512)):a(`v-if`,!0),(w(),h(C(n.listTag),{ref:`wrapper`,style:x({[e.direction===`vertical`?`minHeight`:`minWidth`]:o.totalSize+`px`}),class:F([`vue-recycle-scroller__item-wrapper`,n.listClass])},{default:S(()=>[(w(!0),i(v,null,E(o.pool,t=>(w(),h(C(n.itemTag),_({key:t.nr.id,style:o.ready?{transform:`translate${e.direction===`vertical`?`Y`:`X`}(${t.position}px) translate${e.direction===`vertical`?`X`:`Y`}(${t.offset}px)`,width:n.gridItems?`${e.direction===`vertical`&&n.itemSecondarySize||n.itemSize}px`:void 0,height:n.gridItems?`${e.direction===`horizontal`&&n.itemSecondarySize||n.itemSize}px`:void 0}:null,class:[`vue-recycle-scroller__item-view`,[n.itemClass,{hover:!n.skipHover&&o.hoverKey===t.nr.key}]]},k(n.skipHover?{}:{mouseenter:()=>{o.hoverKey=t.nr.key},mouseleave:()=>{o.hoverKey=null}})),{default:S(()=>[b(e.$slots,`default`,{item:t.item,index:t.nr.index,active:t.nr.used})]),_:2},1040,[`style`,`class`]))),128)),b(e.$slots,`empty`)]),_:3},8,[`style`,`class`])),e.$slots.after?(w(),i(`div`,Kt,[b(e.$slots,`after`)],512)):a(`v-if`,!0),f(c,{onNotify:s.handleResize},null,8,[`onNotify`])],34)),[[l,s.handleVisibilityChange]])}Wt.render=qt,Wt.__file=`src/components/RecycleScroller.vue`;var Jt={name:`DynamicScroller`,components:{RecycleScroller:Wt},provide(){return typeof ResizeObserver<`u`&&(this.$_resizeObserver=new ResizeObserver(e=>{requestAnimationFrame(()=>{if(Array.isArray(e)){for(let t of e)if(t.target&&t.target.$_vs_onResize){let e,n;if(t.borderBoxSize){let r=t.borderBoxSize[0];e=r.inlineSize,n=r.blockSize}else e=t.contentRect.width,n=t.contentRect.height;t.target.$_vs_onResize(t.target.$_vs_id,e,n)}}})})),{vscrollData:this.vscrollData,vscrollParent:this,vscrollResizeObserver:this.$_resizeObserver}},inheritAttrs:!1,props:{...zt,minItemSize:{type:[Number,String],required:!0}},emits:[`resize`,`visible`],data(){return{vscrollData:{active:!0,sizes:{},keyField:this.keyField,simpleArray:!1}}},computed:{simpleArray:Bt,itemsWithSize(){let e=[],{items:t,keyField:n,simpleArray:r}=this,i=this.vscrollData.sizes,a=t.length;for(let o=0;o<a;o++){let a=t[o],s=r?o:a[n],c=i[s];c===void 0&&!this.$_undefinedMap[s]&&(c=0),e.push({item:a,id:s,size:c})}return e}},watch:{items(){this.forceUpdate()},simpleArray:{handler(e){this.vscrollData.simpleArray=e},immediate:!0},direction(e){this.forceUpdate(!0)},itemsWithSize(e,t){let n=this.$el.scrollTop,r=0,i=0,a=Math.min(e.length,t.length);for(let o=0;o<a&&!(r>=n);o++)r+=t[o].size||this.minItemSize,i+=e[o].size||this.minItemSize;let o=i-r;o!==0&&(this.$el.scrollTop+=o)}},beforeCreate(){this.$_updates=[],this.$_undefinedSizes=0,this.$_undefinedMap={},this.$_events=At()},activated(){this.vscrollData.active=!0},deactivated(){this.vscrollData.active=!1},unmounted(){this.$_events.all.clear()},methods:{onScrollerResize(){this.$refs.scroller&&this.forceUpdate(),this.$emit(`resize`)},onScrollerVisible(){this.$_events.emit(`vscroll:update`,{force:!1}),this.$emit(`visible`)},forceUpdate(e=!1){(e||this.simpleArray)&&(this.vscrollData.sizes={}),this.$_events.emit(`vscroll:update`,{force:!0})},scrollToItem(e){let t=this.$refs.scroller;t&&t.scrollToItem(e)},getItemSize(e,t=void 0){let n=this.simpleArray?t??this.items.indexOf(e):e[this.keyField];return this.vscrollData.sizes[n]||0},scrollToBottom(){if(this.$_scrollingToBottom)return;this.$_scrollingToBottom=!0;let e=this.$el;this.$nextTick(()=>{e.scrollTop=e.scrollHeight+5e3;let t=()=>{e.scrollTop=e.scrollHeight+5e3,requestAnimationFrame(()=>{e.scrollTop=e.scrollHeight+5e3,this.$_undefinedSizes===0?this.$_scrollingToBottom=!1:requestAnimationFrame(t)})};requestAnimationFrame(t)})}}};function Yt(e,t,n,r,i,a){let o=A(`RecycleScroller`);return w(),h(o,_({ref:`scroller`,items:a.itemsWithSize,"min-item-size":n.minItemSize,direction:e.direction,"key-field":`id`,"list-tag":e.listTag,"item-tag":e.itemTag},e.$attrs,{onResize:a.onScrollerResize,onVisible:a.onScrollerVisible}),{default:S(({item:t,index:n,active:r})=>[b(e.$slots,`default`,R(c({item:t.item,index:n,active:r,itemWithSize:t})))]),before:S(()=>[b(e.$slots,`before`)]),after:S(()=>[b(e.$slots,`after`)]),empty:S(()=>[b(e.$slots,`empty`)]),_:3},16,[`items`,`min-item-size`,`direction`,`list-tag`,`item-tag`,`onResize`,`onVisible`])}Jt.render=Yt,Jt.__file=`src/components/DynamicScroller.vue`;var Xt={name:`DynamicScrollerItem`,inject:[`vscrollData`,`vscrollParent`,`vscrollResizeObserver`],props:{item:{required:!0},watchData:{type:Boolean,default:!1},active:{type:Boolean,required:!0},index:{type:Number,default:void 0},sizeDependencies:{type:[Array,Object],default:null},emitResize:{type:Boolean,default:!1},tag:{type:String,default:`div`}},emits:[`resize`],computed:{id(){if(this.vscrollData.simpleArray)return this.index;if(this.vscrollData.keyField in this.item)return this.item[this.vscrollData.keyField];throw Error(`keyField '${this.vscrollData.keyField}' not found in your item. You should set a valid keyField prop on your Scroller`)},size(){return this.vscrollData.sizes[this.id]||0},finalActive(){return this.active&&this.vscrollData.active}},watch:{watchData:`updateWatchData`,id(e,t){if(this.$el.$_vs_id=this.id,this.size||this.onDataUpdate(),this.$_sizeObserved){let n=this.vscrollData.sizes[t],r=this.vscrollData.sizes[e];n!=null&&n!==r&&this.applySize(n)}},finalActive(e){this.size||(e?this.vscrollParent.$_undefinedMap[this.id]||(this.vscrollParent.$_undefinedSizes++,this.vscrollParent.$_undefinedMap[this.id]=!0):this.vscrollParent.$_undefinedMap[this.id]&&(this.vscrollParent.$_undefinedSizes--,this.vscrollParent.$_undefinedMap[this.id]=!1)),this.vscrollResizeObserver?e?this.observeSize():this.unobserveSize():e&&this.$_pendingVScrollUpdate===this.id&&this.updateSize()}},created(){if(!this.$isServer&&(this.$_forceNextVScrollUpdate=null,this.updateWatchData(),!this.vscrollResizeObserver)){for(let e in this.sizeDependencies)this.$watch(()=>this.sizeDependencies[e],this.onDataUpdate);this.vscrollParent.$_events.on(`vscroll:update`,this.onVscrollUpdate)}},mounted(){this.finalActive&&(this.updateSize(),this.observeSize())},beforeUnmount(){this.vscrollParent.$_events.off(`vscroll:update`,this.onVscrollUpdate),this.unobserveSize()},methods:{updateSize(){this.finalActive?this.$_pendingSizeUpdate!==this.id&&(this.$_pendingSizeUpdate=this.id,this.$_forceNextVScrollUpdate=null,this.$_pendingVScrollUpdate=null,this.computeSize(this.id)):this.$_forceNextVScrollUpdate=this.id},updateWatchData(){this.watchData&&!this.vscrollResizeObserver?this.$_watchData=this.$watch(`item`,()=>{this.onDataUpdate()},{deep:!0}):this.$_watchData&&=(this.$_watchData(),null)},onVscrollUpdate({force:e}){!this.finalActive&&e&&(this.$_pendingVScrollUpdate=this.id),(this.$_forceNextVScrollUpdate===this.id||e||!this.size)&&this.updateSize()},onDataUpdate(){this.updateSize()},computeSize(e){this.$nextTick(()=>{if(this.id===e){let e=this.$el.offsetWidth,t=this.$el.offsetHeight;this.applyWidthHeight(e,t)}this.$_pendingSizeUpdate=null})},applyWidthHeight(e,t){let n=~~(this.vscrollParent.direction===`vertical`?t:e);n&&this.size!==n&&this.applySize(n)},applySize(e){this.vscrollParent.$_undefinedMap[this.id]&&(this.vscrollParent.$_undefinedSizes--,this.vscrollParent.$_undefinedMap[this.id]=void 0),this.vscrollData.sizes[this.id]=e,this.emitResize&&this.$emit(`resize`,this.id)},observeSize(){this.vscrollResizeObserver&&(this.$_sizeObserved||=(this.vscrollResizeObserver.observe(this.$el),this.$el.$_vs_id=this.id,this.$el.$_vs_onResize=this.onResize,!0))},unobserveSize(){this.vscrollResizeObserver&&(this.$_sizeObserved&&=(this.vscrollResizeObserver.unobserve(this.$el),this.$el.$_vs_onResize=void 0,!1))},onResize(e,t,n){this.id===e&&this.applyWidthHeight(t,n)}},render(){return u(this.tag,this.$slots.default())}};Xt.__file=`src/components/DynamicScrollerItem.vue`;function Zt(){let e=q().activeNode,{workflowObject:t,getNodeByName:n}=J();return!e||!t?[]:t.getParentNodesByDepth(e?.name).filter(({name:t},n,r)=>t!==e.name&&r.findIndex(e=>e.name===t)===n).map(e=>n(e.name)).filter(e=>e!==null)}function Qt(){let e=Zt(),t=e.map(e=>e?.name),{getSchemaForExecutionData:n,getInputDataWithPinned:r}=fe(),i=e.map(e=>{let t=r(e);return{nodeName:e?.name||``,schema:n(oe(t),!1)}}).filter(e=>e.schema?.value.length>0);return{parentNodesNames:t,inputSchema:i.shift(),parentNodesSchemas:i}}var $t=(e,t)=>typeof e==`object`?Math.ceil(JSON.stringify(e).length/t):0,en=e=>{let t=e.message.match(/\d+/g);if(!t||t.length<2)throw e;let n=parseInt(t[0],10);return parseInt(t[1],10)-n},tn=(e,t,n)=>{let r=$t(e.context.schema,n);if(t>r&&(t-=r,e.context.schema=[]),e.context.schema.length){let i=[...e.context.schema];for(let a=0;a<i.length;a++){if(e.question.includes(i[a].nodeName))continue;let o=$t(i[a],n);if(t-=o,r-=o,e.context.schema.splice(a,1),t<=0)break}}return[t,r]},nn=(e,t,n,r)=>{if(t<=0)return t;if(Array.isArray(e.context.inputSchema.schema.value)){let r=[...e.context.inputSchema.schema.value];for(let i=0;i<r.length;i++){let a=r[i].key;if(a&&e.question.includes(a))continue;let o=$t(r[i],n);if(t-=o,e.context.inputSchema.schema.value.splice(i,1),t<=0)break}}return t>0&&(e.context.schema=[],t-=r),t};function rn(e,t,n=4){let r=en(t),[i,a]=tn(e,r,n);if(r=i,r=nn(e,r,n,a),r>0)throw t}async function an(e,t,n=1){let r=Qt(),i={question:e,context:{schema:r.parentNodesSchemas,inputSchema:r.inputSchema,ndvPushRef:q().pushRef,pushRef:Fe().pushRef},forNode:`transform`},a;if(_e().isAskAiEnabled){let{restApiContext:e}=Fe(),t=``;for(;n>0;)try{let{code:n}=await de(e,i);t=n;break}catch(e){if(typeof e.message==`string`&&e.message.includes(`maximum context length`)){rn(i,e);continue}if(n--,!n)throw e}a=t}else throw new be(`AI code generation is not enabled`);if(a!==void 0)return{name:t,value:await Le(String(a),{parser:`babel`,plugins:[Ie,Re]})}}function on(e,t){if(t)return t;let n=[],r=[],i=window.getComputedStyle(e),a=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),o=parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth),s=e.clientWidth-a-o,c=sn(i),l=e.value.split(`
`);return l.forEach(e=>{r.push([])}),l.forEach((e,t)=>{if(e===``){n.push(e),r[t].push(n.length-1);return}let i=``;e.split(/(\s+)/).forEach(e=>{let a=i+e;c.measureText(a).width<=s?i=a:(n.push(i.trimEnd()),r[t].push(n.length-1),i=e)}),i&&(n.push(i.trimEnd()),r[t].push(n.length-1))}),{rows:n,linesToRowsMap:r}}function sn(e){let t=document.createElement(`canvas`).getContext(`2d`);return t.font=`${e.fontWeight} ${e.fontSize} ${e.fontFamily}`,t}var cn=(e,t)=>{let n=parseInt(t,10),r=e-n/2-1;return Math.floor(r/n)},ln=(e,t,n)=>{let r=document.createElement(`span`);r.style.font=n,r.style.visibility=`hidden`,r.style.position=`absolute`,r.style.whiteSpace=`pre`,document.body.appendChild(r);let i=0,a=e.length,o=0;for(;i<=a;){let n=Math.floor((i+a)/2);r.textContent=e.substring(0,n),r.getBoundingClientRect().width<=t?(o=n,i=n+1):a=n-1}return document.body.removeChild(r),e.length===o?o:o-1};function un(e,t,n){let r=e.target,i=r.getBoundingClientRect(),a=e.clientX-i.left,o=e.clientY-i.top,{lineHeight:s,font:c}=window.getComputedStyle(r),l=cn(o,s),u=on(r,t),d=n;u.rows[l]===void 0&&(d=`${r.value} ${n}`);let{rows:f,linesToRowsMap:p}=u,m=f[l];if(m===``)f[l]=n;else{let e=ln(m,a,c);f[l]=[f[l].slice(0,e).trim(),n,f[l].slice(e).trim()].join(` `).trim()}return d=p.map(e=>e.map(e=>f[e]).join(` `)).join(`
`),d}function dn(e,t,n,r){let i=e.getBoundingClientRect(),a=n-i.left,o=r-i.top,{lineHeight:s,font:c}=window.getComputedStyle(e),l=cn(o,s),{rows:u}=on(e,t);if(l<0||l>=u.length)return e.value.length;let d=u[l],f=ln(d,a,c);return u.slice(0,l).reduce((e,t)=>e+t.length+1,0)+f}function fn(e,n={}){let{telemetrySource:r=`setupPanel`,executionMode:i=`inclusive`,source:a=`SetupPanel.ExecuteNodeButton`}=n,o=ne(),s=B(),c=ae(),u=ye(),d=le(),f=ve(),p=J(),m=re(),h=q(),_=ge(),v=ue(),{runWorkflow:y,stopCurrentExecution:b}=Je({router:o}),x=l(!1),S=t(()=>g(e)??null),C=Be(S),w=t(()=>S.value?m.getNodeType(S.value.type,S.value.typeVersion):null),T=t(()=>S.value?m.isTriggerNode(S.value.type):!1),E=t(()=>w.value?.name===je),D=t(()=>w.value?.name===Ce),O=t(()=>S.value?p.checkIfNodeHasChatParent(S.value.name):!1),k=t(()=>w.value?.name===ke),A=t(()=>!!w.value?.polling),j=t(()=>!!w.value?.group.includes(`schedule`)),M=t(()=>w.value?.name===Se),N=t(()=>{if(!p.isWorkflowRunning||x.value)return!1;let e=p.executedNode;return v.executingNode.isNodeExecuting(S.value?.name??``)||e===S.value?.name}),P=t(()=>{let e=p.executionWaitingForWebhook,t=p.executedNode;return!!S.value&&!S.value.disabled&&T.value&&e&&(!t||t===S.value.name)}),F=t(()=>N.value&&T.value&&!j.value&&!E.value),I=t(()=>x.value||N.value&&!P.value&&!F.value),L=t(()=>!!(S.value?.issues&&(S.value.issues.parameters||S.value.issues.credentials))),R=t(()=>P.value?``:x.value?s.baseText(`ndv.execute.generatingCode`):S.value?.disabled?s.baseText(`ndv.execute.nodeIsDisabled`):T.value&&L.value?s.baseText(`ndv.execute.requiredFieldsMissing`):p.isWorkflowRunning&&!N.value?s.baseText(`ndv.execute.workflowAlreadyRunning`):``),z=t(()=>P.value||F.value?s.baseText(`ndv.execute.stopListening`):V.value?s.baseText(`ndv.execute.generateCodeAndTestNode.description`):D.value?s.baseText(`ndv.execute.testChat`):M.value?s.baseText(`ndv.execute.listenForTestEvent`):k.value?s.baseText(`ndv.execute.testStep`):A.value||w.value?.mockManualExecution?s.baseText(`ndv.execute.fetchEvent`):s.baseText(`ndv.execute.testNode`)),ee=t(()=>{if(V.value)return`terminal`;if(!P.value)return`flask-conical`}),V=t(()=>S.value?.type!==`n8n-nodes-base.aiTransform`||!S.value?.parameters?.instructions?!1:!!(!S.value?.parameters?.jsCode||S.value?.parameters.codeGeneratedForPrompt&&(S.value?.parameters?.instructions).trim()!==(S.value?.parameters?.codeGeneratedForPrompt).trim()));async function H(){try{await p.removeTestWebhook(p.workflowId)}catch(e){u.showError(e,`Error stopping webhook`)}}async function U(){if(!V.value||!S.value)return!0;x.value=!0;try{u.showMessage({title:s.baseText(`ndv.execute.generateCode.title`),message:s.baseText(`ndv.execute.generateCode.message`,{interpolate:{nodeName:S.value.name}}),type:`success`});let e=S.value.parameters?.instructions,t=await an(e,`parameters.${X}`,5);if(!t)return x.value=!1,!1;v.updateNodeProperties({name:S.value.name,properties:{parameters:{...S.value.parameters,[X]:t.value,[Y]:e}}}),n.onCodeGenerated?.({name:`parameters.${X}`,value:t.value}),n.onCodeGenerated?.({name:`parameters.${Y}`,value:e}),c.trackAiTransform(`generationFinished`,{prompt:e,code:t.value})}catch(e){return c.trackAiTransform(`generationFinished`,{prompt:S.value?.parameters?.instructions,code:``,hasError:!0}),u.showMessage({type:`error`,title:s.baseText(`codeNodeEditor.askAi.generationFailed`),message:e.message}),x.value=!1,!1}return x.value=!1,!0}async function W(){if(!S.value)return`noop`;let e=S.value.name;if(V.value&&!await U())return`cancelled`;if(D.value||O.value&&h.isInputPanelEmpty)return h.unsetActiveNodeName(),p.chatPartialExecutionDestinationNode=e,pe.emit(`openChat`),`opened-chat`;if(P.value)return await H(),`stopped-webhook`;if(F.value)return await b(),`stopped-execution`;let t=!1;if(C.hasData.value&&(t=await d.confirm(s.baseText(`ndv.pinData.unpinAndExecute.description`),s.baseText(`ndv.pinData.unpinAndExecute.title`),{confirmButtonText:s.baseText(`ndv.pinData.unpinAndExecute.confirm`),cancelButtonText:s.baseText(`ndv.pinData.unpinAndExecute.cancel`)})===Ee,t&&C.unsetData(`unpin-and-execute-modal`)),!C.hasData.value||t){if(Ye(S.value))return _.openModalWithData({name:Ae,data:{nodeName:e}}),`opened-modal`;let t={node_type:w.value?w.value.name:null,workflow_id:p.workflowId,source:r,push_ref:h.pushRef};return c.track(`User clicked execute node button`,t),await f.run(`nodeExecuteButton.onClick`,t),await y({destinationNode:{nodeName:e,mode:g(i)},source:a}),`executed`}return`cancelled`}async function te(){P.value?await H():F.value&&await b()}return{isExecuting:I,isListening:P,isListeningForWorkflowEvents:F,buttonLabel:z,buttonIcon:ee,disabledReason:R,isTriggerNode:T,hasIssues:L,shouldGenerateCode:V,execute:W,stopExecution:te}}var pn=`N8N_NODE_TEST_STEP_POPUP_COUNT`,mn=10,hn=3e3,gn=m({inheritAttrs:!1,__name:`NodeExecuteButton`,props:{nodeName:{},telemetrySource:{},disabled:{type:Boolean,default:!1},label:{},variant:{},size:{},icon:{},square:{type:Boolean,default:!1},transparent:{type:Boolean,default:!1},hideIcon:{type:Boolean},hideLabel:{type:Boolean},tooltip:{},tooltipPlacement:{},showLoadingSpinner:{type:Boolean,default:!0},executionMode:{default:`inclusive`}},emits:[`stopExecution`,`execute`,`valueChanged`],setup(e,{emit:r}){let i=e,a=r,o=j(),c=B(),u=J(),d=q(),{isExecuting:p,isListening:m,isListeningForWorkflowEvents:g,buttonLabel:v,buttonIcon:y,disabledReason:x,isTriggerNode:C,hasIssues:T,shouldGenerateCode:E,execute:O}=fn(t(()=>u.getNodeByName(i.nodeName)),{telemetrySource:i.telemetrySource,executionMode:t(()=>i.executionMode),source:`RunData.ExecuteNodeButton`,onCodeGenerated:e=>a(`valueChanged`,e)}),k=l(0),A=t(()=>{if(C.value&&T.value){let e=d.activeNode;if(e&&e.name!==i.nodeName)return c.baseText(`ndv.execute.fixPrevious`)}return x.value}),M=t(()=>i.hideLabel?``:i.label&&!m.value&&!g.value?i.label:v.value),N=t(()=>{if(i.icon)return i.icon;if(!i.hideIcon)return y.value}),P=t(()=>E.value?c.baseText(`ndv.execute.generateCodeAndTestNode.description`):A.value?A.value:i.tooltip&&!p.value&&F()<mn?i.tooltip:``);function F(){return Number(localStorage.getItem(pn))}function I(){let e=F();if(e<mn&&!A.value&&P.value){let t=Date.now();(!k.value||t-k.value>=hn)&&(localStorage.setItem(pn,`${e+1}`),k.value=t)}}async function L(){let e=await O();e===`executed`&&a(`execute`),e===`stopped-execution`&&a(`stopExecution`)}return(t,r)=>(w(),h(s(U),{placement:e.tooltipPlacement??`right`,disabled:!P.value&&!o.persistentTooltipContent,visible:o.persistentTooltipContent?!0:void 0},{content:S(()=>[b(t.$slots,`persistentTooltipContent`,{},()=>[D(n(P.value),1)])]),default:S(()=>[f(s(H),_(t.$attrs,{loading:s(p)&&e.showLoadingSpinner,disabled:e.disabled||!!A.value||s(p)&&!e.showLoadingSpinner,label:M.value,variant:e.variant,size:e.size,icon:N.value,square:e.square,"transparent-background":e.transparent,title:!s(C)&&!P.value?s(c).baseText(`ndv.execute.testNode.description`):``,onMouseover:I,onClick:L}),null,16,[`loading`,`disabled`,`label`,`variant`,`size`,`icon`,`square`,`transparent-background`,`title`])]),_:3},8,[`placement`,`disabled`,`visible`]))}}),_n=e(Pe(),1),vn=K(m({__name:`VirtualSchema`,props:{nodes:{default:()=>[]},node:{default:null},data:{default:()=>[]},mappingEnabled:{type:Boolean,default:!1},paneType:{},connectionType:{default:Z.Main},search:{default:``},compact:{type:Boolean,default:!1},outputIndex:{default:void 0},previewExecution:{default:void 0},truncateLimit:{default:600}},emits:[`clear:search`,`execute`],setup(e,{emit:r}){let o=e,c=ae(),u=Ke(),d=B(),p=q(),m=re(),g=J(),v=qe(),b=ce(),C=_e(),{getSchemaForExecutionData:E,getSchemaForJsonSchema:O,getSchema:k,filterSchema:A}=fe(),{closedNodes:j,flattenSchema:M,flattenMultipleSchemas:P,toggleNode:R}=me(),{getNodeInputData:H,getLastRunIndexWithData:G,hasNodeExecuted:ne}=ie(),{dismissCallout:K,isCalloutDismissed:se}=We(),le=r,ue=l(),de=l(new Set),pe=t(()=>p.canDraggableDrop),ge=t(()=>p.draggableStickyPos),ye=async e=>{await K(e)},be=e=>{j.value.has(e)&&(j.value=new Set(Z.value.map(e=>e.id))),R(e),ue.value?.scrollToItem(0)},xe=async(e,t)=>{let n=g.pinDataByNodeName(t.name),r=(n?n.length>0:!1)||ne(t.name),i=!r&&o.previewExecution?o.previewExecution.data:void 0,a=t.indicies.length>0?t.indicies:[0],s=a.map(t=>({outputIndex:t,runIndex:G(e.name,t,o.connectionType,i)})).filter(({runIndex:e})=>e!==-1),c=s;o.outputIndex!==void 0&&a.length>1&&a.includes(o.outputIndex)&&(c=s.filter(({outputIndex:e})=>e===o.outputIndex));let l=c.map(({outputIndex:t,runIndex:n})=>H(e,n,t,o.paneType,o.connectionType,i)).flat(),u=l.some(e=>!he(e.binary)),d=n??oe(l),f=d.length===0||d.length===1&&Object.keys(d[0]).length===0,p=E(d),m=!f&&!!i,h=m;if(f&&!h){let t=await Y(e);t.ok&&(p=O(t.result),h=!0)}return{schema:p,connectedOutputIndexes:a,itemsCount:f?0:d.length,runIndex:s[0]?.runIndex??0,preview:h,lastSuccessfulPreview:m,hasBinary:u,isNodeExecuted:r,isDataEmpty:f}},Se=t(()=>C.isEnterpriseFeatureEnabled[De.Variables]),Ce=t(()=>{let e=b.variablesAsObject;return A(k({$now:Ne.now().toISO(),$today:Ne.now().set({hour:0,minute:0,second:0,millisecond:0}).toISO(),$vars:e,$execution:{id:we,mode:`test`,resumeUrl:d.baseText(`dataMapping.schemaView.execution.resumeUrl`)},$workflow:(0,_n.default)(g.workflow,[`id`,`name`,`active`])}),o.search)}),Ee=t(()=>{let e={id:`variables`,type:`header`,title:d.baseText(`dataMapping.schemaView.variablesContextTitle`),collapsable:!0,itemCount:null};if(j.value.has(e.id))return[e];let t=Ce.value;if(!t)return[];let n=M({schema:t,depth:1,isDataEmpty:!1,truncateLimit:o.truncateLimit}).flatMap(e=>{if(e.type===`item`&&e.depth===1&&e.title===`$vars`){let t=!j.value.has(e.id);if(!Se.value)return e.collapsable=!1,e.locked=!0,e.lockedTooltip=d.baseText(`dataMapping.schemaView.variablesUpgrade`),e;if(t&&b.scopedVariables.length===0)return[e,{type:`notice`,id:`notice-variablesEmpty`,level:e.level??0,message:d.baseText(`dataMapping.schemaView.variablesEmpty`)}]}return e});return[e].concat(n)}),Oe=ee(async()=>{let e=o.search;if(o.data.length===0){let t=await Y(o.node);if(t.ok)return A(O(t.result),e)}return A(E(o.data),e)},null);async function Y(e){if(!e)return Te(Error());if(m.getNodeType(e.type,e.typeVersion)?.group.includes(`trigger`))return Te(Error(`Trigger nodes do not have schema previews`));let{type:t,typeVersion:n,parameters:{resource:r,operation:i}}=e;return await v.getSchemaPreview({nodeType:t,version:n,resource:r,operation:i})}let ke=ee(async()=>{let e=[],t=o.search;for(let n of o.nodes){let r=g.getNodeByName(n.name);if(!r)continue;let i=m.getNodeType(r.type,r.typeVersion);if(!i)continue;let{schema:a,connectedOutputIndexes:o,itemsCount:s,preview:c,hasBinary:l,isNodeExecuted:u,isDataEmpty:d,runIndex:f,lastSuccessfulPreview:p}=await xe(r,n),h=A(a,t);h&&e.push({node:r,connectedOutputIndexes:o,depth:n.depth,itemsCount:s,nodeType:i,schema:h,preview:c,hasBinary:l,isNodeExecuted:u,isDataEmpty:d,runIndex:f,lastSuccessfulPreview:p})}return e},[]),Ae=e=>{let t=[];e.disabled&&t.push(d.baseText(`node.disabled`));let n=p.ndvNodeInputNumber[e.name];return n&&(n.length===1?t.push(`Input ${n}`):t.push(`Inputs ${n.join(`, `)}`)),t.length?`(${t.join(` | `)})`:``},je=t(()=>P(ke.value,Ae,o.truncateLimit)),Me=t(()=>Oe.value?M({schema:Oe.value,depth:0,level:-1,isDataEmpty:o.data.length===0,truncateLimit:o.truncateLimit}):[]),X=t(()=>!o.nodes.length),Z=t(()=>{let e;return X.value||o.paneType===`output`?(e=Me.value,o.node?.type===`n8n-nodes-base.merge`&&o.paneType===`output`&&o.data&&o.data.length>1&&(e=[{id:`${o.node.name}-mergeNotice`,type:`callout`,level:0,message:d.baseText(`dataMapping.schemaView.mergeNotice`),theme:`info`},...e])):e=je.value.concat(Ee.value),e.filter(e=>e.type===`callout`?!se(e.id):!0)}),Pe=t(()=>!!o.search.trim()&&!Z.value.length);y(()=>!!o.search,e=>{e?(de.value=new Set(j.value),j.value.clear()):j.value.size===0&&(j.value=de.value)});let Fe=y(Z,e=>{let t=e.length<2?[]:e.filter(e=>e.type===`header`).slice(1).map(e=>e.id),n=e.filter(e=>e.type===`item`&&e.binaryData).map(e=>e.id);j.value=new Set(t.concat(n)),Fe()}),Ie=(e,t)=>{p.draggableStartDragging({type:`mapping`,data:t??``,dimensions:e?.getBoundingClientRect()??null}),p.resetMappingTelemetry()},Le=e=>{p.draggableStopDragging(),setTimeout(()=>{let t=p.mappingTelemetry,n=ke.value.find(({node:t})=>t.name===e.dataset.nodeName),r=n?.preview??!1,i=!he(n?.node.credentials),a=Number(e.dataset.runIndex),o={src_node_type:e.dataset.nodeType,src_field_name:e.dataset.name??``,src_nodes_back:e.dataset.depth,src_run_index:a,src_runs_total:a,src_field_nest_level:e.dataset.level??0,src_view:r?`schema_preview`:`schema`,src_has_credential:i,src_element:e,success:!1,view_shown:u.view_shown,...t};ve().run(`runDataJson.onDragEnd`,o),c.track(`User dragged data for mapping`,o)},250)};return(t,r)=>{let c=N(`n8n-html`);return w(),i(`div`,{class:F([`run-data-schema`,`full-height`,{compact:o.compact,"no-search-results":Pe.value}])},[Pe.value?(w(),h(ze,{key:0,title:s(d).baseText(`ndv.search.noNodeMatch.title`)},{default:S(()=>[f(s(z),{keypath:`ndv.search.noMatchSchema.description`,tag:`span`,scope:`global`},{link:S(()=>[I(`a`,{href:`#`,onClick:r[0]||=T(e=>le(`clear:search`),[`prevent`])},n(s(d).baseText(`ndv.search.noMatchSchema.description.link`)),1)]),_:1})]),_:1},8,[`title`])):a(``,!0),Z.value.length?(w(),h(Ve,{key:1,class:`full-height`,type:`mapping`,"target-data-key":`mappable`,disabled:!e.mappingEnabled,"can-drop":pe.value,"sticky-position":ge.value,onDragstart:Ie,onDragend:Le},{preview:S(({canDrop:e,el:t})=>[t?(w(),h(Ge,{key:0,html:t.outerHTML,"can-drop":e},null,8,[`html`,`can-drop`])):a(``,!0)]),default:S(()=>[f(s(Jt),{ref_key:`scroller`,ref:ue,items:Z.value,"min-item-size":38,class:`full-height scroller`},{default:S(({item:t,index:o,active:l})=>[f(s(Xt),{item:t,active:l,"size-dependencies":[t],"data-index":o},{default:S(()=>[t.type===`header`?(w(),h(nt,_({key:0},t,{collapsed:s(j).has(t.id),"onClick:toggle":e=>s(R)(t.id),onClick:e=>be(t.id),onExecute:r[1]||=e=>le(`execute`,e)}),null,16,[`collapsed`,`onClick:toggle`,`onClick`])):t.type===`item`?(w(),h(st,_({key:1},t,{search:e.search,draggable:e.mappingEnabled,collapsed:s(j).has(t.id),highlight:s(p).highlightDraggables,onClick:e=>s(R)(t.id)}),null,16,[`search`,`draggable`,`collapsed`,`highlight`,`onClick`])):t.type===`icon`?(w(),h(s(U),{key:2,content:t.tooltip,placement:`top`},{default:S(()=>[f(s(W),{size:`small`,icon:t.icon,class:`icon`},null,8,[`icon`])]),_:2},1032,[`content`])):t.type===`notice`?L((w(),i(`div`,{key:3,class:`notice`,style:x({"--schema-level":t.level})},null,4)),[[c,t.message]]):t.type===`callout`?(w(),i(`div`,{key:4,class:`callout-wrapper`,style:x({"--schema-level":t.level}),onClick:r[2]||=T(()=>{},[`stop`])},[f(s(V),{theme:t.theme||`info`,slim:!0,"round-corners":!0,iconless:!1},{trailingContent:S(()=>[f(s(W),{icon:`x`,title:s(d).baseText(`generic.dismiss`),size:`medium`,type:`secondary`,class:`callout-dismiss`,"data-test-id":`callout-dismiss-icon`,onClick:e=>ye(t.id)},null,8,[`title`,`onClick`])]),default:S(()=>[D(n(t.message)+` `,1)]),_:2},1032,[`theme`])],4)):t.type===`empty`?(w(),i(`div`,{key:5,class:`empty-schema`,style:x({"--schema-level":t.level})},[f(s(te),{tag:`div`,size:`small`},{default:S(()=>[t.key===`executeSchema`?(w(),h(s(z),{key:0,tag:`span`,keypath:`dataMapping.schemaView.executeSchema`,scope:`global`},{link:S(()=>[s(p).activeNodeName?(w(),h(gn,{key:0,"node-name":s(p).activeNodeName,label:s(d).baseText(`ndv.input.noOutputData.executePrevious`),"telemetry-source":`inputs`,size:`small`,type:`secondary`,"hide-icon":``,"execution-mode":`exclusive`},null,8,[`node-name`,`label`])):a(``,!0)]),_:1})):(w(),h(s(z),{key:1,tag:`span`,keypath:`dataMapping.schemaView.${t.key}`,scope:`global`},null,8,[`keypath`]))]),_:2},1024)],4)):a(``,!0)]),_:2},1032,[`item`,`active`,`size-dependencies`,`data-index`])]),_:1},8,[`items`])]),_:1},8,[`disabled`,`can-drop`,`sticky-position`])):a(``,!0)],2)}}}),[[`__scopeId`,`data-v-fdcbbd1f`]]);export{Zt as a,Xt as c,an as i,Jt as l,gn as n,dn as o,fn as r,un as s,vn as t};
//# sourceMappingURL=VirtualSchema-SoERffbL.js.map