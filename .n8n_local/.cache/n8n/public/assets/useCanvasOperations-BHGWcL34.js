(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`74f16d9a-e5fd-4823-97d1-93cbcb12e121`,e._sentryDebugIdIdentifier=`sentry-dbid-74f16d9a-e5fd-4823-97d1-93cbcb12e121`)})()}catch{}import{o as e,t}from"./chunk-Din3qlHY.js";import{C as n,Cn as r,D as i,E as a,G as o,Gt as s,It as c,M as l,P as u,T as d,W as f,_ as p,at as m,bt as h,ct as g,et as _,it as v,j as y,vn as b,w as x,zt as S}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{M as C,S as w,yt as T}from"./_MapCache-DjbOQyB7.js";import{Ci as E,_t as D,ki as O,wi as ee}from"./src-CppJvwzX.js";import{t as k}from"./_plugin-vue_export-helper-B_J4Khre.js";import{An as te,Bt as ne,C as re,Dn as ie,En as ae,Fr as A,Gt as oe,Ht as se,In as j,It as ce,Lt as le,On as M,Ot as ue,R as de,Rn as fe,Si as pe,Sn as me,Sr as he,Tn as N,Tt as ge,Vt as _e,ai as ve,bi as ye,ca as be,ct as xe,d as Se,di as Ce,fi as we,gn as Te,jn as Ee,jt as De,kt as Oe,li as P,mi as ke,pa as Ae,pi as je,r as Me,rt as Ne,s as Pe,vi as Fe,wn as Ie,ws as Le,xi as Re,xn as ze,xr as Be,y as Ve,yi as He,yr as Ue,zr as F}from"./users.store-pCkD7Zo0.js";import{Ac as I,Cr as We,Ha as Ge,Hi as Ke,Ni as L,Nn as R,Rc as z,Ua as qe,Yc as Je,_a as Ye,da as Xe,ec as Ze,fa as Qe,gn as $e,hr as B,la as et,nc as tt,oa as nt,rc as V,rs as rt,so as H,tc as it,ua as at,xa as ot,xr as st}from"./constants-D1jZwsUK.js";import{j as U,r as ct}from"./_baseOrderBy-El3qbNHQ.js";import{t as lt}from"./executions.store-DnLtKXBA.js";import{t as ut}from"./usePinnedData-C6FFXoty.js";import{a as dt,c as ft,i as pt,n as W,o as mt}from"./canvas.utils-C8dCdoZZ.js";import{t as ht}from"./nodeCreator.store-KD9kt9dE.js";import{t as G}from"./core-DLhNJSBD.js";import{a as gt,i as _t,n as vt,r as K,t as yt}from"./xml-BJs1rC06.js";import{t as bt}from"./VueMarkdown-OrZqWAIM.js";import{t as xt}from"./folders.store-CS_gIPIm.js";function St(){function e(){return re().allNodeTypes.reduce((e,t)=>{if(typeof t.defaults.name!=`string`)throw Error(`Expected node name default to be a string`);return/\d$/.test(t.defaults.name)&&e.push(t.defaults.name),e},[])}function t(t,n=[]){let{canvasNames:r}=Pe();if(!r.has(t)&&!n.includes(t))return t;let i=e().find(e=>t.startsWith(e));if(i){let e=``,a=1,o=t.split(i).pop(),s=o?.[o.length-1];for(s&&Number.isInteger(Number(s))&&(a=parseInt(s,10),t=t.slice(0,-1)),e=t;r.has(e)||n.includes(e);)e=t+ a++;return e}if(/^\d+-?\d*$/.test(t)){let e=``,i=1,a=t.match(/(?<base>\d+)-?(?<suffix>\d*)/);if(!a?.groups)throw Error(`Failed to find match for unique name`);for(a?.groups?.suffix!==``&&(i=parseInt(a.groups.suffix,10)),e=a.groups.base;r.has(e)||n.includes(e);)e=a.groups.base+`-`+ i++;return e}let a=``,o=1,s=t.match(/(?<base>.*\D+)(?<suffix>\d*)/);if(!s?.groups)throw Error(`Failed to find match for unique name`);for(s?.groups?.suffix!==``&&(o=parseInt(s.groups.suffix,10)),a=s.groups.base;r.has(a)||n.includes(a);)a=s.groups.base+ o++;return a}return{uniqueNodeName:t}}function Ct(){let e=new Map;function t(t,n){let r=e.get(t);r&&r.splice(r.indexOf(n)>>>0,1)}function n(n,r){let i=e.get(n);return i?i.push(r):i=[r],e.set(n,i),()=>t(n,r)}function r(t,n){let r=e.get(t);r&&r.slice().forEach(async e=>{await e(n)})}return{on:n,off:t,emit:r}}var wt=u({inheritAttrs:!1,__name:`Button`,props:{type:{default:`primary`},element:{default:`button`},disabled:{type:Boolean,default:!1}},setup(e){let t=e,r=n(()=>`chat-button-${t.type}${t.disabled?`-disabled`:``}`);return(n,a)=>(_(),i(`span`,{class:b({"chat-button-wrapper-disabled":t.disabled})},[(_(),d(g(e.element),f({class:[`chat-button`,r.value]},n.$attrs),{default:h(()=>[m(n.$slots,`default`)]),_:3},16,[`class`]))],2))}}),Tt=e(O()),Et=u({__name:`MarkdownRenderer`,props:{text:{}},setup(e){G.registerLanguage(`javascript`,_t),G.registerLanguage(`typescript`,vt),G.registerLanguage(`python`,K),G.registerLanguage(`xml`,yt),G.registerLanguage(`bash`,gt);let t=e=>{e.use(Tt.default,{attrs:{target:`_blank`,rel:`noopener`}})},n={highlight(e,t){if(t&&G.getLanguage(t))try{return G.highlight(e,{language:t}).value}catch{}return``}};return(r,i)=>(_(),d(s(bt),{class:`chat-message-markdown`,source:e.text,options:n,plugins:[t]},null,8,[`source`,`plugins`]))}}),Dt=k(u({__name:`MessageWithButtons`,props:{text:{},buttons:{}},setup(e){let t=c(null),n=async(e,n)=>{t.value===null&&(await fetch(e)).ok&&(t.value=n)};return(o,s)=>(_(),i(`div`,null,[l(Et,{text:e.text},null,8,[`text`]),x(`div`,{class:b(o.$style.buttons)},[(_(!0),i(p,null,v(e.buttons,(e,o)=>(_(),i(p,{key:e.text},[t.value===null||o===t.value?(_(),d(wt,{key:0,element:`button`,type:e.type,disabled:o===t.value,onClick:t=>n(e.link,o)},{default:h(()=>[y(r(e.text),1)]),_:2},1032,[`type`,`disabled`,`onClick`])):a(``,!0)],64))),128))],2)]))}}),[[`__cssModules`,{$style:{buttons:`_buttons_1hb9q_125`}}]]);const q={WITH_BUTTONS:`with-buttons`};q.WITH_BUTTONS;const Ot=`Chat`,kt=`ChatOptions`;var At=`with-buttons`;function J(e,t,n,r){let i=new URL(e).origin,a=i.startsWith(`https`)?`wss`:`ws`;return`${i.replace(/^https?/,a)}/chat?sessionId=${n}&executionId=${t}${r?`&isPublic=true`:``}`}function Y(e){let t=F(),n={id:t,sender:`bot`,text:e};try{let r=JSON.parse(e);r.type===At&&(n={id:t,sender:`bot`,type:`component`,key:q.WITH_BUTTONS,arguments:{text:r.text,buttons:r.buttons,blockUserInput:r.blockUserInput}})}catch{}return n}function jt(e){return e.type===`component`&&e.key===q.WITH_BUTTONS&&typeof e.arguments?.blockUserInput==`boolean`?e.arguments?.blockUserInput:!1}const Mt=Ct(),Nt=`N8N_CANVAS_CHAT_HEIGHT`,Pt=`N8N_CANVAS_CHAT_WIDTH`,Ft=`N8N_LOGS_OVERVIEW_PANEL_WIDTH`,X={CLOSED:`closed`,ATTACHED:`attached`,FLOATING:`floating`},Z={INPUT:`input`,OUTPUT:`output`,BOTH:`both`},It=U(`logs`,()=>{let e=C(tt,!1),t=c(!1),r=n(()=>e.value?t.value?X.FLOATING:X.ATTACHED:X.CLOSED),i=c(0),a=C(Ze,Z.OUTPUT,{writeDefaults:!1}),o=C(it,Z.BOTH,{writeDefaults:!1}),s=C(V,!0,{writeDefaults:!1}),l=c(!1),u=le(),d=c(m()),f=c([]);function p(e){i.value=e}function m(){return F().replace(/-/g,``)}function h(){d.value=m()}function g(){f.value=[]}function _(t){e.value=t??!e.value}function v(e){t.value=e}function y(e){l.value=e}function b(e){let t=[Z.INPUT,Z.BOTH],n=l.value?o:a,r=t.includes(n.value);e!==r&&(n.value=r?Z.OUTPUT:Z.BOTH,u.track(`User toggled log view sub pane`,{pane:`input`,newState:r?`hidden`:`visible`,isSubNode:l.value}))}function x(e){let t=[Z.OUTPUT,Z.BOTH],n=l.value?o:a,r=t.includes(n.value);e!==r&&(n.value=r?Z.INPUT:Z.BOTH,u.track(`User toggled log view sub pane`,{pane:`output`,newState:r?`hidden`:`visible`,isSubNode:l.value}))}function S(e){s.value=e??!s.value}function w(e){f.value.push(e)}return{state:r,isOpen:n(()=>r.value!==X.CLOSED),detailsState:n(()=>l.value?o.value:a.value),height:n(()=>i.value),isLogSelectionSyncedWithCanvas:n(()=>s.value),chatSessionId:n(()=>d.value),chatSessionMessages:n(()=>f.value),addChatMessage:w,setHeight:p,toggleOpen:_,setPreferPoppedOut:v,setSubNodeSelected:y,toggleInputOpen:b,toggleOutputOpen:x,toggleLogSelectionSync:S,resetChatSessionId:h,resetMessages:g}});var Lt=t(((e,t)=>{var n=Ke();function r(e){return e&&e.length?n(e):[]}t.exports=r}));const Rt=U(`experimentalNdv`,()=>{let e=Pe(),t=A(),r=n(()=>t.getVariant(I.name)===I.variant),i=n(()=>t.getVariant(z.name)===z.variant),a=n(()=>r.value?2:4),o=c(),s=S({}),l=c(),u=c(!1);function d(e,t){s.value={...s.value,[e]:t===void 0?!s.value[e]:!t}}function f(){s.value=e.allNodes.reduce((e,t)=>(e[t.id]=!0,e),{})}function p(){s.value={}}function m(e){return r.value&&Math.abs(e-a.value)<1e-6}function h(e){l.value=e}function g(e){u.value=e}function _(e,{canvasDimensions:t,canvasViewport:n,setCenter:r}){s.value={...s.value,[e.id]:!1};let i=e.dimensions.width*(m(n.zoom)?1:1.5);l.value===e.data.name&&(l.value=void 0),r(e.position.x+i/2,e.position.y+(t.height*(1/2)-80)/a.value,{duration:200,zoom:a.value,interpolate:`linear`})}function v(e){if(m(e.canvasViewport.zoom)){if(o.value===void 0){e.fitView({duration:200,interpolate:`linear`});return}e.setViewport(o.value,{duration:200,interpolate:`linear`});return}o.value=e.canvasViewport;let t=e.selectedNodes.filter(e=>e.data.render.type===Ce.Default).toSorted((e,t)=>e.position.y===t.position.y?e.position.x-t.position.x:e.position.y-t.position.y)[0];if(t){_(t,e);return}e.zoomTo(a.value,{duration:200,interpolate:`linear`})}return{isZoomedViewEnabled:r,isNdvInFocusPanelEnabled:i,maxCanvasZoom:a,previousZoom:n(()=>o.value),collapsedNodes:n(()=>s.value),nodeNameToBeFocused:n(()=>l.value),isMapperOpen:n(()=>u.value),isActive:m,setNodeExpanded:d,expandAllNodes:p,collapseAllNodes:f,toggleZoomMode:v,focusNode:_,setNodeNameToBeFocused:h,setMapperOpen:g}}),zt=D();function Bt(){let e=xt(),t=oe(),n=Pe();return{fetchAndSetParentFolder:async r=>{if(!r)return;let i=e.getCachedFolder(r);return!i&&t.currentProjectId&&(await e.getFolderPath(t.currentProjectId,r),i=e.getCachedFolder(r)),i&&n.setParentFolder({...i,parentFolderId:i.parentFolder??null}),i??null}}}var Vt=e(L(),1),Ht=e(Lt(),1);function Ut(){let e=ct(),t=Pe(),r=_e(),i=Ne(),a=we(),s=Me(),l=ne(),u=re(),d=he(),f=Le(),p=ue(),m=ht(),h=lt(),g=oe(),_=It(),v=Rt(),y=ze(),b=Te(),x=T(),S=Ue(),C=ge(),D=ce(),O=le(),k=Be(),ie=w(),{uniqueNodeName:A}=St(),{fetchAndSetParentFolder:Ce}=Bt(),F=ee(),I=E(),We=c([0,0]),Ke=!!localStorage.getItem(`NodeView.preventOpeningNDV`),L=n(()=>t.workflow),R=n(()=>t.workflowObject),z=n(()=>t.workflowTriggerNodes);function Ze({result:e,source:t,target:n},{trackEvents:r=!0,trackHistory:i=!0,trackBulk:a=!0}={}){tt(e.nodes.map(({id:e,x:t,y:n})=>({id:e,position:{x:t,y:n}})),{trackBulk:a,trackHistory:i}),r&&$e({result:e,source:t,target:n})}function $e({result:e,source:t,target:n}){O.track(`User tidied up canvas`,{source:t,target:n,nodes_count:e.nodes.length})}function tt(e,{trackHistory:t=!1,trackBulk:n=!0}={}){t&&n&&a.startRecordingUndo(),e.forEach(({id:e,position:n})=>{V(e,n,{trackHistory:t})}),t&&n&&a.stopRecordingUndo()}function V(e,n,{trackHistory:i=!1}={}){let o=t.getNodeById(e);if(!o)return;let s=[...o.position],c=[n.x,n.y];r.setNodePositionById(e,c),i&&a.pushCommandToUndo(new Fe(o.name,s,c,Date.now()))}function it(e,n){let r=t.getNodeByName(e);r&&V(r.id,n)}function U(e,n,i,{trackHistory:o=!1,trackBulk:s=!0}={}){let c=t.getNodeById(e);c&&(o&&s&&a.startRecordingUndo(),r.setNodeParameters({name:c.name,value:i}),o&&a.pushCommandToUndo(new pe(e,n,i,Date.now())),o&&s&&a.stopRecordingUndo())}async function G(e,t,n){U(e,n,t)}async function gt(e,n,{trackHistory:r=!1,trackBulk:i=!0,showErrorToast:o=!0}={}){if(e===n)return!1;r&&i&&a.startRecordingUndo(),n=A(n);let s=t.cloneWorkflowObject();try{s.renameNode(e,n)}catch(e){return o&&S.showMessage({type:`error`,title:e.message,message:e.description}),!1}return r&&a.pushCommandToUndo(new Re(e,n,Date.now())),t.renameNodeSelectedAndExecution({old:e,new:n}),t.setNodes(Object.values(s.nodes)),t.setConnections(s.connectionsBySourceNode),l.activeNodeName===e&&l.setActiveNodeName(n,`other`),r&&i&&a.stopRecordingUndo(),n}async function _t(e,t){await gt(e,t)}function vt(e,{trackHistory:n=!1}={}){let r=t.getNodeById(e);if(!r)return;let i=t.outgoingConnectionsByNodeName(r.name),o=t.incomingConnectionsByNodeName(r.name);for(let[e,r]of Object.entries(o))for(let o of r.at(0)??[]){let r=t.getNodeByName(o.node)?.id;if(r)for(let s of i[e]?.at(0)??[]){let i=t.getNodeByName(s.node)?.id;i&&(n&&a.pushCommandToUndo(new je([{node:o.node,type:e,index:o.index},{node:s.node,type:e,index:s.index}],Date.now())),Q({source:r,sourceHandle:W({mode:P.Output,type:e,index:o.index}),target:i,targetHandle:W({mode:P.Input,type:e,index:s.index})}))}}}function K(e,{trackHistory:n=!1,trackBulk:r=!0}={}){let i=t.getNodeById(e);i&&(n&&r&&a.startRecordingUndo(),s.lastInteractedWithNodeId===e&&(s.lastInteractedWithNodeId=void 0),vt(e,{trackHistory:n}),rn(e,{trackHistory:n,trackBulk:!1}),t.removeNodeExecutionDataById(e),t.removeNodeById(e),n&&(a.pushCommandToUndo(new ye(i,Date.now())),r&&a.stopRecordingUndo()),xt(e))}function yt(e,{trackHistory:t=!0,trackBulk:n=!0}={}){t&&n&&a.startRecordingUndo(),e.forEach(e=>K(e,{trackHistory:t,trackBulk:!1})),t&&n&&a.stopRecordingUndo()}function bt(e){t.addNode(e),s.markStateDirty()}function xt(e){let n=t.getNodeById(e);n&&(n.type===`n8n-nodes-base.stickyNote`?O.track(`User deleted workflow note`,{workflow_id:t.workflowId}):(k.run(`node.deleteNode`,{node:n}),O.track(`User deleted node`,{node_type:n.type,workflow_id:t.workflowId})))}function Ct(e,n,{trackHistory:r=!1,trackBulk:i=!0,replaceInputs:o=!0,replaceOutputs:s=!0}={}){let c=t.getNodeById(e),l=t.getNodeById(n);if(!c||!l)return;let u=t.workflowObject,d=o?(0,Ht.default)(u.getParentNodes(c.name,`ALL`,1)):[],f=s?(0,Ht.default)(u.getChildNodes(c.name,`ALL`,1)):[],p=[...u.getConnectionsBetweenNodes(d,[c.name]),...u.getConnectionsBetweenNodes([c.name],f)];r&&i&&a.startRecordingUndo();for(let e of p){let n=t.getNodeByName(e[0].node),i=t.getNodeByName(e[1].node);if(!n||!i)continue;$(dt(n,i,e),{trackHistory:r,trackBulk:!1});let a={...e[0],node:e[0].node===c.name?l.name:e[0].node},o={...e[1],node:e[1].node===c.name?l.name:e[1].node},s=n.name===c.name?l:n,u=i.name===c.name?l:i;if(!ln(s,u,a,o))continue;let d=dt(s,u,[a,o]);Q(d,{trackHistory:r}),sn(d.target),cn(d.source)}r&&i&&a.stopRecordingUndo()}function wt(e,n){let r=t.getNodeById(e);r&&(t.setNodePristine(r.name,!1),Tt(r.name,n))}function Tt(e,t){l.setActiveNodeName(e,t)}function Et(){l.unsetActiveNodeName()}function Dt(e,n){let i=t.getNodeById(e);i&&r.setNodeParameters({name:i.name,value:n},!0)}function q(e){if(!e){s.lastInteractedWithNodeId=void 0,s.lastSelectedNode=``;return}let n=t.getNodeById(e);n&&(s.lastInteractedWithNodeId=e,s.lastSelectedNode=n.name)}function Ot(e,{trackHistory:n=!0,trackBulk:r=!0}={}){n&&r&&a.startRecordingUndo();let i=t.getNodesByIds(e);D.disableNodes(i,{trackHistory:n,trackBulk:!1}),n&&r&&a.stopRecordingUndo()}function kt(e){let n=t.getNodeByName(e);n&&D.disableNodes([n])}function At(e,n,{trackHistory:r=!0,trackBulk:i=!0}={}){r&&i&&a.startRecordingUndo();let o=t.getNodesByIds(e).filter(e=>ut(e).canPinNode(!0)),s=o.some(e=>!t.pinDataByNodeName(e.name));for(let e of o){let t=ut(e);if(s){let r=xe().getInputDataWithPinned(e);r.length!==0&&t.setData(r,n)}else t.unsetData(n)}r&&i&&a.stopRecordingUndo()}function J(e,t){return u.getNodeType(e,t)??u.communityNodeType(e)?.nodeDescription??{properties:[],displayName:e,name:e,group:[],description:``,version:t??1,defaults:{},inputs:[],outputs:[]}}async function Y(e,{viewport:t,...n}={}){let r=n.position,i,o=[],c=e.map(e=>{let t=e.typeVersion??Kt(J(e.type));return{...e,typeVersion:t}});await Gt(c),n.trackHistory&&n.trackBulk&&a.startRecordingUndo();for(let[e,a]of c.entries()){let{isAutoAdd:s,openDetail:c,actionName:l,positionOffset:u,...d}=a,f=d.position??r,p=f&&u?[f[0]+u[0],f[1]+u[1]]:f,m=J(d.type,d.typeVersion);try{let r=Pt({...d,position:p},m,{...n,...e===0?{viewport:t}:{},openNDV:c,isAutoAdd:s,actionName:l});i=r,o.push(r)}catch(e){S.showError(e,x.baseText(`error`)),console.error(e);continue}r=[i.position[0]+N[0]*2+16,i.position[1]]}return i&&jt(i),n.trackHistory&&n.trackBulk&&a.stopRecordingUndo(),n.keepPristine||s.markStateDirty(),o}function jt(e){let n=R.value.getParentNodesByDepth(e.name,1);n.length>1&&n.slice(1).forEach((e,n)=>{let r=t.getNodeByName(e.name);r&&V(r.id,{x:r.position[0],y:r.position[1]+100*(n+1)})})}function Nt(e){if(e.maxNodes!==void 0&&C.getNodeTypeCount(e.name)>=e.maxNodes)throw Error(x.baseText(`nodeView.showMessage.showMaxNodeTypeError.message`,{adjustToNumber:e.maxNodes,interpolate:{nodeTypeDataDisplayName:e.displayName}}))}function Pt(e,n,r={}){Nt(n);let i=Wt(e,n,{viewport:r.viewport});if(!i)throw Error(x.baseText(`nodeViewV2.showError.failedToCreateNode`));return t.addNode(i),r.trackHistory&&a.pushCommandToUndo(new ke(i,Date.now())),r.isAutoAdd||X(i,r),o(()=>{r.keepPristine||s.markStateDirty(),t.setNodePristine(i.name,!0),D.matchCredentials(i),D.updateNodeParameterIssues(i),D.updateNodeCredentialIssues(i),D.updateNodeInputIssues(i);let e=i.type===B,n=e||!r.openNDV||Ke?void 0:v.isNdvInFocusPanelEnabled&&b.focusPanelActive&&b.resolvedParameter===void 0?`focus_panel`:v.isZoomedViewEnabled?`zoomed_view`:`ndv`;r.telemetry&&Z(i,r,n),e||(k.run(`nodeView.addNodeButton`,{nodeTypeName:i.type}),n===`focus_panel`||(n===`zoomed_view`?v.setNodeNameToBeFocused(i.name):n===`ndv`&&l.setActiveNodeName(i.name,`added_new_node`)))}),i}async function Ft(e){let n=t.getNodeByName(e);n&&K(n.id)}function X(e,n={}){let r=s.lastInteractedWithNode;if(!r)return;let i=ot(e.type),a=r.id,o=s.lastInteractedWithNodeConnection,c=s.lastInteractedWithNodeHandle;if(i&&o){let{type:t}=ft(c),n=e.id,r=W({mode:P.Input,type:t,index:0});Q({target:o.target,targetHandle:o.targetHandle,source:n,sourceHandle:r}),$(o),Q({source:o.source,sourceHandle:o.sourceHandle,target:n,targetHandle:r});return}let l={trackHistory:n.trackHistory,trackBulk:!1};if(c){let{type:t,mode:n}=ft(c),r=e.id,i=W({mode:P.Input,type:t,index:0});n===P.Input?Q({source:r,sourceHandle:i,target:a,targetHandle:c},l):Q({source:a,sourceHandle:c,target:r,targetHandle:i},l)}else Q({source:a,sourceHandle:W({mode:P.Output,type:H.Main,index:0}),target:e.id,targetHandle:W({mode:P.Input,type:H.Main,index:0})},l);o&&($(o,l),t.getNodeById(o.target)&&Q({source:e.id,sourceHandle:W({mode:P.Input,type:H.Main,index:0}),target:o.target,targetHandle:o.targetHandle},l))}function Z(e,t,n){switch(e.type){case B:Lt();break;default:Ut(e,t,n)}}function Lt(){O.track(`User inserted workflow note`,{workflow_id:t.workflowId})}function Ut(e,n,r){let i=e.parameters,a=typeof i?.resource==`string`?i.resource:void 0,o=typeof i?.operation==`string`?i.operation:void 0;m.onNodeAddedToCanvas({node_id:e.id,node_type:e.type,node_version:e.typeVersion,is_auto_add:n.isAutoAdd,workflow_id:t.workflowId,drag_and_drop:n.dragAndDrop,input_node_type:s.lastInteractedWithNode?s.lastInteractedWithNode.type:void 0,resource:a,operation:o,action:n.actionName,next_view_shown:r})}function Wt(e,t,n={}){let r=e.id??D.assignNodeId(e),i=e.name??D.getDefaultNodeName(e)??t.defaults.name,a=e.type??t.name,o=e.typeVersion,s=n.forcePosition&&e.position?e.position:Jt(e,t,{viewport:n.viewport}),c=e.disabled??!1,l=e.parameters??{},d={...e,id:r,name:i,type:a,typeVersion:o,position:s,disabled:c,parameters:l};return Yt(d),u.getIsNodeInstalled(d.type)&&(qt(d,t),Xt(d,t)),d}async function Gt(e){let t=u.allNodeTypes,n=[];t.forEach(t=>{let r=Array.isArray(t.version)?t.version:[t.version];e.find(e=>e.type===t.name&&r.includes(e.typeVersion))&&!t.hasOwnProperty(`properties`)&&n.push({name:t.name,version:Array.isArray(t.version)?t.version.slice(-1)[0]:t.version})}),n.length>0&&await u.getNodesInformation(n)}function Kt(e){let t=e.defaultVersion;return t===void 0&&(t=Array.isArray(e.version)?e.version.slice(-1)[0]:e.version),t}function qt(e,t){e.parameters=Qe(t?.properties??[],e.parameters,!0,!1,e,t)??{}}function Jt(e,n,r={}){let i=s.lastInteractedWithNode,a=s.lastInteractedWithNodeConnection,o=s.lastInteractedWithNodeHandle,{type:c,index:l}=ft(o??a?.sourceHandle??``),d=c===H.Main?N:Ie,f=[d[0]/2,d[1]/2],p=e.position;if(p)return j(t.allNodes,p,{offset:f,size:d,viewport:r.viewport,normalize:!1});if(i){let o=u.getNodeType(i.type,i.typeVersion),m=R.value.getNode(i.name),h=s.lastCancelledConnectionPosition;if(h){let e=c===H.Main?0:-d[0]/2,t=c===H.Main?-d[1]/2:0;p=[h[0]+e,h[1]+t],s.lastCancelledConnectionPosition=void 0}else if(o&&m){if(ot(e.type)&&a&&c===H.AiTool){let e=t.getNodeById(a.target);if(e){let n=e.position[1],a=i.position[1],o=(a-n)/2,s=n+o;if(p=[i.position[0]-me[0]/2,s],Math.abs(s-a)<M){let e=M/2;V(i.id,{x:i.position[0],y:i.position[1]+(o>0?e:-e)},{trackHistory:!0})}return j(t.allNodes,p,{offset:f,size:d,viewport:r.viewport})}}let s=et(at(R.value,m,o)),u=(s||[]).filter(e=>e!==H.Main),h=et(Xe(R.value,m,o)).filter(e=>e===H.Main),g=0;if(a){let e=!1;typeof n.inputs==`string`?e=!0:Array.isArray(n.inputs)&&(e=et(n.inputs).filter(e=>e!==H.Main).length>0);let t=e?me:N,r=M+(e?me[0]-N[0]:0);tn(i.name,r,{trackHistory:!0,nodeSize:t})}h.length>1&&(g=Ee(h.length,N[1],16)[l]);let _=[];try{_=Xe(R.value,e,n)}catch{}let v=et(_),y={[H.AiLanguageModel]:d[0]*2,[H.AiMemory]:d[0]}[c]??0;if(v.length>0&&v.every(e=>e!==H.Main)){let e=u.findIndex(e=>_[0]===e),t=Math.max(u.length+1,1);p=[i.position[0]+me[0]/t*(e+1)-d[0]/2-y,i.position[1]+M]}else{let e=M;s.find(e=>e!==H.Main)&&(e+=140),p=[i.position[0]+e,i.position[1]+g],a&&(p=[p[0],i.position[1]])}}}return p||=u.isTriggerNode(e.type)&&z.value.length===0?[0,0]:We.value,j(t.allNodes,p,{offset:f,size:d,viewport:r.viewport})}function Yt(t){t.name=A(x.localizeNodeName(e.defaultLocale,t.name,t.type))}function Xt(e,t){t.webhooks?.length&&!e.webhookId&&D.assignWebhookId(e),[`n8n-nodes-base.webhook`,`n8n-nodes-base.formTrigger`,`@n8n/n8n-nodes-langchain.mcpTrigger`].includes(e.type)&&e.parameters.path===``&&(e.parameters.path=e.webhookId)}function Zt(e){return e.type===`n8n-nodes-base.stickyNote`?{x:e.position[0],y:e.position[1],width:e.parameters.width||N[0],height:e.parameters.height||N[1]}:{x:e.position[0],y:e.position[1],width:N[0],height:N[1]}}function Qt(e,t,n){let r={x:e[0],y:e[1],width:t[0]+16,height:t[1]};for(let e of n)if(e.type!==`n8n-nodes-base.stickyNote`&&te(r,Zt(e)))return!1;return!0}function $t(e,n,r=N){let i=Object.values(t.nodesByName),a=e[0],o=e[1],s=N[1]*2,c=e=>({x:e.position[0]+N[0]/2,y:e.position[1]+N[1]/2}),l=e=>Math.abs(e.position[1]-o)<=s,u=e=>e.position[0]+N[0]>a||e.position[0]>=a,d=(e,t,n)=>e.position[0]>=t.position[0]&&e.position[0]+N[0]<=t.position[0]+n.width&&e.position[1]>=t.position[1]&&e.position[1]+N[1]<=t.position[1]+n.height,f=(e,t,n)=>Math.abs(e.x-t.x)<=n.x&&Math.abs(e.y-t.y)<=n.y,p=(e,t,n,r,i)=>d(e,t,n)||f(c(e),r,i),m=(e,t,n,r,i)=>i.filter(i=>p(i,e,t,n,r)),h=i.filter(e=>e.type===`n8n-nodes-base.stickyNote`||e.name===n?!1:l(e)&&u(e)),g=new Set(h.map(e=>e.name));for(let e of h)C.getConnectedNodes(`downstream`,R.value,e.name).filter(e=>{let n=t.getNodeByName(e);return n?u(n):!1}).forEach(e=>g.add(e));let _=i.filter(e=>e.type===`n8n-nodes-base.stickyNote`?!1:g.has(e.name)),v=[],y=[],b=[],x=new Map,S=i.filter(e=>e.type===B),w=Math.min(o,..._.map(e=>e.position[1])),T=Math.max(o+r[1],..._.map(e=>e.position[1]+N[1])),E=t.nodesByName[n],D={x:r[0]/2,y:r[1]/2};for(let e of S){let t=Zt(e),n=e.position[0],i=n+t.width,o=e.position[1],s=!(o+t.height<=w||o>=T),c=a>=n&&a<=i,l={x:e.position[0]+t.width/2,y:e.position[1]+t.height/2};if(E&&p(E,e,t,l,D)&&c){let n=m(e,t,l,D,_);x.set(e.id,n),v.push(e);continue}let u=m(e,t,l,D,_);u.length>0&&x.set(e.id,u);let d=u.length>0;s&&(d?a+r[0]>n+2*M/3?b.push(e):y.push(e):c?v.push(e):n>=a&&y.push(e))}return{nodesToMove:[..._,...y,...b],stickiesToStretch:v,stickiesToMoveAndStretch:b,stickyAssociatedNodes:x}}function en(e,n,r,i,{trackHistory:a=!1}){let o=Zt(e),s=e.position[0],c=s+o.width,l=n[0]-20,u=n[0]+r[0]+20;for(let e of i){let n=t.getNodeById(e.id);if(!n)continue;let r=n.position[0]-20,i=n.position[0]+N[0]+20;l=Math.min(l,r),u=Math.max(u,i)}let d=Math.min(s,l),f=Math.max(c,u)-d,p={...e.parameters,width:f};U(e.id,e.parameters,p,{trackHistory:a,trackBulk:!1}),d!==s&&V(e.id,{x:d,y:e.position[1]},{trackHistory:a})}function tn(e,n,{trackHistory:r=!1,nodeSize:i=N}){let a=t.nodesByName[e];if(!a)return;let o=[a.position[0]+M,a.position[1]];if(Qt(o,i,Object.values(t.nodesByName).filter(t=>t.name!==e&&t.type!==`n8n-nodes-base.stickyNote`)))return;let{nodesToMove:s,stickiesToStretch:c,stickiesToMoveAndStretch:l,stickyAssociatedNodes:u}=$t(o,e,i);for(let e of s)V(e.id,{x:e.position[0]+n,y:e.position[1]},{trackHistory:r});for(let e of l){let n=t.getNodeById(e.id);n&&en(n,o,i,u.get(e.id)??[],{trackHistory:r})}for(let e of c)en(e,o,i,u.get(e.id)??[],{trackHistory:r})}function Q(e,{trackHistory:n=!1,keepPristine:r=!1}={}){let i=t.getNodeById(e.source),c=t.getNodeById(e.target);if(!i||!c)return;n&&a.pushCommandToUndo(new je(pt(i,c,e),Date.now()));let l=pt(i,c,e);ln(i,c,l[0],l[1])&&(t.addConnection({connection:l}),o(()=>{D.updateNodeInputIssues(i),D.updateNodeInputIssues(c)}),r||s.markStateDirty())}function nn(e){let n=e[0].node,r=t.getNodeByName(n),i=e[1].node,a=t.getNodeByName(i);!r||!a||$(dt(r,a,e))}function rn(e,{trackHistory:n=!1,trackBulk:r=!0}={}){let i=t.getNodeById(e);if(!i)return;n&&r&&a.startRecordingUndo();let o=(0,Vt.default)(t.workflow.connections);for(let e of Object.keys(o)){let r=t.getNodeByName(e);if(r)for(let a of Object.keys(o[e]))for(let s of Object.keys(o[e][a])){let c=o[e][a][parseInt(s,10)]??[];for(let e of Object.keys(c)){let o=c[parseInt(e,10)];if(!o)continue;let l=t.getNodeByName(o.node);l&&(l.id===i.id||r.name===i.name)&&$({source:r.id,sourceHandle:W({mode:P.Output,type:a,index:parseInt(s,10)}),target:l.id,targetHandle:W({mode:P.Input,type:o.type,index:o.index})},{trackHistory:n,trackBulk:!1})}}}delete t.workflow.connections[i.name],n&&r&&a.stopRecordingUndo()}function $(e,{trackHistory:n=!1,trackBulk:r=!0}={}){let i=t.getNodeById(e.source),s=t.getNodeById(e.target);if(!i||!s)return;let c=pt(i,s,e);n&&r&&a.startRecordingUndo(),t.removeConnection({connection:c}),o(()=>{D.updateNodeInputIssues(i),D.updateNodeInputIssues(s)}),n&&(a.pushCommandToUndo(new He(c,Date.now())),r&&a.stopRecordingUndo())}function an(e){t.addConnection({connection:e})}function on(e,n){let r=t.getNodeById(e),i=n===P.Input;r&&u.getNodeType(r.type,r.typeVersion)&&mt(t.workflow.connections,t.workflow.nodes).forEach(n=>{if(i?n.target===e:n.source===e){let e=i?n.source:n.target,a=t.getNodeById(e);if(!a||!n.data)return;let[s,c]=i?[a,r]:[r,a];ln(s,c,n.data.source,n.data.target)||o(()=>$(n))}})}function sn(e){return on(e,P.Input)}function cn(e){return on(e,P.Output)}function ln(e,t,n,r){let i=[B],a=e=>qe(e.type)&&!re().getIsNodeInstalled(e.type),o=a(e),s=a(t),c=e=>u.getNodeType(e.type,e.typeVersion)??u.communityNodeType(e.type)?.nodeDescription,l=(e,t)=>e.filter(e=>(typeof e==`string`?e:e.type)===t),d=e=>{if(e&&typeof e==`object`&&`filter`in e)return e.filter};if(n.type!==r.type||i.includes(e.type)||i.includes(t.type))return!1;let f=c(e),p=R.value.getNode(e.name);if(!p)return!1;let m=[];f&&(m=Xe(R.value,p,f)||[]);let h=l(m,n.type),g=h.length>0,_=n.index<h.length,v=d(_?h[n.index]:void 0);if((!g||!_)&&!o)return!1;let y=c(t),b=R.value.getNode(t.name);if(!b)return!1;let C=[];y&&(C=at(R.value,b,y)||[]);let w=l(C,r.type),T=w.length>0,E=r.index<w.length,D=d(E?w[r.index]:void 0);function O(e,t){let n=!!e?.nodes?.length&&!e.nodes.includes(t),r=!!e?.excludedNodes?.length&&e.excludedNodes.includes(t);return n||r}let ee=O(D,e.type),k=O(v,t.type);return ee||k?(S.showToast({title:x.baseText(`nodeView.showError.nodeNodeCompatible.title`),message:x.baseText(`nodeView.showError.nodeNodeCompatible.message`,{interpolate:{sourceNodeName:e.name,targetNodeName:t.name}}),type:`error`,duration:5e3}),!1):!((!T||!E)&&!s)}async function un(e,{trackBulk:t=!0,trackHistory:n=!1,keepPristine:r=!1}={}){await o(),t&&n&&a.startRecordingUndo();for(let t of e)Q(t,{trackHistory:n,keepPristine:r});t&&n&&a.stopRecordingUndo(),r||s.markStateDirty()}function dn(){if(m.setNodeCreatorState({createNodeActive:!1}),m.setShowScrim(!1),t.executionWaitingForWebhook)try{t.removeTestWebhook(t.workflowId)}catch{}t.resetWorkflow(),r.resetState(),t.currentWorkflowExecutions=[],r.setActiveExecutionId(void 0),t.lastSuccessfulExecution=null,s.resetLastInteractedWith(),s.markStateClean(),h.activeExecution=null,D.credentialsUpdated.value=!1}async function fn(e){let{workflowDocumentStore:n}=await C.initState(e,se());return e.nodes.forEach(e=>{let t=J(e.type,e.typeVersion),n=u.getIsNodeInstalled(e.type);D.matchCredentials(e),n&&(qt(e,t),Xt(e,t))}),t.setNodes(e.nodes),t.setConnections(e.connections),r.setWorkflowProperty(`createdAt`,e.createdAt),r.setWorkflowProperty(`updatedAt`,e.updatedAt),{workflowDocumentStore:n}}let pn=e=>{e.forEach(e=>{let n=J(de(e.type),e.typeVersion);D.matchCredentials(e),qt(e,n),Xt(e,n);let i=t.workflow.nodes.findIndex(t=>t.name===e.name);r.updateNodeAtIndex(i,{...e,type:de(e.type)})})};function mn(e){if(e?.nodes){for(let t of e.nodes)if(t.credentials)for(let[e,n]of Object.entries(t.credentials))typeof n==`string`||n.id===null||i.getCredentialById(n.id)||delete t.credentials[e]}}async function hn(n,{trackBulk:r=!0,trackHistory:i=!1,viewport:o=ae,setStateDirty:c=!0}={}){let l={},d=new Set((n.nodes??[]).map(e=>e.name));if(!n.nodes)throw Error(x.baseText(`nodeView.noNodesGivenToAdd`));let f=C.getNodeTypesMaxCount(),p,m,h=[];await D.loadNodesProperties(n.nodes.map(e=>({name:e.type,version:e.typeVersion}))),n.nodes.forEach(t=>{if(f[t.type]!==void 0)if(f[t.type].exist>=f[t.type].max){l[t.name]=f[t.type].nodeNames[0];return}else f[t.type].exist+=1;p=t.name;let n=x.localizeNodeName(e.defaultLocale,t.name,t.type);d.delete(p),m=A(n,Array.from(d)),d.add(m),l[p]=m,h.push(t)});let g={},_=n.connections??{},v=h.map(e=>e.name),y,b,w,T,E;for(y of Object.keys(_)){if(!v.includes(y))continue;let e={};for(b of Object.keys(_[y]))for(e[b]=[],w=0;w<_[y][b].length;w++){let t=[],n=_[y][b][w];if(n)for(T=0;T<n.length;T++)E=n[T],v.includes(E.node)&&t.push(E);e[b].push(t)}g[y]=e}let O=t.createWorkflowObject(h,g,!0);for(let e of Object.keys(O.nodes)){let t=O.nodes[e];u.getIsNodeInstalled(t.type)||(t.parameters=h.find(t=>t.name===e)?.parameters??t.parameters)}for(p in l){let e=l[p];!e||p===e||O.renameNode(p,e)}if(n.pinData){let e=!0;for(let t of Object.keys(n.pinData)){if(!e){S.showError(Error(x.baseText(`ndv.pinData.error.tooLarge.description`)),x.baseText(`ndv.pinData.error.tooLarge.title`));continue}let r=O.nodes[l[t]??t];if(r)try{ut(r).setData(n.pinData[t],`add-nodes`),e=!0}catch(t){e=!1,console.error(t)}}}return r&&i&&a.startRecordingUndo(),await Y(Object.values(O.nodes),{trackBulk:!1,trackHistory:i,viewport:o,keepPristine:!0}),await un(mt(O.connectionsBySourceNode,Object.values(O.nodes)),{trackBulk:!1,trackHistory:i,keepPristine:!0}),r&&i&&a.stopRecordingUndo(),c?s.markStateDirty():s.markStateClean(),{nodes:Object.values(O.nodes),connections:O.connectionsBySourceNode}}async function gn(n,i,{importTags:a=!0,trackBulk:o=!0,trackHistory:c=!0,viewport:l,regenerateIds:d=!0,trackEvents:p=!0,setStateDirty:m=!0}={}){if(s.resetLastInteractedWith(),!n.hasOwnProperty(`nodes`)||!n.hasOwnProperty(`connections`))return{};try{let s={};if(n.nodes){let e=new Set(n.nodes.map(e=>e.name));n.nodes.forEach(t=>{if(!t.name){let n=A(u.getNodeType(t.type)?.displayName??t.type,Array.from(e));t.name=n,e.add(n)}if(t.webhookId&&st.includes(t.type)&&t.webhookId&&(D.assignWebhookId(t),t.parameters.path?t.parameters.path=t.webhookId:t.parameters.options?.path&&(t.parameters.options.path=t.webhookId)),t.id){let e=t.id;if(d){let n=D.assignNodeId(t);s[n]=e}}else D.assignNodeId(t)})}mn(n);try{if(p){let r=JSON.stringify(nt(n,C.getNodeTypes(),{nodeIdMap:s,sourceInstanceId:n.meta&&n.meta.instanceId!==e.instanceId?n.meta.instanceId:``,isCloudDeployment:f.isCloudDeployment}).nodeGraph);i===`paste`?O.track(`User pasted nodes`,{workflow_id:t.workflowId,node_graph_string:r}):i===`duplicate`?O.track(`User duplicated nodes`,{workflow_id:t.workflowId,node_graph_string:r}):O.track(`User imported workflow`,{source:i,workflow_id:t.workflowId,node_graph_string:r})}}catch{}return C.updateNodePositions(n,j(L.value.nodes,We.value,{...n.nodes&&n.nodes.length>1?{size:fe(n.nodes)}:{},viewport:l})),await hn(n,{trackBulk:o,trackHistory:c,viewport:l,setStateDirty:m}),a&&f.areTagsEnabled&&Array.isArray(n.tags)&&await _n(n),n.name&&r.setWorkflowName({newName:n.name,setStateDirty:m}),n}catch(e){return console.error(e),S.showError(e,x.baseText(`nodeView.showError.importWorkflowData.title`)),{}}}async function _n(e){let n=await p.fetchAll(),r=new Set(n.map(e=>e.name)),i=e.tags,a=i.filter(e=>!r.has(e.name)),o=[];for(let e of a){let t=p.create(e.name).then(e=>(n.push(e),e));o.push(t)}await Promise.all(o);let s=i.reduce((e,t)=>{let r=n.find(e=>e.name===t.name);return r&&e.push(r.id),e},[]);De(Oe(t.workflowId)).addTags(s)}async function vn(e){let n,r=g.currentProjectId??g.personalProject?.id;if(!r)throw Error(`No project selected`);d.startLoading();try{n=await t.getWorkflowFromUrl(e,r)}catch(e){S.showError(e,x.baseText(`nodeView.showError.getWorkflowDataFromUrl.title`));return}finally{d.stopLoading()}return n}function yn(e){let n={nodes:[],connections:{},pinData:{}},r=new Set;for(let i of e){let e=C.getNodeDataToSave(i),a=t.pinDataByNodeName(i.name);a&&(n.pinData[i.name]=a),e.credentials&&f.isEnterpriseFeatureEnabled[Je.Sharing]&&(e.credentials=bn(e.credentials,t.usedCredentials)),n.nodes.push(e),r.add(i.name)}return n.connections=xn(n.nodes,r),C.removeForeignCredentialsFromWorkflow(n,i.allCredentials),n}function bn(e,t){return Object.fromEntries(Object.entries(e).filter(([,e])=>e.id&&(!t[e.id]||t[e.id]?.currentUserHasAccess)))}function xn(e,n){let r={};for(let i of e){let e=t.outgoingConnectionsByNodeName(i.name);if(!Object.keys(e).length)continue;let a=Sn(e,n);Object.keys(a).length&&(r[i.name]=a)}return r}function Sn(e,t){let n={};for(let[r,i]of Object.entries(e)){let e=i.map(e=>(e??[]).filter(e=>t.has(e.node)));e.length&&(n[r]=e)}return n}async function Cn(e,n={}){return(await gn(Ge(yn(t.getNodesByIds(e))),`duplicate`,{viewport:n.viewport,importTags:!1})).nodes?.map(e=>e.id).filter(be)??[]}async function wn(n){let r=Ge(yn(t.getNodesByIds(n)));r.meta={...r.meta,...t.workflow.meta,instanceId:e.instanceId},await ie.copy(JSON.stringify(r,null,2)),O.track(`User copied nodes`,{node_types:r.nodes.map(e=>e.type),workflow_id:t.workflowId})}async function Tn(e){await wn(e),yt(e)}async function En(e,n){let i;try{i=await t.getExecution(e)}catch(e){S.showError(e,x.baseText(`nodeView.showError.openExecution.title`));return}if(i===void 0)throw Error(`Execution with id "${e}" could not be found!`);if(i.status===`error`&&i.data?.resultData.error){let{title:e,message:t}=Ve({error:i.data.resultData.error,lastNodeExecuted:i.data.resultData.lastNodeExecuted});S.showMessage({title:e,message:t,type:`error`,duration:0})}if(await fn(i.workflowData),r.setWorkflowExecutionData(i),[`manual`,`evaluation`].includes(i.mode)||r.setWorkflowPinData({}),n){let e=t.getNodeById(n);e?l.setActiveNodeName(e.name,`other`):S.showError(Error(`Node with id "${n}" could not be found!`),x.baseText(`nodeView.showError.openExecution.node`))}return s.markStateClean(),i}function Dn(e){if(!t.allNodes.some(Se))return;let n=t.workflowObject;_.toggleOpen(!0);let r={workflow_id:n.id,button_type:e};k.run(`nodeView.onOpenChat`,r),O.track(`User clicked chat open button`,r),setTimeout(()=>{Mt.emit(`focusInput`)},0)}async function On({id:e,name:n,workflow:i}){let a=i.nodes?.map(t.convertTemplateNodeToNodeUi);i.connections&&t.setConnections(i.connections),await Y(a??[],{keepPristine:!0}),await r.getNewWorkflowDataAndMakeShareable(n,g.currentProjectId),r.addToWorkflowMetadata({templateId:`${e}`})}function kn(n){let r=t.getNodeById(n);if(!r)return!1;let i=Ye(r);return i?(window.open(`${e.baseUrl}workflow/${i}`,`_blank`),!0):!1}function An(e,n,{trackHistory:r=!0,trackBulk:i=!0}={}){let o=t.getNodeById(e),c=t.getNodeById(n);if(!o||!c)return;r&&i&&a.startRecordingUndo();let[l,u]=o.position;V(n,{x:l,y:u},{trackHistory:r}),Ct(e,n,{trackBulk:!1,trackHistory:r}),K(e,{trackHistory:r,trackBulk:!1}),s.markStateDirty(),r&&i&&a.stopRecordingUndo()}async function jn(e,t,{trackBulk:n=!0,trackHistory:r=!0,...i}){r&&n&&a.startRecordingUndo();let o=await Y(e,{...i,trackHistory:r,trackBulk:!1,telemetry:!0}),c=L.value.nodes.length-e.length;if(await un(t.map(({from:e,to:t})=>{let n=L.value.nodes[c+e.nodeIndex],r=L.value.nodes[c+t.nodeIndex],i=e.type??t.type??H.Main;return{source:n.id,sourceHandle:W({mode:P.Output,type:ve(i)?i:H.Main,index:e.outputIndex??0}),target:r.id,targetHandle:W({mode:P.Input,type:ve(i)?i:H.Main,index:t.inputIndex??0}),data:{source:{index:e.outputIndex??0,type:i},target:{index:t.inputIndex??0,type:i}}}}),{trackHistory:r,trackBulk:!1}),s.resetLastInteractedWith(),o.length>0&&i.replaceNodeId){let e=o[o.length-1].id;An(i.replaceNodeId,e,{trackHistory:r,trackBulk:!1})}return r&&n&&a.stopRecordingUndo(),{addedNodes:o}}function Mn(){setTimeout(()=>zt.emit(`fitView`))}function Nn(e){O.track(`User inserted workflow template`,{source:`workflow`,template_id:Ae(e),wf_template_repo_session_id:y.previousSessionId})}async function Pn(e){dn(),d.startLoading(),d.setLoadingText(x.baseText(`nodeView.loadingTemplate`)),t.currentWorkflowExecutions=[],h.activeExecution=null;let n;try{if(k.run(`template.requested`,{templateId:e}),n=await y.getFixedWorkflowTemplate(e),!n)throw Error(x.baseText(`nodeView.workflowTemplateWithIdCouldNotBeFound`,{interpolate:{templateId:e}}))}catch(e){S.showError(e,x.baseText(`nodeView.couldntImportWorkflow`)),await F.replace({name:rt.NEW_WORKFLOW});return}Nn(e),s.isBlankRedirect=!0,await F.replace({name:rt.NEW_WORKFLOW,query:{templateId:e}}),await On({id:e,name:n.name,workflow:n.workflow}),typeof I.params.name==`string`&&r.setWorkflowId(I.params.name),d.stopLoading(),k.run(`template.open`,{templateId:e,templateName:n.name,workflow:n.workflow}),Mn()}async function Fn(e){if(!e.nodes||!e.connections){S.showError(Error(x.baseText(`nodeView.couldntLoadWorkflow.invalidWorkflowObject`)),x.baseText(`nodeView.couldntImportWorkflow`)),await F.replace({name:rt.NEW_WORKFLOW});return}dn(),d.startLoading(),d.setLoadingText(x.baseText(`nodeView.loadingTemplate`)),t.currentWorkflowExecutions=[],h.activeExecution=null,s.isBlankRedirect=!0;let n=e.meta.templateId,r=I.query.parentFolderId;await g.refreshCurrentProject(),await Ce(r),await F.replace({name:rt.NEW_WORKFLOW,query:{templateId:n,parentFolderId:r,projectId:g.currentProjectId}}),await On({id:n,name:e.name,workflow:e}),d.stopLoading(),Mn()}return{lastClickPosition:We,editableWorkflow:L,editableWorkflowObject:R,triggerNodes:z,requireNodeTypeDescription:J,addNodes:Y,addNode:Pt,resolveNodePosition:Jt,revertAddNode:Ft,updateNodesPosition:tt,updateNodePosition:V,tidyUp:Ze,revertUpdateNodePosition:it,setNodeActive:wt,setNodeActiveByName:Tt,clearNodeActive:Et,setNodeSelected:q,toggleNodesDisabled:Ot,revertToggleNodeDisabled:kt,toggleNodesPinned:At,setNodeParameters:Dt,renameNode:gt,revertRenameNode:_t,replaceNodeParameters:U,revertReplaceNodeParameters:G,deleteNode:K,deleteNodes:yt,copyNodes:wn,cutNodes:Tn,duplicateNodes:Cn,getNodesToSave:yn,getNodesToShift:$t,revertDeleteNode:bt,addConnections:un,createConnection:Q,revertCreateConnection:nn,deleteConnection:$,revertDeleteConnection:an,deleteConnectionsByNodeId:rn,revalidateNodeInputConnections:sn,revalidateNodeOutputConnections:cn,isConnectionAllowed:ln,filterConnectionsByNodes:Sn,connectAdjacentNodes:vt,importWorkflowData:gn,fetchWorkflowDataFromUrl:vn,resetWorkspace:dn,initializeWorkspace:fn,resolveNodeWebhook:Xt,openExecution:En,startChat:Dn,importTemplate:On,replaceNodeConnections:Ct,tryToOpenSubworkflowInNewTab:kn,initializeUnknownNodes:pn,replaceNode:An,addNodesAndConnections:jn,fitView:Mn,openWorkflowTemplate:Pn,openWorkflowTemplateFromJSON:Fn}}export{q as _,It as a,Pt as c,Mt as d,J as f,Ot as g,kt as h,Rt as i,X as l,jt as m,Bt as n,Ft as o,Y as p,zt as r,Nt as s,Ut as t,Z as u,Dt as v,Et as y};
//# sourceMappingURL=useCanvasOperations-BHGWcL34.js.map