(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`d1e281dc-a9e7-4b46-9c90-79a86610a217`,e._sentryDebugIdIdentifier=`sentry-dbid-d1e281dc-a9e7-4b46-9c90-79a86610a217`)})()}catch{}import{C as e,It as t}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{Es as n,Hr as r,Lt as i,Ts as a,Wc as o,r as s,t as c,ws as l,yr as u}from"./users.store-pCkD7Zo0.js";import{As as d,Ga as f,Ys as p,ks as m,sc as h}from"./constants-D1jZwsUK.js";import{j as g,r as _}from"./_baseOrderBy-El3qbNHQ.js";const v=/^(?<major>0|[1-9]\d*)\.(?<minor>0|[1-9]\d*)\.(?<patch>0|[1-9]\d*)(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<buildmetadata>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,y=g(o.VERSIONS,()=>{let o=t({enabled:!1,whatsNewEnabled:!1,endpoint:``,whatsNewEndpoint:``,infoUrl:``}),g=t([]),y=t(),b=t({title:``,createdAt:new Date().toISOString(),updatedAt:null,calloutText:``,footer:``,items:[]}),x=t(),S=i(),{showToast:C,showMessage:w}=u(),T=s(),E=l(),D=c(),O=r(h),k=r(p),A=e(()=>E.settings.releaseChannel===`stable`&&g.value.length>0),j=e(()=>{if(!A.value||!y.value||!M.value)return!1;if(y.value.hasSecurityIssue)return!0;let e=y.value.name.match(v),t=M.value.name.match(v);if(!e?.groups||!t?.groups)return!1;if(Number(e.groups.major)!==Number(t.groups.major))return!0;let n=Number(e.groups.minor);return Number(t.groups.minor)-n>=2}),M=e(()=>g.value[0]??y.value),N=e(()=>o.value.enabled),P=e(()=>o.value.infoUrl),F=e(()=>O.value?f(O.value,{fallbackValue:[]}):[]),I=e(()=>k.value?f(k.value,{fallbackValue:[]}):[]),L=e(()=>b.value.items),R=async()=>{try{let{enabled:e,endpoint:t}=o.value;if(e&&t){let e=_(),n=e.versionCli,r=e.instanceId;z({versions:await a(t,n,r),currentVersion:n})}}catch(e){console.error(`Failed to fetch versions:`,e)}},z=e=>{g.value=e.versions.filter(t=>t.name!==e.currentVersion),y.value=e.versions.find(t=>t.name===e.currentVersion)},B=e=>{b.value=e},V=e=>{F.value.includes(e)||(O.value=JSON.stringify([...F.value,e]))},H=e=>F.value.includes(e),U=()=>{x.value?.close(),x.value=void 0},W=()=>{k.value=JSON.stringify(L.value.map(e=>e.id))},G=()=>{let e=D.currentUser?.createdAt,t=!1;if(e){let n=new Date(e).getTime();t=L.value.some(e=>(e.updatedAt?new Date(e.updatedAt).getTime():0)>n)}else t=!0;let n=L.value.every(e=>I.value.includes(e.id));return t&&!n},K=async()=>{try{let{enabled:e,whatsNewEnabled:t,whatsNewEndpoint:r}=o.value;if(e&&t&&r){let e=_(),t=e.versionCli,i=e.instanceId,a=await n(r,t,i);a.items?.length>0&&(B(a),G()&&(x.value=w({title:b.value.title,message:b.value.calloutText,duration:0,position:`bottom-left`,customClass:`clickable whats-new-notification`,onClick:()=>{let e=b.value.items[0]?.id??0;S.track(`User clicked on what's new notification`,{article_id:e}),T.openModalWithData({name:d,data:{articleId:e}})},onClose:()=>{W()}})))}}catch(e){console.error(`Failed to fetch Whats New section:`,e)}};return{currentVersion:y,latestVersion:M,nextVersions:g,hasVersionUpdates:A,hasSignificantUpdates:j,areNotificationsEnabled:N,infoUrl:P,fetchVersions:R,setVersions:z,initialize:e=>{o.value=e},checkForNewVersions:async()=>{if(N.value&&(await Promise.all([R(),K()]),y.value&&y.value.hasSecurityIssue&&g.value.length)){let e=y.value.securityIssueFixVersion,t=`Please update to latest version.`;e&&(t=`Please update to version ${e} or higher.`),t=`${t} <a class="primary-color">More info</a>`,C({title:`Critical update available`,message:t,onClick:()=>{T.openModal(m)},closeOnClick:!0,customClass:`clickable`,type:`warning`,duration:0})}},fetchWhatsNew:K,whatsNew:b,whatsNewArticles:L,isWhatsNewArticleRead:H,setWhatsNewArticleRead:V,closeWhatsNewCallout:U,shouldShowWhatsNewCallout:G,dismissWhatsNewCallout:W}});export{y as t};
//# sourceMappingURL=versions.store-1_eor2Ku.js.map