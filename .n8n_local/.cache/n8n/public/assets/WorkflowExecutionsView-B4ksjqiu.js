(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`78a09149-da12-4aa6-95b8-90e3b1bbab1a`,e._sentryDebugIdIdentifier=`sentry-dbid-78a09149-da12-4aa6-95b8-90e3b1bbab1a`)})()}catch{}import{C as e,Cn as t,D as n,E as r,Gt as i,It as a,J as o,M as s,P as c,T as l,Z as u,_ as d,_t as f,bt as p,et as m,it as h,j as g,ot as _,r as v,vn as y,w as b}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as x}from"./_MapCache-DjbOQyB7.js";import{A as S,Ci as C,Dt as w,Et as T,F as E,Oi as D,Si as O,Ui as k,Vi as A,st as j,wi as M,zi as N}from"./src-CppJvwzX.js";import{t as P}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import"./date-picker-CHH0vNVG.js";import{Gr as F,Ln as I,Lt as L,Rr as R,g as z,pn as B,s as V,ws as H,yr as U}from"./users.store-pCkD7Zo0.js";import{Tc as W,Yc as G,ns as K,qo as q,rs as J}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import{s as Y}from"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import{t as X}from"./useDebounce-D6lADr4O.js";import"./versions.store-1_eor2Ku.js";import{t as ee}from"./usePageRedirectionHelper-BoF8hzbN.js";import{t as Z}from"./executions.store-DnLtKXBA.js";import{a as Q,i as te}from"./dateFormatter-C82w-7IH.js";import{t as ne}from"./useExecutionHelpers-mcaelfkG.js";import"./TagsDropdown-B5U3GUsU.js";import"./WorkflowTagsDropdown-Bab-8Jcr.js";import{t as $}from"./injectStrict-CjZBqt9B.js";import{t as re}from"./WorkflowExecutionsInfoAccordion-BAON_vu5.js";import"./AnnotationTagsDropdown.ee-Cj5VoFhA.js";import{i as ie,n as ae,r as oe,t as se}from"./ExecutionsTime-BalErGV0.js";import{t as ce}from"./useIntersectionObserver-CdOhbl0L.js";var le={key:2},ue=P(c({__name:`WorkflowExecutionsCard`,props:{execution:{},highlight:{type:Boolean},showGap:{type:Boolean},workflowPermissions:{}},emits:[`retryExecution`,`mounted`],setup(a,{emit:o}){let c=a,d=o,f=C(),h=x(),v=ne(),T=H(),O=e(()=>T.isEnterpriseFeatureEnabled[G.AdvancedExecutionFilters]),j=e(()=>O.value),M=$(W),N=e(()=>[{id:`current-workflow`,label:h.baseText(`executionsList.retryWithCurrentlySavedWorkflow`)},{id:`original-workflow`,label:h.baseText(`executionsList.retryWithOriginalWorkflow`)}]),P=e(()=>v.getUIDetails(c.execution)),F=e(()=>c.execution.id===f.params.executionId),I=e(()=>v.isExecutionRetriable(c.execution));u(()=>{d(`mounted`,c.execution.id)});function L(e){d(`retryExecution`,{execution:c.execution,command:e})}return(e,o)=>{let c=_(`RouterLink`);return m(),n(`div`,{class:y({"execution-card":!0,[e.$style.WorkflowExecutionsCard]:!0,[e.$style.active]:F.value,[e.$style[P.value.name]]:!0,[e.$style.highlight]:a.highlight,[e.$style.showGap]:a.showGap})},[s(c,{class:y(e.$style.executionLink),to:{name:i(J).EXECUTION_PREVIEW,params:{name:i(M),executionId:a.execution.id},query:i(f).query},"data-test-execution-status":P.value.name},{default:p(()=>[b(`div`,{class:y(e.$style.description)},[P.value.name===`new`?(m(),l(i(A),{key:0,color:`text-dark`,bold:!0,size:`medium`,"data-test-id":`execution-time`},{default:p(()=>[g(t(i(te)(P.value.createdAt))+` - `+t(i(h).baseText(`executionDetails.startingSoon`)),1)]),_:1})):(m(),l(i(A),{key:1,color:`text-dark`,bold:!0,size:`medium`,"data-test-id":`execution-time`},{default:p(()=>[g(t(P.value.startTime),1)]),_:1})),b(`div`,{class:y(e.$style.executionStatus)},[P.value.name===`running`?(m(),l(i(E),{key:0,size:`small`,class:y([e.$style.spinner,`mr-4xs`])},null,8,[`class`])):r(``,!0),s(i(A),{class:y(e.$style.statusLabel),size:`small`},{default:p(()=>[g(t(P.value.label),1)]),_:1},8,[`class`]),o[0]||=g(` `+t(` `)+` `,-1),P.value.name===`running`&&!a.execution.stoppedAt?(m(),l(i(A),{key:1,color:F.value?`text-dark`:`text-base`,size:`small`,"data-test-id":`execution-time-in-status`},{default:p(()=>[g(t(i(h).baseText(`executionDetails.runningTimeRunning`))+` `,1),s(se,{"start-time":a.execution.startedAt??a.execution.createdAt},null,8,[`start-time`])]),_:1},8,[`color`])):r(``,!0),P.value.name===`new`&&a.execution.createdAt?(m(),l(i(A),{key:2,color:F.value?`text-dark`:`text-base`,size:`small`},{default:p(()=>[b(`span`,null,t(i(h).baseText(`executionDetails.at`))+` `+t(i(Q)(a.execution.createdAt)),1)]),_:1},8,[`color`])):P.value.runningTime===``?r(``,!0):(m(),l(i(A),{key:3,color:F.value?`text-dark`:`text-base`,size:`small`},{default:p(()=>[g(t(i(h).baseText(`executionDetails.runningTimeFinished`,{interpolate:{time:P.value?.runningTime}})),1)]),_:1},8,[`color`]))],2),a.execution.mode===`retry`?(m(),n(`div`,le,[s(i(A),{color:F.value?`text-dark`:`text-base`,size:`small`},{default:p(()=>[g(t(i(h).baseText(`executionDetails.retry`))+` #`+t(a.execution.retryOf),1)]),_:1},8,[`color`])])):r(``,!0),j.value?(m(),n(`div`,{key:3,class:y(e.$style.annotation)},[a.execution.annotation?.vote?(m(),n(`div`,{key:0,class:y(e.$style.ratingIcon)},[a.execution.annotation.vote==`up`?(m(),l(i(k),{key:0,class:y(e.$style.up),icon:`thumbs-up`},null,8,[`class`])):(m(),l(i(k),{key:1,class:y(e.$style.down),icon:`thumbs-down`},null,8,[`class`]))],2)):r(``,!0),P.value.tags.length>0?(m(),l(i(S),{key:1,tags:P.value.tags,clickable:!1},null,8,[`tags`])):r(``,!0)],2)):r(``,!0)],2),b(`div`,{class:y(e.$style.icons)},[I.value?(m(),l(i(w),{key:0,class:y([e.$style.icon,e.$style.retry]),items:N.value,disabled:!a.workflowPermissions.execute,"activator-icon":`redo-2`,"data-test-id":`retry-execution-button`,onSelect:L},null,8,[`class`,`items`,`disabled`])):r(``,!0),a.execution.mode===`manual`?(m(),l(i(D),{key:1,placement:`top`},{content:p(()=>[b(`span`,null,t(i(h).baseText(`executionsList.test`)),1)]),default:p(()=>[s(i(k),{class:y([e.$style.icon,e.$style.manual]),icon:`flask-conical`},null,8,[`class`])]),_:1})):r(``,!0),a.execution.mode===`evaluation`?(m(),l(i(D),{key:2,placement:`top`},{content:p(()=>[b(`span`,null,t(i(h).baseText(`executionsList.evaluation`)),1)]),default:p(()=>[s(i(k),{class:y([e.$style.icon,e.$style.evaluation]),icon:`check-check`},null,8,[`class`])]),_:1})):r(``,!0)],2)]),_:1},8,[`class`,`to`,`data-test-execution-status`])],2)}}}),[[`__cssModules`,{$style:{WorkflowExecutionsCard:`_WorkflowExecutionsCard_m24vz_125`,active:`_active_m24vz_132`,executionStatus:`_executionStatus_m24vz_135`,executionLink:`_executionLink_m24vz_138`,new:`_new_m24vz_141`,spinner:`_spinner_m24vz_141`,running:`_running_m24vz_141`,statusLabel:`_statusLabel_m24vz_148`,success:`_success_m24vz_153`,waiting:`_waiting_m24vz_162`,error:`_error_m24vz_168`,unknown:`_unknown_m24vz_174`,annotation:`_annotation_m24vz_177`,ratingIcon:`_ratingIcon_m24vz_184`,up:`_up_m24vz_184`,down:`_down_m24vz_187`,icon:`_icon_m24vz_204`,icons:`_icons_m24vz_209`,retry:`_retry_m24vz_217`,manual:`_manual_m24vz_220`,showGap:`_showGap_m24vz_228`}}]]),de={key:0,class:`mr-l`},fe={key:3,class:`mr-m`},pe=P(c({__name:`WorkflowExecutionsSidebar`,props:{workflow:{},executions:{},loading:{type:Boolean},loadingMore:{type:Boolean},temporaryExecution:{}},emits:[`retryExecution`,`loadMore`,`filterUpdated`,`update:autoRefresh`,`execution:stopMany`],setup(o,{emit:c}){let u=o,_=c,S=C(),w=M(),E=x(),D=Z(),O=H(),k=ee(),P=a({activeExecutionSet:!1,cardsMounted:!1,scroll:!0}),I=a({}),L=a(null),{observe:R}=ce({root:L,threshold:.01,onIntersect:()=>_(`loadMore`,20)}),z=e(()=>q(u.workflow?.scopes).workflow),B=e(()=>O.isConcurrencyEnabled&&!O.isQueueModeEnabled);f(()=>S,(e,t)=>{t.name===J.EXECUTION_PREVIEW&&e.name===J.EXECUTION_HOME&&w.go(-1)}),f(()=>D.activeExecution,(e,t)=>{e&&e.id!==t?.id&&(P.value.activeExecutionSet=!0)}),f(P,e=>{Object.values(e).every(Boolean)&&X()},{deep:!0});function V(e,t){e&&F(e)&&t&&(I.value[t]=e)}function U(e){let t=u.executions.findIndex(t=>t.id===e);if(D.activeExecution?.id===e&&(P.value.activeExecutionSet=!0,P.value.cardsMounted=!0),t===u.executions.length-1&&!u.loading&&!u.loadingMore){let t=I.value[e]?.$el;R(t)}}function W(e=20){if(!u.loading&&L.value){let t=L.value.offsetHeight-(L.value.scrollHeight-L.value.scrollTop);t>-10&&t<10&&_(`loadMore`,e)}}function G(e){_(`retryExecution`,e)}function K(e){P.value.activeExecutionSet=!1,P.value.cardsMounted=!1,P.value.scroll=!0,_(`filterUpdated`,e)}function Y(e){_(`update:autoRefresh`,e)}function X(){if(L.value&&D.activeExecution&&I.value[D.activeExecution.id]){let e=I.value[D.activeExecution.id].$el.getBoundingClientRect();e.top>L.value.offsetHeight&&(P.value.scroll=!1,L.value.scrollTo({top:e.top-200,behavior:`smooth`}))}}let Q=()=>{k.goToUpgrade(`concurrency`,`upgrade-concurrency`)};return(e,a)=>(m(),n(`div`,{class:y([`executions-sidebar`,e.$style.container]),"data-test-id":`executions-sidebar`},[b(`div`,{class:y(e.$style.heading)},[s(i(N),{tag:`h2`,size:`medium`,color:`text-dark`},{default:p(()=>[g(t(i(E).baseText(`generic.executions`)),1)]),_:1}),B.value?(m(),l(ie,{key:0,"running-executions-count":i(D).concurrentExecutionsCount,"concurrency-cap":i(O).concurrency,"is-cloud-deployment":i(O).isCloudDeployment,onGoToUpgrade:Q},null,8,[`running-executions-count`,`concurrency-cap`,`is-cloud-deployment`])):r(``,!0),s(ae,{executions:u.executions},null,8,[`executions`])],2),b(`div`,{class:y(e.$style.controls)},[s(i(j),{modelValue:i(D).autoRefresh,"onUpdate:modelValue":[a[0]||=e=>i(D).autoRefresh=e,Y],"data-test-id":`auto-refresh-checkbox`,label:i(E).baseText(`executionsList.autoRefresh`)},null,8,[`modelValue`,`label`]),s(oe,{"popover-side":`right`,"popover-align":`start`,onFilterChanged:K})],2),b(`div`,{ref_key:`executionListRef`,ref:L,class:y(e.$style.executionList),"data-test-id":`current-executions-list`,onScroll:a[1]||=e=>W(20)},[o.loading?(m(),n(`div`,de,[s(i(T),{variant:`rect`})])):r(``,!0),!o.loading&&o.executions.length===0?(m(),n(`div`,{key:1,class:y(e.$style.noResultsContainer),"data-test-id":`execution-list-empty`},[s(i(A),{color:`text-base`,size:`medium`,align:`center`},{default:p(()=>[g(t(i(E).baseText(`executionsLandingPage.noResults`)),1)]),_:1})],2)):o.temporaryExecution?(m(),l(ue,{key:2,ref:e=>V(e,o.temporaryExecution?.id),execution:o.temporaryExecution,"data-test-id":`execution-details-${o.temporaryExecution.id}`,"show-gap":!0,"workflow-permissions":z.value,onRetryExecution:G},null,8,[`execution`,`data-test-id`,`workflow-permissions`])):r(``,!0),s(v,{name:`executions-list`},{default:p(()=>[(m(!0),n(d,null,h(o.executions,e=>(m(),l(ue,{key:e.id,ref_for:!0,ref:t=>V(t,e.id),execution:e,"workflow-permissions":z.value,"data-test-id":`execution-details-${e.id}`,onRetryExecution:G,onMounted:U},null,8,[`execution`,`workflow-permissions`,`data-test-id`]))),128))]),_:1}),o.loadingMore?(m(),n(`div`,fe,[s(i(T),{variant:`p`,rows:1})])):r(``,!0)],34),b(`div`,{class:y(e.$style.infoAccordion)},[s(re,{"initially-expanded":!1})],2)],2))}}),[[`__cssModules`,{$style:{container:`_container_1nvjo_125`,heading:`_heading_1nvjo_137`,controls:`_controls_1nvjo_144`,executionList:`_executionList_1nvjo_152`,infoAccordion:`_infoAccordion_1nvjo_170`,noResultsContainer:`_noResultsContainer_1nvjo_183`}}],[`__scopeId`,`data-v-b9def645`]]),me=P(c({__name:`WorkflowExecutionsList`,props:{loading:{type:Boolean,default:!1},workflow:{},executions:{default:()=>[]},execution:{},loadingMore:{type:Boolean,default:!1}},emits:[`execution:delete`,`execution:stop`,`execution:retry`,`update:auto-refresh`,`update:filters`,`load-more`,`reload`],setup(t,{emit:i}){let a=t,o=i,{promptSaveUnsavedWorkflowChanges:c}=B({router:M()}),l=e(()=>a.executions.find(e=>e.id===a.execution?.id)?void 0:a.execution??void 0),u=e(()=>a.loading||!a.execution&&a.executions.length),d=()=>{a.execution?.id&&o(`execution:delete`,a.execution.id)},f=()=>{a.execution?.id&&o(`execution:stop`,a.execution.id)},p=e=>{let t=e.command===`current-workflow`;o(`execution:retry`,{id:e.execution.id,loadWorkflow:t})};return O(async(e,t,n)=>{if(I(e)===K.WORKFLOW){n();return}await c(n)}),(e,i)=>{let a=_(`RouterView`);return m(),n(`div`,{class:y(e.$style.container)},[s(pe,{executions:t.executions,loading:t.loading&&!t.executions.length,"loading-more":t.loadingMore,"temporary-execution":l.value,workflow:t.workflow,"onUpdate:autoRefresh":i[0]||=e=>o(`update:auto-refresh`,e),onReloadExecutions:i[1]||=e=>o(`reload`),onFilterUpdated:i[2]||=e=>o(`update:filters`,e),onLoadMore:i[3]||=e=>o(`load-more`),onRetryExecution:p},null,8,[`executions`,`loading`,`loading-more`,`temporary-execution`,`workflow`]),u.value?r(``,!0):(m(),n(`div`,{key:0,class:y(e.$style.content)},[s(a,{name:`executionPreview`,execution:t.execution,onDeleteCurrentExecution:d,onRetryExecution:p,onStopExecution:f},null,8,[`execution`])],2))],2)}}}),[[`__cssModules`,{$style:{container:`_container_pd7qp_125`,content:`_content_pd7qp_131`}}]]),he=c({__name:`WorkflowExecutionsView`,setup(t){let n=Z(),i=V(),s=R(),c=x(),d=L(),p=C(),h=M(),g=U(),{callDebounced:_}=X(),v=a(!1),y=a(!1),b=a(),S=$(W),w=e(()=>{let e=p.params.executionId;return typeof e==`string`?e:void 0}),T=e(()=>S.value?[...n.currentExecutionsByWorkflowId[S.value]??[],...n.executionsByWorkflowId[S.value]??[]]:[]),E=e(()=>T.value.find(e=>e.id===w.value)??D.value),D=a(),O=e(()=>p.query.new===`true`);f(()=>S.value,()=>{N()}),f(()=>w.value,async()=>{await k()}),u(async()=>{N(),S.value&&await Promise.all([n.initialize(S.value),k()]),await j(),document.addEventListener(`visibilitychange`,A)}),o(()=>{n.reset(),document.removeEventListener(`visibilitychange`,A)});async function k(){if(w.value){try{D.value=await n.fetchExecution(w.value),n.activeExecution=D.value}catch(e){g.showError(e,c.baseText(`nodeView.showError.openExecution.title`))}if(!D.value){g.showMessage({type:`error`,title:c.baseText(`openExecution.missingExeuctionId.title`),message:c.baseText(`openExecution.missingExeuctionId.message`)});return}}}function A(){document.visibilityState===`hidden`?n.stopAutoRefreshInterval():n.startAutoRefreshInterval(S.value)}async function j(){p.name===J.EXECUTION_HOME&&T.value.length>0&&b.value&&await h.replace({name:J.EXECUTION_PREVIEW,params:{name:b.value.id,executionId:T.value[0].id},query:p.query}).catch(()=>{})}function N(){if(O.value||!S.value){b.value=i.workflow;return}b.value=s.workflowsById[S.value]??i.workflow}async function P(e){e?await n.startAutoRefreshInterval(S.value):n.stopAutoRefreshInterval()}async function F(){if(S.value)try{await n.fetchExecutions({...n.executionsFilters,workflowId:S.value})}catch(e){e.errorCode===999?g.showMessage({title:c.baseText(`executionsList.showError.refreshData.title`),message:e.message,type:`error`,duration:3500},!1):g.showError(e,c.baseText(`executionsList.showError.refreshData.title`))}}async function I(e){n.reset(),n.setFilters(e),await n.initialize(S.value)}async function B(e){if(e)try{await n.stopCurrentExecution(e),g.showMessage({title:c.baseText(`executionsList.showMessage.stopExecution.title`),message:c.baseText(`executionsList.showMessage.stopExecution.message`,{interpolate:{activeExecutionId:e}}),type:`success`}),await F()}catch(e){g.showError(e,c.baseText(`executionsList.showError.stopExecution.title`))}}async function H(e){if(e){v.value=!0;try{let t=T.value.findIndex(t=>t.id===e),r=T.value[t+1]||T.value[t-1]||T.value[0];await n.deleteExecutions({ids:[e]}),b.value&&(T.value.length>0?await h.replace({name:J.EXECUTION_PREVIEW,params:{name:b.value.id,executionId:r.id}}).catch(()=>{}):await h.replace({name:J.EXECUTION_HOME,params:{name:b.value.id}}))}catch(e){v.value=!1,g.showError(e,c.baseText(`executionsList.showError.handleDeleteSelected.title`));return}v.value=!1,g.showMessage({title:c.baseText(`executionsList.showMessage.handleDeleteSelected.title`),type:`success`})}}async function G(e){g.showMessage({title:c.baseText(`executionDetails.runningMessage`),type:`info`,duration:2e3}),await K(e),await F(),d.track(`User clicked retry execution button`,{workflow_id:b.value?.id,execution_id:e.id,retry_type:e.loadWorkflow?`current`:`original`})}async function K(e){try{let t=z((await n.retryExecution(e.id,e.loadWorkflow)).status);t&&g.showMessage(t)}catch(e){g.showError(e,c.baseText(`executionsList.showError.retryExecution.title`))}}async function q(){y.value||await _(Y,{debounceTime:1e3})}async function Y(){if(n.executionsFilters.status?.includes(`running`)||T.value.length>=n.executionsCount)return;y.value=!0;let e;T.value.length!==0&&(e=T.value.slice(-1)[0].id);try{await n.fetchExecutions(n.executionsFilters,e)}catch(e){y.value=!1,g.showError(e,c.baseText(`executionsList.showError.loadMore.title`));return}y.value=!1}return(e,t)=>b.value?(m(),l(me,{key:0,executions:T.value,execution:E.value,workflow:b.value,loading:v.value,"loading-more":y.value,"onExecution:stop":B,"onExecution:delete":H,"onExecution:retry":G,"onUpdate:filters":I,"onUpdate:autoRefresh":P,onLoadMore:q,onReload:F},null,8,[`executions`,`execution`,`workflow`,`loading`,`loading-more`])):r(``,!0)}});export{he as default};
//# sourceMappingURL=WorkflowExecutionsView-B4ksjqiu.js.map