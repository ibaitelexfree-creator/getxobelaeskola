(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`7f7288d2-a1de-4a60-827e-5d429d790bcb`,e._sentryDebugIdIdentifier=`sentry-dbid-7f7288d2-a1de-4a60-827e-5d429d790bcb`)})()}catch{}import{It as e}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as t}from"./_MapCache-DjbOQyB7.js";import{Hr as n,Lt as r,Rr as i,r as a,s as o,xr as s,yr as c}from"./users.store-pCkD7Zo0.js";import{Ms as l,Us as u,js as d}from"./constants-D1jZwsUK.js";import{t as f}from"./collaboration.store-QKYwE2H2.js";function p(){let u=e(!1),p=o(),m=i(),h=a(),g=r(),_=c(),v=t(),y=f(),b=e=>{try{let{errorCode:t,hint:n}=e;if(t===409){let e=JSON.parse(n??``);if(Array.isArray(e)&&e.length>0&&Object.hasOwn(e[0],`trigger`))return e}return null}catch{return null}},x=async e=>{let{trigger:t,conflict:n}=b(e)?.pop()||{},r=n?.workflowId;try{n?.workflowId&&(r=(await m.fetchWorkflow(n?.workflowId)).name)}catch{}h.openModalWithData({name:d,data:{triggerType:t?.type,workflowName:r,...n}})},S=e=>b(e)!==null;return{updatingWorkflowActivation:u,publishWorkflow:async(e,t,r)=>{u.value=!0,y.requestWriteAccess();let i=!!m.getWorkflowById(e).activeVersion;if(!i){let t={workflow_id:e,is_active:!0,previous_status:!1,ndv_input:!1};s().run(`workflowActivate.updateWorkflowActivation`,t)}try{let a=e===p.workflowId?p.workflowChecksum:void 0,o=await p.publishWorkflow(e,{versionId:t,name:r?.name,description:r?.description,expectedChecksum:a});if(!o.activeVersion||!o.checksum)throw Error(`Failed to publish workflow`);return p.setWorkflowActive(e,o.activeVersion,!0),e===p.workflowId&&p.setWorkflowVersionData({versionId:o.versionId,name:p.versionData?.name??null,description:p.versionData?.description??null},o.checksum),s().run(`workflow.published`,{workflowId:e,versionId:o.activeVersion.versionId}),!i&&n(`N8N_HIDE_ACTIVATION_ALERT`).value!==`true`&&h.openModal(l),{success:!0}}catch(t){return S(t)?(await x(t),{success:!1,errorHandled:!0}):(_.showError(t,v.baseText(`workflowActivator.showError.title`,{interpolate:{newStateName:`published`}})+`:`),t.meta?.validationError||p.setWorkflowInactive(e),{success:!1})}finally{u.value=!1}},unpublishWorkflowFromHistory:async e=>{u.value=!0,y.requestWriteAccess();let t={workflow_id:e,is_active:!1,previous_status:!!m.getWorkflowById(e).activeVersion,ndv_input:!1};g.track(`User set workflow active status`,t),s().run(`workflowActivate.updateWorkflowActivation`,t);try{let t=e===p.workflowId?p.workflowChecksum:void 0;return await p.deactivateWorkflow(e,t),s().run(`workflow.unpublished`,{workflowId:e}),!0}catch(e){return _.showError(e,v.baseText(`workflowActivator.showError.title`,{interpolate:{newStateName:`deactivated`}})+`:`),!1}finally{u.value=!1}}}}export{p as t};
//# sourceMappingURL=useWorkflowActivate-CpGKv5Cd.js.map