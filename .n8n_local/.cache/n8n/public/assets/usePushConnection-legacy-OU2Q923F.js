!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"n8n@2.9.4"}}catch(t){}}(),System.register(["./vue.runtime.esm-bundler-legacy-BquwEXRp.js","./_MapCache-legacy-BR_CVmoL.js","./users.store-legacy-B-bVJKl3.js","./constants-legacy-DVkAm8xO.js","./_baseOrderBy-legacy-BnyL5wLN.js","./banners.store-legacy-B3TV_6lC.js","./assistant.store-legacy-5vR0xJ8p.js","./useCanvasOperations-legacy-CEMGNuuE.js","./useRunWorkflow-legacy-4stFR283.js","./pushConnection.store-legacy-C36NF7Lj.js","./readyToRun.store-legacy-CKgcGLoh.js","./aiTemplatesStarterCollection.store-legacy-Ch_qppxf.js"],(function(t,e){var o,a,s,n,r,i,c,u,d,l,w,f,k,y,p,g,x,h,E,v,I,D,m,N,S,T,W,b,A,_,C,R,j,L,M,F,O,B,U,P,H,V,z,Q,q;async function G({data:t},e){const o=v(),a=d(),s=h(),n=Q(),c=z();if(e.workflowState.executingNode.lastAddedExecutingNode=null,void 0===o.activeExecutionId)return;const u=i();g();const l=a.getWorkflowById(t.workflowId)?.meta?.templateId;l&&(l===k.EasyAiTemplate?u.track("User executed test AI workflow",{status:t.status}):l.startsWith("035_template_onboarding")?n.trackUserExecutedWorkflow(l.split("-").pop()??"",t.status):"ready-to-run-ai-workflow"===l||"ready-to-run-ai-workflow-v5"===l||"ready-to-run-ai-workflow-v6"===l?"success"===t.status?c.trackExecuteAiWorkflowSuccess():c.trackExecuteAiWorkflow(t.status):r(l)&&u.track("User executed tutorial template",{template:l,status:t.status})),s.setProcessingExecutionResults(!0);let w=!1;"success"===t.status&&($(e.workflowState,t.status,w),w=!0);const f=await J(t.executionId);if(!f)return e.workflowState.setActiveExecutionId(void 0),void s.setProcessingExecutionResults(!1);const y=K(f);s.setProcessingExecutionResults(!1),void 0!==f.data?.waitTill?Y(e):"error"===f.status||"canceled"===f.status?X(f,y):$(e.workflowState,f.status,w),tt(f,y,e.workflowState),function(t,e){if("success"!==t.status||void 0!==t.data?.startData?.destinationNode)return;const o=t.workflowData.nodes.find((t=>t.type===L)),a=o?t?.data?.resultData?.runData[o.name]:void 0;if(!o||void 0===a)return;const s=a[0]?.data?.main[0],n=s?s[0]?.json?._rowsLeft:0;if(n&&n>0){const{runWorkflow:t}=H(e);t({triggerNode:o.name,nodeData:a[0],rerunTriggerNode:!0})}}(f,e)}async function J(t){const e=v();try{const o=await e.fetchExecutionDataById(t);if(!o?.data)return;return{id:t,workflowId:o.workflowId,workflowData:e.workflow,data:c(o.data),status:o.status,startedAt:e.workflowExecutionData?.startedAt,stoppedAt:new Date}}catch{return}}function K(t){return C({...t.data,startData:t.data?.startData,resultData:t.data?.resultData??{runData:{}},executionData:t.data?.executionData})}function Y(t){const e=v(),o=m(),a=x(t),s=e.workflowObject;if(!(e.workflowSettings.saveManualExecutions??o.saveManualExecutions)){const t=h();W.emit("registerGlobalLinkAction",{key:"open-settings",action:async()=>{e.isWorkflowSaved[e.workflowId]||await a.saveAsNewWorkflow(),t.openModal(_)}})}p().setDocumentTitle(s.name,"IDLE")}function X(t,e){const o=b(),s=a(),n=i(),r=v(),c=p(),u=l(),d=r.workflowObject;if(c.setDocumentTitle(d.name,"ERROR"),"ExpressionError"===e.resultData.error?.name&&"pairedItem"===e.resultData.error.functionality){const t=e.resultData.error;u.getWorkflowDataToSave().then((e=>{const o={caused_by_credential:!1,error_message:t.description,error_title:t.message,error_type:t.context.type,node_graph_string:JSON.stringify(j(e,u.getNodeTypes()).nodeGraph),workflow_id:r.workflowId};if(t.context.nodeCause&&["paired_item_no_info","paired_item_invalid_info"].includes(t.context.type)){const e=d.getNode(t.context.nodeCause);e&&(o.is_pinned=!!d.getPinDataOfNode(e.name),o.mode=e.parameters.mode,o.node_type=e.type,o.operation=e.parameters.operation,o.resource=e.parameters.resource)}n.track("Instance FE emitted paired item error",o)}))}if("canceled"===t.status)o.showMessage({title:s.baseText("nodeView.showMessage.stopExecutionTry.title"),type:"success"});else if(t.data?.resultData.error){const{message:e,title:a}=T({error:t.data.resultData.error,lastNodeExecuted:t.data?.resultData.lastNodeExecuted});o.showMessage({title:a,message:e,type:"error",duration:0}),I().incrementManualExecutionStats("error")}}function Z(t,e,o){const a=b();p().setDocumentTitle(t,"IDLE"),o.setActiveExecutionId(void 0),a.showMessage({title:e,type:"success"})}function $(t,e,o){const n=v(),r=b(),i=a(),c=s(),u=n.workflowObject.name??"";p().setDocumentTitle(u,"IDLE");const d=n.getWorkflowExecution;if(d?.executedNode){const e=n.getNodeByName(d.executedNode),a=e&&c.getNodeType(e.type,e.typeVersion),s=d.data?.resultData?.runData?.[d.executedNode];a?.polling&&!s?r.showMessage({title:i.baseText("pushConnection.pollingNode.dataNotFound",{interpolate:{service:w(a)}}),message:i.baseText("pushConnection.pollingNode.dataNotFound.message",{interpolate:{service:w(a)}}),type:"success"}):o||Z(u,i.baseText("pushConnection.nodeExecutedSuccessfully"),t)}else o||Z(u,i.baseText("pushConnection.workflowExecutedSuccessfully"),t);"success"!==e||o||I().incrementManualExecutionStats("success")}function tt(t,e,o){const s=v(),r=n({workflowState:o}),i=function(t){const e=a();if("crashed"===t.status)return e.baseText("pushConnection.executionFailed.message");if("canceled"===t.status){const t=v();return e.baseText("executionsList.showMessage.stopExecution.message",{interpolate:{activeExecutionId:t.activeExecutionId??""}})}return D({error:t.data?.resultData.error,lastNodeExecuted:t.data?.resultData.lastNodeExecuted})}(t),c=s.getWorkflowExecution;if(o.executingNode.executingNode.length=0,null===c)return;o.setWorkflowExecutionData({...c,status:t.status,id:t.id,stoppedAt:t.stoppedAt}),s.setWorkflowExecutionRunData(e),o.setActiveExecutionId(void 0),r.updateNodesExecutionIssues();const u=e.resultData.lastNodeExecuted;let d=0;u&&e.resultData.runData[u]&&!i&&(d=e.resultData.runData[u][0].data?.main[0]?.length??0),o.setActiveExecutionId(void 0),S().run("pushConnection.executionFinished",{itemsCount:d,nodeName:e.resultData.lastNodeExecuted,errorMessage:i,runDataExecutedStartData:e.startData,resultDataError:e.resultData.error});const l=e.resultData?.error?.lineNumber;N.emit("highlightLine",l??"last")}function et(t){const e=[];let o=!1;async function a(){if(o||0===e.length)return;o=!0;const s=e.shift();if(void 0!==s)try{await t(s)}catch(n){console.error("Error processing event:",n)}o=!1,await a()}return{enqueue:function(t){e.push(t),a()}}}return t("t",(function({router:t,workflowState:e}){const n=V(),r={router:t,workflowState:e??f()},{enqueue:i}=et((async function(t){switch(t.type){case"testWebhookDeleted":return await async function({data:t},e){const o=v();t.workflowId===o.workflowId&&(o.executionWaitingForWebhook=!1,e.workflowState.setActiveExecutionId(void 0))}(t,r);case"testWebhookReceived":return await async function({data:t},e){const o=v();t.workflowId===o.workflowId&&(o.executionWaitingForWebhook=!1,e.workflowState.setActiveExecutionId(t.executionId??null))}(t,r);case"reloadNodeType":return await async function({data:t}){const e=s();await e.getNodeTypes();const o=A(t.name);await e.getFullNodesProperties([t],!o)}(t);case"removeNodeType":return await async function({data:t}){const e=s(),o=E(),a=[t];await o.fetchCredentialTypes(!1).then((()=>{e.removeNodeTypes(a)}))}(t);case"nodeDescriptionUpdated":return await async function(t){const e=s(),o=E();await e.getNodeTypes(),await o.fetchCredentialTypes(!0)}();case"nodeExecuteBefore":return await async function({data:t},{workflowState:e}){const o=v();e.executingNode.addExecutingNode(t.nodeName),o.addNodeExecutionStartedData(t)}(t,r);case"nodeExecuteAfter":return await async function({data:t},{workflowState:e}){const o=v(),a=B(),s={main:[]};if(t.itemCountByConnectionType&&"object"==typeof t.itemCountByConnectionType){const e={json:{[R]:!0}};for(const[o,a]of Object.entries(t.itemCountByConnectionType))y(o)&&(s[o]=a.map((t=>Array.from({length:t},(()=>e)))))}const n={...t,data:{...t.data,data:s}};o.updateNodeExecutionStatus(n),e.executingNode.removeExecutingNode(t.nodeName),a.onNodeExecution(t)}(t,r);case"nodeExecuteAfterData":return await async function({data:t}){const e=v(),o=P();e.updateNodeExecutionRunData(t),o.trackSchemaPreviewExecution(t)}(t);case"executionStarted":return await async function({data:t},e){const o=v();void 0!==o.activeExecutionId&&(null===o.activeExecutionId&&e.workflowState.setActiveExecutionId(t.executionId),o.workflowExecutionData?.data&&t.flattedRunData&&(o.workflowExecutionData.data.resultData.runData=c(t.flattedRunData)))}(t,r);case"sendWorkerStatusMessage":return await async function({data:t}){q().updateWorkerStatus(t.status)}(t);case"sendConsoleMessage":return await async function({data:t}){console.log(t.source,...t.messages)}(t);case"workflowFailedToActivate":return await async function({data:t},e){const o=v();if(o.workflowId!==t.workflowId)return;o.setWorkflowInactive(t.workflowId),e.workflowState.setActive(null);const s=b(),n=a();s.showError(new Error(t.errorMessage),n.baseText("workflowActivator.showError.title",{interpolate:{newStateName:"activated"}})+":")}(t,r);case"executionFinished":return await G(t,r);case"executionRecovered":return await async function({data:t},e){const o=v(),a=h();if(void 0===o.activeExecutionId)return;a.setProcessingExecutionResults(!0);const s=await J(t.executionId);if(!s)return void a.setProcessingExecutionResults(!1);const n=K(s);a.setProcessingExecutionResults(!1),void 0!==s.data?.waitTill?Y(e):"error"===s.status||"canceled"===s.status?X(s,n):$(e.workflowState,s.status,!1),tt(s,n,e.workflowState)}(t,r);case"workflowActivated":return await async function({data:t}){const{initializeWorkspace:e}=U(),o=v(),a=d(),s=O(),n=h(),{workflowId:r,activeVersionId:i}=t,c=o.workflowId===r,u=o.workflow.activeVersionId!==i;if(c&&u&&!n.stateIsDirty){const t=await a.fetchWorkflow(r);if(!t.checksum)throw new Error("Failed to fetch workflow");await e(t)}c&&s.removeBannerFromStack("WORKFLOW_AUTO_DEACTIVATED")}(t);case"workflowDeactivated":return await async function({data:t}){const{initializeWorkspace:e}=U(),o=v(),a=d(),s=h();if(o.workflowId===t.workflowId&&!s.stateIsDirty){const o=await a.fetchWorkflow(t.workflowId);if(!o.checksum)throw new Error("Failed to fetch workflow");await e(o)}}(t);case"workflowAutoDeactivated":return await async function({data:t}){const e=v(),o=d(),{initializeWorkspace:a}=U(),s=O(),n=h();if(e.setWorkflowInactive(t.workflowId),e.workflowId===t.workflowId){if(!n.stateIsDirty){const e=await o.fetchWorkflow(t.workflowId);if(!e.checksum)throw new Error("Failed to fetch workflow");await a(e)}s.pushBannerToStack("WORKFLOW_AUTO_DEACTIVATED")}}(t);case"updateBuilderCredits":return await async function(t){I().updateBuilderCredits(t.data.creditsQuota,t.data.creditsClaimed)}(t)}})),u=o(null);return{initialize:function(){u.value=n.addEventListener((t=>{i(t)}))},terminate:function(){"function"==typeof u.value&&u.value()}}})),{setters:[function(t){o=t.It},function(t){a=t.yt},function(t){s=t.C,n=t.It,r=t.J,i=t.Lt,c=t.Qi,u=t.Qs,d=t.Rr,l=t.Tt,w=t.Vi,f=t.Vt,k=t.W,y=t.ai,p=t.fn,g=t.p,x=t.pn,h=t.r,E=t.rt,v=t.s,I=t.un,D=t.v,m=t.ws,N=t.xa,S=t.xr,T=t.y,W=t.ya,b=t.yr},function(t){A=t.Ua,_=t.Vs,C=t.ea,R=t.jo,j=t.oa,L=t.xo},function(t){M=t.j,F=t.r},function(t){O=t.t},function(t){B=t.t},function(t){U=t.t},function(t){P=t.i,H=t.t},function(t){V=t.t},function(t){z=t.t},function(t){Q=t.t}],execute:function(){try{e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},(o=(new e.Error).stack)&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[o]="4de473e4-f17e-4ad0-9f74-cd98b5ae64f9",e._sentryDebugIdIdentifier="sentry-dbid-4de473e4-f17e-4ad0-9f74-cd98b5ae64f9")}catch(e){}var e,o;t("n",100),t("r",q=M("orchestrationManager",{state:()=>({initialStatusReceived:!1,workers:{},workersHistory:{},workersLastUpdated:{},statusInterval:null}),actions:{updateWorkerStatus(t){this.workers[t.senderId]=t,this.workersHistory[t.senderId]||(this.workersHistory[t.senderId]=[]),this.workersHistory[t.senderId].push({data:t,timestamp:Date.now()}),this.workersHistory[t.senderId].length>100&&this.workersHistory[t.senderId].shift(),this.workersLastUpdated[t.senderId]=Date.now(),this.initialStatusReceived=!0},removeStaleWorkers(){for(const t in this.workersLastUpdated)this.workersLastUpdated[t]+12e4<Date.now()&&(delete this.workers[t],delete this.workersHistory[t],delete this.workersLastUpdated[t])},startWorkerStatusPolling(){const t=F();this.statusInterval||(this.statusInterval=setInterval((async()=>{await u(t.restApiContext),this.removeStaleWorkers()}),1e3))},stopWorkerStatusPolling(){this.statusInterval&&(clearInterval(this.statusInterval),this.statusInterval=null)},getWorkerLastUpdated(t){return this.workersLastUpdated[t]??0},getWorkerStatus(t){return this.workers[t]},getWorkerStatusHistory(t){return this.workersHistory[t]??[]}}}))}}}));
//# sourceMappingURL=usePushConnection-legacy-OU2Q923F.js.map