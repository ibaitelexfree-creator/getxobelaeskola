(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`8964dc28-5aa1-463c-aa1d-771fe1b0d7f9`,e._sentryDebugIdIdentifier=`sentry-dbid-8964dc28-5aa1-463c-aa1d-771fe1b0d7f9`)})()}catch{}import{o as e}from"./chunk-Din3qlHY.js";import{C as t,Cn as n,D as r,E as i,Gt as a,I as o,It as s,M as c,P as l,T as u,U as d,Z as f,_ as p,bt as m,et as h,ft as g,it as _,j as v,vn as y,w as b,yn as x}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{bt as S,ot as C,yt as w}from"./_MapCache-DjbOQyB7.js";import{Dt as T,Hi as E,O as D,Oi as O,Pi as k,Tt as A,U as ee,Ui as j,Vi as M,gi as te,ji as ne,p as N,zi as re}from"./src-CppJvwzX.js";import{t as P}from"./_plugin-vue_export-helper-B_J4Khre.js";import"./sanitize-html-K63Olwt_.js";import{Fr as ie,Oo as ae,Tr as oe,do as se,fn as ce,r as le,t as ue,ur as F,ws as I,yr as de}from"./users.store-pCkD7Zo0.js";import{t as L}from"./radio-CPckkBdz.js";import{t as fe}from"./Alert-DMo6Skho.js";import{Gc as R,Qc as pe,Ss as z,Yc as B,mi as me,ol as he,ti as V}from"./constants-D1jZwsUK.js";import"./merge-CKxbv8m_.js";import"./_baseOrderBy-El3qbNHQ.js";import"./dateformat-BhE5sUDK.js";import"./useDebounce-D6lADr4O.js";import"./versions.store-1_eor2Ku.js";import{t as ge}from"./usePageRedirectionHelper-BoF8hzbN.js";import{t as _e}from"./useClipboard-Duc7LjuO.js";import{r as H}from"./dateFormatter-C82w-7IH.js";import{n as ve}from"./sso.store-Dd63iqNy.js";import{t as ye}from"./userRoleProvisioning.store-CIdn8sQc.js";var U=[`disabled`],W={key:1},G=P(l({__name:`SettingsUsersRoleCell`,props:{data:{},roles:{},actions:{},loading:{type:Boolean,default:!1}},emits:[`update:role`],setup(e,{emit:i}){let o=e,s=i,l=t(()=>o.data.role??V.Default),d=t(()=>o.data.role!==V.Owner),f=t(()=>o.roles[l.value]?.label),p=e=>{s(`update:role`,{role:e,userId:o.data.id})};return(e,t)=>(h(),r(`div`,null,[d.value?(h(),u(a(T),{key:0,placement:`bottom-start`,items:o.actions,disabled:o.loading,"data-test-id":`user-role-dropdown`,onSelect:p},{activator:m(()=>[b(`button`,{class:y(e.$style.roleLabel),type:`button`,disabled:o.loading},[c(a(M),{color:`text-dark`},{default:m(()=>[v(n(f.value),1)]),_:1}),o.loading?(h(),u(a(j),{key:0,color:`text-dark`,icon:`spinner`,spin:``,size:`large`})):(h(),u(a(j),{key:1,color:`text-dark`,icon:`chevron-down`,size:`large`}))],10,U)]),menuItem:m(t=>[c(a(L),{"model-value":l.value,label:t.id},{default:m(()=>[b(`span`,{class:y(e.$style.radioLabel)},[c(a(M),{color:`text-dark`,class:`pb-3xs`},{default:m(()=>[v(n(t.label),1)]),_:2},1024),c(a(M),{color:`text-dark`,size:`small`},{default:m(()=>[v(n(o.roles[t.id]?.desc),1)]),_:2},1024)],2)]),_:2},1032,[`model-value`,`label`])]),_:1},8,[`items`,`disabled`])):(h(),r(`span`,W,n(f.value),1))]))}}),[[`__cssModules`,{$style:{roleLabel:`_roleLabel_13imy_125`,radioLabel:`_radioLabel_13imy_139`,removeUser:`_removeUser_13imy_149`}}]]),K=P(l({__name:`SettingsUsersProjectsCell`,props:{data:{}},setup(e){let o=e,c=w(),l=s([V.Owner,V.Admin]),d=s(2),f=t(()=>o.data.role&&l.value.includes(o.data.role)?[c.baseText(`settings.users.table.row.allProjects`)]:o.data.projectRelations?.length?o.data.projectRelations.map(({name:e})=>e):[c.baseText(`settings.users.table.row.personalProject`)]),g=t(()=>({visible:f.value.slice(0,d.value),additional:f.value.slice(d.value)}));return(e,t)=>(h(),r(`div`,{class:y(e.$style.projects)},[(h(!0),r(p,null,_(g.value.visible,(t,a)=>(h(),r(p,{key:a},[b(`span`,{class:y(e.$style.project)},n(t),3),a<g.value.visible.length-1?(h(),r(`span`,{key:0,class:y(e.$style.comma)},`,`,2)):i(``,!0)],64))),128)),g.value.additional.length>0?(h(),r(`span`,{key:0,class:y(e.$style.comma)},`,`,2)):i(``,!0),g.value.additional.length>0?(h(),u(a(O),{key:1},{content:m(()=>[b(`ul`,{class:y(e.$style.projectList)},[(h(!0),r(p,null,_(g.value.additional,(e,t)=>(h(),r(`li`,{key:t},n(e),1))),128))],2)]),default:m(()=>[b(`span`,{class:y(e.$style.project)},`+ `+n(g.value.additional.length),3)]),_:1})):i(``,!0)],2))}}),[[`__cssModules`,{$style:{projects:`_projects_1ynwg_125`,project:`_project_1ynwg_125`,comma:`_comma_1ynwg_140`,projectList:`_projectList_1ynwg_145`}}]]),q=l({__name:`SettingsUsersActionsCell`,props:{data:{},actions:{}},emits:[`action`],setup(e,{emit:t}){let n=e,o=t,s=e=>{o(`action`,{action:e,userId:n.data.id})};return(e,t)=>(h(),r(`div`,null,[n.data.signInType!==`ldap`&&n.actions.length>0?(h(),u(a(A),{key:0,placement:`bottom`,actions:n.actions,theme:`dark`,onAction:s},null,8,[`actions`])):i(``,!0)]))}}),J=l({__name:`SettingsUsersLastActiveCell`,props:{data:{}},setup(e){let i=w(),a=e,o=t(()=>a.data.lastActiveAt?H(a.data.lastActiveAt):i.baseText(`generic.never`));return(e,t)=>(h(),r(`span`,null,n(o.value),1))}}),Y={class:`pt-xs pb-xs`},be=l({__name:`SettingsUsersTable`,props:d({data:{},actions:{},loading:{type:Boolean},canEditRole:{type:Boolean},updatingRoleUserId:{}},{tableOptions:{default:()=>({})},tableOptionsModifiers:{}}),emits:d([`update:options`,`update:role`,`action`],[`update:tableOptions`]),setup(e,{emit:i}){let l=w(),d=I(),f=e,p=i,_=g(e,`tableOptions`),y=t(()=>f.data.items),S=s([{title:l.baseText(`settings.users.table.header.user`),key:`name`,width:400,value(e){return{...e,isPendingUser:e.isPending}}},{title:l.baseText(`settings.users.table.header.accountType`),key:`role`},{title:l.baseText(`settings.users.table.header.lastActive`),key:`lastActiveAt`,value(e){return{...e,lastActiveAt:e.lastActiveAt??``}}},{title:l.baseText(`settings.users.table.header.2fa`),key:`mfaEnabled`,value(e){return e.mfaEnabled?l.baseText(`settings.users.table.row.2fa.enabled`):l.baseText(`settings.users.table.row.2fa.disabled`)}},{title:l.baseText(`projects.menu.title`),key:`projects`,disableSort:!0,value(){}},{title:``,key:`actions`,align:`end`,width:46,disableSort:!0,value(){}}]),C=t(()=>({[V.Owner]:{label:l.baseText(`auth.roles.owner`),desc:``},[V.Admin]:{label:l.baseText(`auth.roles.admin`),desc:l.baseText(`settings.users.table.row.role.description.admin`)},[V.Member]:{label:l.baseText(`auth.roles.member`),desc:l.baseText(`settings.users.table.row.role.description.member`)},...d.isChatFeatureEnabled&&{[V.ChatUser]:{label:l.baseText(`auth.roles.chatUser`),desc:l.baseText(`settings.users.table.row.role.description.chatUser`)}},[V.Default]:{label:l.baseText(`auth.roles.default`),desc:``}})),T=t(()=>[{id:V.Member,label:l.baseText(`auth.roles.member`)},...d.isChatFeatureEnabled?[{id:V.ChatUser,label:l.baseText(`auth.roles.chatUser`)}]:[],{id:V.Admin,label:l.baseText(`auth.roles.admin`)}]),E=t(()=>!(!F([`rbac`],{rbac:{scope:[`user:update`,`user:changeRole`]}})||!f.canEditRole)),O=e=>e.isOwner?[]:f.actions.filter(t=>t.guard?.({...e,isPendingUser:e.isPending})??!0),k=({role:e,userId:t})=>{p(`update:role`,{role:e,userId:t})};return(t,i)=>(h(),r(`div`,null,[c(a(N),{"sort-by":_.value.sortBy,"onUpdate:sortBy":i[1]||=e=>_.value.sortBy=e,page:_.value.page,"onUpdate:page":i[2]||=e=>_.value.page=e,"items-per-page":_.value.itemsPerPage,"onUpdate:itemsPerPage":i[3]||=e=>_.value.itemsPerPage=e,headers:S.value,items:y.value,"items-length":e.data.count,"page-sizes":[10,25,50],"onUpdate:options":i[4]||=e=>p(`update:options`,e)},{"item.name":m(({value:e})=>[b(`div`,Y,[c(a(D),x(o(e)),null,16)])]),"item.role":m(({item:e})=>[E.value?(h(),u(G,{key:0,data:e,roles:C.value,actions:T.value,loading:f.updatingRoleUserId===e.id,"onUpdate:role":k},null,8,[`data`,`roles`,`actions`,`loading`])):(h(),u(a(M),{key:1,color:`text-dark`},{default:m(()=>[v(n(C.value[e.role??a(V).Default]?.label),1)]),_:2},1024))]),"item.lastActiveAt":m(({item:e})=>[c(J,{data:e},null,8,[`data`])]),"item.projects":m(({item:e})=>[c(K,{data:e},null,8,[`data`])]),"item.actions":m(({item:e})=>[c(q,{data:e,actions:O(e),onAction:i[0]||=e=>t.$emit(`action`,e)},null,8,[`data`,`actions`])]),_:2},1032,[`sort-by`,`page`,`items-per-page`,`headers`,`items`,`items-length`])]))}}),X=P(l({__name:`SettingsUsersView`,setup(e){let o=_e(),{showToast:l,showError:d}=de(),p=oe(),g=I(),_=le(),x=ue(),T=ve(),D=ce(),A=ge(),N=ye(),P=ie(),L=w(),z=s(``),H=s({page:0,itemsPerPage:10,sortBy:[{id:`firstName`,desc:!1},{id:`lastName`,desc:!1},{id:`email`,desc:!1}]}),U=t(()=>F([`defaultUser`])),W=t(()=>N.provisioningConfig?.scopesProvisionInstanceRole||!1),G=t(()=>P.isVariantEnabled(R.name,R.variant)),K=t(()=>!!T.isSamlLoginEnabled||!!T.isOidcLoginEnabled);f(async()=>{D.set(L.baseText(`settings.users`)),U.value||await $(H.value),await N.getProvisioningConfig()});let q=t(()=>[{label:L.baseText(`settings.users.actions.generateInviteLink`),value:`generateInviteLink`,guard:e=>G.value&&F([`rbac`],{rbac:{scope:`user:generateInviteLink`}})&&x.usersLimitNotReached&&e.id!==x.currentUserId&&!e.firstName},{label:L.baseText(`settings.users.actions.copyInviteLink`),value:`copyInviteLink`,guard:e=>!G.value&&x.usersLimitNotReached&&!e.firstName&&!!e.inviteAcceptUrl},{label:L.baseText(`settings.users.actions.reinvite`),value:`reinvite`,guard:e=>x.usersLimitNotReached&&!e.firstName&&g.isSmtpSetup},{label:L.baseText(`settings.users.actions.delete`),value:`delete`,guard:e=>F([`rbac`],{rbac:{scope:`user:delete`}})&&e.id!==x.currentUserId},{label:L.baseText(`settings.users.actions.copyPasswordResetLink`),value:`copyPasswordResetLink`,guard:e=>F([`rbac`],{rbac:{scope:`user:resetPassword`}})&&x.usersLimitNotReached&&!e.isPendingUser&&e.id!==x.currentUserId},{label:L.baseText(`settings.users.actions.allowSSOManualLogin`),value:`allowSSOManualLogin`,guard:e=>K.value&&!e.settings?.allowSSOManualLogin},{label:L.baseText(`settings.users.actions.disallowSSOManualLogin`),value:`disallowSSOManualLogin`,guard:e=>K.value&&e.settings?.allowSSOManualLogin===!0}]),J=t(()=>g.isEnterpriseFeatureEnabled[B.AdvancedPermissions]),Y=t(()=>[{value:V.Member,label:L.baseText(`auth.roles.member`)},{value:V.ChatUser,label:L.baseText(`auth.roles.chatUser`),disabled:!J.value},{value:V.Admin,label:L.baseText(`auth.roles.admin`),disabled:!J.value}]);async function X({action:e,userId:t}){switch(e){case`delete`:await Se(t);break;case`reinvite`:await Ce(t);break;case`copyInviteLink`:await we(t);break;case`generateInviteLink`:await Te(t);break;case`copyPasswordResetLink`:await Ee(t);break;case`allowSSOManualLogin`:await De(t);break;case`disallowSSOManualLogin`:await Oe(t);break}}function xe(){_.openModalWithData({name:ae,data:{afterInvite:async()=>{await $(H.value)}}})}async function Se(e){_.openModalWithData({name:se,data:{userId:e,afterDelete:async()=>{await $(H.value)}}})}async function Ce(e){try{let t=x.usersList.state.items.find(t=>t.id===e);if(t?.email&&t?.role){if(![`global:admin`,`global:member`].includes(t.role))throw Error(`Invalid role name on reinvite`);await x.reinviteUser({email:t.email,role:t.role}),l({type:`success`,title:L.baseText(`settings.users.inviteResent`),message:L.baseText(`settings.users.emailSentTo`,{interpolate:{email:t.email??``}})})}}catch(e){d(e,L.baseText(`settings.users.userReinviteError`))}}async function we(e){let t=x.usersList.state.items.find(t=>t.id===e);t?.inviteAcceptUrl&&(o.copy(t.inviteAcceptUrl),l({type:`success`,title:L.baseText(`settings.users.inviteUrlCreated`),message:L.baseText(`settings.users.inviteUrlCreated.message`)}))}async function Te(e){try{if(x.usersList.state.items.find(t=>t.id===e)){let t=await x.generateInviteLink({id:e});o.copy(t.link),l({type:`success`,title:L.baseText(`settings.users.inviteUrlCreated`),message:L.baseText(`settings.users.inviteUrlCreated.message`)})}}catch(e){d(e,L.baseText(`settings.users.inviteLinkError`))}}async function Ee(e){try{let t=x.usersList.state.items.find(t=>t.id===e);if(t){let e=await x.getUserPasswordResetLink(t);o.copy(e.link),l({type:`success`,title:L.baseText(`settings.users.passwordResetUrlCreated`),message:L.baseText(`settings.users.passwordResetUrlCreated.message`)})}}catch(e){d(e,L.baseText(`settings.users.passwordResetLinkError`))}}async function De(e){let t=x.usersList.state.items.find(t=>t.id===e);t&&(t.settings||={},t.settings.allowSSOManualLogin=!0,await x.updateOtherUserSettings(e,t.settings),await $(H.value),l({type:`success`,title:L.baseText(`settings.users.allowSSOManualLogin`),message:L.baseText(`settings.users.allowSSOManualLogin.message`)}))}async function Oe(e){let t=x.usersList.state.items.find(t=>t.id===e);t?.settings&&(t.settings.allowSSOManualLogin=!1,await x.updateOtherUserSettings(e,t.settings),await $(H.value),l({type:`success`,title:L.baseText(`settings.users.disallowSSOManualLogin`),message:L.baseText(`settings.users.disallowSSOManualLogin.message`)}))}function ke(){A.goToUpgrade(`settings-users`,`upgrade-users`)}function Z(){A.goToUpgrade(`settings-users`,`upgrade-advanced-permissions`)}let Q=s(null),Ae=async e=>{let t=x.usersList.state.items.find(t=>t.id===e.userId);if(!t){d(Error(`User not found`),L.baseText(`settings.users.userNotFound`));return}await je(t,e.role)},$=async({page:e,itemsPerPage:t,sortBy:n})=>{try{H.value={page:e,itemsPerPage:t,sortBy:n};let r=e*t,i=t,a=n.flatMap(({id:e,desc:t})=>{let n=t?`desc`:`asc`;return e===`name`?[`firstName:${n}`,`lastName:${n}`,`email:${n}`]:`${e}:${n}`}).filter(Me);await x.usersList.execute(0,{skip:r,take:i,sortBy:a,expand:[`projectRelations`],filter:{fullText:z.value.trim()}})}catch(e){d(e,L.baseText(`settings.users.table.update.error`))}};async function je(e,t){if(t===e.role)return;let n=e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.email??``,r=Y.value.find(({value:e})=>e===t)?.label??t;if(!(t===V.ChatUser&&await p.confirm(L.baseText(`settings.users.userRoleUpdated.confirm.message`,{interpolate:{role:r}}),L.baseText(`settings.users.userRoleUpdated.confirm.title`,{interpolate:{user:n}}),{confirmButtonText:L.baseText(`settings.users.userRoleUpdated.confirm.button`),cancelButtonText:L.baseText(`settings.users.userRoleUpdated.cancel.button`)})!==`confirm`)){Q.value=e.id;try{await x.updateGlobalRole({id:e.id,newRoleName:t}),await $(H.value),l({type:`success`,title:L.baseText(`settings.users.userRoleUpdated`),message:L.baseText(`settings.users.userRoleUpdated.message`,{interpolate:{user:n,role:r}})})}catch(e){d(e,L.baseText(`settings.users.userRoleUpdatedError`))}finally{Q.value=null}}}let Me=e=>me.includes(e),Ne=C(()=>{H.value.page=0,$(H.value)},he(pe.INPUT.SEARCH)),Pe=e=>{z.value=e,Ne()};return(e,t)=>(h(),r(`div`,{class:y(e.$style.container)},[c(a(re),{tag:`h1`,size:`2xlarge`,class:`mb-xl`},{default:m(()=>[v(n(a(L).baseText(`settings.users`))+` `,1),U.value?i(``,!0):(h(),u(a(M),{key:0,class:y(e.$style.userCount),color:`text-light`},{default:m(()=>[v(n(a(L).baseText(`settings.users.count`,{interpolate:{count:a(x).usersList.state.count},adjustToNumber:a(x).usersList.state.count})),1)]),_:1},8,[`class`]))]),_:1}),a(x).usersLimitNotReached?i(``,!0):(h(),r(`div`,{key:0,class:y(e.$style.setupInfoContainer)},[c(a(k),{heading:a(L).baseText(a(_).contextBasedTranslationKeys.users.settings.unavailable.title),description:a(L).baseText(a(_).contextBasedTranslationKeys.users.settings.unavailable.description),"button-text":a(L).baseText(a(_).contextBasedTranslationKeys.users.settings.unavailable.button),"onClick:button":ke},null,8,[`heading`,`description`,`button-text`])],2)),J.value?i(``,!0):(h(),u(a(ee),{key:1},{default:m(()=>[c(a(S),{keypath:`settings.users.advancedPermissions.warning`,scope:`global`},{link:m(()=>[c(a(te),{"data-test-id":`upgrade-permissions-link`,size:`small`,onClick:Z},{default:m(()=>[v(n(a(L).baseText(`generic.upgrade`)),1)]),_:1})]),_:1})]),_:1})),W.value?(h(),r(`div`,{key:2,class:y(e.$style.container)},[c(fe,{type:`info`,title:a(L).baseText(`settings.provisioningInstanceRolesHandledBySsoProvider.description`)},null,8,[`title`])],2)):i(``,!0),U.value?i(``,!0):(h(),r(`div`,{key:3,class:y(e.$style.buttonContainer)},[c(a(ne),{class:y(e.$style.search),"model-value":z.value,placeholder:a(L).baseText(`settings.users.search.placeholder`),clearable:``,"data-test-id":`users-list-search`,"onUpdate:modelValue":Pe},{prefix:m(()=>[c(a(j),{icon:`search`})]),_:1},8,[`class`,`model-value`,`placeholder`]),c(a(O),{disabled:!K.value},{content:m(()=>[b(`span`,null,n(a(L).baseText(`settings.users.invite.tooltip`)),1)]),default:m(()=>[b(`div`,null,[c(a(E),{disabled:K.value||!a(x).usersLimitNotReached||W.value,label:a(L).baseText(`settings.users.invite`),size:`large`,"data-test-id":`settings-users-invite-button`,onClick:xe},null,8,[`disabled`,`label`])])]),_:1},8,[`disabled`])],2)),a(x).usersLimitNotReached||a(x).usersList.state.count>1?(h(),r(`div`,{key:4,class:y(e.$style.usersContainer)},[c(be,{"table-options":H.value,"onUpdate:tableOptions":t[0]||=e=>H.value=e,"data-test-id":`settings-users-table`,"can-edit-role":!W.value,data:a(x).usersList.state,loading:a(x).usersList.isLoading,"updating-role-user-id":Q.value,actions:q.value,"onUpdate:options":$,"onUpdate:role":Ae,onAction:X},null,8,[`table-options`,`can-edit-role`,`data`,`loading`,`updating-role-user-id`,`actions`])],2)):i(``,!0)],2))}}),[[`__cssModules`,{$style:{userCount:`_userCount_17a4t_125`,buttonContainer:`_buttonContainer_17a4t_130`,search:`_search_17a4t_137`,setupInfoContainer:`_setupInfoContainer_17a4t_141`,container:`_container_17a4t_145`}}]]);export{X as default};
//# sourceMappingURL=SettingsUsersView-CT7EKSdm.js.map