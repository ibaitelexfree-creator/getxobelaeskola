(function(){try{var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{};e.SENTRY_RELEASE={id:`n8n@2.9.4`}}catch{}})();try{(function(){var e=typeof window<`u`?window:typeof global<`u`?global:typeof globalThis<`u`?globalThis:typeof self<`u`?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]=`600f4b21-47cc-4601-b9be-a65cd3c70f29`,e._sentryDebugIdIdentifier=`sentry-dbid-600f4b21-47cc-4601-b9be-a65cd3c70f29`)})()}catch{}import{C as e,It as t}from"./vue.runtime.esm-bundler-1e_FtHOF.js";import{yt as n}from"./_MapCache-DjbOQyB7.js";import{Lt as r,yr as i,zr as a}from"./users.store-pCkD7Zo0.js";import{Ha as o,di as s,fi as c,ui as l}from"./constants-D1jZwsUK.js";import{a as u,c as d,d as f,j as p,r as m}from"./_baseOrderBy-El3qbNHQ.js";import{t as ee}from"./retry-C_b9sBX6.js";import{l as h,s as g}from"./constants-BeYoedeu.js";import{t as te}from"./fileUtils-CrAesjp5.js";const _=async(e,t)=>await f(e,`POST`,`/chat/models`,t);async function ne(e,t){return await f(e,`POST`,`/chat/conversations/send`,t)}async function re(e,t){return await f(e,`POST`,`/chat/conversations/${t.sessionId}/messages/${t.editId}/edit`,t.payload)}async function ie(e,t){return await f(e,`POST`,`/chat/conversations/${t.sessionId}/messages/${t.retryId}/regenerate`,t.payload)}async function ae(e,t,n){return await f(e,`POST`,`/chat/conversations/${t}/reconnect${n===void 0?``:`?lastSequence=${n}`}`,{})}const oe=async(e,t,n)=>{await f(e,`POST`,`/chat/conversations/${t}/messages/${n}/stop`)},se=async(e,t,n)=>{let r=new URLSearchParams;return r.append(`limit`,t.toString()),n&&r.append(`cursor`,n),await f(e,`GET`,`/chat/conversations?${r.toString()}`)},v=async(e,t,n)=>await f(e,`PATCH`,`/chat/conversations/${t}`,n),ce=async(e,t,n)=>await v(e,t,{title:n}),le=async(e,t)=>{await f(e,`DELETE`,`/chat/conversations/${t}`)},y=async(e,t)=>await f(e,`GET`,`/chat/conversations/${t}`),ue=async(e,t)=>await f(e,`GET`,`/chat/agents/${t}`),de=async(e,t)=>await f(e,`POST`,`/chat/agents`,t),b=async(e,t,n)=>await f(e,`POST`,`/chat/agents/${t}`,n),fe=async(e,t)=>{await f(e,`DELETE`,`/chat/agents/${t}`)},pe=async e=>(await f(e,`GET`,`/chat/settings`)).providers,me=async(e,t)=>(await f(e,`GET`,`/chat/settings/`+t)).settings,he=async(e,t)=>await f(e,`POST`,`/chat/settings`,{payload:t});function x(e,t,n,r){return`${e.baseUrl}/chat/conversations/${t}/messages/${n}/attachments/${r}`}const ge=async e=>await f(e,`GET`,`/chat/tools`),_e=async(e,t)=>await f(e,`POST`,`/chat/tools`,{definition:t}),ve=async(e,t,n)=>await f(e,`PATCH`,`/chat/tools/${t}`,n),ye=async(e,t)=>{await f(e,`DELETE`,`/chat/tools/${t}`)};function S(e,t){let n=new Date(t),r=new Date(e.getFullYear(),e.getMonth(),e.getDate()),i=new Date(r);i.setDate(i.getDate()-1);let a=new Date(r);a.setDate(a.getDate()-7);let o=new Date(n.getFullYear(),n.getMonth(),n.getDate());return o.getTime()===r.getTime()?`Today`:o.getTime()===i.getTime()?`Yesterday`:o>=a?`This week`:`Older`}function C(e){let t=new Date,n=new Map;for(let r of e){let e=S(t,r.lastMessageAt??r.updatedAt);n.has(e)||n.set(e,[]),n.get(e).push(r)}return[`Today`,`Yesterday`,`This week`,`Older`].flatMap(e=>{let t=n.get(e)??[];return t.length>0?[{group:e,sessions:t.sort((e,t)=>Date.parse(t.lastMessageAt??t.updatedAt)-Date.parse(e.lastMessageAt??e.updatedAt))}]:[]})}function w(e){return e.provider===`n8n`?{name:h,query:{workflowId:e.workflowId}}:e.provider===`custom-agent`?{name:h,query:{agentId:e.agentId}}:{name:h,query:{provider:e.provider,model:e.model}}}function T(e){return{provider:e.provider,model:e?.provider===`n8n`||e?.provider===`custom-agent`?null:e?.model??null,workflowId:e?.provider===`n8n`?e.workflowId:null,agentId:e?.provider===`custom-agent`?e.agentId:null}}function E(e){if(e.provider===null)return null;switch(e.provider){case`custom-agent`:return e.agentId?{provider:`custom-agent`,agentId:e.agentId}:null;case`n8n`:return e.workflowId?{provider:`n8n`,workflowId:e.workflowId}:null;default:return e.model===null?null:{provider:e.provider,model:e.model}}}function D(e,t){let n=e;if(t.search.trim()){let e=t.search.toLowerCase();n=n.filter(t=>t.name.toLowerCase().includes(e))}return n=[...n].sort((e,n)=>{let r=e[t.sortBy],i=n[t.sortBy],a=r?Date.parse(r):void 0,o=i?Date.parse(i):void 0;return a&&o?o-a:a&&!o?-1:!a&&o?1:0}),n}function O(e){return`${e.provider}::${e.provider===`custom-agent`?e.agentId:e.provider===`n8n`?e.workflowId:e.model}`}function k(e){let[t,n]=e.split(`::`),r=s.safeParse(t).data;if(r)return r===`n8n`?{provider:`n8n`,workflowId:n}:r===`custom-agent`?{provider:`custom-agent`,agentId:n}:{provider:r,model:n}}function be(e,t){return t.provider===`n8n`?e.model.provider===`n8n`&&e.model.workflowId===t.workflowId:t.provider===`custom-agent`?e.model.provider===`custom-agent`&&e.model.agentId===t.agentId:e.model.provider===t.provider&&e.model.model===t.model}function A(e,t,n){return{id:t,sessionId:e,type:`ai`,name:`AI`,content:[],executionId:n?.executionId??null,status:`running`,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),previousMessageId:n?.previousMessageId??null,retryOfMessageId:n?.retryOfMessageId??null,revisionOfMessageId:null,responses:[],alternatives:[],attachments:[],...n?.agent?T(n.agent.model):{provider:null,model:null,workflowId:null,agentId:null}}}function xe(e,t,n){let r=[],i=!1;for(let a=0;a<t.activeMessageChain.length;a++){let o=t.activeMessageChain[a],s=t.messages[o];if(s){if(i||=s.status===`running`,i||n?.sessionId!==e||s.type!==`ai`){r.push(s);continue}if(n.retryOfMessageId===o&&!n.messageId){r.push({...s,content:[],status:`running`,...T(n.agent.model)}),i=!0;continue}if(n.messageId&&a===t.activeMessageChain.length-1){r.push({...s,status:`running`}),i=!0;continue}r.push(s)}}return r}function j(e){return e!==`n8n`&&e!==`custom-agent`}function M(e){return j(e?.provider)}function N({enabled:e=!0,allowedModels:t},n){return e&&(t.length===0||t.some(e=>`model`in n&&e.model===n.model))}function P(e,t){for(let n of s.options){let r,i=-1/0,a=j(n)?t[n]:void 0,o=e[n].models.filter(e=>!a||N(a,e.model));for(let e of o){let t=e.metadata.priority??0;t>i&&(i=t,r=e)}if(r)return r}}function Se(e,t){return{id:e.sessionId,title:`New Chat`,ownerId:``,lastMessageAt:new Date().toISOString(),credentialId:null,agentName:e.agent.name,agentIcon:e.agent.icon,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),toolIds:t,...T(e.agent.model)}}function F(e){if(e.includes(`file`))return`*/*`;let t=[`text/*`];for(let n of e)n===`image`&&t.push(`image/*`),n===`audio`&&t.push(`audio/*`),n===`video`&&t.push(`video/*`);return t.join(`,`)}const I={type:`icon`,value:`message-square`},L={type:`icon`,value:`bot`};function R(e,t){return{model:e,name:t?.name||``,description:null,icon:t?.icon??null,createdAt:null,updatedAt:null,metadata:{inputModalities:[`text`,`file`],capabilities:{functionCalling:e.provider!==`n8n`},available:!0},groupName:null,groupIcon:null}}const z=e=>e.status===`success`&&e.type!==`ai`,B=e=>e.type===`ai`;function V(e){if(!e)return[];let t=[],n=``,r={type:`normal`},i=e.split(`
`),a=()=>{n.trim()&&(t.push(n.trimEnd()),n=``)};for(let e=0;e<i.length;e++){let t=i[e],o=e<i.length-1?i[e+1]:``,s=t.trim(),c=/^( {4}|\t)/.test(t),l=/^( {0,3})(`{3,}|~{3,})/.test(t);if(r.type===`backtick-fence`){if(l&&s.startsWith("```")){let e=s.match(/^(`+)/);if((e?e[1].length:0)>=r.count){n+=t+`
`,r={type:`normal`},a();continue}}}else if(r.type===`tilde-fence`){if(l&&s.startsWith(`~~~`)){let e=s.match(/^(~+)/);if((e?e[1].length:0)>=r.count){n+=t+`
`,r={type:`normal`},a();continue}}}else if(r.type===`indented`)!c&&s!==``&&(r={type:`normal`},a());else if(l&&s.startsWith("```")){let e=s.match(/^(`+)/);r={type:`backtick-fence`,count:e?e[1].length:0}}else if(l&&s.startsWith(`~~~`)){let e=s.match(/^(~+)/);r={type:`tilde-fence`,count:e?e[1].length:0}}else c&&s!==``&&(a(),r={type:`indented`});if(n+=t+`
`,r.type===`normal`){let e=s===``,t=o.trim()===``,n=o.trim().startsWith(`#`);(e&&t||e&&n)&&a()}}return a(),t}function H(e){return!e||e.status!==`waiting`?!1:e.content.some(e=>e.type===`with-buttons`&&e.blockUserInput)}function U(e,t){let n=[...e],r=t;if(n.length>0){let e=n[n.length-1];(e.type===`hidden`||(e.type===`artifact-create`||e.type===`artifact-edit`)&&e.isIncomplete)&&(r=e.content+t,n.pop())}let i=Ce(r);if(i)return n.push(i),n;let a=0,o=/<command:artifact-create>/g,s=/<command:artifact-edit>/g;for(;a<r.length;){o.lastIndex=a,s.lastIndex=a;let e=o.exec(r),t=s.exec(r),i=null,c=null;if(e&&t?e.index<t.index?(i=e,c=`create`):(i=t,c=`edit`):e?(i=e,c=`create`):t&&(i=t,c=`edit`),!i||!c){let e=r.slice(a);if(e){let{text:t,hiddenPrefix:r}=G(e);t&&W(n,t),r&&n.push({type:`hidden`,content:r})}break}i.index>a&&W(n,r.slice(a,i.index));let l=i.index,u=r.slice(l);if(c===`create`){let e=K(u);n.push(e.item),a=l+e.consumed}else{let e=q(u);n.push(e.item),a=l+e.consumed}}return n}function W(e,t){if(t!==``){if(e.length>0){let n=e[e.length-1];if(n.type===`text`){e[e.length-1]={type:`text`,content:n.content+t};return}}e.push({type:`text`,content:t})}}function G(e){let t=[`<command:artifact-create>`,`<command:artifact-edit>`];for(let n=1;n<=Math.min(e.length,30);n++){let r=e.slice(-n);for(let i of t)if(i.startsWith(r))return{text:e.slice(0,-n),hiddenPrefix:r}}return{text:e,hiddenPrefix:``}}function K(e){let t=e.indexOf(`</command:artifact-create>`),n=t===-1,r=n?e:e.slice(0,t+26);return{item:{type:`artifact-create`,content:r,command:{title:J(r,`title`)??``,type:J(r,`type`)??``,content:J(r,`content`)??``},isIncomplete:n},consumed:r.length}}function q(e){let t=e.indexOf(`</command:artifact-edit>`),n=t===-1,r=n?e:e.slice(0,t+24);return{item:{type:`artifact-edit`,content:r,command:{title:J(r,`title`)??``,oldString:J(r,`oldString`)??``,newString:J(r,`newString`)??``,replaceAll:(J(r,`replaceAll`)??`false`).toLowerCase()===`true`},isIncomplete:n},consumed:r.length}}function J(e,t){let n=`<${t}>`,r=`</${t}>`,i=e.indexOf(n);if(i===-1)return null;let a=i+n.length,o=e.indexOf(r,a);if(o===-1){let t=e.slice(a);for(let e=1;e<r.length;e++){let n=r.slice(0,e);if(t.endsWith(n)){t=t.slice(0,-e);break}}return t.length>0?t:null}return e.slice(a,o)}function Ce(e){if(!e.startsWith(`{`))return null;try{let t=JSON.parse(e),n=l.safeParse(t);if(n.success)return{type:`with-buttons`,content:n.data.text,buttons:n.data.buttons,blockUserInput:n.data.blockUserInput}}catch{}return null}function Y(e){let t=[];for(let n of e)if(n.type===`artifact-create`){if(!n.command.title)continue;t.push({title:n.command.title,type:n.command.type,content:n.command.content})}else if(n.type===`artifact-edit`){let e=t.find(e=>e.title===n.command.title);e&&(n.command.replaceAll?e.content=e.content.split(n.command.oldString).join(n.command.newString):e.content=e.content.replace(n.command.oldString,n.command.newString))}return t}const X=p(u.CHAT_HUB,()=>{let s=m(),l=i(),u=r(),f=n(),p=t(null),h=null,g=t({}),x=t({byId:{},ids:null,hasMore:!1,nextCursor:null}),S=t(!1),C=t(),w=t(!1),D=t(null),O=t([]),k=t(!1),j=t(new Map),M=e=>j.value.get(e),N=e=>{let t=M(e);return t?xe(e,t,C.value):[]};function P(e){j.value.has(e)||j.value.set(e,{messages:{},activeMessageChain:[]});let t=j.value.get(e);if(!t)throw Error(`Conversation for session ID ${e} not found`);return t}function F(e){let t=M(e);if(!t||t.activeMessageChain.length===0)return null;let n=t.activeMessageChain[t.activeMessageChain.length-1];return t.messages[n]??null}function I(e){return C.value?.sessionId===e}function L(e,t){let n=[];if(!t)return n;let r=t;for(;;){let t=e[r].responses;if(t.length===0)break;r=t[t.length-1]}let i=r,a=new Set;for(;i&&!a.has(i);)n.unshift(i),a.add(i),i=e[i]?.previousMessageId??null;return n}function z(e){let t={};for(let n of e)t[n.id]={...n,responses:[],alternatives:[]};for(let e of Object.values(t))e.previousMessageId&&t[e.previousMessageId]&&t[e.previousMessageId].responses.push(e.id),e.retryOfMessageId&&t[e.retryOfMessageId]&&t[e.retryOfMessageId].alternatives.push(e.id),e.revisionOfMessageId&&t[e.revisionOfMessageId]&&t[e.revisionOfMessageId].alternatives.push(e.id);let n=(e,n)=>{let r=t[e],i=t[n];return r.createdAt===i.createdAt?r.id<i.id?-1:1:r.createdAt<i.createdAt?-1:1};for(let e of Object.values(t)){if(e.alternatives.includes(e.id)||e.alternatives.push(e.id),e.retryOfMessageId&&t[e.retryOfMessageId]){e.alternatives.push(e.retryOfMessageId);for(let n of t[e.retryOfMessageId].alternatives)n!==e.id&&!e.alternatives.includes(n)&&e.alternatives.push(n)}if(e.revisionOfMessageId&&t[e.revisionOfMessageId]){e.alternatives.push(e.revisionOfMessageId);for(let n of t[e.revisionOfMessageId].alternatives)n!==e.id&&!e.alternatives.includes(n)&&e.alternatives.push(n)}e.responses.sort(n),e.alternatives.sort(n)}return t}function B(e,t){let n=P(e);return n.messages[t.id]=t,n.messages=z(Object.values(n.messages)),n.activeMessageChain=L(n.messages,t.id),t}function V(e,t,n){let r=P(e).messages[t];if(!r)throw Error(`Message with ID ${t} not found in session ${e}`);r.content=[{type:`text`,content:n}]}function H(e,t,n){let r=P(e).messages[t];if(!r)throw Error(`Message with ID ${t} not found in session ${e}`);r.content=U(r.content,n)}function W(e,t,n,r){let i=P(e).messages[t];if(!i)throw Error(`Message with ID ${t} not found in session ${e}`);i.status=n,r&&(i.content=r),i.updatedAt=new Date().toISOString()}async function G(){let e=await ge(s.restApiContext);return O.value=e,k.value=!0,e}async function K(e){let t=await _e(s.restApiContext,e);return O.value=[...O.value,t],t}async function q(e,t){let n=await ve(s.restApiContext,e,{definition:t});return O.value=O.value.map(t=>t.definition.id===e?n:t),n}async function J(e,t){let n=await ve(s.restApiContext,e,{enabled:t});return O.value=O.value.map(t=>t.definition.id===e?n:t),n}async function Ce(e){await ye(s.restApiContext,e),O.value=O.value.filter(t=>t.definition.id!==e)}async function Y(e,t={}){return h??=_(s.restApiContext,{credentials:e}).finally(()=>{h=null}),[p.value]=await Promise.all([h,new Promise(e=>setTimeout(e,t.minLoadingTime??0))]),p.value}async function X(e,t={}){if(!S.value&&!(!e&&x.value&&!x.value.hasMore&&(x.value.ids??[]).length>0)){e||(S.value=!0);try{let n=e?void 0:x.value?.nextCursor??void 0,[r]=await Promise.all([se(s.restApiContext,18,n),new Promise(e=>setTimeout(e,t.minLoadingTime??0))]);(e||x.value.ids===null)&&(x.value.ids=[]),x.value.hasMore=r.hasMore,x.value.nextCursor=r.nextCursor;for(let e of r.data){x.value.ids.push(e.id);let t=x.value.byId[e.id];x.value.byId[e.id]={...e,toolIds:t?.toolIds??e.toolIds}}}finally{S.value=!1}}}async function we(e={}){x.value?.hasMore&&!S.value&&await X(!1,e)}async function Te(e){let{conversation:t,session:n}=await y(s.restApiContext,e),r=z(Object.values(t.messages)),i=L(r,Object.values(r).sort((e,t)=>e.createdAt<t.createdAt?-1:1).pop()?.id??null);j.value.set(e,{messages:r,activeMessageChain:i}),x.value.byId[e]=n}async function Z(e){let t=x.value.byId[e];(!t||t.title===`New Chat`)&&await ee(async()=>{try{return(await y(s.restApiContext,e)).session.title!==`New Chat`}catch{return!1}},2e3,10),await X(!0)}function Ee(e,t){return P(e).messages[t]||B(e,A(e,t,C.value))}function De(e,t){let n={413:f.baseText(`chatHub.error.payloadTooLarge`),400:t??f.baseText(`chatHub.error.badRequest`),403:f.baseText(`chatHub.error.forbidden`),500:t?f.baseText(`chatHub.error.serverErrorWithReason`,{interpolate:{error:t}}):f.baseText(`chatHub.error.serverError`)};return e&&n[e]||t||f.baseText(`chatHub.error.unknown`)}async function Q(e){if(!C.value)return;let t=e instanceof d?Error(De(e.httpStatusCode,e.message)):e instanceof Error&&e.message.includes(`Failed to fetch`)?Error(f.baseText(`chatHub.error.noConnection`)):e;l.showError(t,f.baseText(`chatHub.error.sendMessageFailed`));let{sessionId:n}=C.value;C.value=void 0,await Z(n)}async function Oe(e,t,n,r,i=[]){let o=a(),c=P(e),l=c.activeMessageChain.length?c.activeMessageChain[c.activeMessageChain.length-1]:null,d=(await Promise.all(i.map(te))).map(e=>({fileName:e.fileName??`unnamed file`,mimeType:e.mimeType,data:e.data}));C.value={promptPreviousMessageId:l,promptId:o,promptText:t,sessionId:e,retryOfMessageId:null,revisionOfMessageId:null,attachments:d,agent:n},u.track(`User sent chat hub message`,{...T(n.model),is_custom:n.model.provider===`custom-agent`,chat_session_id:e});let f={model:n.model,messageId:o,sessionId:e,message:t,credentials:r,previousMessageId:l,attachments:d,agentName:n.name,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};try{x.value.byId[e]||(x.value.byId[e]=Se(C.value,O.value.filter(e=>e.enabled).map(e=>e.definition.id)),x.value.ids??=[],x.value.ids.unshift(e)),await ne(s.restApiContext,f)}catch(e){await Q(e)}}async function ke(e,t,n,r,i,o=[],c=[]){let l=a(),d=P(e).messages[t],f=d?.previousMessageId??null,p=await Promise.all(c.map(te)),m={model:r.model,messageId:l,message:n,credentials:i,newAttachments:p.map(e=>({fileName:e.fileName??`unnamed file`,mimeType:e.mimeType,data:e.data})),keepAttachmentIndices:o,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};d?.type===`ai`&&V(e,t,n),C.value={promptPreviousMessageId:f,promptId:l,promptText:n,sessionId:e,agent:r,retryOfMessageId:null,revisionOfMessageId:t,attachments:[...o.flatMap(e=>{let t=d?.attachments[e];return t?[{fileName:t.fileName??`unnamed file`,mimeType:t.mimeType??`application/octet-stream`,data:``}]:[]}),...p]},u.track(`User edited chat hub message`,{...T(r.model),is_custom:r.model.provider===`custom-agent`,chat_session_id:e,chat_message_id:t});try{await re(s.restApiContext,{sessionId:e,editId:t,payload:m})}catch(e){await Q(e)}}async function Ae(e,t,n,r){let i=P(e).messages[t]?.previousMessageId??null,a={model:n.model,credentials:r,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};if(!i)throw Error(`No previous message to base regeneration on`);C.value={promptPreviousMessageId:i,promptId:t,promptText:``,sessionId:e,agent:n,retryOfMessageId:t,revisionOfMessageId:null,attachments:[]},u.track(`User regenerated chat hub message`,{...T(n.model),is_custom:n.model.provider===`custom-agent`,chat_session_id:e,chat_message_id:t});try{await ie(s.restApiContext,{sessionId:e,retryId:t,payload:a})}catch(e){await Q(e)}}async function je(e){let t=F(e);t&&t.status===`running`&&(W(e,t.id,`cancelled`),await oe(s.restApiContext,e,t.id),C.value?.sessionId===e&&(C.value=void 0,await Z(e)))}function $(e,t){let n=x.value.byId[e];n&&(x.value.byId[e]={...n,...t})}async function Me(e,t){let n=g.value[e];if(!n)throw Error(`Custom agent with ID ${e} not found`);let r=n.toolIds??[],i=r.includes(t)?r.filter(e=>e!==t):[...r,t];g.value[e]={...n,toolIds:i},await b(s.restApiContext,e,{toolIds:i})}async function Ne(e,t){let n=x.value?.byId[e];if(!n)throw Error(`Session with ID ${e} not found`);let r=n.toolIds??[],i=r.includes(t)?r.filter(e=>e!==t):[...r,t];$(e,(await v(s.restApiContext,e,{toolIds:i})).session)}async function Pe(e,t){$(e,(await ce(s.restApiContext,e,t)).session)}async function Fe(e,t,n){$(e,(await v(s.restApiContext,e,{agent:{model:t,name:n}})).session)}async function Ie(e){await le(s.restApiContext,e),delete x.value.byId[e],x.value.ids=x.value.ids?.filter(t=>t!==e)??null}function Le(e,t){let n=M(e);if(!n?.messages[t])throw Error(`Message with ID ${t} not found in session ${e}`);n.activeMessageChain=L(n.messages,t)}async function Re(e){let t=await ue(s.restApiContext,e);g.value[e]=t}function ze(e){return p.value?.[`custom-agent`].models.find(t=>`agentId`in t&&t.agentId===e)}async function Be(e,t){let n=await de(s.restApiContext,e),r=p.value?.[n.provider]?.models.find(e=>e.name===n.model),i={model:{provider:`custom-agent`,agentId:n.id},name:n.name,description:n.description??null,icon:n.icon,createdAt:n.createdAt,updatedAt:n.updatedAt,metadata:r?.metadata??{capabilities:{functionCalling:!1},inputModalities:[],available:!0},groupName:null,groupIcon:null};return p.value?.[`custom-agent`].models.push(i),g.value[n.id]=n,await Y(t),u.track(`User created agent`,{...T(e)}),i}async function Ve(e,t,n){let r=await b(s.restApiContext,e,t);return p.value?.[`custom-agent`]&&(p.value[`custom-agent`].models=p.value[`custom-agent`].models.map(t=>`agentId`in t&&t.agentId===e?{...t,name:r.name}:t)),g.value[e]=r,await Y(n),r}async function He(e,t){await fe(s.restApiContext,e),p.value?.[`custom-agent`]&&(p.value[`custom-agent`].models=p.value[`custom-agent`].models.filter(t=>!(`agentId`in t)||t.agentId!==e)),delete g.value[e],await Y(t)}function Ue(e,t){return p.value?.[e.provider]?.models.find(t=>be(t,e))||R(e,t)}async function We(){try{w.value=!0,D.value=await pe(s.restApiContext)}finally{w.value=!1}return D.value}async function Ge(e){let t=await me(s.restApiContext,e);return D.value&&(D.value[e]=o(t)),t}async function Ke(e){e.enabled||(e.allowedModels=[]);let t=await he(s.restApiContext,e);return D.value&&(D.value[e.provider]=o(t)),t}function qe(e){let{sessionId:t,messageId:n,previousMessageId:r,retryOfMessageId:i}=e;C.value?.sessionId===t&&(C.value.messageId=n,C.value.promptPreviousMessageId=r,C.value.retryOfMessageId=i);let a=M(t);if(a?.messages[n])return;r&&a?.messages[r]?.status===`waiting`&&W(t,r,`success`);let o=A(t,n,C.value?.sessionId===t?C.value:void 0);o.previousMessageId=r,o.retryOfMessageId=i,B(t,o)}function Je(e){let{sessionId:t,messageId:n,content:r}=e;M(t)?.messages[n]||Ee(t,n),H(t,n,r)}function Ye(e){let{sessionId:t,messageId:n,status:r}=e;W(t,n,r)}function Xe(e){let{sessionId:t,messageId:n,error:r}=e,i=Ee(t,n);i.content?i.content=U(i.content,`

`+r):i.content=[{type:`text`,content:r}],i.status=`error`,W(t,n,`error`,i.content)}function Ze(e){let{sessionId:t}=e;if(C.value?.sessionId===t)return;let n=x.value.byId[t];if(!n)return;let r=E(n);r&&(C.value={promptPreviousMessageId:null,promptId:``,promptText:``,sessionId:t,retryOfMessageId:null,revisionOfMessageId:null,attachments:[],agent:Ue(r,{name:n.agentName,icon:n.agentIcon})})}function Qe(e){let{sessionId:t,status:n}=e;if(C.value?.sessionId===t){let e=C.value.sessionId;if(C.value.messageId){let e=M(t)?.messages[C.value.messageId];e&&e.status===`running`&&W(t,C.value.messageId,n)}C.value=void 0,n===`error`&&l.showError(Error(`Execution failed`),f.baseText(`chatHub.error.unknown`)),Z(e)}}async function $e(e,t){try{let n=await ae(s.restApiContext,e,t);if(n.pendingChunks&&n.pendingChunks.length>0)for(let t of n.pendingChunks)n.currentMessageId&&H(e,n.currentMessageId,t.content);return n}catch{return null}}function et(e){let t=j.value.get(e.sessionId);if(!t||t.messages[e.messageId])return;let n={id:e.messageId,sessionId:e.sessionId,type:`human`,name:`User`,content:[{type:`text`,content:e.content}],previousMessageId:e.previousMessageId,retryOfMessageId:null,revisionOfMessageId:null,status:`success`,attachments:e.attachments.map(e=>({fileName:e.fileName,mimeType:e.mimeType})),provider:null,model:null,workflowId:null,agentId:null,executionId:null,createdAt:new Date(e.timestamp).toISOString(),updatedAt:new Date(e.timestamp).toISOString(),responses:[],alternatives:[]};B(e.sessionId,n)}function tt(e){let t=j.value.get(e.sessionId);if(!t||t.messages[e.messageId])return;let n=t.messages[e.revisionOfMessageId],r={id:e.messageId,sessionId:e.sessionId,type:`human`,name:n?.name??`User`,content:[{type:`text`,content:e.content}],previousMessageId:n?.previousMessageId??null,retryOfMessageId:null,revisionOfMessageId:e.revisionOfMessageId,status:`success`,attachments:e.attachments.map(e=>({fileName:e.fileName,mimeType:e.mimeType})),provider:n?.provider??null,model:n?.model??null,workflowId:n?.workflowId??null,agentId:n?.agentId??null,executionId:null,createdAt:new Date(e.timestamp).toISOString(),updatedAt:new Date(e.timestamp).toISOString(),responses:[],alternatives:[]};B(e.sessionId,r)}return{agents:e(()=>p.value??c),agentsReady:e(()=>p.value!==null),customAgents:g,getAgent:Ue,fetchAgents:Y,getCustomAgent:ze,fetchCustomAgent:Re,createCustomAgent:Be,updateCustomAgent:Ve,deleteCustomAgent:He,configuredTools:O,configuredToolsLoaded:k,fetchConfiguredTools:G,addConfiguredTool:K,updateConfiguredTool:q,toggleToolEnabled:J,removeConfiguredTool:Ce,sessions:x,sessionsReady:e(()=>x.value.ids!==null),sessionsLoading:e(()=>S.value),fetchSessions:X,fetchMoreSessions:we,renameSession:Pe,updateSessionModel:Fe,deleteSession:Ie,toggleSessionTool:Ne,toggleCustomAgentTool:Me,conversationsBySession:j,getConversation:M,fetchMessages:Te,getActiveMessages:N,switchAlternative:Le,lastMessage:F,streaming:C,isResponding:I,sendMessage:Oe,editMessage:ke,regenerateMessage:Ae,stopStreamingMessage:je,settings:D,settingsLoading:w,fetchAllChatSettings:We,fetchProviderSettings:Ge,updateProviderSettings:Ke,handleWebSocketExecutionBegin:Ze,handleWebSocketExecutionEnd:Qe,handleWebSocketStreamBegin:qe,handleWebSocketStreamChunk:Je,handleWebSocketStreamEnd:Ye,handleWebSocketStreamError:Xe,handleHumanMessageCreated:et,handleMessageEdited:tt,reconnectToStream:$e}});export{_ as C,x as S,I as _,D as a,E as b,k as c,N as d,z as f,H as g,B as h,F as i,w as l,M as m,Y as n,P as o,j as p,R as r,T as s,X as t,C as u,V as v,L as x,O as y};
//# sourceMappingURL=chat.store-a0NAXg9S.js.map