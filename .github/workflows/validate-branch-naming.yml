name: Validate Branch Naming

on:
  pull_request:
    types: [opened, reopened, synchronize]

jobs:
  validate-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Check branch name
        run: |
          BRANCH_NAME="${{ github.head_ref }}"
          echo "Checking branch: $BRANCH_NAME"

          # Allow:
          # 1. jules/arch-*, jules/fix-*, jules/data-*, jules/ui-*
          # 2. branch-* (legacy/simple)
          # 3. fix/* (generic fixes)

          if [[ "$BRANCH_NAME" =~ ^jules/(arch|fix|data|ui)- ]]; then
            echo "✅ Valid Jules branch name"
            exit 0
          fi

          if [[ "$BRANCH_NAME" =~ ^branch- ]]; then
            echo "✅ Valid simple branch name"
            exit 0
          fi

          if [[ "$BRANCH_NAME" =~ ^fix/ ]]; then
            echo "✅ Valid fix branch name"
            exit 0
          fi

          echo "❌ Error: The branch '$BRANCH_NAME' does not follow conventions."
          echo "Allowed patterns:"
          echo "  - jules/arch-*, jules/fix-*, jules/data-*, jules/ui-*"
          echo "  - branch-*"
          echo "  - fix/*"
          exit 1
