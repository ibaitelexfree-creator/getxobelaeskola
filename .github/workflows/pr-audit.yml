name: "‚öñÔ∏è IA Tribunal PR Audit"

on:
    pull_request:
        types: [opened, synchronize, reopened]

jobs:
    audit:
        runs-on: ubuntu-latest
        if: github.event.pull_request.draft == false
        steps:
            - name: "üöÄ Trigger IA Tribunal via n8n"
              env:
                WEBHOOK_URL: ${{ secrets.N8N_WEBHOOK_URL }}
              run: |
                  if [ -z "$WEBHOOK_URL" ]; then
                    echo "‚ö†Ô∏è N8N_WEBHOOK_URL secret is not set. Skipping audit trigger."
                    exit 0
                  fi

                  curl -X POST "${WEBHOOK_URL}/webhook/github-pr-audit" \
                    -H "Content-Type: application/json" \
                    -d '{
                      "number": "${{ github.event.pull_request.number }}",
                      "title": ${{ toJSON(github.event.pull_request.title) }},
                      "description": ${{ toJSON(github.event.pull_request.body) }},
                      "repository": "${{ github.repository }}",
                      "sender": "${{ github.event.sender.login }}",
                      "branch": "${{ github.event.pull_request.head.ref }}"
                    }'
