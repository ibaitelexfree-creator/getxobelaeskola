name: "‚öñÔ∏è IA Tribunal PR Audit"
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  workflow_dispatch: {}
    pull_request:
        types: [opened, synchronize, reopened]

jobs:
    audit:
        runs-on: ubuntu-latest
        if: github.event.pull_request.draft == false
        steps:
            - name: "üöÄ Trigger IA Tribunal via n8n"
              run: |
                  curl -X POST "${{ secrets.N8N_WEBHOOK_URL }}/webhook/github-pr-audit" \
                    -H "Content-Type: application/json" \
                    -d '{
                      "number": "${{ github.event.pull_request.number }}",
                      "title": ${{ toJSON(github.event.pull_request.title) }},
                      "description": ${{ toJSON(github.event.pull_request.body) }},
                      "repository": "${{ github.repository }}",
                      "sender": "${{ github.event.sender.login }}",
                      "branch": "${{ github.event.pull_request.head.ref }}"
                    }'
