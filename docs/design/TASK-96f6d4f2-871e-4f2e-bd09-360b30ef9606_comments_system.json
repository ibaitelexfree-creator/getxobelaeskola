{
  "schema_sql": "CREATE TABLE IF NOT EXISTS public.comments (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,\n    resource_id UUID NOT NULL,\n    resource_type TEXT NOT NULL,\n    content TEXT NOT NULL,\n    created_at TIMESTAMPTZ DEFAULT NOW(),\n    updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- RLS Policies\nALTER TABLE public.comments ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Public read access\" ON public.comments FOR SELECT USING (true);\nCREATE POLICY \"Authenticated create access\" ON public.comments FOR INSERT WITH CHECK (auth.uid() = user_id);\nCREATE POLICY \"Owner delete access\" ON public.comments FOR DELETE USING (auth.uid() = user_id);\n",
  "openapi_yaml": "openapi: 3.0.0\ninfo:\n  title: Comments API\n  version: 1.0.0\npaths:\n  /api/comments:\n    get:\n      summary: List comments\n      parameters:\n        - name: resource_id\n          in: query\n          required: true\n          schema:\n            type: string\n            format: uuid\n      responses:\n        '200':\n          description: List of comments\n    post:\n      summary: Create a comment\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              type: object\n              properties:\n                resource_id:\n                  type: string\n                  format: uuid\n                resource_type:\n                  type: string\n                content:\n                  type: string\n      responses:\n        '201':\n          description: Comment created\n  /api/comments/{id}:\n    delete:\n      summary: Delete a comment\n      parameters:\n        - name: id\n          in: path\n          required: true\n          schema:\n            type: string\n            format: uuid\n      responses:\n        '204':\n          description: Comment deleted\n",
  "dependencies": [
    "zod"
  ],
  "vote": "OK",
  "vote_reason": "Standard schema design proposed. The prompt mentions a duplicate column issue in an existing table, but no such table exists in the codebase. I am proposing a clean, new table structure. If a migration is needed later, it can be added.",
  "confidence": 95,
  "architectural_notes": "The prompt claims a 'comments' table exists with a duplicate column. A thorough search of the codebase (`grep -r \"comments\"`) revealed no such table definition in `supabase/migrations` or `src/`. Therefore, I am proceeding with a fresh design for `public.comments`. If a legacy table exists in a production database not reflected in the code, a migration strategy (rename/migrate data) will be required during implementation."
}