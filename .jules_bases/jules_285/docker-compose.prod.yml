services:
  orchestrator:
    build:
      context: ./orchestration
      dockerfile: Dockerfile
    image: nodejs-orchestrator:prod
    container_name: orchestrator
    restart: always
    environment:
      - NODE_ENV=production
      - PORT=3323
      - REDIS_URL=redis://redis:6379
      # Add other environment variables here as needed
      # - JULES_API_KEY=${JULES_API_KEY}
      # - GITHUB_TOKEN=${GITHUB_TOKEN}
    ports:
      - "3323:3323"
    volumes:
      - orchestrator_state:/usr/src/app/state
    networks:
      - orchestrator_net
    depends_on:
      - redis
      - qdrant

  redis:
    image: redis:alpine
    container_name: redis
    restart: always
    volumes:
      - redis_data:/data
    networks:
      - orchestrator_net

  qdrant:
    image: qdrant/qdrant
    container_name: qdrant
    restart: always
    ports:
      - "6333:6333"
    volumes:
      - qdrant_storage:/qdrant/storage
    networks:
      - orchestrator_net

networks:
  orchestrator_net:
    driver: bridge

volumes:
  orchestrator_state:
  redis_data:
  qdrant_storage:
